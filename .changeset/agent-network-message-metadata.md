---
'@mastra/core': minor
---

Added source metadata to all messages in agent networks, so UIs can identify the origin of each message.

**Why:** Previously, messages created during agent network execution (routing-agent prompts, agent results, workflow/tool results) had no metadata to distinguish them from real user messages. The routing agent's prompt to a sub-agent was a bare `{ role: 'user', content: '...' }` — identical to human input.

**What's new:**

- All messages now include `content.metadata.source` with one of three values:
  - `'user'` — actual human input
  - `'routing-agent'` — prompt generated by the routing agent for a sub-agent
  - `'agent-network'` — results, feedback, and bookkeeping from network execution
- Routing-agent messages include `primitiveId`, `primitiveType`, and `selectionReason`
- Agent/workflow/tool result messages always include `primitiveId` and `primitiveType` (previously only set when approval/suspension was involved)
- Non-string user messages now also receive `metadata.source = 'user'` when saved

```ts
// Example: distinguish message sources in a UI
for (const msg of messages) {
  const meta = msg.content.metadata;
  if (meta?.source === 'user') {
    // Real human input
  } else if (meta?.source === 'routing-agent') {
    // Dispatcher's rewritten prompt — meta.primitiveId tells you which agent
  } else if (meta?.source === 'agent-network') {
    // Network result — meta.primitiveId tells you which primitive produced it
  }
}
```
