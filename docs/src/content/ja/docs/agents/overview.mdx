---
title: "ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ¦‚è¦ | Agents | Mastra ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ"
description: Mastra ã«ãŠã‘ã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æ¦‚è¦ã€‚ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æ©Ÿèƒ½ã‚„ã€ãƒ„ãƒ¼ãƒ«ã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã€å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æºæ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚
---

import { Steps, Callout, Tabs } from "nextra/components";


# ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ä½¿ç”¨

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ LLM ã¨ãƒ„ãƒ¼ãƒ«ã‚’æ´»ç”¨ã—ã¦ã€ã‚ªãƒ¼ãƒ—ãƒ³ã‚¨ãƒ³ãƒ‰ãªã‚¿ã‚¹ã‚¯ã‚’è§£æ±ºã—ã¾ã™ã€‚ç›®æ¨™ã‚’è¸ã¾ãˆã¦æ¨è«–ã—ã€ä½¿ã†ãƒ„ãƒ¼ãƒ«ã‚’é¸ã³ã€ä¼šè©±ã®è¨˜æ†¶ã‚’ä¿æŒã—ã€ãƒ¢ãƒ‡ãƒ«ãŒæœ€çµ‚çš„ãªå›ç­”ã‚’å‡ºã™ã‹ä»»æ„ã®åœæ­¢æ¡ä»¶ã‚’æº€ãŸã™ã¾ã§å†…éƒ¨ã§åå¾©ã—ã¾ã™ã€‚ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ UI ã§è¡¨ç¤ºã—ãŸã‚Šãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‹ã‚‰å‡¦ç†ã—ãŸã‚Šã§ãã‚‹æ§‹é€ åŒ–ã•ã‚ŒãŸå¿œç­”ã‚’ç”Ÿæˆã—ã¾ã™ã€‚ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å˜ä½“ã§ä½¿ã†ã“ã¨ã‚‚ã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«çµ„ã¿è¾¼ã‚€ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

![ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æ¦‚è¦](/image/agents/agents-overview.jpg)

> **ğŸ“¹ è¦–è´**:  â†’ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ç´¹ä»‹ã¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¨ã®æ¯”è¼ƒ [YouTubeï¼ˆ7åˆ†ï¼‰](https://youtu.be/0jg2g3sNvgw)

## ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

<Tabs items={["Mastra model router", "Vercel AI SDK"]}>
  <Tabs.Tab>
    <Steps>
### ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ [#install-dependencies-mastra-router]

Mastra ã®ã‚³ã‚¢ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«è¿½åŠ ã—ã¾ã™ï¼š

```bash
npm install @mastra/core
```

### API ã‚­ãƒ¼ã‚’è¨­å®šã™ã‚‹ [#set-api-key-mastra-router]

Mastra ã®ãƒ¢ãƒ‡ãƒ«ãƒ«ãƒ¼ã‚¿ãƒ¼ã¯ã€é¸æŠã—ãŸãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å‘ã‘ã®ç’°å¢ƒå¤‰æ•°ã‚’è‡ªå‹•æ¤œå‡ºã—ã¾ã™ã€‚OpenAI ã®å ´åˆã¯ `OPENAI_API_KEY` ã‚’è¨­å®šã—ã¾ã™ï¼š

```bash filename=".env" copy
OPENAI_API_KEY=<your-api-key>
```

> Mastra ã¯ 600 ä»¥ä¸Šã®ãƒ¢ãƒ‡ãƒ«ã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚å…¨ãƒªã‚¹ãƒˆã¯[ã“ã¡ã‚‰](/models)ã‹ã‚‰ã”ç¢ºèªãã ã•ã„ã€‚

### ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ [#creating-an-agent-mastra-router]

ã‚·ã‚¹ãƒ†ãƒ ã® `instructions` ã¨ `model` ã‚’æŒ‡å®šã—ã¦ `Agent` ã‚¯ãƒ©ã‚¹ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ï¼š

```typescript filename="src/mastra/agents/test-agent.ts" showLineNumbers copy
import { Agent } from "@mastra/core/agent";

export const testAgent = new Agent({
  name: "test-agent",
  instructions: "You are a helpful assistant.",
  model: "openai/gpt-4o-mini"
});
```
    </Steps>
  </Tabs.Tab>
  <Tabs.Tab>
    <Steps>

### ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ [#install-dependencies-ai-sdk]

ä½¿ç”¨ã™ã‚‹ Vercel AI SDK ã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«åˆã‚ã›ã¦ã€Mastra ã®ã‚³ã‚¢ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è¿½åŠ ã—ã¾ã™ï¼š

```bash
npm install @mastra/core @ai-sdk/openai
```

### API ã‚­ãƒ¼ã‚’è¨­å®šã™ã‚‹ [#set-api-key-ai-sdk]

åˆ©ç”¨ã™ã‚‹ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«å¯¾å¿œã™ã‚‹ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¾ã™ã€‚AI SDK çµŒç”±ã§ OpenAI ã‚’ä½¿ã†å ´åˆï¼š

```bash filename=".env" copy
OPENAI_API_KEY=<your-api-key>
```

> è¿½åŠ ã®è¨­å®šé …ç›®ã¯ã€Vercel AI SDK ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã® [AI SDK Providers](https://ai-sdk.dev/providers/ai-sdk-providers) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ [#creating-an-agent-ai-sdk]

Mastra ã§ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ã«ã¯ `Agent` ã‚¯ãƒ©ã‚¹ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã¯ã€å‹•ä½œã‚’å®šç¾©ã™ã‚‹ `instructions` ã¨ã€LLM ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã¨ãƒ¢ãƒ‡ãƒ«ã‚’æŒ‡å®šã™ã‚‹ `model` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒå¿…è¦ã§ã™ã€‚Vercel AI SDK ã‚’ä½¿ã†å ´åˆã¯ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã® `model` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’æ¸¡ã—ã¾ã™ï¼š

```typescript filename="src/mastra/agents/test-agent.ts" showLineNumbers copy
import { openai } from "@ai-sdk/openai";
import { Agent } from "@mastra/core/agent";

export const testAgent = new Agent({
  name: "test-agent",
  instructions: "You are a helpful assistant.",
  model: openai("gpt-4o-mini")
});
```
    </Steps>
  </Tabs.Tab>
</Tabs>

#### å‘½ä»¤ã®å½¢å¼

å‘½ä»¤ã¯ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æŒ¯ã‚‹èˆã„ãƒ»äººæ ¼ãƒ»èƒ½åŠ›ã‚’å®šç¾©ã—ã¾ã™ã€‚
ã“ã‚Œã¯ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ä¸­æ ¸ã¨ãªã‚‹ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨å°‚é–€æ€§ã‚’ç¢ºç«‹ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ãƒ¬ãƒ™ãƒ«ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§ã™ã€‚

æŸ”è»Ÿæ€§ã‚’é«˜ã‚ã‚‹ãŸã‚ã€å‘½ä»¤ã¯è¤‡æ•°ã®å½¢å¼ã§æä¾›ã§ãã¾ã™ã€‚ä»¥ä¸‹ã®ä¾‹ã¯ã€ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹å½¢å¼ã‚’ç¤ºã—ã¾ã™ã€‚

```typescript copy
// æ–‡å­—åˆ—ï¼ˆæœ€ã‚‚ä¸€èˆ¬çš„ï¼‰
instructions: "ã‚ãªãŸã¯è¦ªåˆ‡ãªã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚"

// æ–‡å­—åˆ—ã®é…åˆ—
instructions: [
  "ã‚ãªãŸã¯è¦ªåˆ‡ãªã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚",
  "å¸¸ã«ä¸å¯§ã«å¯¾å¿œã—ã¦ãã ã•ã„ã€‚",
  "è©³ç´°ãªå›ç­”ã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚"
]

// ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é…åˆ—
instructions: [
  { role: "system", content: "ã‚ãªãŸã¯è¦ªåˆ‡ãªã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚" },
  { role: "system", content: "ã‚ãªãŸã¯TypeScriptã®å°‚é–€çŸ¥è­˜ã‚’æŒã£ã¦ã„ã¾ã™ã€‚" }
]
```


#### ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å›ºæœ‰ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³

å„ãƒ¢ãƒ‡ãƒ«ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã§ã¯ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚„æ¨è«–è¨­å®šãªã©ã€ã„ãã¤ã‹ç•°ãªã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚‚åˆ©ç”¨ã§ãã¾ã™ã€‚ã“ã‚Œã‚‰ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã« `providerOptions` ãƒ•ãƒ©ã‚°ã‚’ç”¨æ„ã—ã¦ã„ã¾ã™ã€‚`providerOptions` ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚·ãƒ§ãƒ³å˜ä½ã§è¨­å®šã§ãã€å„ã‚·ã‚¹ãƒ†ãƒ ã‚¤ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚·ãƒ§ãƒ³ï¼ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã”ã¨ã«ç•°ãªã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã‚’æŒ‡å®šã§ãã¾ã™ã€‚

```typescript copy
// ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å›ºæœ‰ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³(ä¾‹:ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°ã€æ¨è«–)
instructions: {
  role: "system",
  content:
    "ã‚ãªãŸã¯ç†Ÿç·´ã—ãŸã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼ã§ã™ã€‚ãƒã‚°ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å•é¡Œã€ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«ã¤ã„ã¦ã‚³ãƒ¼ãƒ‰ã‚’åˆ†æã—ã¦ãã ã•ã„ã€‚",
  providerOptions: {
    openai: { reasoningEffort: "high" },        // OpenAIã®æ¨è«–ãƒ¢ãƒ‡ãƒ«
    anthropic: { cacheControl: { type: "ephemeral" } }  // Anthropicã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°
  }
}
```

> è©³ç´°ã¯ [Agent ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](../../reference/agents/agent.mdx) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚


### ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ç™»éŒ²

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã§åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã€Mastra ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ç™»éŒ²ã—ã¾ã™ã€‚ç™»éŒ²ã™ã‚‹ã¨ã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚„ãƒ„ãƒ¼ãƒ«ã€ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‹ã‚‰å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«ãªã‚Šã€ãƒ¡ãƒ¢ãƒªã€ãƒ­ã‚®ãƒ³ã‚°ã€ã‚ªãƒ–ã‚¶ãƒ¼ãƒãƒ“ãƒªãƒ†ã‚£æ©Ÿèƒ½ãªã©ã®å…±æœ‰ãƒªã‚½ãƒ¼ã‚¹ã«ã‚‚ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚

```typescript {6} showLineNumbers filename="src/mastra/index.ts" copy
import { Mastra } from "@mastra/core/mastra";
import { testAgent } from './agents/test-agent';

export const mastra = new Mastra({
  // ...
  agents: { testAgent },
});
```


## ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å‚ç…§

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ã‚¹ãƒ†ãƒƒãƒ—ã€ãƒ„ãƒ¼ãƒ«ã€Mastra Clientã€ã¾ãŸã¯ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å‘¼ã³å‡ºã›ã¾ã™ã€‚ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã«å¿œã˜ã¦ã€`mastra` ã¾ãŸã¯ `mastraClient` ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§ `.getAgent()` ã‚’å‘¼ã³å‡ºã—ã€å‚ç…§ã‚’å–å¾—ã—ã¾ã™ã€‚

```typescript showLineNumbers copy
const testAgent = mastra.getAgent("testAgent");
```

<Callout type="info">
  <p>
    `mastra.getAgent()` ã®ä½¿ç”¨ã‚’ã€ç›´æ¥ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚ˆã‚Šã‚‚æ¨å¥¨ã—ã¾ã™ã€‚Mastra ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®è¨­å®šï¼ˆloggerã€telemetryã€storageã€ç™»éŒ²æ¸ˆã¿ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã€ãƒ™ã‚¯ãƒˆãƒ«ã‚¹ãƒˆã‚¢ï¼‰ã¸ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãŸã‚ã§ã™ã€‚
  </p>
</Callout>

> è©³ç´°ã¯ [Calling agents](../../examples/agents/calling-agents.mdx) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚


## ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ç”Ÿæˆ

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯çµæœã‚’è¿”ã™æ–¹æ³•ã¨ã—ã¦ã€è¿”å´å‰ã«å‡ºåŠ›ã‚’ã™ã¹ã¦ç”Ÿæˆã—ã¦ã‹ã‚‰è¿”ã™ã‹ã€ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã™ã‚‹ã‹ã®2é€šã‚ŠãŒã‚ã‚Šã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«åˆã†æ–¹æ³•ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚çŸ­ã„å†…éƒ¨å‘ã‘ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚„ãƒ‡ãƒãƒƒã‚°ã«ã¯ç”Ÿæˆã‚’ã€ã‚¨ãƒ³ãƒ‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã§ãã‚‹ã ã‘æ—©ãç”»é¢ã‚’å±Šã‘ã‚‹ã«ã¯ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚’ä½¿ã„ã¾ã™ã€‚

<Tabs items={["Generate", "Stream"]}>
  <Tabs.Tab>
ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«ã¯å˜ä¸€ã®æ–‡å­—åˆ—ã‚’ã€è¤‡æ•°ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’æ¸¡ã™å ´åˆã¯æ–‡å­—åˆ—ã®é…åˆ—ã‚’ã€ã¾ãŸã¯ `role` ã¨ `content` ã‚’æŒã¤ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é…åˆ—ã‚’æ¸¡ã—ã¾ã™ã€‚

ï¼ˆ`role` ã¯å„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è©±è€…ã‚’ç¤ºã—ã¾ã™ã€‚ä¸€èˆ¬çš„ãªãƒ­ãƒ¼ãƒ«ã¯ã€äººé–“ã®å…¥åŠ›ã‚’è¡¨ã™ `user`ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å¿œç­”ã‚’è¡¨ã™ `assistant`ã€æŒ‡ç¤ºã‚’è¡¨ã™ `system` ã§ã™ã€‚ï¼‰

```typescript showLineNumbers copy
const response = await testAgent.generate([
  { role: "user", content: "Help me organize my day" },
  { role: "user", content: "My day starts at 9am and finishes at 5.30pm" },
  { role: "user", content: "I take lunch between 12:30 and 13:30" },
  { role: "user", content: "I have meetings Monday to Friday between 10:30 and 11:30" }
]);

console.log(response.text);
```
  </Tabs.Tab>
  <Tabs.Tab>
ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«ã¯å˜ä¸€ã®æ–‡å­—åˆ—ã‚’ã€è¤‡æ•°ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’æ¸¡ã™å ´åˆã¯æ–‡å­—åˆ—ã®é…åˆ—ã‚’ã€ã¾ãŸã¯ `role` ã¨ `content` ã‚’æŒã¤ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é…åˆ—ã‚’æ¸¡ã—ã¾ã™ã€‚

ï¼ˆ`role` ã¯å„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è©±è€…ã‚’ç¤ºã—ã¾ã™ã€‚ä¸€èˆ¬çš„ãªãƒ­ãƒ¼ãƒ«ã¯ã€äººé–“ã®å…¥åŠ›ã‚’è¡¨ã™ `user`ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å¿œç­”ã‚’è¡¨ã™ `assistant`ã€æŒ‡ç¤ºã‚’è¡¨ã™ `system` ã§ã™ã€‚ï¼‰

```typescript showLineNumbers copy
const stream = await testAgent.stream([
  { role: "user", content: "Help me organize my day" },
  { role: "user", content: "My day starts at 9am and finishes at 5.30pm" },
  { role: "user", content: "I take lunch between 12:30 and 13:30" },
  { role: "user", content: "I have meetings Monday to Friday between 10:30 and 11:30" }
]);

for await (const chunk of stream.textStream) {
  process.stdout.write(chunk);
}
```

### `onFinish()` ã‚’ä½¿ã£ãŸå®Œäº†å‡¦ç†

ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã™ã‚‹å ´åˆã€`onFinish()` ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯ LLM ãŒãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ç”Ÿæˆã‚’çµ‚ãˆã€ã™ã¹ã¦ã®ãƒ„ãƒ¼ãƒ«å®Ÿè¡ŒãŒå®Œäº†ã—ãŸå¾Œã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
ã“ã‚Œã«ã‚ˆã‚Šã€æœ€çµ‚çš„ãª `text`ã€å®Ÿè¡Œã® `steps`ã€`finishReason`ã€ãƒˆãƒ¼ã‚¯ãƒ³ã® `usage` çµ±è¨ˆã€ãã—ã¦ç›£è¦–ã‚„ãƒ­ã‚°è¨˜éŒ²ã«å½¹ç«‹ã¤ãã®ä»–ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãŒæä¾›ã•ã‚Œã¾ã™ã€‚

```typescript showLineNumbers copy
const stream = await testAgent.stream("Help me organize my day", {
  onFinish: ({ steps, text, finishReason, usage }) => {
    console.log({ steps, text, finishReason, usage });
  }
});

for await (const chunk of stream.textStream) {
  process.stdout.write(chunk);
}
```
  </Tabs.Tab>
</Tabs>

> è©³ç´°ã¯ [.generate()](../../reference/agents/generate.mdx) ã¾ãŸã¯ [.stream()](../../reference/agents/stream.mdx) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## æ§‹é€ åŒ–å‡ºåŠ›

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ã€æœŸå¾…ã™ã‚‹å‡ºåŠ›ã‚’ [Zod](https://zod.dev/) ã¾ãŸã¯ [JSON Schema](https://json-schema.org/) ã§å®šç¾©ã™ã‚‹ã“ã¨ã§ã€æ§‹é€ åŒ–ã•ã‚ŒãŸå‹å®‰å…¨ãªãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã›ã¾ã™ã€‚TypeScript ã®ã‚µãƒãƒ¼ãƒˆã¨é–‹ç™ºä½“é¨“ã®è¦³ç‚¹ã‹ã‚‰ã¯ Zod ã‚’æ¨å¥¨ã—ã¾ã™ã€‚ãƒ‘ãƒ¼ã‚¹æ¸ˆã¿ã®çµæœã¯ `response.object` ã§å‚ç…§ã§ãã€æ¤œè¨¼æ¸ˆã¿ã‹ã¤å‹ä»˜ã‘ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ãã®ã¾ã¾æ‰±ãˆã¾ã™ã€‚

### Zod ã‚’ä½¿ã†

[Zod](https://zod.dev/) ã‚’ä½¿ã£ã¦ `output` ã®ã‚¹ã‚­ãƒ¼ãƒã‚’å®šç¾©ã—ã¾ã™ï¼š

```typescript showLineNumbers copy
import { z } from "zod";

const response = await testAgent.generate(
  [
    {
      role: "system",
      content: "ä»¥ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã®è¦ç´„ã¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æä¾›ã—ã¦ãã ã•ã„:"
    },
    {
      role: "user",
      content: "ã‚µãƒ«ã€ã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ ã€ãƒœãƒ¼ãƒˆ"
    }
  ],
  {
    structuredOutput: {
      schema: z.object({
        summary: z.string(),
        keywords: z.array(z.string())
      })
    },
  }
);

console.log(response.object);
```


### ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã‚’åˆ©ç”¨ã™ã‚‹

`model` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¨­å®šã—ã¦ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã‚’ä¼´ã†è¤‡æ•°æ®µéšã® LLM å‘¼ã³å‡ºã—ã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```typescript showLineNumbers copy
import { z } from "zod";

const response = await testAgentWithTools.generate(
  [
    {
      role: "system",
      content: "æ¬¡ã®ãƒ†ã‚­ã‚¹ãƒˆã®è¦ç´„ã¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æä¾›ã—ã¦ãã ã•ã„:"
    },
    {
      role: "user",
      content: "ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦çµæœã‚’æ•™ãˆã¦ãã ã•ã„"
    }
  ],
  {
    structuredOutput: {
      schema: z.object({
        summary: z.string(),
        keywords: z.array(z.string())
      }),
      model: "openai/gpt-4o"
    },
  }
);

console.log(response.object);
console.log(response.toolResults)
```


### ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€`structuredOutput` ã¯ã‚¹ã‚­ãƒ¼ãƒã‚’ãƒ¢ãƒ‡ãƒ«ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«æ¸¡ã™ãŸã‚ã« `response_format` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ãƒ¢ãƒ‡ãƒ«ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ãŒ `response_format` ã‚’ãƒã‚¤ãƒ†ã‚£ãƒ–ã«ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„å ´åˆã€ã‚¨ãƒ©ãƒ¼ã«ãªã£ãŸã‚Šã€æœŸå¾…ã—ãŸçµæœãŒå¾—ã‚‰ã‚Œãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚åŒã˜ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ã„ç¶šã‘ã‚‹ã«ã¯ã€`jsonPromptInjection` ã‚’ä½¿ç”¨ã—ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ã€ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ³¨å…¥ã—ã¦ã€ãƒ¢ãƒ‡ãƒ«ã«æ§‹é€ åŒ–å‡ºåŠ›ã‚’è¿”ã™ã‚ˆã†ä¿ƒã—ã¦ãã ã•ã„ã€‚

```typescript showLineNumbers copy
import { z } from "zod";

const response = await testAgentThatDoesntSupportStructuredOutput.generate(
  [
    {
      role: "system",
      content: "æ¬¡ã®ãƒ†ã‚­ã‚¹ãƒˆã®è¦ç´„ã¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æä¾›ã—ã¦ãã ã•ã„:"
    },
    {
      role: "user",
      content: "ã‚µãƒ«ã€ã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ ã€ãƒœãƒ¼ãƒˆ"
    }
  ],
  {
    structuredOutput: {
      schema: z.object({
        summary: z.string(),
        keywords: z.array(z.string())
      }),
      jsonPromptInjection: true
    },
  }
);

console.log(response.object);
```


## ç”»åƒã®æ‰±ã„æ–¹

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ã€ç”»åƒã®è¦–è¦šçš„ãªå†…å®¹ã¨å†…éƒ¨ã®ãƒ†ã‚­ã‚¹ãƒˆã®ä¸¡æ–¹ã‚’å‡¦ç†ã—ã€ç”»åƒã‚’åˆ†æã—ã¦èª¬æ˜ã§ãã¾ã™ã€‚ç”»åƒåˆ†æã‚’æœ‰åŠ¹ã«ã™ã‚‹ã«ã¯ã€`content` é…åˆ—ã« `type: 'image'` ã¨ç”»åƒã®URLã‚’å«ã‚€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¸¡ã—ã¦ãã ã•ã„ã€‚ç”»åƒã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ãƒ†ã‚­ã‚¹ãƒˆã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®åˆ†æã‚’èª˜å°ã§ãã¾ã™ã€‚

```typescript showLineNumbers copy
const response = await testAgent.generate([
  {
    role: "user",
    content: [
      {
        type: "image",
        image: "https://placebear.com/cache/395-205.jpg",
        mimeType: "image/jpeg"
      },
      {
        type: "text",
        text: "ç”»åƒã‚’è©³ã—ãèª¬æ˜ã—ã€ç”»åƒå†…ã®ã™ã¹ã¦ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’æŠ½å‡ºã—ã¦ãã ã•ã„ã€‚"
      }
    ]
  }
]);

console.log(response.text);
```

ãƒ„ãƒ¼ãƒ«ã®ä½œæˆã¨è¨­å®šã«é–¢ã™ã‚‹è©³ã—ã„ã‚¬ã‚¤ãƒ‰ã¯ã€[Tools Overview](../tools-mcp/overview.mdx) ãƒšãƒ¼ã‚¸ã‚’ã”è¦§ãã ã•ã„ã€‚


### `maxSteps` ã®ä½¿ç”¨

`maxSteps` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒè¡Œãˆã‚‹é€£ç¶šçš„ãª LLM å‘¼ã³å‡ºã—ã®æœ€å¤§å›æ•°ã‚’åˆ¶å¾¡ã—ã¾ã™ã€‚å„ã‚¹ãƒ†ãƒƒãƒ—ã«ã¯ã€å¿œç­”ã®ç”Ÿæˆã€ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã®å®Ÿè¡Œã€çµæœã®å‡¦ç†ãŒå«ã¾ã‚Œã¾ã™ã€‚ã‚¹ãƒ†ãƒƒãƒ—æ•°ã‚’åˆ¶é™ã™ã‚‹ã“ã¨ã§ã€ç„¡é™ãƒ«ãƒ¼ãƒ—ã®é˜²æ­¢ã€ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ã®ä½æ¸›ã€ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡ã®ç®¡ç†ã«å½¹ç«‹ã¡ã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ 1 ã§ã™ãŒã€å¢—ã‚„ã™ã“ã¨ã‚‚ã§ãã¾ã™:

```typescript showLineNumbers copy
const response = await testAgent.generate("ç§ã®ä¸€æ—¥ã‚’æ•´ç†ã™ã‚‹ã®ã‚’æ‰‹ä¼ã£ã¦", {
  maxSteps: 5
});

console.log(response.text);
```


### `onStepFinish` ã®ä½¿ç”¨

`onStepFinish` ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ä½¿ã†ã¨ã€è¤‡æ•°ã‚¹ãƒ†ãƒƒãƒ—ã®å‡¦ç†ã®é€²è¡ŒçŠ¶æ³ã‚’ç›£è¦–ã§ãã¾ã™ã€‚ãƒ‡ãƒãƒƒã‚°ã‚„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®é€²æ—é€šçŸ¥ã«ä¾¿åˆ©ã§ã™ã€‚

`onStepFinish` ã¯ã€ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ä¸­ã€ã¾ãŸã¯æ§‹é€ åŒ–ã•ã‚Œã¦ã„ãªã„å‡ºåŠ›ã§ãƒ†ã‚­ã‚¹ãƒˆã‚’ç”Ÿæˆã—ã¦ã„ã‚‹å ´åˆã«ã®ã¿åˆ©ç”¨ã§ãã¾ã™ã€‚

```typescript showLineNumbers copy
const response = await testAgent.generate("ä»Šæ—¥ã®äºˆå®šã‚’æ•´ç†ã™ã‚‹ã®ã‚’æ‰‹ä¼ã£ã¦", {
  onStepFinish: ({ text, toolCalls, toolResults, finishReason, usage }) => {
    console.log({ text, toolCalls, toolResults, finishReason, usage });
  }
});
```


## ãƒ„ãƒ¼ãƒ«ã®ä½¿ç”¨

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã†ã“ã¨ã§å˜ãªã‚‹è¨€èªç”Ÿæˆã‚’è¶…ãˆã€å¤–éƒ¨ã® API ã‚„ã‚µãƒ¼ãƒ“ã‚¹ã¨æ§‹é€ åŒ–ã•ã‚ŒãŸã‚„ã‚Šå–ã‚ŠãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚ãƒ„ãƒ¼ãƒ«ã«ã‚ˆã£ã¦ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€æ˜ç¢ºã«å®šç¾©ã•ã‚ŒãŸæ“ä½œã‚’ã€ä¿¡é ¼æ€§ãŒé«˜ãå†ç¾æ€§ã®ã‚ã‚‹æ–¹æ³•ã§å®Ÿè¡Œã§ãã¾ã™ã€‚

```typescript filename="src/mastra/agents/test-agent.ts" showLineNumbers
export const testAgent = new Agent({
  // ...
  tools: { testTool }
});
```

> è©³ç´°ã«ã¤ã„ã¦ã¯ã€[Using Tools](./using-tools.mdx) ã‚’ã”è¦§ãã ã•ã„ã€‚


## `RuntimeContext` ã®ä½¿ç”¨

`RuntimeContext` ã‚’ä½¿ã†ã¨ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã”ã¨ã®å€¤ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«å¿œã˜ã¦æŒ™å‹•ã‚’æ¡ä»¶ä»˜ãã§èª¿æ•´ã§ãã¾ã™ã€‚

```typescript filename="src/mastra/agents/test-agent.ts" showLineNumbers
export type UserTier = {
  "user-tier": "enterprise" | "pro";
};

export const testAgent = new Agent({
  // ...
  model: ({ runtimeContext }) => {
    const userTier = runtimeContext.get("user-tier") as UserTier["user-tier"];

    return userTier === "enterprise"
      ? openai("gpt-4o-mini")
      : openai("gpt-4.1-nano");
  }
});
```

> è©³ã—ãã¯ [Runtime Context](../server-db/runtime-context.mdx) ã‚’ã”è¦§ãã ã•ã„ã€‚


## Mastra Playground ã§ã®ãƒ†ã‚¹ãƒˆ

Mastra ã®[Playground](../server-db/local-dev-playground.mdx)ã‚’ä½¿ã£ã¦ã€ã•ã¾ã–ã¾ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ãƒ†ã‚¹ãƒˆã—ã€ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã‚„ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç¢ºèªã—ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å‹•ä½œã‚’ãƒ‡ãƒãƒƒã‚°ã—ã¾ã™ã€‚

## é–¢é€£é …ç›®

- [ãƒ„ãƒ¼ãƒ«ã®ä½¿ã„æ–¹](./using-tools.mdx)
- [ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ¡ãƒ¢ãƒª](./agent-memory.mdx)
- [ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ](../../examples/agents/runtime-context.mdx)
- [ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å‘¼ã³å‡ºã—](../../examples/agents/calling-agents.mdx)