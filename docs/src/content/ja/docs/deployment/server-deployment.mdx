---
title: "Mastra サーバーをデプロイする"
description: "ビルド設定やデプロイ方法を使って Mastra サーバーをデプロイする手順を学びましょう。"
---

import { FileTree } from "nextra/components";


# Mastra サーバーをデプロイする

Mastra は標準的な Node.js サーバーとして動作し、さまざまな環境にデプロイできます。

## デフォルトのプロジェクト構成

[はじめにガイド](/docs/getting-started/installation)では、すぐに作業を始められるよう、妥当なデフォルト設定のプロジェクトひな型を作成します。標準では、CLI はアプリケーションのファイルを `src/mastra/` ディレクトリ配下に整理し、次のような構成になります。

<FileTree>
  <FileTree.Folder name="src" defaultOpen>
    <FileTree.Folder name="mastra" defaultOpen>
      <FileTree.Folder name="agents" />
      <FileTree.Folder name="tools" />
      <FileTree.Folder name="workflows" />
      <FileTree.File name="index.ts" />
    </FileTree.Folder>
  </FileTree.Folder>
  <FileTree.File name="package.json" />
  <FileTree.File name="tsconfig.json" />
</FileTree>

## ビルド

`mastra build` コマンドでビルドを開始します。

```bash copy
mastra build
```


### 入力ディレクトリのカスタマイズ

Mastra のファイルが別の場所にある場合は、`--dir` フラグを使って場所を指定します。`--dir` フラグは、エントリポイントとなるファイル（`index.ts` または `index.js`）と関連ディレクトリをどこで探すかを Mastra に指示します。

```bash copy
mastra build --dir ./my-project/mastra
```


## ビルドプロセス

ビルドプロセスは次の手順で行われます:

1. **エントリーファイルの特定**: 指定ディレクトリ内の `index.ts` または `index.js` を探索します（デフォルト: `src/mastra/`）。
2. **ビルドディレクトリの作成**: 次を含む `.mastra/` ディレクトリを生成します:
    - **`.build`**: 依存関係の解析結果、バンドル済みの依存関係、ビルド設定ファイルを含みます。
    - **`output`**: `index.mjs`、`instrumentation.mjs`、およびプロジェクト固有のファイルを含む、本番環境向けのアプリケーションバンドルを格納します。
3. **静的アセットのコピー**: 静的ファイル配信用に、`public/` フォルダの内容を `output` ディレクトリへコピーします。
4. **コードのバンドル**: 最適化のため、Rollup を使用してツリーシェイキングとソースマップを有効化します。
5. **サーバーの生成**: デプロイ可能な状態の [Hono](https://hono.dev) 製 HTTP サーバーを作成します。

### ビルド出力の構造

ビルド後、Mastra は次の構造で `.mastra/` ディレクトリを作成します：

<FileTree>
  <FileTree.Folder name=".mastra" defaultOpen>
    <FileTree.Folder name=".build" />
    <FileTree.Folder name="output" />
  </FileTree.Folder>
</FileTree>

### `public` フォルダー

`src/mastra` に `public` フォルダーが存在する場合、ビルド時にその内容は `.build/output` ディレクトリにコピーされます。

## サーバーの実行

HTTP サーバーを起動する:

```bash copy
node .mastra/output/index.mjs
```


## テレメトリーを有効にする

テレメトリーとオブザーバビリティを有効にするには、instrumentation ファイルを読み込みます:

```bash copy
node --import=./.mastra/output/instrumentation.mjs .mastra/output/index.mjs
```
