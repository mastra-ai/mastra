---
title: "DigitalOcean"
description: "Mastra アプリを DigitalOcean にデプロイする。"
---

import { Callout, Steps, Tabs } from "nextra/components";


# DigitalOcean

Mastra アプリケーションを DigitalOcean の App Platform および Droplets にデプロイします。

<Callout>
  このガイドは、デフォルトの
  `npx create-mastra@latest` コマンドで Mastra アプリケーションを作成していることを前提としています。
  新しい Mastra アプリケーションの作成方法について詳しくは、
  [はじめに](./../../getting-started/installation.mdx)をご覧ください。
</Callout>

<Tabs items={["App Platform", "Droplets"]}>

<Tabs.Tab>

## App Platform

### 前提条件 [#app-platform-prerequisites]

- Mastra アプリケーションを含む Git リポジトリ。[GitHub](https://github.com/) や [GitLab](https://gitlab.com/) など、互換性のある任意のソースプロバイダーを利用できます。
- [DigitalOcean アカウント](https://www.digitalocean.com/)

### デプロイ手順

<Steps>

### 新規アプリの作成

- [DigitalOcean ダッシュボード](https://cloud.digitalocean.com/) にログインします。
- [App Platform](https://docs.digitalocean.com/products/app-platform/) サービスに移動します。
- ソースプロバイダーを選択し、新しいアプリを作成します。

### デプロイ元の設定

- リポジトリを接続して選択します。コンテナイメージやサンプルアプリを選ぶこともできます。
- デプロイに使用するブランチを選択します。
- 必要に応じてソースディレクトリを指定します。Mastra アプリがデフォルトのディレクトリ構成の場合は設定不要です。
- 次のステップへ進みます。

### リソース設定と環境変数の構成

- Node.js のビルドは自動検出されるはずです。
- **ビルドコマンドの設定**: App Platform が Mastra プロジェクトを正しくビルドできるよう、カスタムのビルドコマンドを追加します。使用しているパッケージマネージャに合わせて設定してください:

<Tabs items={["npm", "pnpm", "yarn", "bun"]}>
  <Tabs.Tab>
    ```
    npm run build
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```
    pnpm build
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```
    yarn build
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```
    bun run build
    ```
  </Tabs.Tab>
</Tabs>

- Mastra アプリに必要な環境変数を追加します。API キー、データベース URL、その他の設定値などが該当します。
- 必要に応じてリソースのサイズを設定します。
- 任意で、リソースのリージョン、アプリ名（ユニーク）、所属プロジェクトなども設定できます。
- 設定内容と料金見積もりを確認し、問題なければアプリを作成します。

### デプロイ

- アプリは自動的にビルドされ、デプロイされます。
- DigitalOcean からデプロイ済みアプリにアクセスできる URL が提供されます。

</Steps>

これで、DigitalOcean が提供する URL からデプロイ済みアプリにアクセスできます。

<Callout>
DigitalOcean App Platform はエフェメラル（短期）なファイルシステムを使用します。
つまり、ファイルシステムに書き込まれたファイルは短命で、失われる可能性があります。
ファイルシステムを使用する Mastra のストレージプロバイダーの利用は避けてください。
例: ファイル URL を使う `LibSQLStore`
</Callout>

</Tabs.Tab>

<Tabs.Tab>

## Droplets

Mastra アプリケーションを DigitalOcean の Droplets にデプロイします。

### 前提条件 [#droplets-prerequisites]

- [DigitalOcean アカウント](https://www.digitalocean.com/)
- Ubuntu 24+ を実行している [Droplet](https://docs.digitalocean.com/products/droplets/)
- A レコードが Droplet を指すドメイン名
- リバースプロキシの設定（例: [nginx](https://nginx.org/)）
- SSL 証明書の設定（例: [Let's Encrypt](https://letsencrypt.org/)）
- Droplet に Node.js 18+ がインストール済みであること

### デプロイ手順

<Steps>

### Mastra アプリケーションのクローン

Droplet に接続し、リポジトリをクローンします:

<Tabs items={["Public Repository", "Private Repository"]}>
<Tabs.Tab>

```bash copy
git clone https://github.com/<your-username>/<your-repository>.git
```

</Tabs.Tab>

<Tabs.Tab>

```bash copy
git clone https://<your-username>:<your-personal-access-token>@github.com/<your-username>/<your-repository>.git
```

</Tabs.Tab>
</Tabs>

リポジトリのディレクトリに移動します:

```bash copy
cd "<your-repository>"
```

### 依存関係のインストール

```bash copy
npm install
```

### 環境変数の設定

`.env` ファイルを作成し、環境変数を追加します:

```bash copy
touch .env
```

`.env` ファイルを編集して、環境変数を追加します:

```bash copy
OPENAI_API_KEY=<your-openai-api-key>
# 必要な他の環境変数を追加
```

### アプリケーションのビルド

```bash copy
npm run build
```

### アプリケーションの実行

```bash copy
node --import=./.mastra/output/instrumentation.mjs --env-file=".env" .mastra/output/index.mjs
```

<Callout>
Mastra アプリケーションはデフォルトでポート 4111 で動作します。リバースプロキシがこのポートへリクエストを転送するよう設定されていることを確認してください。
</Callout>

</Steps>

</Tabs.Tab>

</Tabs>

## Mastra サーバーに接続する

`@mastra/client-js` パッケージの `MastraClient` を使うと、クライアントアプリケーションから Mastra サーバーに接続できます。

詳しくは、[`MastraClient` のドキュメント](/docs/server-db/mastra-client)をご覧ください。

```typescript copy showLineNumbers
import { MastraClient } from "@mastra/client-js";

const mastraClient = new MastraClient({
  baseUrl: "https://<あなたのドメイン>",
});
```


## 次のステップ

- [Mastra クライアント SDK](/docs/client-js/overview)
- [DigitalOcean App Platform ドキュメント](https://docs.digitalocean.com/products/app-platform/)
- [DigitalOcean Droplets ドキュメント](https://docs.digitalocean.com/products/droplets/)