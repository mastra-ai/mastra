---
title: "åˆ†å²ãƒ»ãƒãƒ¼ã‚¸ãƒ»æ¡ä»¶ | Workflows | Mastra ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ"
description: "Mastra ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®åˆ¶å¾¡ãƒ•ãƒ­ãƒ¼ã‚’ä½¿ã†ã¨ã€åˆ†å²ã‚„ãƒãƒ¼ã‚¸ã€æ¡ä»¶ã‚’ç®¡ç†ã—ã¦ã€è¦ä»¶ã«åˆã£ãŸãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚"
---

# åˆ¶å¾¡ãƒ•ãƒ­ãƒ¼

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’æ§‹ç¯‰ã™ã‚‹éš›ã¯ã€é€šå¸¸ã€å‡¦ç†ã‚’å°ã•ãªã‚¿ã‚¹ã‚¯ã«åˆ†å‰²ã—ã€ãã‚Œã‚‰ã‚’é€£çµã—ã¦å†åˆ©ç”¨ã—ã¾ã™ã€‚**Steps** ã¯ã€å…¥åŠ›ãƒ»å‡ºåŠ›ãƒ»å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯ã‚’å®šç¾©ã™ã‚‹ã“ã¨ã§ã€ã“ã‚Œã‚‰ã®ã‚¿ã‚¹ã‚¯ã‚’ä½“ç³»çš„ã«ç®¡ç†ã™ã‚‹ãŸã‚ã®ä»•çµ„ã¿ã‚’æä¾›ã—ã¾ã™ã€‚

- ã‚¹ã‚­ãƒ¼ãƒãŒä¸€è‡´ã™ã‚‹å ´åˆã€å„ã‚¹ãƒ†ãƒƒãƒ—ã® `outputSchema` ã¯è‡ªå‹•çš„ã«æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã® `inputSchema` ã«æ¸¡ã•ã‚Œã¾ã™ã€‚
- ã‚¹ã‚­ãƒ¼ãƒãŒä¸€è‡´ã—ãªã„å ´åˆã¯ã€[Input data mapping](./input-data-mapping.mdx) ã‚’ä½¿ç”¨ã—ã¦ã€`outputSchema` ã‚’æœŸå¾…ã•ã‚Œã‚‹ `inputSchema` ã«å¤‰æ›ã—ã¾ã™ã€‚

## `.then()` ã‚’ä½¿ã£ãŸã‚¹ãƒ†ãƒƒãƒ—ã®ãƒã‚§ãƒ¼ãƒ³

`.then()` ã‚’ä½¿ã£ã¦ã‚¹ãƒ†ãƒƒãƒ—ã‚’é †ç•ªã«å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«ãƒã‚§ãƒ¼ãƒ³ã—ã¾ã™:

![.then() ã‚’ä½¿ã£ãŸã‚¹ãƒ†ãƒƒãƒ—ã®ãƒã‚§ãƒ¼ãƒ³](/image/workflows/workflows-control-flow-then.jpg)

```typescript {8-9,4-5} filename="src/mastra/workflows/test-workflow.ts" showLineNumbers copy
import { createWorkflow, createStep } from "@mastra/core/workflows";
import { z } from "zod";

const step1 = createStep({...});
const step2 = createStep({...});

export const testWorkflow = createWorkflow({...})
  .then(step1)
  .then(step2)
  .commit();
```

ã“ã‚Œã¯æœŸå¾…ã©ãŠã‚Šã«å‹•ä½œã—ã¾ã™ã€‚ã¾ãš `step1` ã‚’å®Ÿè¡Œã—ã€ç¶šã„ã¦ `step2` ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚


## `.parallel()` ã‚’ä½¿ã£ãŸåŒæ™‚å®Ÿè¡Œã‚¹ãƒ†ãƒƒãƒ—

`.parallel()` ã‚’ä½¿ã£ã¦ã‚¹ãƒ†ãƒƒãƒ—ã‚’åŒæ™‚ã«å®Ÿè¡Œã—ã¾ã™:

![.parallel() ã«ã‚ˆã‚‹åŒæ™‚å®Ÿè¡Œã‚¹ãƒ†ãƒƒãƒ—](/image/workflows/workflows-control-flow-parallel.jpg)

```typescript {9,4-5} filename="src/mastra/workflows/test-workflow.ts" showLineNumbers copy
import { createWorkflow, createStep } from "@mastra/core/workflows";
import { z } from "zod";

const step1 = createStep({...});
const step2 = createStep({...});
const step3 = createStep({...});

export const testWorkflow = createWorkflow({...})
  .parallel([step1, step2])
  .then(step3)
  .commit();
```

`step1` ã¨ `step2` ã‚’åŒæ™‚ã«å®Ÿè¡Œã—ã€ä¸¡æ–¹ãŒå®Œäº†ã—ãŸã‚‰ `step3` ã«é€²ã¿ã¾ã™ã€‚

> è©³ç´°ã¯ [Parallel Execution with Steps](../../examples/workflows/parallel-steps.mdx) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

> ğŸ“¹ è¦–è´: ã‚¹ãƒ†ãƒƒãƒ—ã‚’ä¸¦åˆ—å®Ÿè¡Œã—ã¦ Mastra ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’æœ€é©åŒ–ã™ã‚‹æ–¹æ³• â†’ [YouTubeï¼ˆ3åˆ†ï¼‰](https://youtu.be/GQJxve5Hki4)


## `.branch()` ã‚’ä½¿ã£ãŸæ¡ä»¶åˆ†å²

`.branch()` ã‚’ç”¨ã„ã¦æ¡ä»¶ã«å¿œã˜ã¦ã‚¹ãƒ†ãƒƒãƒ—ã‚’å®Ÿè¡Œã—ã¾ã™:

![.branch() ã«ã‚ˆã‚‹æ¡ä»¶åˆ†å²](/image/workflows/workflows-control-flow-branch.jpg)

```typescript {8-11,4-5} filename="src/mastra/workflows/test-workflow.ts" showLineNumbers copy
import { createWorkflow, createStep } from "@mastra/core/workflows";
import { z } from "zod";

const lessThanStep = createStep({...});
const greaterThanStep = createStep({...});

export const testWorkflow = createWorkflow({...})
  .branch([
    [async ({ inputData: { value } }) => value <= 10, lessThanStep],
    [async ({ inputData: { value } }) => value > 10, greaterThanStep]
  ])
  .commit();
```

åˆ†å²æ¡ä»¶ã¯é †ç•ªã«è©•ä¾¡ã•ã‚Œã¾ã™ãŒã€æ¡ä»¶ã«ä¸€è‡´ã—ãŸã‚¹ãƒ†ãƒƒãƒ—ã¯ä¸¦è¡Œã—ã¦å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

> è©³ç´°ã¯ [Workflow with Conditional Branching](../../examples/workflows/conditional-branching.mdx) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚


## ã‚¹ãƒ†ãƒƒãƒ—ã®ãƒ«ãƒ¼ãƒ—å‡¦ç†

Workflows ã¯ 2 ç¨®é¡ã®ãƒ«ãƒ¼ãƒ—ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚ã‚¹ãƒ†ãƒƒãƒ—ã‚„ã€ãƒã‚¹ãƒˆã•ã‚ŒãŸ workflow ã®ã‚ˆã†ãªã‚¹ãƒ†ãƒƒãƒ—äº’æ›ã®æ§‹æˆè¦ç´ ã‚’ãƒ«ãƒ¼ãƒ—ã•ã›ã‚‹å ´åˆã€åˆæœŸã® `inputData` ã¯å‰ã®ã‚¹ãƒ†ãƒƒãƒ—ã®å‡ºåŠ›ã‹ã‚‰ä¾›çµ¦ã•ã‚Œã¾ã™ã€‚

äº’æ›æ€§ã‚’ä¿ã¤ãŸã‚ã«ã€ãƒ«ãƒ¼ãƒ—ã®åˆæœŸå…¥åŠ›ã¯å‰ã®ã‚¹ãƒ†ãƒƒãƒ—ã®å‡ºåŠ›ã®å½¢ã«ä¸€è‡´ã—ã¦ã„ã‚‹ã‹ã€`map` é–¢æ•°ã§æ˜ç¤ºçš„ã«å¤‰æ›ã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

- å‰ã®ã‚¹ãƒ†ãƒƒãƒ—ã®å‡ºåŠ›ã®å½¢ã«ä¸€è‡´ã•ã›ã‚‹ã€ã¾ãŸã¯
- `map` é–¢æ•°ã§æ˜ç¤ºçš„ã«å¤‰æ›ã™ã‚‹ã€‚

### `.dowhile()` ã§ã®ç¹°ã‚Šè¿”ã—

æ¡ä»¶ãŒ true ã®é–“ã€ã‚¹ãƒ†ãƒƒãƒ—ã‚’ç¹°ã‚Šè¿”ã—å®Ÿè¡Œã—ã¾ã™ã€‚

![.dowhile() ã§ã®ç¹°ã‚Šè¿”ã—](/image/workflows/workflows-control-flow-dowhile.jpg)

```typescript {7} filename="src/mastra/workflows/test-workflow.ts" showLineNumbers copy
import { createWorkflow, createStep } from "@mastra/core/workflows";
import { z } from "zod";

const counterStep = createStep({...});

export const testWorkflow = createWorkflow({...})
  .dowhile(counterStep, async ({ inputData: { number } }) => number < 10)
  .commit();
```


### `.dountil()` ã«ã‚ˆã‚‹ç¹°ã‚Šè¿”ã—

æ¡ä»¶ãŒçœŸã«ãªã‚‹ã¾ã§ã‚¹ãƒ†ãƒƒãƒ—ã‚’ç¹°ã‚Šè¿”ã—å®Ÿè¡Œã—ã¾ã™ã€‚

![.dountil() ã«ã‚ˆã‚‹ç¹°ã‚Šè¿”ã—](/image/workflows/workflows-control-flow-dountil.jpg)

```typescript {7} filename="src/mastra/workflows/test-workflow.ts" showLineNumbers copy
import { createWorkflow, createStep } from "@mastra/core/workflows";
import { z } from "zod";

const counterStep = createStep({...});

export const testWorkflow = createWorkflow({...})
  .dountil(counterStep, async ({ inputData: { number } }) => number > 10)
  .commit();
```


### ãƒ«ãƒ¼ãƒ—ç®¡ç†

ãƒ«ãƒ¼ãƒ—ã®çµ‚äº†æ–¹æ³•ã«å¿œã˜ã¦ã€ãƒ«ãƒ¼ãƒ—æ¡ä»¶ã¯ã•ã¾ã–ã¾ã«å®Ÿè£…ã§ãã¾ã™ã€‚ä¸€èˆ¬çš„ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã—ã¦ã¯ã€`inputData` ã§è¿”ã•ã‚Œã‚‹å€¤ã®ãƒã‚§ãƒƒã‚¯ã€åå¾©å›æ•°ã®ä¸Šé™è¨­å®šã€ä¸Šé™ã«é”ã—ãŸéš›ã®å®Ÿè¡Œä¸­æ­¢ãªã©ãŒã‚ã‚Šã¾ã™ã€‚

#### æ¡ä»¶ä»˜ããƒ«ãƒ¼ãƒ—

ãƒ«ãƒ¼ãƒ—ã‚¹ãƒ†ãƒƒãƒ—ã® `inputData` ã¯å‰ã®ã‚¹ãƒ†ãƒƒãƒ—ã®å‡ºåŠ›ã§ã™ã€‚`inputData` ã®å€¤ã‚’ä½¿ã£ã¦ã€ãƒ«ãƒ¼ãƒ—ã‚’ç¶™ç¶šã™ã‚‹ã‹åœæ­¢ã™ã‚‹ã‹ã‚’åˆ¤æ–­ã—ã¾ã™ã€‚

```typescript {7} filename="src/mastra/workflows/test-workflow.ts" showLineNumbers copy
import { createWorkflow, createStep } from "@mastra/core/workflows";
import { z } from "zod";

const counterStep = createStep({...});

export const testWorkflow = createWorkflow({...})
.dountil(nestedWorkflowStep, async ({ inputData: { userResponse } }) => userResponse === "yes")
.commit();
```


#### ãƒ«ãƒ¼ãƒ—ã®åˆ¶é™

`iterationCount` ã¯ã€ãƒ«ãƒ¼ãƒ—ã‚¹ãƒ†ãƒƒãƒ—ãŒä½•å›å®Ÿè¡Œã•ã‚ŒãŸã‹ã‚’è¿½è·¡ã—ã¾ã™ã€‚ã“ã‚Œã‚’ä½¿ã£ã¦åå¾©å›æ•°ã‚’åˆ¶é™ã—ã€ç„¡é™ãƒ«ãƒ¼ãƒ—ã‚’é˜²ã’ã¾ã™ã€‚`inputData` ã®å€¤ã¨çµ„ã¿åˆã‚ã›ã¦ã€æŒ‡å®šã—ãŸå›æ•°ã«é”ã—ãŸã‚‰ãƒ«ãƒ¼ãƒ—ã‚’åœæ­¢ã—ã¾ã™ã€‚

```typescript {7} filename="src/mastra/workflows/test-workflow.ts" showLineNumbers copy
import { createWorkflow, createStep } from "@mastra/core/workflows";
import { z } from "zod";

const counterStep = createStep({...});

export const testWorkflow = createWorkflow({...})
.dountil(nestedWorkflowStep, async ({ inputData: { userResponse, iterationCount } }) => userResponse === "yes" || iterationCount >= 10)
.commit();
```


#### ãƒ«ãƒ¼ãƒ—ã®ä¸­æ–­

`iterationCount` ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ«ãƒ¼ãƒ—ã®å®Ÿè¡Œå›æ•°ã«ä¸Šé™ã‚’è¨­ã‘ã¾ã™ã€‚å›æ•°ãŒã—ãã„å€¤ã‚’è¶…ãˆãŸå ´åˆã¯ã€ã‚¨ãƒ©ãƒ¼ã‚’ã‚¹ãƒ­ãƒ¼ã—ã¦ã‚¹ãƒ†ãƒƒãƒ—ã‚’å¤±æ•—ã•ã›ã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’åœæ­¢ã—ã¾ã™ã€‚

```typescript {7} filename="src/mastra/workflows/test-workflow.ts" showLineNumbers copy
import { createWorkflow, createStep } from "@mastra/core/workflows";
import { z } from "zod";

const counterStep = createStep({...});

export const testWorkflow = createWorkflow({...})
.dountil(nestedWorkflowStep, async ({ inputData: { userResponse, iterationCount } }) => {
  if (iterationCount >= 10) {
    throw new Error("æœ€å¤§ç¹°ã‚Šè¿”ã—å›æ•°ã«é”ã—ã¾ã—ãŸ");
  }
  return userResponse === "yes";
})
.commit();
```


### `.foreach()` ã§ã®ç¹°ã‚Šè¿”ã—

`inputSchema` ã®å„é …ç›®ã«å¯¾ã—ã¦ã€åŒã˜ã‚¹ãƒ†ãƒƒãƒ—ã‚’é †ã«å®Ÿè¡Œã—ã¾ã™ã€‚

![.foreach() ã§ã®ç¹°ã‚Šè¿”ã—](/image/workflows/workflows-control-flow-foreach.jpg)

```typescript {7} filename="src/mastra/workflows/test-workflow.ts" showLineNumbers copy
import { createWorkflow, createStep } from "@mastra/core/workflows";
import { z } from "zod";

const mapStep = createStep({...});

export const testWorkflow = createWorkflow({...})
  .foreach(mapStep)
  .commit();
```


#### åŒæ™‚å®Ÿè¡Œæ•°ã®åˆ¶é™ã‚’è¨­å®šã™ã‚‹

`concurrency` ã‚’ä½¿ã†ã¨ã€åŒæ™‚å®Ÿè¡Œæ•°ã®ä¸Šé™ã‚’è¨­ã‘ã¦ã‚¹ãƒ†ãƒƒãƒ—ã‚’ä¸¦åˆ—å®Ÿè¡Œã§ãã¾ã™ã€‚

```typescript {7} filename="src/mastra/workflows/test-workflow.ts" showLineNumbers copy
import { createWorkflow, createStep } from "@mastra/core/workflows";
import { z } from "zod";

const mapStep = createStep({...})

export const testWorkflow = createWorkflow({...})
  .foreach(mapStep, { concurrency: 2 })
  .commit();
```


## ãƒã‚¹ãƒˆã—ãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ä½¿ç”¨

`.then()` ã«æ¸¡ã—ã¦ã€ã‚¹ãƒ†ãƒƒãƒ—ã¨ã—ã¦ãƒã‚¹ãƒˆã—ãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€è¦ªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ä¸€éƒ¨ã¨ã—ã¦ã€ãã®å„ã‚¹ãƒ†ãƒƒãƒ—ãŒé †ç•ªã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

```typescript {4,7} filename="src/mastra/workflows/test-workflow.ts" showLineNumbers copy
import { createWorkflow, createStep } from "@mastra/core/workflows";
import { z } from "zod";

export const nestedWorkflow = createWorkflow({...})

export const testWorkflow = createWorkflow({...})
  .then(nestedWorkflow)
  .commit();
```


## ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ã‚¯ãƒ­ãƒ¼ãƒ³

æ—¢å­˜ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’è¤‡è£½ã™ã‚‹ã«ã¯ `cloneWorkflow` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€`id` ãªã©ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’ä¸Šæ›¸ãã—ã¤ã¤ã€ãã®æ§‹é€ ã‚’å†åˆ©ç”¨ã§ãã¾ã™ã€‚

```typescript {6,10} filename="src/mastra/workflows/test-workflow.ts" showLineNumbers copy
import { createWorkflow, createStep, cloneWorkflow } from "@mastra/core/workflows";
import { z } from "zod";

const step1 = createStep({...});
const parentWorkflow = createWorkflow({...})
const clonedWorkflow = cloneWorkflow(parentWorkflow, { id: "cloned-workflow" });

export const testWorkflow = createWorkflow({...})
  .then(step1)
  .then(clonedWorkflow)
  .commit();
```


## å®Ÿè¡Œã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä¾‹

æ¬¡ã®ä¾‹ã§ã¯ã€è¤‡æ•°ã®å…¥åŠ›ã§å®Ÿè¡Œã‚’é–‹å§‹ã™ã‚‹æ–¹æ³•ã‚’ç¤ºã—ã¾ã™ã€‚å„å…¥åŠ›ã¯ `mapStep` ã‚’é †ã«é€šéã—ã¾ã™ã€‚

```typescript {6} filename="src/test-workflow.ts" showLineNumbers copy
import { mastra } from "./mastra";

const run = await mastra.getWorkflow("testWorkflow").createRunAsync();

const result = await run.start({
  inputData: [{ number: 10 }, { number: 100 }, { number: 200 }]
});
```

ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š

```bash copy
npx tsx src/test-workflow.ts
```
