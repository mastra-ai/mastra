---
title: "Mastra Client SDK | Mastra ドキュメント"
description: "Mastra Client SDK のセットアップと使用方法を学ぶ"
---

import { Tabs } from "nextra/components";


# Mastra Client SDK

Mastra Client SDKは、クライアント環境から [Mastra Server](/docs/deployment/server) とやり取りするための、シンプルで型安全なインターフェースを提供します。

## 前提条件

ローカル開発をスムーズに行うため、次をご用意ください:

- Node.js `v18` 以上
- TypeScript `v4.7` 以上（TypeScript を使用する場合）
- ローカルの Mastra サーバーが起動していること（通常はポート `4111`）

## 使い方

Mastra Client SDK はブラウザ環境向けに設計されており、Mastra サーバーへの HTTP リクエストにはネイティブの `fetch` API を使用します。

## インストール

Mastra Client SDK を使用するには、必要な依存関係をインストールしてください。

{/*
LLM CONTEXT:
この Tabs コンポーネントは、異なるパッケージマネージャーを使って Mastra Client SDK をインストールするためのコマンドを表示します。
各タブには、そのパッケージマネージャー（npm、yarn、pnpm）のインストールコマンドが表示されます。
これにより、ユーザーは好みのパッケージマネージャーでクライアント SDK をインストールできます。
すべてのコマンドは同じ @mastra/client-js パッケージをインストールしますが、パッケージマネージャーごとに構文が異なります。
*/}

<Tabs items={["npm", "yarn", "pnpm", "bun"]}>
  <Tabs.Tab>
    ```bash copy
    npm install @mastra/client-js@latest
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```bash copy
    yarn add @mastra/client-js@latest
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```bash copy
    pnpm add @mastra/client-js@latest
    ```
  </Tabs.Tab>
    <Tabs.Tab>
    ```bash copy
    bun add @mastra/client-js@latest
    ```
  </Tabs.Tab>
</Tabs>

### `MastraClient` の初期化

`baseUrl` を指定して初期化すると、`MastraClient` はエージェント、ツール、ワークフローを呼び出すための型安全なインターフェースを提供します。

```typescript filename="lib/mastra-client.ts" showLineNumbers copy
import { MastraClient } from "@mastra/client-js";

export const mastraClient = new MastraClient({
  baseUrl: process.env.MASTRA_API_URL || "http://localhost:4111"
});
```


## コア API

Mastra Client SDK は、Mastra Server が提供するすべてのリソースにアクセスできます。

- **[Agents](/reference/client-js/agents.mdx)**: 応答を生成し、会話をストリーミングします。
- **[Memory](/reference/client-js/memory.mdx)**: 会話スレッドとメッセージ履歴を管理します。
- **[Tools](/reference/client-js/tools.mdx)**: ツールを実行・管理します。
- **[Workflows](/reference/client-js/workflows.mdx)**: ワークフローをトリガーし、実行状況を追跡します。
- **[Vectors](/reference/client-js/vectors.mdx)**: セマンティック検索のためにベクトル埋め込みを利用します。
- **[Logs](/reference/client-js/logs.mdx)**: ログを閲覧し、システムの挙動をデバッグします。
- **[Telemetry](/reference/client-js/telemetry.mdx)**: アプリのパフォーマンスを監視し、アクティビティをトレースします。

## レスポンスの生成

`role` と `content` を含むメッセージオブジェクトの配列を渡して、`.generate()` を呼び出します。

```typescript showLineNumbers copy
import { mastraClient } from "lib/mastra-client";

const testAgent = async () => {
  try {
    const agent = mastraClient.getAgent("testAgent");

    const response = await agent.generate({
      messages: [
        {
          role: "user",
          content: "こんにちは"
        }
      ]
    });

    console.log(response.text);
  } catch (error) {
    return "応答の生成中にエラーが発生しました"
  }
};
```

> 詳細は [.generate()](../../reference/client-js/agents.mdx#generate-response) をご覧ください。


## ストリーミング応答

`role` と `content` を含むメッセージオブジェクトの配列に対して、リアルタイム応答には `.stream()` を使用します：

```typescript showLineNumbers copy
import { mastraClient } from "lib/mastra-client";

const testAgent = async () => {
  try {
    const agent = mastraClient.getAgent("testAgent");

    const stream = await agent.stream({
      messages: [
        {
          role: "user",
          content: "こんにちは"
        }
      ]
    });

    stream.processDataStream({
      onTextPart: (text) => {
        console.log(text);
      }
    });
  } catch (error) {
    return "応答の生成中にエラーが発生しました"
  }
};
```

> 詳細は [.stream()](../../reference/client-js/agents.mdx#stream-response) をご覧ください。


## 設定オプション

`MastraClient` は `retries`、`backoffMs`、`headers` などのオプションパラメータを受け取り、リクエストの動作を制御できます。これらのパラメータは、再試行の挙動を調整したり、診断用のメタデータを含めたりするのに役立ちます。

```typescript filename="lib/mastra-client.ts" showLineNumbers copy
import { MastraClient } from "@mastra/client-js";

export const mastraClient = new MastraClient({
  // ...
  retries: 3,
  backoffMs: 300,
  maxBackoffMs: 5000,
  headers: {
    "X-Development": "true",
  },
});
```

> さらに多くの設定オプションについては、[MastraClient](../../reference/client-js/mastra-client.mdx) を参照してください。


## リクエストのキャンセルを追加する

`MastraClient` は、標準的な Node.js の `AbortSignal` API によるリクエストのキャンセルに対応しています。ユーザーが操作を中止した場合や、古いネットワーク呼び出しを整理する場合など、進行中のリクエストをキャンセルするのに役立ちます。

すべてのリクエストでキャンセルを有効にするには、クライアントのコンストラクターに `AbortSignal` を渡します。

```typescript {3,7} filename="lib/mastra-client.ts" showLineNumbers copy
import { MastraClient } from "@mastra/client-js";

export const controller = new AbortController();

export const mastraClient = new MastraClient({
  baseUrl: process.env.MASTRA_API_URL ?? "http://localhost:4111",
  abortSignal: controller.signal
});
```


### `AbortController` の使用

`.abort()` を呼び出すと、そのシグナルに結び付けられた進行中のリクエストがキャンセルされます。

```typescript {4} showLineNumbers copy
import { mastraClient, controller } from "lib/mastra-client";

const handleAbort = () => {
  controller.abort();
};
```


## クライアントツール

`createTool()` 関数を使って、クライアント側アプリケーション内でツールを直接定義します。`.generate()` や `.stream()` の呼び出し時に、`clientTools` パラメータへ渡します。

これにより、エージェントは DOM 操作、ローカルストレージへのアクセス、その他の Web API などのブラウザ側の機能を起動し、サーバーではなくユーザーの環境でツールを実行できるようになります。

```typescript {27} showLineNumbers copy
import { createTool } from '@mastra/client-js';
import { z } from 'zod';

const handleClientTool = async () => {
  try {
    const agent = mastraClient.getAgent("colorAgent");

    const colorChangeTool = createTool({
      id: "color-change-tool",
      description: "HTMLの背景色を変更します",
      inputSchema: z.object({
        color: z.string()
      }),
      outputSchema: z.object({
        success: z.boolean()
      }),
      execute: async ({ context }) => {
        const { color } = context

        document.body.style.backgroundColor = color;
        return { success: true };
      }
    });

    const response = await agent.generate({
      messages: "背景を青に変更してください",
      clientTools: { colorChangeTool }
    });

    console.log(response);
  } catch (error) {
    console.error(error);
  }
};
```


### クライアントツールのエージェント

これは、上で定義したブラウザベースのクライアントツールと連携し、16進数のカラーコードを返すように構成された、標準的な Mastra の[エージェント](../agents/overview#creating-an-agent)です。

```typescript filename="src/mastra/agents/color-agent" showLineNumbers copy
import { openai } from "@ai-sdk/openai";
import { Agent } from "@mastra/core/agent";

export const colorAgent = new Agent({
  name: "test-agent",
  instructions: `あなたは有能なCSSアシスタントです。
  Webページの背景色を変更できます。
  ユーザーが指定した色を16進数のカラーコード（#RRGGBB）で返答してください`,
  model: openai("gpt-4o-mini")
});
```


## サーバーサイド環境

`MastraClient` は、API ルート、サーバーレス関数、アクションなどのサーバーサイド環境でも使用できます。使い方は概ね同じですが、クライアント向けのレスポンスを再構築する必要が生じる場合があります。

```typescript {8} showLineNumbers
export async function action() {
  const agent = mastraClient.getAgent("testAgent");

  const stream = await agent.stream({
    messages: [{ role: "user", content: "やあ" }]
  });

  return new Response(stream.body);
}
```


## ベストプラクティス

1. **エラーハンドリング**: 開発環境向けに適切な[エラーハンドリング](/reference/client-js/error-handling)を実装します。
2. **環境変数**: 設定には環境変数を使用します。
3. **デバッグ**: 必要に応じて詳細な[ログ](/reference/client-js/logs)を有効化します。
4. **パフォーマンス**: アプリケーションのパフォーマンス、[テレメトリー](/reference/client-js/telemetry)、トレースを監視します。