---
title: "カスタム API ルート"
description: "Mastra サーバーから追加の HTTP エンドポイントを公開する。"
---

# カスタム API ルート

デフォルトでは、Mastra は登録済みのエージェントとワークフローをサーバー経由で自動的に公開します。追加の動作が必要な場合は、独自の HTTP ルートを定義できます。

ルートは `@mastra/core/server` のヘルパー `registerApiRoute` で提供されます。ルートは `Mastra` インスタンスと同じファイルに置くこともできますが、分離することで設定を簡潔に保てます。

```typescript filename="src/mastra/index.ts" copy showLineNumbers
import { Mastra } from "@mastra/core/mastra";
import { registerApiRoute } from "@mastra/core/server";

export const mastra = new Mastra({
  // ...
  server: {
    apiRoutes: [
      registerApiRoute("/my-custom-route", {
        method: "GET",
        handler: async (c) => {
          const mastra = c.get("mastra");
          const agents = await mastra.getAgent("my-agent");

          return c.json({ message: "カスタムルート" });
        },
      }),
    ],
  },
});
```

登録が完了すると、カスタムルートはサーバーのルートパスからアクセス可能になります。例：

```bash
curl http://localhost:4111/my-custom-route
```

各ルートのハンドラーは Hono の `Context` を受け取ります。ハンドラー内では、`Mastra` インスタンスにアクセスして、エージェントやワークフローをフェッチしたり呼び出したりできます。

ルート固有のミドルウェアを追加するには、`registerApiRoute` を呼び出す際に `middleware` 配列を渡します。

```typescript filename="src/mastra/index.ts" copy showLineNumbers
import { Mastra } from "@mastra/core/mastra";
import { registerApiRoute } from "@mastra/core/server";

export const mastra = new Mastra({
  // ...
  server: {
    apiRoutes: [
      registerApiRoute("/my-custom-route", {
        method: "GET",
        middleware: [
          async (c, next) => {
            console.log(`${c.req.method} ${c.req.url}`);
            await next();
          }
        ],
        handler: async (c) => {
          return c.json({ message: "ミドルウェア付きカスタムルート" });
        }
      })
    ]
  }
});
```
