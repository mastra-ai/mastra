---
title: "Cloud Exporter | AI トレーシング | オブザーバビリティ | Mastra ドキュメント"
description: "本番監視のためにトレースを Mastra Cloud に送信する"
---

import { Callout } from "nextra/components";


# Cloud Exporter

`CloudExporter` は、集中監視とチームでのコラボレーションのために Mastra Cloud にトレースを送信します。有効なアクセストークン付きのデフォルトのオブザーバビリティ設定を使用している場合は、自動的に有効になります。

## CloudExporter を使うべきとき

CloudExporter は次の用途に最適です:

- **本番監視** - トレースを一元的に可視化
- **チームコラボレーション** - 組織全体でトレースを共有
- **高度な分析** - インサイトとパフォーマンス指標の取得
- **メンテナンス不要** - インフラ運用は不要

## 設定

### 前提条件

1. **Mastra Cloud アカウント**: [cloud.mastra.ai](https://cloud.mastra.ai) で登録
2. **アクセス トークン**: Mastra Cloud → Settings → API Tokens で作成
3. **環境変数**: 認証情報を設定します:

```bash filename=".env"
MASTRA_CLOUD_ACCESS_TOKEN=mst_xxxxxxxxxxxxxxxx
```


### 基本設定

```typescript filename="src/mastra/index.ts"
import { Mastra } from "@mastra/core";
import { CloudExporter } from "@mastra/core/ai-tracing";

export const mastra = new Mastra({
  observability: {
    configs: {
      production: {
        serviceName: 'my-service',
        exporters: [
          new CloudExporter(),  // MASTRA_CLOUD_ACCESS_TOKEN環境変数を使用
        ],
      },
    },
  },
});
```


### 自動設定

デフォルトのオブザーバビリティ設定を使用している場合、アクセストークンが設定されていれば CloudExporter は自動的に含まれます。

```typescript
export const mastra = new Mastra({
  observability: {
    default: { enabled: true },  // トークンが存在する場合、CloudExporterを自動的に含む
  },
});
```


### 完全な構成

```typescript
new CloudExporter({
  // オプション - デフォルトは環境変数
  accessToken: process.env.MASTRA_CLOUD_ACCESS_TOKEN,

  // オプション - セルフホスト版Mastra Cloud用
  endpoint: 'https://cloud.your-domain.com',

  // バッチ処理設定
  maxBatchSize: 1000,     // バッチあたりの最大スパン数
  maxBatchWaitMs: 5000,   // バッチ送信前の最大待機時間

  // 診断ログ
  logLevel: 'info',  // debug | info | warn | error
})
```


## トレースの確認

### Mastra Cloud ダッシュボード

1. [cloud.mastra.ai](https://cloud.mastra.ai) にアクセスします
2. プロジェクトを選択します
3. Observability → Traces に移動します
4. フィルターを使って特定のトレースを絞り込みます:
   - サービス名
   - 時間範囲
   - トレース ID
   - エラーステータス

### 機能

- **Trace Timeline** - 実行フローの可視化
- **Span Details** - 入力、出力、メタデータ
- **Performance Metrics** - レイテンシ、トークン使用量
- **Team Collaboration** - トレースの共有

## パフォーマンス

<Callout type="info">
  CloudExporter はネットワーク使用効率を高めるため、インテリジェントなバッチ処理を採用しています。トレースはバッファリングされ、バッチで送信されるため、オーバーヘッドを抑えつつ、ほぼリアルタイムの可視性を維持できます。
</Callout>

### バッチ処理の動作

- トレースは `maxBatchSize`（デフォルト: 1000）までまとめてバッチ化されます
- バッチは満杯になるか、`maxBatchWaitMs`（デフォルト: 5秒）に達すると送信されます
- 失敗したバッチは指数バックオフで再試行されます
- Mastra Cloud に到達できない場合は段階的に機能を低下させます（グレースフル・デグラデーション）

## 関連項目

- [AI Tracingの概要](/docs/observability/ai-tracing/overview)
- [DefaultExporter](/docs/observability/ai-tracing/exporters/default)
- [Mastra Cloudドキュメント](https://cloud.mastra.ai/docs)