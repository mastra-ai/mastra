---
title: "CopilotKit ã¨ä¸€ç·’ã«ä½¿ã†"
description: "Mastra ãŒ CopilotKit ã® AGUI ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã©ã®ã‚ˆã†ã«æ´»ç”¨ã—ã¦ã„ã‚‹ã‹ã€ã¾ãŸãã‚Œã‚’ä½¿ã£ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã‚’å­¦ã³ã¾ã—ã‚‡ã†"
---

import { Tabs, Steps } from "nextra/components";
import Image from "next/image";


# Mastra ã¨ CopilotKit ã‚’çµ±åˆã™ã‚‹

CopilotKit ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ãª AI ã‚³ãƒ‘ã‚¤ãƒ­ãƒƒãƒˆã‚’æ‰‹æ—©ãçµ„ã¿è¾¼ã‚€ãŸã‚ã® React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æä¾›ã—ã¾ã™ã€‚Mastra ã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€åŒæ–¹å‘ã®çŠ¶æ…‹åŒæœŸã‚„ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãª UI ã‚’å‚™ãˆãŸé«˜åº¦ãª AI ã‚¢ãƒ—ãƒªã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚

CopilotKit ã®ã‚³ãƒ³ã‚»ãƒ—ãƒˆã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€ç™ºå±•çš„ãªæ´»ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã¤ã„ã¦ã¯ã€[CopilotKit ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.copilotkit.ai/)ã‚’ã”è¦§ãã ã•ã„ã€‚

ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€æ¬¡ã® 2 ã¤ã®çµ±åˆæ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

1. Mastra ã‚µãƒ¼ãƒãƒ¼ã« CopilotKit ã‚’çµ±åˆã—ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯åˆ¥ã® React ã¨ã—ã¦æ§‹ç¯‰ã™ã‚‹
2. Next.js ã‚¢ãƒ—ãƒªã« CopilotKit ã‚’çµ±åˆã™ã‚‹

<Tabs items={["Mastra Server", "Next.js" ]}>
  <Tabs.Tab>
    <Steps>
      ## React ã®ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

      React ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã€å¿…è¦ãª CopilotKit ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™:

      <Tabs items={["npm", "yarn", "pnpm"]}>
        <Tabs.Tab>
          ```bash copy
          npm install @copilotkit/react-core @copilotkit/react-ui
          ```
        </Tabs.Tab>

        <Tabs.Tab>
          ```bash copy
          yarn add @copilotkit/react-core @copilotkit/react-ui
          ```
        </Tabs.Tab>

        <Tabs.Tab>
          ```bash copy
          pnpm add @copilotkit/react-core @copilotkit/react-ui
          ```
        </Tabs.Tab>
      </Tabs>

      ## CopilotKit ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆ

      React ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã« CopilotKit ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™:

      ```tsx filename="components/copilotkit-component.tsx" copy
      import { CopilotChat } from "@copilotkit/react-ui";
      import { CopilotKit } from "@copilotkit/react-core";
      import "@copilotkit/react-ui/styles.css";

      export function CopilotKitComponent({ runtimeUrl }: { runtimeUrl: string}) {
        return (
          <CopilotKit
            runtimeUrl={runtimeUrl}
            agent="weatherAgent"
          >
            <CopilotChat
              labels={{
                title: "Your Assistant",
                initial: "Hi! ğŸ‘‹ How can I assist you today?",
              }}
            />
          </CopilotKit>
        );
      }
      ```

      ## ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

      ã¾ã  Mastra ã‚µãƒ¼ãƒãƒ¼ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¦ã„ãªã„å ´åˆã¯ã€[ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆã‚¬ã‚¤ãƒ‰](/docs/getting-started/installation)ã«å¾“ã£ã¦æ–°ã—ã„ Mastra ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

      Mastra ã‚µãƒ¼ãƒãƒ¼å´ã§ã€CopilotKit é€£æºç”¨ã®è¿½åŠ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™:

      <Tabs items={["npm", "yarn", "pnpm"]}>
        <Tabs.Tab>
          ```bash copy
          npm install @copilotkit/runtime @ag-ui/mastra
          ```
        </Tabs.Tab>

        <Tabs.Tab>
          ```bash copy
          yarn add @copilotkit/runtime @ag-ui/mastra
          ```
        </Tabs.Tab>

        <Tabs.Tab>
          ```bash copy
          pnpm add @copilotkit/runtime @ag-ui/mastra
          ```
        </Tabs.Tab>
      </Tabs>

      ## Mastra ã‚µãƒ¼ãƒãƒ¼ã‚’æ§‹æˆ

      CopilotKit ã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å«ã‚ã‚‹ã‚ˆã†ã« Mastra ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æ§‹æˆã—ã¾ã™:

      ```typescript filename="src/mastra/index.ts" copy {2,5-8,12-28}
      import { Mastra } from "@mastra/core/mastra";
      import { registerCopilotKit } from "@ag-ui/mastra/copilotkit";
      import { weatherAgent } from "./agents/weather-agent";

      type WeatherRuntimeContext = {
        "user-id": string;
        "temperature-scale": "celsius" | "fahrenheit";
      };

      export const mastra = new Mastra({
        agents: { weatherAgent },
        server: {
          cors: {
            origin: "*",
            allowMethods: ["*"],
            allowHeaders: ["*"]
          },
          apiRoutes: [
            registerCopilotKit<WeatherRuntimeContext>({
              path: "/copilotkit",
              resourceId: "weatherAgent",
              setContext: (c, runtimeContext) => {
                runtimeContext.set("user-id", c.req.header("X-User-ID") || "anonymous");
                runtimeContext.set("temperature-scale", "celsius");
              }
            })
          ]
        }
      });
      ```

      ## React ã‚¢ãƒ—ãƒªã§ã®ä½¿ç”¨

      Mastra ã‚µãƒ¼ãƒãƒ¼ã® URL ã‚’æŒ‡å®šã—ã¦ã€React ã‚¢ãƒ—ãƒªã§ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¾ã™:

      ```tsx filename="App.tsx" copy {5}
      import { CopilotKitComponent } from "./components/copilotkit-component";

      function App() {
        return (
          <CopilotKitComponent runtimeUrl="http://localhost:4111/copilotkit" />
        );
      }

      export default App;
      ```

      ã“ã‚Œã§ã€Mastra ã‚µãƒ¼ãƒãƒ¼ã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ä¸¡æ–¹ã‚’èµ·å‹•ã—ã¦ãã ã•ã„ã€‚
    </Steps>
  </Tabs.Tab>

  <Tabs.Tab>
    <Steps>
      ## ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

      Next.jsã‚¢ãƒ—ãƒªã«ã€å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™:

      <Tabs items={["npm", "yarn", "pnpm"]}>
        <Tabs.Tab>
          ```bash copy
          npm install @copilotkit/react-core @copilotkit/react-ui @copilotkit/runtime @ag-ui/mastra
          ```
        </Tabs.Tab>

        <Tabs.Tab>
          ```bash copy
          yarn add @copilotkit/react-core @copilotkit/react-ui @copilotkit/runtime @ag-ui/mastra
          ```
        </Tabs.Tab>

        <Tabs.Tab>
          ```bash copy
          pnpm add @copilotkit/react-core @copilotkit/react-ui @copilotkit/runtime @ag-ui/mastra
          ```
        </Tabs.Tab>
      </Tabs>

      ## CopilotKitã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ [#full-stack-nextjs-create-copilotkit-component]

      CopilotKitã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹:

      ```tsx filename="components/copilotkit-component.tsx" copy
      'use client';
      import { CopilotChat } from "@copilotkit/react-ui";
      import { CopilotKit } from "@copilotkit/react-core";
      import "@copilotkit/react-ui/styles.css";

      export function CopilotKitComponent({ runtimeUrl }: { runtimeUrl: string}) {
        return (                                                       y
          <CopilotKit
            runtimeUrl={runtimeUrl}
            agent="weatherAgent"
          >
            <CopilotChat
              labels={{
                title: "ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ",
                initial: "ã“ã‚“ã«ã¡ã¯!ğŸ‘‹ ä»Šæ—¥ã¯ã©ã†ã•ã‚Œã¾ã—ãŸã‹?",
              }}
            />
          </CopilotKit>
        );
      }
      ```

      ## APIãƒ«ãƒ¼ãƒˆã‚’ä½œæˆã™ã‚‹

      Next.jsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¸ã®Mastraã®çµ±åˆæ–¹æ³•ã«å¿œã˜ã¦ã€APIãƒ«ãƒ¼ãƒˆã«ã¯2ã¤ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒã‚ã‚Šã¾ã™ã€‚

      1. ã‚¢ãƒ—ãƒªã« Mastra ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒçµ±åˆã•ã‚ŒãŸãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ã® Next.js ã‚¢ãƒ—ãƒªå‘ã‘ã€‚
      2. åˆ¥å€‹ã® Mastra ã‚µãƒ¼ãƒãƒ¼ã¨ Mastra Client SDK ã‚’åˆ©ç”¨ã™ã‚‹ Next.js ã‚¢ãƒ—ãƒªã®å ´åˆã€‚

      <Tabs items={["With a Mastra instance", "With the Mastra Client SDK"]}>
        <Tabs.Tab>
          ãƒ­ãƒ¼ã‚«ãƒ«ã® Mastra ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«æ¥ç¶šã™ã‚‹ API ãƒ«ãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

          ```typescript filename="app/api/copilotkit/route.ts" copy {1-7,11-26}
          import { mastra } from "../../mastra";
          import {
            CopilotRuntime,
            ExperimentalEmptyAdapter,
            copilotRuntimeNextJSAppRouterEndpoint,
          } from "@copilotkit/runtime";
          import { MastraAgent } from "@ag-ui/mastra";
          import { NextRequest } from "next/server";

          export const POST = async (req: NextRequest) => {
            const mastraAgents = MastraAgent.getLocalAgents({
              mastra,
              agentId: "weatherAgent",
            });

            const runtime = new CopilotRuntime({
              agents: mastraAgents,
            });

            const { handleRequest } = copilotRuntimeNextJSAppRouterEndpoint({
              runtime,
              serviceAdapter: new ExperimentalEmptyAdapter(),
              endpoint: "/api/copilotkit",
            });

            return handleRequest(req);
          };
          ```
        </Tabs.Tab>

        <Tabs.Tab>
          ## Mastra Client SDK ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

          Mastra Client SDK ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

          <Tabs items={["npm", "yarn", "pnpm"]}>
            <Tabs.Tab>
              ```bash copy
              npm install @mastra/client-js
              ```
            </Tabs.Tab>

            <Tabs.Tab>
              ```bash copy
              yarn add @mastra/client-js
              ```
            </Tabs.Tab>

            <Tabs.Tab>
              ```bash copy
               pnpm add @mastra/client-js
              ```
            </Tabs.Tab>
          </Tabs>

          ãƒªãƒ¢ãƒ¼ãƒˆã® Mastra ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«æ¥ç¶šã™ã‚‹ API ãƒ«ãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

          ```typescript filename="app/api/copilotkit/route.ts" copy {1-7,12-26}
          import { MastraClient } from "@mastra/client-js";
          import {
            CopilotRuntime,
            ExperimentalEmptyAdapter,
            copilotRuntimeNextJSAppRouterEndpoint,
          } from "@copilotkit/runtime";
          import { MastraAgent } from "@ag-ui/mastra";
          import { NextRequest } from "next/server";

          export const POST = async (req: NextRequest) => {
            const baseUrl = process.env.MASTRA_BASE_URL || "http://localhost:4111";
            const mastraClient = new MastraClient({ baseUrl });

            const mastraAgents = await MastraAgent.getRemoteAgents({ mastraClient });

            const runtime = new CopilotRuntime({
              agents: mastraAgents,
            });

            const { handleRequest } = copilotRuntimeNextJSAppRouterEndpoint({
              runtime,
              serviceAdapter: new ExperimentalEmptyAdapter(),
              endpoint: "/api/copilotkit",
            });

            return handleRequest(req);
          };
          ```
        </Tabs.Tab>
      </Tabs>

      ## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨ã™ã‚‹

      ãƒ­ãƒ¼ã‚«ãƒ«APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨ã™ã‚‹:

      ```tsx filename="App.tsx" copy {5}
      import { CopilotKitComponent } from "./components/copilotkit-component";

      function App() {
        return (
          <CopilotKitComponent runtimeUrl="/api/copilotkit" />
        );
      }

      export default App;
      ```
    </Steps>
  </Tabs.Tab>
</Tabs>

æœªæ¥ã‚’ç¯‰ãå§‹ã‚ã‚ˆã†ï¼

<br />

<Image
  className="rounded-lg"
  src="/image/copilotkit/cpkoutput.jpg"
  alt="CopilotKitã®å‡ºåŠ›"
  width={700}
  height={700}
/>

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

- [CopilotKit Documentation](https://docs.copilotkit.ai) - CopilotKit ã®åŒ…æ‹¬çš„ãªãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹
- [React Hooks with CopilotKit](https://docs.copilotkit.ai/reference/hooks/useCoAgent) - React ã®é«˜åº¦ãªçµ±åˆãƒ‘ã‚¿ãƒ¼ãƒ³
- [Next.js Integration with Mastra](/docs/frameworks/web-frameworks/next-js) - ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ã® Next.js ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰