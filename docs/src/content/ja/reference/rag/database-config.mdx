---
title: "リファレンス: DatabaseConfig | RAG | Mastra ドキュメント"
description: Mastra の RAG システムでベクトル検索ツールと使用する、データベース固有の設定タイプに関する API リファレンス。
---

import { Callout } from "nextra/components";
import { Tabs } from "nextra/components";


# DatabaseConfig

`DatabaseConfig` 型は、ベクトルクエリツールを使用する際に、データベース固有の設定を指定するための型です。これらの設定により、各ベクトルストアが提供する独自の機能や最適化を活用できます。

## 型定義

```typescript
export type DatabaseConfig = {
  pinecone?: PineconeConfig;
  pgvector?: PgVectorConfig;
  chroma?: ChromaConfig;
  [key: string]: any; // 将来のデータベース拡張に対応
};
```


## データベース特有の型

### PineconeConfig

Pinecone ベクターストア向けの構成オプション。

<PropertiesTable
  content={[
    {
      name: "namespace",
      type: "string",
      description: "同一インデックス内でベクターを整理・分離するための Pinecone の namespace。マルチテナンシーや環境の切り分けに有用です。",
      isOptional: true,
    },
    {
      name: "sparseVector",
      type: "{ indices: number[]; values: number[]; }",
      description: "密と疎の埋め込みを組み合わせるハイブリッド検索用の疎ベクター。キーワードベースのクエリに対してより高品質な検索を可能にします。indices と values の配列は同じ長さである必要があります。",
      isOptional: true,
      properties: [
        {
          type: "object",
          parameters: [
            {
              name: "indices",
              description: "疎ベクターの各成分に対応するインデックスの配列",
              isOptional: false,
              type: "number[]",
            },
            {
              name: "values",
              description: "各インデックスに対応する値の配列",
              isOptional: false,
              type: "number[]",
            },
          ],
        },
      ],
    },
  ]}
/>

**ユースケース:**

- マルチテナントアプリケーション（テナントごとに namespace を分離）
- 環境の分離（dev/staging/prod ごとに namespace を分離）
- セマンティック検索とキーワードマッチングを組み合わせたハイブリッド検索

### PgVectorConfig

pgvector 拡張機能を利用する PostgreSQL 向けの設定オプション。

<PropertiesTable
  content={[
    {
      name: "minScore",
      type: "number",
      description: "結果に対する最小類似度スコアのしきい値。この値を上回る類似度スコアのベクトルのみが返されます。",
      isOptional: true,
    },
    {
      name: "ef",
      type: "number",
      description: "検索時の動的候補リストのサイズを制御する HNSW の検索パラメータ。値を高くすると精度は向上しますが、速度は低下します。通常は topK〜200 の範囲で設定します。",
      isOptional: true,
    },
    {
      name: "probes",
      type: "number",
      description: "検索時に走査するインデックスセル数を指定する IVFFlat の probe パラメータ。値を高くすると再現率は向上しますが、速度は低下します。",
      isOptional: true,
    },
  ]}
/>

**パフォーマンスガイドライン:**

- **ef**: topK の 2〜4 倍から始め、より高精度が必要なら増やす
- **probes**: 1〜10 から始め、より高再現率が必要なら増やす
- **minScore**: 品質要件に応じて 0.5〜0.9 を設定

**ユースケース:**

- 高負荷環境でのパフォーマンス最適化
- 無関係な結果を除外するための品質フィルタリング
- 検索の精度と速度のトレードオフの調整

### ChromaConfig

Chroma ベクターストア固有の設定オプション。

<PropertiesTable
  content={[
{
  name: "where",
  type: "Record<string, any>",
  description: "MongoDB 風のクエリ構文を用いたメタデータのフィルタ条件。メタデータフィールドに基づいて結果を絞り込みます。",
  isOptional: true,
},
{
  name: "whereDocument",
  type: "Record<string, any>",
  description: "ドキュメント本文のフィルタ条件。実際のドキュメントテキストに基づいて絞り込みを行えます。",
  isOptional: true,
},
]}
/>

**フィルター構文の例:**

```typescript
// 単純な等価比較
where: { "category": "technical" }

// 演算子
where: { "price": { "$gt": 100 } }

// 複数の条件
where: { 
  "category": "electronics",
  "inStock": true 
}

// ドキュメント内容によるフィルタリング
whereDocument: { "$contains": "API documentation" }
```

**ユースケース:**

* 高度なメタデータのフィルタリング
* コンテンツに基づくドキュメントのフィルタリング
* 複雑なクエリの組み合わせ


## 使用例

<Tabs items={['基本的な使い方', 'ランタイムでの上書き', 'マルチデータベース', 'パフォーマンスチューニング']}>
  <Tabs.Tab>
    ### 基本的なデータベース設定

    ```typescript
    import { createVectorQueryTool } from '@mastra/rag';
    
    const vectorTool = createVectorQueryTool({
      vectorStoreName: 'pinecone',
      indexName: 'documents',
      model: embedModel,
      databaseConfig: {
        pinecone: {
          namespace: 'production'
        }
      }
    });
    ```
  </Tabs.Tab>

  <Tabs.Tab>
    ### ランタイムでの設定上書き

    ```typescript
    import { RuntimeContext } from '@mastra/core/runtime-context';
    
    // 初期設定
    const vectorTool = createVectorQueryTool({
      vectorStoreName: 'pinecone',
      indexName: 'documents', 
      model: embedModel,
      databaseConfig: {
        pinecone: {
          namespace: 'development'
        }
      }
    });
    
    // 実行時に上書き
    const runtimeContext = new RuntimeContext();
    runtimeContext.set('databaseConfig', {
      pinecone: {
        namespace: 'production'
      }
    });
    
    await vectorTool.execute({
      context: { queryText: 'search query' },
      mastra,
      runtimeContext
    });
    ```
  </Tabs.Tab>

  <Tabs.Tab>
    ### マルチデータベース設定

    ```typescript
    const vectorTool = createVectorQueryTool({
      vectorStoreName: 'dynamic', // 実行時に決定
      indexName: 'documents',
      model: embedModel,
      databaseConfig: {
        pinecone: {
          namespace: 'default'
        },
        pgvector: {
          minScore: 0.8,
          ef: 150
        },
        chroma: {
          where: { 'type': 'documentation' }
        }
      }
    });
    ```

    <Callout>
      **マルチデータベース対応**: 複数のデータベースを設定している場合、実際に使用されるベクターストアに一致する設定のみが適用されます。
    </Callout>
  </Tabs.Tab>

  <Tabs.Tab>
    ### パフォーマンスチューニング

    ```typescript
    // 高精度の構成
    const highAccuracyTool = createVectorQueryTool({
      vectorStoreName: 'postgres',
      indexName: 'embeddings',
      model: embedModel,
      databaseConfig: {
        pgvector: {
          ef: 400,        // 高精度
          probes: 20,     // 高再現率
          minScore: 0.85  // 高品質のしきい値
        }
      }
    });
    
    // 高速構成  
    const highSpeedTool = createVectorQueryTool({
      vectorStoreName: 'postgres',
      indexName: 'embeddings',
      model: embedModel,
      databaseConfig: {
        pgvector: {
          ef: 50,         // 精度は下がるが高速
          probes: 3,      // 再現率は下がるが高速
          minScore: 0.6   // 品質のしきい値を低めに設定
        }
      }
    });
    ```
  </Tabs.Tab>
</Tabs>

## 拡張性

`DatabaseConfig` 型は拡張しやすいように設計されています。新しいベクターデータベースへの対応を追加するには、次のとおりです。

```typescript
// 1. 設定用インターフェースを定義する
export interface NewDatabaseConfig {
  customParam1?: string;
  customParam2?: number;
}

// 2. DatabaseConfig 型を拡張する
export type DatabaseConfig = {
  pinecone?: PineconeConfig;
  pgvector?: PgVectorConfig;
  chroma?: ChromaConfig;
  newdatabase?: NewDatabaseConfig;
  [key: string]: any;
};

// 3. ベクタークエリツールで使用する
const vectorTool = createVectorQueryTool({
  vectorStoreName: 'newdatabase',
  indexName: 'documents',
  model: embedModel,
  databaseConfig: {
    newdatabase: {
      customParam1: 'value',
      customParam2: 42
    }
  }
});
```


## ベストプラクティス

1. **環境構成**: 環境ごとに別の名前空間や設定を使用する
2. **パフォーマンス調整**: 既定値から始め、要件に応じて最適化する
3. **品質フィルタリング**: 低品質な結果を除外するために minScore を利用する
4. **ランタイムの柔軟性**: 動的な状況に対応できるよう、実行時に設定を上書きする
5. **ドキュメンテーション**: チーム向けに、採用した設定の理由と内容を明記する

## 移行ガイド

既存のベクター検索ツールは変更なしでそのまま動作します。データベースの設定を追加するには：

```diff
const vectorTool = createVectorQueryTool({
  vectorStoreName: 'pinecone',
  indexName: 'documents',
  model: embedModel,
+ databaseConfig: {
+   pinecone: {
+     namespace: 'production'
+   }
+ }
});
```


## 関連項目

- [createVectorQueryTool()](/reference/tools/vector-query-tool)
- [ハイブリッド ベクター検索](/examples/rag/query/hybrid-vector-search.mdx)
- [メタデータフィルタ](/reference/rag/metadata-filters) 