---
title: "リファレンス: MastraScorer | スコアラー | Mastra ドキュメント"
description: Mastra の MastraScorer 基底クラスに関するドキュメント。すべてのカスタムおよび組み込みスコアラーの基盤となるクラスです。
---

# MastraScorer

`MastraScorer` クラスは、Mastra におけるすべてのスコアラーの基底クラスです。入力と出力のペアを評価するための標準的な `.run()` メソッドを提供し、preprocess → analyze → generateScore → generateReason の実行フローによるマルチステップのスコアリングをサポートします。

**注:** 多くのユーザーは、スコアラーのインスタンスを作成する際は [`createScorer`](./create-scorer) を使用してください。`MastraScorer` を直接インスタンス化することは推奨されません。

## MastraScorer インスタンスの取得方法

`createScorer` ファクトリ関数を使用します。`MastraScorer` インスタンスが返されます。

```typescript
const scorer = createScorer({
  name: "My Custom Scorer",
  description: "カスタム基準に基づいてレスポンスを評価します",
})
.generateScore(({ run, results }) => {
  // スコアリングのロジック
  return 0.85;
});

// scorer は現在 MastraScorer のインスタンスです
```


## .run() メソッド

`.run()` メソッドは、スコアラーを実行して入出力ペアを評価するための主要な手段です。定義した処理手順（preprocess → analyze → generateScore → generateReason）に沿ってデータを処理し、スコア、根拠、および中間結果を含む包括的な結果オブジェクトを返します。

```typescript
const result = await scorer.run({
  input: "機械学習とは何ですか？",
  output: "機械学習は人工知能の一分野です...",
  runId: "任意のrun-id",
  runtimeContext: { /* 任意のコンテキスト */ }
});
```


## .run() の入力

<PropertiesTable
  content={[
    {
      name: "input",
      type: "any",
      required: true,
      description: "評価する入力データ。スコアラーの要件に応じて任意の型を使用できます。",
    },
    {
      name: "output",
      type: "any",
      required: true,
      description: "評価する出力データ。スコアラーの要件に応じて任意の型を使用できます。",
    },
    {
      name: "runId",
      type: "string",
      required: false,
      description: "このスコアリング実行の一意の識別子（任意）。",
    },
    {
      name: "runtimeContext",
      type: "any",
      required: false,
      description: "評価対象のエージェントまたはワークフローのステップから渡される実行時コンテキスト（任意）。",
    },
    {
      name: "groundTruth",
      type: "any",
      required: false,
      description: "スコアリング時の比較用の期待値または参照出力（任意）。runExperiment を使用する場合は自動的に渡されます。",
    },
  ]}
/>

## .run() の戻り値

<PropertiesTable
  content={[
    {
      name: "runId",
      type: "string",
      description: "このスコアリング実行の一意の識別子。",
    },
    {
      name: "score",
      type: "number",
      description: "generateScore ステップで算出された数値スコア。",
    },
    {
      name: "reason",
      type: "string",
      description: "スコアの説明（generateReason ステップが定義されている場合、任意）。",
    },
    {
      name: "preprocessStepResult",
      type: "any",
      description: "preprocess ステップの結果（定義されている場合、任意）。",
    },
    {
      name: "analyzeStepResult",
      type: "any",
      description: "analyze ステップの結果（定義されている場合、任意）。",
    },
    {
      name: "preprocessPrompt",
      type: "string",
      description: "preprocess 用のプロンプト（定義されている場合、任意）。",
    },
    {
      name: "analyzePrompt",
      type: "string",
      description: "analyze 用のプロンプト（定義されている場合、任意）。",
    },
    {
      name: "generateScorePrompt",
      type: "string",
      description: "スコア生成用のプロンプト（定義されている場合、任意）。",
    },
        {
      name: "generateReasonPrompt",
      type: "string",
      description: "理由生成用のプロンプト（定義されている場合、任意）。",
    },
  ]}
/>

## ステップ実行フロー

`.run()` を呼び出すと、MastraScorer は次の順序で定義されたステップを実行します：

1. **preprocess**（任意）- データを抽出または変換する
2. **analyze**（任意）- 入力/出力および前処理済みデータを処理する  
3. **generateScore**（必須）- 数値スコアを算出する
4. **generateReason**（任意）- スコアの根拠を提示する

各ステップは前のステップの結果を受け取り、複雑な評価パイプラインを構築できます。

## 使い方の例

```typescript
const scorer = createScorer({
  name: "品質スコアラー",
  description: "応答の品質を評価する",
})
.preprocess(({ run }) => {
  // 重要情報を抽出
  return { wordCount: run.output.split(' ').length };
})
.analyze(({ run, results }) => {
  // 応答を分析
  const hasSubstance = results.preprocessStepResult.wordCount > 10;
  return { hasSubstance };
})
.generateScore(({ results }) => {
  // スコアを算出
  return results.analyzeStepResult.hasSubstance ? 1.0 : 0.0;
})
.generateReason(({ score, results }) => {
  // スコアの理由を説明
  const wordCount = results.preprocessStepResult.wordCount;
  return `スコア: ${score}。応答は${wordCount}語です。`;
});

// スコアラーを使用する
const result = await scorer.run({
  input: "機械学習とは？",
  output: "機械学習は人工知能の一分野です..."
});

console.log(result.score);  // 1.0
console.log(result.reason); // "スコア: 1.0。応答は12語です。"
```


## 統合

MastraScorer のインスタンスは、エージェントやワークフローの各ステップで使用できます。

カスタムスコアリングロジックの定義についての詳細は、[createScorer リファレンス](./create-scorer)をご覧ください。