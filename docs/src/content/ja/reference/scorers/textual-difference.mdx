---
title: "リファレンス: Textual Difference | Scorers | Mastra ドキュメント"
description: Mastra の Textual Difference Scorer に関するドキュメント。シーケンスマッチングを用いて文字列間のテキスト差を測定します。
---

# テキスト差分スコアラー

`createTextualDifferenceScorer()` 関数は、シーケンスマッチングを用いて2つの文字列間のテキスト上の差分を測定します。あるテキストを別のテキストへ変換するのに必要な操作回数など、変更点に関する詳細な情報を提供します。

使用例は [Textual Difference の例](/examples/scorers/textual-difference) を参照してください。

## パラメータ

`createTextualDifferenceScorer()` 関数にはオプションはありません。

この関数は MastraScorer クラスのインスタンスを返します。`.run()` メソッドとその入出力の詳細については、[MastraScorer リファレンス](./mastra-scorer)を参照してください。

## .run() の戻り値

<PropertiesTable
  content={[
{
  name: "runId",
  type: "string",
  description: "実行のID（オプション）。",
},
{
  name: "analyzeStepResult",
  type: "object",
  description: "差分指標を含むオブジェクト: { confidence: number, changes: number, lengthDiff: number }",
},
{
  name: "score",
  type: "number",
  description: "類似度（0～1）。1はテキストが完全に同一であることを示します。",
},
]}
/>

`.run()` は次の形の結果を返します:

```typescript
{
  runId: string,
  analyzeStepResult: {
    confidence: number,
    ratio: number,
    changes: number,
    lengthDiff: number
  },
  score: number
}
```


## スコアの詳細

スコアリングは以下の指標を算出します:

- **類似度比**: テキスト間のシーケンス照合に基づく値（0〜1）
- **変更数**: 不一致を解消するために必要な操作の回数
- **長さの差**: テキスト長の正規化された差分
- **信頼度**: 長さの差に反比例する指標

### スコアリングプロセス

1. テキスト差分の分析:
   - 入力と出力のシーケンスを照合
   - 必要な変更操作の数をカウント
   - 長さの差分を測定
2. 指標の計算:
   - 類似度を算出
   - 信頼度スコアを算定
   - 重み付きスコアに集約

最終スコア: `(similarity_ratio * confidence) * scale`

### スコアの解釈

0～1の範囲のテキスト差異スコア:

- **1.0**: テキストは同一 — 差異は検出されません。
- **0.7–0.9**: 軽微な差異 — わずかな修正が必要。
- **0.4–0.6**: 中程度の差異 — 目立つ修正が必要。
- **0.1–0.3**: 大きな差異 — 大幅な修正が必要。
- **0.0**: 完全に異なるテキスト。

## 例

### 差分なしの例

この例では、テキストはまったく同じです。スコアラーは満点として完全な一致を判定し、変更は一切検出されません。

```typescript filename="src/example-no-differences.ts" showLineNumbers copy
import { createTextualDifferenceScorer } from "@mastra/evals/scorers/code";

const scorer = createTextualDifferenceScorer();

const input = '素早い茶色のキツネが怠惰な犬を飛び越える';
const output = '素早い茶色のキツネが怠惰な犬を飛び越える';

const result = await scorer.run({
  input: [{ role: 'user', content: input }],
  output: { role: 'assistant', text: output },
});

console.log('スコア:', result.score);
console.log('分析ステップ結果:', result.analyzeStepResult);
```


#### 差分はありません

スコアラーは高スコアを返し、テキストが同一であることを示します。詳細情報でも変更はなく、長さの差もないことが確認されています。

```typescript
{
  score: 1,
  analyzeStepResult: {
    confidence: 1,
    ratio: 1,
    changes: 0,
    lengthDiff: 0,
  },
}
```


### 些細な差分の例

この例では、テキストにわずかな違いがあります。スコアラーはこれらの小さな差異を検出し、中程度の類似度スコアを返します。

```typescript filename="src/example-minor-differences.ts" showLineNumbers copy
import { createTextualDifferenceScorer } from "@mastra/evals/scorers/code";

const scorer = createTextualDifferenceScorer();

const input = 'こんにちは!元気ですか?';
const output = 'やあ!調子はどう?';

const result = await scorer.run({
  input: [{ role: 'user', content: input }],
  output: { role: 'assistant', text: output },
});

console.log('スコア:', result.score);
console.log('分析ステップ結果:', result.analyzeStepResult);
```


#### 軽微な差分の出力

スコアラーは、テキスト間の小さな違いを反映して中程度のスコアを返します。詳細情報には、変更数と確認された長さの差が含まれます。

```typescript
{
  score: 0.5925925925925926,
  analyzeStepResult: {
    confidence: 0.8620689655172413,
    ratio: 0.5925925925925926,
    changes: 5,
    lengthDiff: 0.13793103448275862
  }
}
```


### 大きな差の例

この例では、テキスト間に大きな違いがあります。スコアラーは大幅な変更を検出し、類似度スコアを低く返します。

```typescript filename="src/example-major-differences.ts" showLineNumbers copy
import { createTextualDifferenceScorer } from "@mastra/evals/scorers/code";

const scorer = createTextualDifferenceScorer();

const input = 'Pythonは高水準プログラミング言語です';
const output = 'JavaScriptはWeb開発に使用されます';

const result = await scorer.run({
  input: [{ role: 'user', content: input }],
  output: { role: 'assistant', text: output },
});

console.log('スコア:', result.score);
console.log('分析ステップ結果:', result.analyzeStepResult);
```


#### 主要な差分の出力

テキスト間に大きな差異があるため、スコアラーは低いスコアを返します。詳細な `analyzeStepResult` には多数の変更点と、長さに顕著な違いが示されています。

```typescript
{
  score: 0.3170731707317073,
  analyzeStepResult: {
    confidence: 0.8636363636363636,
    ratio: 0.3170731707317073,
    changes: 8,
    lengthDiff: 0.13636363636363635
  }
}
```


## 関連項目

- [コンテンツ類似度スコアラー](./content-similarity)
- [完全性スコアラー](./completeness)
- [キーワード網羅性スコアラー](./keyword-coverage)