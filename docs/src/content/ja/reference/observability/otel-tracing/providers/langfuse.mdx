---
title: "リファレンス: Langfuse 連携 | Mastra オブザーバビリティ ドキュメント"
description: LLMアプリケーション向けオープンソースのオブザーバビリティプラットフォームである Mastra と Langfuse を統合するためのドキュメント。
---

# Langfuse

Langfuse は、LLM アプリケーション向けに特化して設計されたオープンソースのオブザーバビリティ・プラットフォームです。

> **注**: 現在、詳細なテレメトリーデータを含むのは AI 関連の呼び出しのみです。その他の操作でもトレースは作成されますが、情報は限定的です。

## 設定

Mastra で Langfuse を使用するには、環境変数で設定するか、Mastra の設定で直接指定します。

### 環境変数の使用

以下の環境変数を設定します：

```env
OTEL_EXPORTER_OTLP_ENDPOINT="https://cloud.langfuse.com/api/public/otel/v1/traces" # 🇪🇺 EUデータ地域
# OTEL_EXPORTER_OTLP_ENDPOINT="https://us.cloud.langfuse.com/api/public/otel/v1/traces" # 🇺🇸 USデータ地域

OTEL_EXPORTER_OTLP_HEADERS="Authorization=Basic ${AUTH_STRING}"
```

`AUTH_STRING` は、公開キーと秘密キーを組み合わせて base64 エンコードしたものです（下記参照）。


### AUTH&#95;STRING の生成

認可には Langfuse の API キーを用いた Basic 認証を使用します。以下の方法で、base64 エンコードされた認証文字列を生成できます:

```bash
echo -n "pk-lf-1234567890:sk-lf-1234567890" | base64
```

GNU システムで長い API キーを使用する場合は、自動改行を防ぐために `-w 0` を追加する必要がある場合があります：

```bash
echo -n "pk-lf-1234567890:sk-lf-1234567890" | base64 -w 0
```


## 実装

Mastra で OpenTelemetry と併用して Langfuse を使えるように設定する手順は次のとおりです。

```typescript
import { Mastra } from "@mastra/core";

export const mastra = new Mastra({
  // ... その他の設定
  telemetry: {
    enabled: true,
    export: {
      type: 'otlp',
      endpoint: 'https://cloud.langfuse.com/api/public/otel/v1/traces', // または任意のエンドポイント
      headers: {
        Authorization: `Basic ${AUTH_STRING}`, // Base64エンコードされた認証文字列
      },
    },
  },
});
```

または、環境変数を使用している場合は、設定を簡略化できます。

```typescript
import { Mastra } from "@mastra/core";

export const mastra = new Mastra({
  // ... その他の設定
  telemetry: {
    enabled: true,
    export: {
      type: 'otlp',
      // エンドポイントとヘッダーはOTEL_EXPORTER_OTLP_*環境変数から読み取られます
    },
  },
});
```


## ダッシュボード

設定が完了すると、[cloud.langfuse.com](https://cloud.langfuse.com) の Langfuse ダッシュボードでトレースと分析を確認できます