---
title: "リファレンス: Agent.streamLegacy()（レガシー） | エージェント | Mastra ドキュメント"
description: "Mastra のエージェントにおける旧式の `Agent.streamLegacy()` メソッドのドキュメント。このメソッドは非推奨で、今後のバージョンで削除されます。"
---

import { Callout } from 'nextra/components';


# Agent.streamLegacy()（レガシー）

<Callout type="warning">
  **非推奨**: このメソッドは非推奨で、V1モデルでのみ動作します。V2モデルでは、新しい[`.stream()`](./stream.mdx)メソッドを使用してください。アップグレードの詳細は[移行ガイド](../../../guides/migrations/vnext-to-standard-apis)を参照してください。
</Callout>

`.streamLegacy()` メソッドは、エージェントのストリーミングAPIの旧式のバージョンで、V1モデルのエージェントからの応答をリアルタイムにストリーミングするために使用されます。このメソッドは、メッセージと任意のストリーミングオプションを受け取ります。

## 使い方の例

```typescript copy
await agent.streamLegacy("エージェント用メッセージ");
```


## パラメータ

<PropertiesTable
  content={[
    {
      name: "messages",
      type: "string | string[] | CoreMessage[] | AiMessageType[] | UIMessageWithMetadata[]",
      description: "エージェントに送信するメッセージ。単一の文字列、文字列の配列、または構造化メッセージオブジェクトを指定できます。",
    },
    {
      name: "options",
      type: "AgentStreamOptions<OUTPUT, EXPERIMENTAL_OUTPUT>",
      isOptional: true,
      description: "ストリーミング処理に関する任意の設定。",
    },
  ]}
/>

### オプションパラメータ

<PropertiesTable
  content={[
  {
    name: "abortSignal",
    type: "AbortSignal",
    isOptional: true,
    description:
      "エージェントの実行を中止するためのシグナルオブジェクト。シグナルが中止されると、実行中のすべての操作が終了されます。"
  },
  {
    name: "context",
    type: "CoreMessage[]",
    isOptional: true,
    description: "エージェントに提供する追加のコンテキストメッセージ。"
  },
  {
    name: "experimental_output",
    type: "Zod schema | JsonSchema7",
    isOptional: true,
    description:
      "テキスト生成とツール呼び出しと並行して構造化出力生成を有効にします。モデルは提供されたスキーマに準拠した応答を生成します。"
  },
  {
    name: "instructions",
    type: "string",
    isOptional: true,
    description:
      "この特定の生成でエージェントのデフォルト指示を上書きするカスタム指示。新しいエージェントインスタンスを作成せずにエージェントの動作を動的に変更するのに便利です。"
  },
  {
    name: "output",
    type: "Zod schema | JsonSchema7",
    isOptional: true,
    description:
      "出力の期待される構造を定義します。JSONスキーマオブジェクトまたはZodスキーマを指定できます。"
  },
  {
    name: "memory",
    type: "object",
    isOptional: true,
    description:
      "メモリの設定。これがメモリを管理する推奨方法です。",
    properties: [
      {
        parameters: [
          {
            name: "thread",
            type: "string | { id: string; metadata?: Record<string, any>, title?: string }",
            isOptional: false,
            description:
              "会話スレッド。文字列IDまたは`id`とオプションの`metadata`を持つオブジェクトとして指定します。"
          }
        ]
      },
      {
        parameters: [
          {
            name: "resource",
            type: "string",
            isOptional: false,
            description:
              "スレッドに関連付けられたユーザーまたはリソースの識別子。"
          }
        ]
      },
      {
        parameters: [
          {
            name: "options",
            type: "MemoryConfig",
            isOptional: true,
            description:
              "メッセージ履歴やセマンティック想起などのメモリ動作の設定。"
          }
        ]
      }
    ]
  },
  {
    name: "maxSteps",
    type: "number",
    isOptional: true,
    defaultValue: "5",
    description: "許可される実行ステップの最大数。"
  },
  {
    name: "maxRetries",
    type: "number",
    isOptional: true,
    defaultValue: "2",
    description: "最大再試行回数。再試行を無効にするには0に設定します。"
  },
  {
    name: "memoryOptions",
    type: "MemoryConfig",
    isOptional: true,
    description:
      "**非推奨。** 代わりに`memory.options`を使用してください。メモリ管理の設定オプション。",
    properties: [
      {
        parameters: [
          {
            name: "lastMessages",
            type: "number | false",
            isOptional: true,
            description:
              "コンテキストに含める最近のメッセージ数、または無効にするにはfalse。"
          }
        ]
      },
      {
        parameters: [
          {
            name: "semanticRecall",
            type: "boolean | { topK: number; messageRange: number | { before: number; after: number }; scope?: 'thread' | 'resource' }",
            isOptional: true,
            description:
              "関連する過去のメッセージを見つけるためのセマンティック想起を有効にします。ブール値または詳細設定を指定できます。"
          }
        ]
      },
      {
        parameters: [
          {
            name: "workingMemory",
            type: "WorkingMemory",
            isOptional: true,
            description: "ワーキングメモリ機能の設定。"
          }
        ]
      },
      {
        parameters: [
          {
            name: "threads",
            type: "{ generateTitle?: boolean | { model: DynamicArgument<MastraLanguageModel>; instructions?: DynamicArgument<string> } }",
            isOptional: true,
            description:
              "自動タイトル生成を含むスレッド固有の設定。"
          }
        ]
      }
    ]
  },
  {
    name: "onFinish",
    type: "StreamTextOnFinishCallback<any> | StreamObjectOnFinishCallback<OUTPUT>",
    isOptional: true,
    description:
      "ストリーミング完了時に呼び出されるコールバック関数。最終結果を受け取ります。"
  },
  {
    name: "onStepFinish",
    type: "StreamTextOnStepFinishCallback<any> | never",
    isOptional: true,
    description:
      "各実行ステップ後に呼び出されるコールバック関数。ステップの詳細をJSON文字列として受け取ります。構造化出力では利用できません。"
  },
  {
    name: "resourceId",
    type: "string",
    isOptional: true,
    description:
      "**非推奨。** 代わりに`memory.resource`を使用してください。エージェントと対話するユーザーまたはリソースの識別子。threadIdが提供される場合は必須です。"
  },
  {
    name: "telemetry",
    type: "TelemetrySettings",
    isOptional: true,
    description: "ストリーミング中のテレメトリ収集の設定。",
    properties: [
      {
        parameters: [
          {
            name: "isEnabled",
            type: "boolean",
            isOptional: true,
            description:
              "テレメトリを有効または無効にします。実験的機能のためデフォルトでは無効です。"
          }
        ]
      },
      {
        parameters: [
          {
            name: "recordInputs",
            type: "boolean",
            isOptional: true,
            description:
              "入力記録を有効または無効にします。デフォルトで有効です。機密情報の記録を避けるために入力記録を無効にしたい場合があります。"
          }
        ]
      },
      {
        parameters: [
          {
            name: "recordOutputs",
            type: "boolean",
            isOptional: true,
            description:
              "出力記録を有効または無効にします。デフォルトで有効です。機密情報の記録を避けるために出力記録を無効にしたい場合があります。"
          }
        ]
      },
      {
        parameters: [
          {
            name: "functionId",
            type: "string",
            isOptional: true,
            description:
              "この関数の識別子。関数別にテレメトリデータをグループ化するために使用されます。"
          }
        ]
      }
    ]
  },
  {
    name: "temperature",
    type: "number",
    isOptional: true,
    description:
      "モデル出力のランダム性を制御します。高い値（例：0.8）は出力をよりランダムにし、低い値（例：0.2）はより集中的で決定論的にします。"
  },
  {
    name: "threadId",
    type: "string",
    isOptional: true,
    description:
      "**非推奨。** 代わりに`memory.thread`を使用してください。会話スレッドの識別子。複数の対話間でコンテキストを維持できます。resourceIdが提供される場合は必須です。"
  },
  {
    name: "toolChoice",
    type: "'auto' | 'none' | 'required' | { type: 'tool'; toolName: string }",
    isOptional: true,
    defaultValue: "'auto'",
    description: "ストリーミング中にエージェントがツールを使用する方法を制御します。",
    properties: [
      {
        parameters: [
          {
            name: "'auto'",
            type: "string",
            description: "モデルにツールを使用するかどうかを決定させます（デフォルト）。"
          }
        ]
      },
      {
        parameters: [
          {
            name: "'none'",
            type: "string",
            description: "ツールを使用しません。"
          }
        ]
      },
      {
        parameters: [
          {
            name: "'required'",
            type: "string",
            description: "モデルに少なくとも1つのツールの使用を要求します。"
          }
        ]
      },
      {
        parameters: [
          {
            name: "{ type: 'tool'; toolName: string }",
            type: "object",
            description: "モデルに名前で特定のツールの使用を要求します。"
          }
        ]
      }
    ]
  },
  {
    name: "toolsets",
    type: "ToolsetsInput",
    isOptional: true,
    description:
      "ストリーミング中にエージェントが利用できる追加のツールセット。"
  },
  {
    name: "clientTools",
    type: "ToolsInput",
    isOptional: true,
    description:
      "リクエストの「クライアント」側で実行されるツール。これらのツールは定義に実行関数を持ちません。"
  },
  {
    name: "savePerStep",
    type: "boolean",
    isOptional: true,
    description:
      "各ストリームステップ完了後にメッセージを段階的に保存します（デフォルト：false）。"
  },
  {
    name: "providerOptions",
    type: "Record<string, Record<string, JSONValue>>",
    isOptional: true,
    description:
      "基盤となるLLMプロバイダーに渡される追加のプロバイダー固有オプション。構造は`{ providerName: { optionKey: value } }`です。例：`{ openai: { reasoningEffort: 'high' }, anthropic: { maxTokens: 1000 } }`。",
    properties: [
      {
        parameters: [
          {
            name: "openai",
            type: "Record<string, JSONValue>",
            isOptional: true,
            description:
              "OpenAI固有のオプション。例：`{ reasoningEffort: 'high' }`"
          }
        ]
      },
      {
        parameters: [
          {
            name: "anthropic",
            type: "Record<string, JSONValue>",
            isOptional: true,
            description:
              "Anthropic固有のオプション。例：`{ maxTokens: 1000 }`"
          }
        ]
      },
      {
        parameters: [
          {
            name: "google",
            type: "Record<string, JSONValue>",
            isOptional: true,
            description:
              "Google固有のオプション。例: `{ safetySettings: [...] }`"
          }
        ]
      },
      {
        parameters: [
          {
            name: "[providerName]",
            type: "Record<string, JSONValue>",
            isOptional: true,
            description:
              "その他のプロバイダー固有のオプション。キーはプロバイダー名、値はプロバイダー固有のオプションのレコードです。"
          }
        ]
      }
    ]
  },
  {
    name: "runId",
    type: "string",
    isOptional: true,
    description:
      "この生成実行の一意のID。追跡とデバッグ用途に使用されます。"
  },
  {
    name: "runtimeContext",
    type: "RuntimeContext",
    isOptional: true,
    description:
      "依存性注入とコンテキスト情報のためのランタイムコンテキスト。"
  },
  {
    name: "maxTokens",
    type: "number",
    isOptional: true,
    description: "生成するトークンの最大数。"
  },
  {
    name: "topP",
    type: "number",
    isOptional: true,
    description:
      "ニュークリアスサンプリング。0から1の間の数値です。`temperature`または`topP`のいずれかを設定することを推奨しますが、両方は設定しないでください。"
  },
  {
    name: "topK",
    type: "number",
    isOptional: true,
    description:
      "後続の各トークンに対して上位K個のオプションからのみサンプリングします。「ロングテール」の低確率応答を除去するために使用されます。"
  },
  {
    name: "presencePenalty",
    type: "number",
    isOptional: true,
    description:
      "プレゼンスペナルティ設定。プロンプトに既に含まれている情報をモデルが繰り返す可能性に影響します。-1（繰り返しを増加）から1（最大ペナルティ、繰り返しを減少）の間の数値です。"
  },
  {
    name: "frequencyPenalty",
    type: "number",
    isOptional: true,
    description:
      "頻度ペナルティ設定。モデルが同じ単語やフレーズを繰り返し使用する可能性に影響します。-1（繰り返しを増加）から1（最大ペナルティ、繰り返しを減少）の間の数値です。"
  },
  {
    name: "stopSequences",
    type: "string[]",
    isOptional: true,
    description:
      "停止シーケンス。設定された場合、停止シーケンスの1つが生成されるとモデルはテキストの生成を停止します。"
  },
  {
    name: "seed",
    type: "number",
    isOptional: true,
    description:
      "ランダムサンプリングに使用するシード（整数）。設定されてモデルでサポートされている場合、呼び出しは決定論的な結果を生成します。"
  },
  {
    name: "headers",
    type: "Record<string, string | undefined>",
    isOptional: true,
    description:
      "リクエストと共に送信される追加のHTTPヘッダー。HTTPベースのプロバイダーにのみ適用されます。"
  }
]}
/>

## 戻り値

<PropertiesTable
  content={[
    {
      name: "textStream",
      type: "AsyncGenerator<string>",
      isOptional: true,
      description:
        "利用可能になり次第テキストのチャンクを順次返す非同期ジェネレーター。",
    },
    {
      name: "fullStream",
      type: "Promise<ReadableStream>",
      isOptional: true,
      description:
        "完全なレスポンスを表す ReadableStream へ解決される Promise。",
    },
    {
      name: "text",
      type: "Promise<string>",
      isOptional: true,
      description:
        "完全なテキストレスポンスへ解決される Promise。",
    },
    {
      name: "usage",
      type: "Promise<{ totalTokens: number; promptTokens: number; completionTokens: number }>",
      isOptional: true,
      description:
        "トークン使用量の情報へ解決される Promise。",
    },
    {
      name: "finishReason",
      type: "Promise<string>",
      isOptional: true,
      description:
        "ストリームが終了した理由へ解決される Promise。",
    },
    {
      name: "toolCalls",
      type: "Promise<Array<ToolCall>>",
      isOptional: true,
      description:
        "ストリーミング中に行われたツール呼び出しへ解決される Promise。",
      properties: [
        {
          parameters: [{
            name: "toolName",
            type: "string",
            required: true,
            description: "呼び出されたツール名。"
          }]
        },
        {
          parameters: [{
            name: "args",
            type: "any",
            required: true,
            description: "ツールに渡された引数。"
          }]
        }
      ]
    },
  ]}
/>

## 拡張された使用例

```typescript showLineNumbers copy
await agent.streamLegacy("エージェントへのメッセージ", {
  temperature: 0.7,
  maxSteps: 3,
  memory: {
    thread: "user-123",
    resource: "test-app"
  },
  toolChoice: "auto"
});
```


## 新しい API への移行

<Callout type="info">
  新しい `.stream()` メソッドは、AI SDK v5 への対応、構造化出力のより適切な取り扱い、改良されたコールバックシステムなど、強化された機能を提供します。詳細な移行手順は [移行ガイド](../../../guides/migrations/vnext-to-standard-apis) を参照してください。
</Callout>

### 迅速な移行の例

#### 以前（レガシー）

```typescript
const result = await agent.streamLegacy("message", {
  temperature: 0.7,
  maxSteps: 3,
  onFinish: (result) => console.log(result)
});
```


#### 以降（新しい API）

```typescript
const result = await agent.stream("message", {
  modelSettings: {
    temperature: 0.7
  },
  maxSteps: 3,
  onFinish: (result) => console.log(result)
});
```


## 関連

- [移行ガイド](../../../guides/migrations/vnext-to-standard-apis)
- [新しい .stream() メソッド](./stream.mdx)
- [レスポンスの生成](../../../docs/agents/overview.mdx#generating-responses)
- [レスポンスのストリーミング](../../../docs/agents/overview.mdx#streaming-responses)