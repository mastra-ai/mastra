---
title: "リファレンス: 要約 | メトリクス | 評価 | Mastra ドキュメント"
description: Mastra の要約メトリクスに関するドキュメント。LLM が生成した要約を、内容の品質と事実の正確性に基づいて評価します。
---

import { ScorerCallout } from '@/components/scorer-callout'


# SummarizationMetric

<ScorerCallout />

`SummarizationMetric` は、LLM の要約が元のテキストの内容を適切に捉え、かつ事実関係の正確さを保っているかを評価します。整合性（事実の正確さ）とカバレッジ（重要情報の網羅）の2側面を組み合わせ、どちらも満たされていることを保証するために両者のうち低い方のスコアを指標とします。

## 基本的な使い方

```typescript
import { openai } from "@ai-sdk/openai";
import { SummarizationMetric } from "@mastra/evals/llm";

// 評価用にモデルを設定する
const model = openai("gpt-4o-mini");

const metric = new SummarizationMetric(model);

const result = await metric.measure(
  "同社は1995年にJohn Smithによって設立された。従業員は当初10人で、2020年までに500人に増えた。本社はシアトルにある。",
  "1995年にJohn Smithが設立し、同社は従業員数を10人から2020年までに500人へ拡大した。",
);

console.log(result.score); // スコア（0〜1）
console.log(result.info); // 要約に関する詳細な評価指標を含むオブジェクト
```


## コンストラクターのパラメーター

<PropertiesTable
  content={[
    {
      name: "model",
      type: "LanguageModel",
      description: "要約を評価するために使用するモデルの設定",
      isOptional: false,
    },
    {
      name: "options",
      type: "SummarizationMetricOptions",
      description: "メトリクスの設定オプション",
      isOptional: true,
      defaultValue: "{ scale: 1 }",
    },
  ]}
/>

### SummarizationMetricOptions

<PropertiesTable
  content={[
    {
      name: "scale",
      type: "number",
      description: "スコアの最大値",
      isOptional: true,
      defaultValue: "1",
    },
  ]}
/>

## measure() のパラメーター

<PropertiesTable
  content={[
    {
      name: "input",
      type: "string",
      description: "要約対象の原文テキスト",
      isOptional: false,
    },
    {
      name: "output",
      type: "string",
      description: "評価する生成要約",
      isOptional: false,
    },
  ]}
/>

## 返り値

<PropertiesTable
  content={[
    {
      name: "score",
      type: "number",
      description: "要約スコア（0からのスケール、既定は0〜1）",
    },
    {
      name: "info",
      type: "object",
      description: "要約に関する詳細な指標を含むオブジェクト",
      properties: [
        {
          type: "string",
          parameters: [
            {
              name: "reason",
              type: "string",
              description:
                "スコアの詳細な説明（整合性と網羅性の両面を含む）",
            },
          ],
        },
        {
          type: "number",
          parameters: [
            {
              name: "alignmentScore",
              type: "number",
              description: "整合性スコア（0〜1）",
            },
          ],
        },
        {
          type: "number",
          parameters: [
            {
              name: "coverageScore",
              type: "number",
              description: "網羅性スコア（0〜1）",
            },
          ],
        },
      ],
    },
  ]}
/>

## スコアリングの詳細

この指標は、2つの重要な要素から要約を評価します:

1. **Alignment Score**: 事実関係の正確性を測定

   - 要約から主張を抽出
   - 各主張を原文と照合して検証
   - 「yes」「no」「unsure」のいずれかを付与

2. **Coverage Score**: 重要情報の網羅性を測定
   - 原文から主要な設問を生成
   - 要約がこれらの設問に回答しているかを確認
   - 情報の包含状況を確認し、包括性を評価

### スコアリングプロセス

1. アラインメント・スコアを計算:

   - 要約から主張を抽出
   - 元テキストと照合して検証
   - 計算式: `supported_claims / total_claims`

2. カバレッジ・スコアを算出:
   - 元テキストから質問を生成
   - 要約に回答が含まれているか確認
   - 完全性を評価
   - 計算式: `answerable_questions / total_questions`

最終スコア: `min(alignment_score, coverage_score) * scale`

### スコアの解釈

（0からのスケール、デフォルトは0～1）

- 1.0: 完璧な要約 - 完全に事実に基づき、重要な情報をすべて網羅
- 0.7～0.9: 軽微な抜けやわずかな不正確さはあるが、総じて優れた要約
- 0.4～0.6: 重要な抜けや不正確さが目立つ中程度の品質
- 0.1～0.3: 大きな省略や事実誤認がある低品質な要約
- 0.0: 無効な要約 - まったくの誤り、または重要な情報が欠落

## 分析付きの例

```typescript
import { openai } from "@ai-sdk/openai";
import { SummarizationMetric } from "@mastra/evals/llm";

// 評価用にモデルを設定する
const model = openai("gpt-4o-mini");

const metric = new SummarizationMetric(model);

const result = await metric.measure(
  "電気自動車メーカーのTeslaは2003年にMartin EberhardとMarc Tarpenningによって設立された。Elon Muskは2004年に最大の投資家として参加し、2008年にCEOとなった。同社初の車種であるRoadsterは2008年に発売された。",
  "Teslaは2003年にElon Muskによって設立され、2008年のRoadsterを皮切りに電気自動車業界に革命をもたらした。",
);

// 出力例:
// {
//   score: 0.5,
//   info: {
//     reason: "スコアが0.5である理由は、網羅性は良好（0.75）で、設立年・初の車種・発売時期に言及している一方、整合性スコアが低い（0.5）のは、会社の創業を本来のMartin EberhardとMarc TarpenningではなくElon Muskに誤って帰属しているためです。
//           最初の車種と発売時期に言及している一方で、整合性スコアが低い（0.5）のは、
//           会社の創業をElon Muskに誤って帰属しており、本来はMartin EberhardとMarc Tarpenningだからです。
//           最終スコアは、事実の正確性と網羅性の両方を満たすことを重視し、これら2つのスコアの最小値を採用しています。"
//           coverage are necessary for a good summary."
//     alignmentScore: 0.5,
//     coverageScore: 0.75,
//   }
// }
```


## 関連項目

- [忠実度メトリック](./faithfulness)
- [完全性メトリック](./completeness)
- [文脈再現率メトリック](./contextual-recall)
- [幻覚（ハルシネーション）メトリック](./hallucination)