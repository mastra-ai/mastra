---
title: "リファレンス: Agent.generateVNext()（実験的） | Agents | Mastra ドキュメント"
description: "Mastra エージェントにおける `Agent.generateVNext()` メソッドのドキュメント。強化された機能により、ストリーミングなしでの応答生成を可能にします。"
---

import { GenerateVNextCallout } from "@/components/generateVNext-callout.tsx"


# Agent.generateVNext()（実験的）

<GenerateVNextCallout />

`.generateVNext()` メソッドは、エージェントからの非ストリーミング応答の生成を可能にし、拡張された機能と柔軟な出力形式を提供します。メッセージと任意の生成オプションを受け取り、Mastra のネイティブ形式と AI SDK v5 との互換性の両方をサポートします。

## 使用例

```typescript copy
// Mastra のデフォルト形式
const mastraResult = await agent.generateVNext("message for agent");

// AI SDK v5 互換形式
const aiSdkResult = await agent.generateVNext("message for agent", {
  format: 'aisdk'
});
```

## パラメータ

<PropertiesTable
  content={[
    {
      name: "messages",
      type: "string | string[] | CoreMessage[] | AiMessageType[] | UIMessageWithMetadata[]",
      description: "エージェントに送信するメッセージ。単一の文字列、文字列配列、または構造化メッセージオブジェクトを指定できます。",
    },
    {
      name: "options",
      type: "AgentExecutionOptions<Output, StructuredOutput, Format>",
      isOptional: true,
      description: "生成処理のための任意の設定。",
    },
  ]}
/>

### 設定

<PropertiesTable
  content={[
  {
    name: 'format',
    type: "'mastra' | 'aisdk'",
    isOptional: true,
    defaultValue: "'mastra'",
    description:
      "出力形式を指定します。Mastra のネイティブ形式（デフォルト）には 'mastra'、AI SDK v5 互換には 'aisdk' を使用します。",
  },
  {
    name: 'maxSteps',
    type: 'number',
    isOptional: true,
    description: '実行中に実行するステップの最大数。',
  },
  {
    name: 'scorers',
    type: "MastraScorers | Record<string, { scorer: MastraScorer['name']; sampling?: ScoringSamplingConfig }>",
    isOptional: true,
    description: '実行結果に対して実行する評価用スコアラー。',
    properties: [
      {
        parameters: [
          {
            name: 'scorer',
            type: 'string',
            isOptional: false,
            description: '使用するスコアラー名。',
          },
        ],
      },
      {
        parameters: [
          {
            name: 'sampling',
            type: 'ScoringSamplingConfig',
            isOptional: true,
            description: 'スコアラーのサンプリング設定。',
            properties: [
              {
                parameters: [
                  {
                    name: 'type',
                    type: "'none' | 'ratio'",
                    isOptional: false,
                    description:
                      "サンプリング戦略の種類。'none' はサンプリングを無効化、'ratio' は割合ベースのサンプリングを行います。",
                  },
                ],
              },
              {
                parameters: [
                  {
                    name: 'rate',
                    type: 'number',
                    isOptional: true,
                    description:
                      "サンプリング率（0〜1）。type が 'ratio' の場合は必須です。",
                  },
                ],
              },
            ],
          },
        ],
      },
    ],
  },
  {
    name: 'tracingContext',
    type: 'TracingContext',
    isOptional: true,
    description: 'スパン階層とメタデータのための AI トレーシングコンテキスト。',
  },
  {
    name: 'returnScorerData',
    type: 'boolean',
    isOptional: true,
    description: 'レスポンスに詳細なスコアリングデータを含めるかどうか。',
  },
  {
    name: 'onChunk',
    type: '(chunk: ChunkType) => Promise<void> | void',
    isOptional: true,
    description: '生成中の各チャンクごとに呼び出されるコールバック関数。',
  },
  {
    name: 'onError',
    type: '({ error }: { error: Error | string }) => Promise<void> | void',
    isOptional: true,
    description:
      '生成中にエラーが発生した場合に呼び出されるコールバック関数。',
  },
  {
    name: 'onAbort',
    type: '(event: any) => Promise<void> | void',
    isOptional: true,
    description: '生成が中断された場合に呼び出されるコールバック関数。',
  },
  {
    name: 'activeTools',
    type: 'Array<keyof ToolSet> | undefined',
    isOptional: true,
    description:
      '実行中に有効化するツール名の配列。未指定の場合は利用可能なすべてのツールが有効になります。',
  },
  {
    name: 'abortSignal',
    type: 'AbortSignal',
    isOptional: true,
    description:
      "エージェントの実行を中断できる Signal オブジェクト。Signal が中断されると、進行中のすべての処理が終了します。",
  },
  {
    name: 'prepareStep',
    type: 'PrepareStepFunction<any>',
    isOptional: true,
    description:
      'マルチステップ実行の各ステップ前に呼び出されるコールバック関数。',
  },
  {
    name: 'context',
    type: 'ModelMessage[]',
    isOptional: true,
    description: 'エージェントに渡す追加のコンテキストメッセージ。',
  },
  {
    name: 'structuredOutput',
    type: 'StructuredOutputOptions<S extends ZodTypeAny = ZodTypeAny>',
    isOptional: true,
    description:
      '開発者体験を向上させるために構造化出力を有効化します。内部で StructuredOutputProcessor を自動的に作成・使用します。',
    properties: [
      {
        parameters: [
          {
            name: 'schema',
            type: 'z.ZodSchema<S>',
            isOptional: false,
            description: '期待される出力構造を定義する Zod スキーマ。',
          },
        ],
      },
      {
        parameters: [
          {
            name: 'model',
            type: 'MastraLanguageModel',
            isOptional: true,
            description:
              "構造化出力の生成に使用する言語モデル。指定しない場合はエージェントのデフォルトモデルを使用します。",
          },
        ],
      },
      {
        parameters: [
          {
            name: 'errorStrategy',
            type: "'strict' | 'warn' | 'fallback'",
            isOptional: true,
            description:
              "スキーマ検証エラーの処理方針。'strict' はエラーを送出、'warn' は警告を記録、'fallback' はフォールバック値を使用します。",
          },
        ],
      },
      {
        parameters: [
          {
            name: 'fallbackValue',
            type: '<S extends ZodTypeAny>',
            isOptional: true,
            description:
              "スキーマ検証に失敗し、errorStrategy が 'fallback' の場合に使用するフォールバック値。",
          },
        ],
      },
      {
        parameters: [
          {
            name: 'instructions',
            type: 'string',
            isOptional: true,
            description:
              '構造化出力生成のための追加指示。',
          },
        ],
      },
    ],
  },
  {
    name: 'outputProcessors',
    type: 'Processor[]',
    isOptional: true,
    description:
      "この実行で使用する出力プロセッサ（エージェントのデフォルトを上書き）。",
  },
  {
    name: 'inputProcessors',
    type: 'Processor[]',
    isOptional: true,
    description:
      "この実行で使用する入力プロセッサ（エージェントのデフォルトを上書き）。",
  },
  {
    name: 'instructions',
    type: 'string',
    isOptional: true,
    description:
      "この実行でエージェントのデフォルトの指示を上書きするカスタム指示。",
  },
  {
    name: 'system',
    type: 'string | string[] | CoreSystemMessage | SystemModelMessage | CoreSystemMessage[] | SystemModelMessage[]',
    isOptional: true,
    description:
      "プロンプトに含めるカスタムのシステムメッセージ。単一の文字列、メッセージオブジェクト、またはいずれかの配列を指定できます。システムメッセージは、エージェントの主指示を補完する追加のコンテキストや挙動の指示を提供します。",
  },
  {
    name: 'output',
    type: 'Zod schema | JsonSchema7',
    isOptional: true,
    description:
      '**非推奨。** structuredOutput と maxSteps:1 を使用して同等のことができます。期待される出力の構造を定義します。JSON Schema オブジェクトまたは Zod スキーマを指定できます。',
  },
  {
    name: 'memory',
    type: 'object',
    isOptional: true,
    description:
      'メモリの設定（会話の永続化と検索）。',
    properties: [
      {
        parameters: [
          {
            name: 'thread',
            type: 'string | { id: string; metadata?: Record<string, any>, title?: string }',
            isOptional: false,
            description:
              '会話の継続性のためのスレッド識別子。文字列 ID、または ID と任意のメタデータ/タイトルを含むオブジェクトを指定できます。',
          },
        ],
      },
      {
        parameters: [
          {
            name: 'resource',
            type: 'string',
            isOptional: false,
            description:
              'ユーザー、セッション、またはコンテキストごとに会話を整理するためのリソース識別子。',
          },
        ],
      },
      {
        parameters: [
          {
            name: 'options',
            type: 'MemoryConfig',
            isOptional: true,
            description:
              '会話管理のための追加のメモリ設定オプション。',
          },
        ],
      },
    ],
  },
  {
    name: 'onFinish',
    type: 'StreamTextOnFinishCallback<any> | StreamObjectOnFinishCallback<OUTPUT>',
    isOptional: true,
    description:
      '生成が完了したときに発火するコールバック。形式によって型が異なります。',
  },
  {
    name: 'onStepFinish',
    type: 'StreamTextOnStepFinishCallback<any> | never',
    isOptional: true,
    description:
      '各生成ステップ後に発火するコールバック。形式によって型が異なります。',
  },
  {
    name: 'resourceId',
    type: 'string',
    isOptional: true,
    description:
      '非推奨。代わりに memory.resource を使用してください。リソース/ユーザーの識別子。',
  },
  {
    name: 'telemetry',
    type: 'TelemetrySettings',
    isOptional: true,
    description: '可観測性のためのテレメトリ収集設定。',
    properties: [
      {
        parameters: [
          {
            name: 'isEnabled',
            type: 'boolean',
            isOptional: true,
            description: 'テレメトリ収集が有効かどうか。',
          },
        ],
      },
      {
        parameters: [
          {
            name: 'recordInputs',
            type: 'boolean',
            isOptional: true,
            description: 'テレメトリに入力データを記録するかどうか。',
          },
        ],
      },
      {
        parameters: [
          {
            name: 'recordOutputs',
            type: 'boolean',
            isOptional: true,
            description: 'テレメトリに出力データを記録するかどうか。',
          },
        ],
      },
      {
        parameters: [
          {
            name: 'functionId',
            type: 'string',
            isOptional: true,
            description: '実行中の関数の識別子。',
          },
        ],
      },
    ],
  },
  {
    name: 'modelSettings',
    type: 'CallSettings',
    isOptional: true,
    description: '温度、topP などのモデル固有設定。',
    properties: [
      {
        parameters: [
          {
            name: 'temperature',
            type: 'number',
            isOptional: true,
            description:
              '生成のランダム性を制御（0〜2）。値が高いほど出力はランダムになります。',
          },
        ],
      },
      {
        parameters: [
          {
            name: 'maxRetries',
            type: 'number',
            isOptional: true,
            description:
              '失敗したリクエストの最大再試行回数。',
          },
        ],
      },
      {
        parameters: [
          {
            name: 'topP',
            type: 'number',
            isOptional: true,
            description:
              'Nucleus サンプリングのパラメータ（0〜1）。生成テキストの多様性を制御します。',
          },
        ],
      },
      {
        parameters: [
          {
            name: 'topK',
            type: 'number',
            isOptional: true,
            description:
              'Top-k サンプリングのパラメータ。語彙を確率上位 k 個のトークンに制限します。',
          },
        ],
      },
      {
        parameters: [
          {
            name: 'presencePenalty',
            type: 'number',
            isOptional: true,
            description:
              'トークン出現に対するペナルティ（-2〜2）。反復を減らします。',
          },
        ],
      },
      {
        parameters: [
          {
            name: 'frequencyPenalty',
            type: 'number',
            isOptional: true,
            description:
              'トークン頻度に対するペナルティ（-2〜2）。頻出トークンの反復を減らします。',
          },
        ],
      },
      {
        parameters: [
          {
            name: 'stopSequences',
            type: 'string[]',
            isOptional: true,
            description:
              '出現したら生成を停止する文字列の配列。',
          },
        ],
      },
    ],
  },
  {
    name: 'threadId',
    type: 'string',
    isOptional: true,
    description:
      '非推奨。代わりに memory.thread を使用してください。会話の継続性のためのスレッド識別子。',
  },
  {
    name: 'toolChoice',
    type: "'auto' | 'none' | 'required' | { type: 'tool'; toolName: string }",
    isOptional: true,
    description: '生成中のツールの選択方法を制御します。',
    properties: [
      {
        parameters: [
          {
            name: "'auto'",
            type: 'string',
            isOptional: false,
            description: 'ツールをいつ使用するかをモデルに任せる（デフォルト）。',
          },
        ],
      },
      {
        parameters: [
          {
            name: "'none'",
            type: 'string',
            isOptional: false,
            description: 'ツールの使用を完全に無効化します。',
          },
        ],
      },
      {
        parameters: [
          {
            name: "'required'",
            type: 'string',
            isOptional: false,
            description: '少なくとも 1 つのツールを必ず使用させます。',
          },
        ],
      },
      {
        parameters: [
          {
            name: "{ type: 'tool'; toolName: string }",
            type: 'object',
            isOptional: false,
            description: '特定のツールを必ず使用させます。',
          },
        ],
      },
    ],
  },
  {
    name: 'toolsets',
    type: 'ToolsetsInput',
    isOptional: true,
    description: 'この実行で使用できる追加のツールセット。',
  },
  {
    name: 'clientTools',
    type: 'ToolsInput',
    isOptional: true,
    description: '実行中に利用可能なクライアントサイドのツール。',
  },
  {
    name: 'savePerStep',
    type: 'boolean',
    isOptional: true,
    description:
      '各生成ステップの完了後にメッセージを段階的に保存します（デフォルト: false）。',
  },
  {
    name: 'providerOptions',
    type: 'Record<string, Record<string, JSONValue>>',
    isOptional: true,
    description: '言語モデルに渡すプロバイダー固有のオプション。',
    properties: [
      {
        parameters: [
          {
            name: 'openai',
            type: 'Record<string, JSONValue>',
            isOptional: true,
            description:
              'OpenAI 固有のオプション（reasoningEffort、responseFormat など）。',
          },
        ],
      },
      {
        parameters: [
          {
            name: 'anthropic',
            type: 'Record<string, JSONValue>',
            isOptional: true,
            description: 'Anthropic 固有のオプション（maxTokens など）。',
          },
        ],
      },
      {
        parameters: [
          {
            name: 'google',
            type: 'Record<string, JSONValue>',
            isOptional: true,
            description: 'Google 固有のオプション。',
          },
        ],
      },
      {
        parameters: [
          {
            name: '[providerName]',
            type: 'Record<string, JSONValue>',
            isOptional: true,
            description: '任意のプロバイダー固有のオプション。',
          },
        ],
      },
    ],
  },
  {
    name: 'runId',
    type: 'string',
    isOptional: true,
    description: 'この実行ランの一意の識別子。',
  },
  {
    name: 'runtimeContext',
    type: 'RuntimeContext',
    isOptional: true,
    description: '動的な設定と状態を含むランタイムコンテキスト。',
  },
  {
    name: 'stopWhen',
    type: 'StopCondition | StopCondition[]',
    isOptional: true,
    description:
      '実行を停止する条件（例: ステップ数、トークン上限）。',
  },
]}
/>

## 返り値

<PropertiesTable
  content={[
    {
      name: "result",
      type: "Awaited<ReturnType<MastraModelOutput<Output>['getFullOutput']>> | Awaited<ReturnType<AISDKV5OutputStream<Output>['getFullOutput']>>",
      description: "生成処理の最終的な出力全体を返します。format が 'mastra'（デフォルト）の場合は MastraModelOutput の結果を、'aisdk' の場合は AI SDK v5 との互換性のため AISDKV5OutputStream の結果を返します。",
    },
  ]}
/>