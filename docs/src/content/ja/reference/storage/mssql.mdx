---
title: "MSSQL ストレージ | ストレージシステム | Mastra Core"
description: Mastra における MSSQL ストレージ実装のドキュメントです。
---

# MSSQL ストレージ

MSSQL ストレージ実装は、Microsoft SQL Server データベースを用いた本番運用レベルのストレージソリューションを提供します。

## インストール

```bash copy
npm install @mastra/mssql@latest
```


## 使い方

```typescript copy showLineNumbers
import { MSSQLStore } from "@mastra/mssql";

const storage = new MSSQLStore({
  connectionString: process.env.DATABASE_URL,
});
```


## パラメータ

<PropertiesTable
  content={[
    {
      name: "connectionString",
      type: "string",
      description:
        "MSSQL の接続文字列（例：mssql://user:pass@host:1433/dbname）",
      isOptional: false,
    },
    {
      name: "schemaName",
      type: "string",
      description:
        "ストレージで使用するスキーマ名。未指定の場合は既定のスキーマが使用されます。",
      isOptional: true,
    },
  ]}
/>

## コンストラクターの例

`MSSQLStore` は次の方法でインスタンス化できます：

```ts
import { MSSQLStore } from "@mastra/mssql";

// 接続文字列のみを使用
const store1 = new MSSQLStore({
  connectionString: "mssql://user:password@localhost:1433/mydb",
});

// カスタムスキーマ名付きの接続文字列を使用
const store2 = new MSSQLStore({
  connectionString: "mssql://user:password@localhost:1433/mydb",
  schemaName: "custom_schema", // 省略可
});

// 個別の接続パラメータを使用
const store4 = new MSSQLStore({
  server: "localhost",
  port: 1433,
  database: "mydb",
  user: "user",
  password: "password",
});

// schemaName を含む個別パラメータ
const store5 = new MSSQLStore({
  server: "localhost",
  port: 1433,
  database: "mydb",
  user: "user",
  password: "password",
  schemaName: "custom_schema", // 省略可
});
```


## 追記

### スキーマ管理

ストレージ実装はスキーマの作成と更新を自動で処理します。次のテーブルを作成します:

- `mastra_workflow_snapshot`: ワークフローの状態と実行データを保存
- `mastra_evals`: 評価結果とメタデータを保存  
- `mastra_threads`: 会話スレッドを保存
- `mastra_messages`: 個々のメッセージを保存
- `mastra_traces`: テレメトリおよびトレースデータを保存
- `mastra_scorers`: スコアリングおよび評価データを保存
- `mastra_resources`: リソースのワーキングメモリデータを保存

### データベースおよびプールへの直接アクセス

`MSSQLStore` は、mssql の接続プールを公開フィールドとして提供します:

```typescript
store.pool // mssql の接続プールインスタンス
```

これにより、直接クエリやカスタムのトランザクション管理が可能になります。これらのフィールドを使用する場合:

* 接続およびトランザクションの適切な処理は利用者の責任です。
* ストアを閉じる（`store.close()`）と、関連する接続プールが破棄されます。
* 直接アクセスは、MSSQLStore のメソッドが提供する追加のロジックや検証を迂回します。

このアプローチは、低レベルのアクセスが必要となる高度なユースケースを想定しています。
