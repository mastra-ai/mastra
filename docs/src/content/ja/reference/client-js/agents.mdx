---
title: Mastra クライアントエージェント API
description: client-js SDK を使って、応答生成、ストリーミングでの対話、エージェントツールの管理など、Mastra の AI エージェントとのやり取り方法を学びます。
---

# Agents API

Agents API は、Mastra の AI エージェントとの対話に用いるメソッドを提供し、応答生成、ストリーミングでのやり取り、エージェントツールの管理を行えます。

## すべてのエージェントの取得

利用可能なエージェントの一覧を取得します。

```typescript
const agents = await mastraClient.getAgents();
```


## 特定のエージェントを操作する

特定のエージェントのインスタンスを取得するには:

```typescript
const agent = mastraClient.getAgent("agent-id");
```


## エージェントのメソッド

### エージェントの詳細を取得

エージェントの詳細情報を取得します:

```typescript
const details = await agent.details();
```


### 応答を生成

エージェントから応答を生成します:

```typescript
const response = await agent.generate({
  messages: [
    {
      role: "user",
      content: "こんにちは。お元気ですか？",
    },
  ],
  threadId: "thread-1", // 任意: 会話コンテキスト用のスレッドID
  resourceId: "resource-1", // 任意: リソースID
  output: {}, // 任意: 出力設定
});
```


### ストリーム応答

リアルタイムのやり取りに向けて、エージェントからの応答をストリーミング配信します：

```typescript
const response = await agent.stream({
  messages: [
    {
      role: "user",
      content: "物語を聞かせて",
    },
  ],
});

// processDataStream ユーティリティでデータストリームを処理
response.processDataStream({
  onChunk: async(chunk) => {
    console.log(chunk);
  },
});


// レスポンスボディから直接読み取ることも可能です
const reader = response.body.getReader();
while (true) {
  const { done, value } = await reader.read();
  if (done) break;
  console.log(new TextDecoder().decode(value));
}
```


### クライアントツール

クライアント側ツールを使うと、エージェントからの要求に応じてクライアント側でカスタム関数を実行できます。

#### 基本的な使用方法

```typescript
import { createTool } from '@mastra/client-js';
import { z } from 'zod';

const colorChangeTool = createTool({
  id: 'changeColor',
  description: '背景色を変更します',
  inputSchema: z.object({
    color: z.string(),
  }),
  execute: async ({ context }) => {
    document.body.style.backgroundColor = context.color;
    return { success: true };
  }
})


// generateで使用
const response = await agent.generate({
  messages: '背景を青に変更',
  clientTools: {colorChangeTool},
});

// streamで使用
const response = await agent.stream({
  messages: '背景を緑に変更',
  clientTools: {colorChangeTool},
});

response.processDataStream({
  onChunk: async (chunk) => {
    if (chunk.type === 'text-delta') {
      console.log(chunk.payload.text);
    } else if (chunk.type === 'tool-call') {
      console.log(`ツール ${chunk.payload.toolName} を引数 ${JSON.stringify(chunk.payload.args, null, 2)} で呼び出し中`);
    }
  },
});
```


### エージェントのツールを取得

エージェントで利用可能な特定のツールの情報を取得します：

```typescript
const tool = await agent.getTool("tool-id");
```


### エージェントの評価を取得

エージェントの評価結果を取得します。

```typescript
// CI 評価を取得
const evals = await agent.evals();

// ライブ評価を取得
const liveEvals = await agent.liveEvals();
```


### Stream

拡張 API と改良されたメソッドシグネチャを用いて、レスポンスをストリーミングします。このメソッドは Mastra のネイティブ形式をサポートし、より強力な機能と柔軟なフォーマットを提供します。

```typescript
const response = await agent.stream(
  "物語を聞かせて",
  {
    threadId: "thread-1",
    clientTools: { colorChangeTool },
  }
);

// ストリームを処理
response.processDataStream({
  onChunk: async (chunk) => {
    if (chunk.type === 'text-delta') {
      console.log(chunk.payload.text);
    }
  },
});
```


#### AI SDK 互換フォーマット

クライアント側で `agent.stream(...)` のレスポンスから AI SDK 形式のパーツをストリーミングするには、`response.processDataStream` を `ReadableStream<ChunkType>` でラップし、`toAISdkFormat` を使用します。

```typescript filename="client-ai-sdk-transform.ts" copy
import { createUIMessageStream } from 'ai';
import { toAISdkFormat } from '@mastra/ai-sdk';
import type { ChunkType, MastraModelOutput } from '@mastra/core/stream';

const response = await agent.stream({ messages: '物語を聞かせて' });

const chunkStream: ReadableStream<ChunkType> = new ReadableStream<ChunkType>({
  start(controller) {
    response.processDataStream({
      onChunk: async (chunk) => controller.enqueue(chunk as ChunkType),
    }).finally(() => controller.close());
  },
});

const uiMessageStream = createUIMessageStream({
  execute: async ({ writer }) => {
    for await (const part of toAISdkFormat(chunkStream as unknown as MastraModelOutput, { from: 'agent' })) {
      writer.write(part);
    }
  },
});

for await (const part of uiMessageStream) {
  console.log(part);
}
```


### 生成

拡張された API を使い、改良されたメソッドシグネチャと AI SDK v5 の互換性に対応してレスポンスを生成します:

```typescript
const response = await agent.generate(
  "こんにちは、元気ですか？",
  {
    threadId: "thread-1",
    resourceId: "resource-1",
  }
);
```
