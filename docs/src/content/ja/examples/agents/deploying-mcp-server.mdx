---
title: "例: MCPServer のデプロイ | Agents | Mastra Docs"
description: stdio トランスポートを用いた Mastra MCPServer のセットアップ、ビルド、デプロイから NPM への公開までの例。
---

import { GithubLink } from "@/components/github-link";


# 例: MCPServer のデプロイ

この例では、stdio トランスポートを使って基本的な Mastra MCPServer をセットアップし、ビルドして、NPM への公開などのデプロイ準備を行う方法を説明します。

## 依存関係をインストール

必要なパッケージをインストールします：

```bash
pnpm add @mastra/mcp @mastra/core tsup
```


## MCP サーバーをセットアップする

1. `/src/mastra/stdio.ts` など、stdio サーバー用のファイルを作成します。

2. 次のコードをファイルに追加します。実際の Mastra のツールをインポートし、サーバーに適切な名前を付けてください。

   ```typescript filename="src/mastra/stdio.ts" copy
   #!/usr/bin/env node
   import { MCPServer } from "@mastra/mcp";
   import { weatherTool } from "./tools";

   const server = new MCPServer({
     name: "my-mcp-server",
     version: "1.0.0",
     tools: { weatherTool },
   });

   server.startStdio().catch((error) => {
     console.error("Error running MCP server:", error);
     process.exit(1);
   });
   ```

3. `package.json` を更新し、ビルド済みのサーバーファイルを指す `bin` エントリと、サーバーをビルドするスクリプトを追加します。

```json filename="package.json" copy
{
  "bin": "dist/stdio.js",
  "scripts": {
    "build:mcp": "tsup src/mastra/stdio.ts --format esm --no-splitting --dts && chmod +x dist/stdio.js"
  }
}
```

4. ビルドコマンドを実行します：

   ```bash
   pnpm run build:mcp
   ```

   これによりサーバーのコードがコンパイルされ、出力ファイルが実行可能になります。


## NPM へのデプロイ

`npx` 経由または依存関係として、他の人（や自分自身）が MCP サーバーを利用できるようにするには、NPM に公開します。

1. NPM アカウントを作成し、ログインしていることを確認します（`npm login`）。
2. `package.json` のパッケージ名が一意で、利用可能であることを確認します。
3. ビルド後、プロジェクトのルートで公開コマンドを実行します：

    ```bash
    npm publish --access public
    ```

    パッケージの公開に関する詳細は、[NPM ドキュメント](https://docs.npmjs.com/creating-and-publishing-scoped-public-packages)を参照してください。

## デプロイ済みの MCP サーバーを使用する

公開が完了すると、`MCPClient` はパッケージを実行するコマンドを指定して、あなたの MCP サーバーを利用できます。Claude Desktop、Cursor、Windsurf など、他の MCP クライアントを使うことも可能です。

```typescript
import { MCPClient } from "@mastra/mcp";

const mcp = new MCPClient({
  servers: {
    // この MCP サーバーのインスタンスに名前を付ける
    yourServerName: {
      command: "npx",
      args: ["-y", "@your-org-name/your-package-name@latest"], // 自分のパッケージ名に置き換えてください
    },
  },
});

// この設定からツールやツールセットを取得してエージェントで使用できます
const tools = await mcp.getTools();
const toolsets = await mcp.getToolsets();
```

Note: 組織スコープを付けずに公開した場合、`args` は単に `["-y", "your-package-name@latest"]` になることがあります。

<br />

<br />

<hr className="dark:border-[#404040] border-gray-300" />

<br />

<br />
