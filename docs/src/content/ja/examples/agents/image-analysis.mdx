---
title: "例：画像解析エージェント | Agents | Mastra Docs"
description: Unsplashの画像をMastraのAIエージェントで解析し、物体の識別、種の特定、場所の説明を行う例。
---

import { GithubLink } from "@/components/github-link";


# 画像解析

AI エージェントは、テキストの指示とあわせて視覚コンテンツを処理することで、画像を分析し理解できます。この機能により、エージェントは物体の特定、シーンの説明、画像に関する質問への回答、さらには複雑な視覚的推論タスクの実行が可能になります。

## 前提条件

* [Unsplash](https://unsplash.com/documentation#creating-a-developer-account) の開発者アカウント、アプリケーション、APIキー
* OpenAI APIキー

この例では`openai`モデルを使用します。`OPENAI_API_KEY` と `UNSPLASH_ACCESS_KEY` の両方を `.env` ファイルに追加してください。

```bash filename=".env" copy
OPENAI_API_KEY=<あなたの API キー>
UNSPLASH_ACCESS_KEY=<あなたの Unsplash アクセスキー>
```


## エージェントの作成

画像を分析して物体を認識し、場面を描写し、視覚的な内容に関する質問に答えるシンプルなエージェントを作成します。

```typescript filename="src/mastra/agents/example-image-analysis-agent.ts" showLineNumbers copy
import { openai } from "@ai-sdk/openai";
import { Agent } from "@mastra/core/agent";

export const imageAnalysisAgent = new Agent({
  name: "image-analysis",
  description: "画像を分析して物体を特定し、シーンを説明します",
  instructions: `
    画像を表示して物体を特定し、シーンを説明し、内容に関する質問に回答できます。
    また、動物の種を判別したり、画像内の場所を説明したりすることもできます。
   `,
  model: openai("gpt-4o")
});
```

> 設定オプションの全一覧は、[Agent](../../reference/agents/agent.mdx)を参照してください。


## エージェントの登録

エージェントを使用するには、メインの Mastra インスタンスに登録してください。

```typescript filename="src/mastra/index.ts" showLineNumbers copy
import { Mastra } from "@mastra/core/mastra";

import { imageAnalysisAgent } from "./agents/example-image-analysis-agent";

export const mastra = new Mastra({
  // 省略
  agents: { imageAnalysisAgent }
});
```


## 関数の作成

この関数は、エージェントに解析させるために、Unsplash からランダムな画像を取得します。

```typescript filename="src/mastra/utils/get-random-image.ts" showLineNumbers copy
export const getRandomImage = async (): Promise<string> => {
  const queries = ["野生生物", "羽毛", "飛翔", "鳥類"];
  const query = queries[Math.floor(Math.random() * queries.length)];
  const page = Math.floor(Math.random() * 20);
  const order_by = Math.random() < 0.5 ? "relevant" : "latest";

  const response = await fetch(`https://api.unsplash.com/search/photos?query=${query}&page=${page}&order_by=${order_by}`, {
    headers: {
      Authorization: `Client-ID ${process.env.UNSPLASH_ACCESS_KEY}`,
      "Accept-Version": "v1"
    },
    cache: "no-store"
  });

  const { results } = await response.json();
  return results[Math.floor(Math.random() * results.length)].urls.regular;
};
```


## 使用例

`getAgent()` でエージェント参照を取得し、プロンプトを渡して `generate()` を呼び出します。`content` 配列には、画像の `type`、`imageUrl`、`mimeType`、そしてエージェントの応答方法に関する明確な指示を含めてください。

```typescript filename="src/test-image-analysis.ts" showLineNumbers copy
import "dotenv/config";

import { mastra } from "./mastra";
import { getRandomImage } from "./mastra/utils/get-random-image";

const imageUrl = await getRandomImage();
const agent = mastra.getAgent("imageAnalysisAgent");

const response = await agent.generate([
  {
    role: "user",
    content: [
      {
        type: "image",
        image: imageUrl,
        mimeType: "image/jpeg"
      },
      {
        type: "text",
        text: `この画像を分析し、主要な物体や被写体を特定してください。動物がいる場合は、その一般名と学名を記してください。場所や環境についても、1～2文で簡潔に説明してください。`
      }
    ]
  }
]);

console.log(response.text);
```

<GithubLink outdated={true} marginTop="mt-16" link="https://github.com/mastra-ai/mastra/blob/main/examples/basics/agents/bird-checker" />


## 関連項目

- [エージェントの呼び出し](./calling-agents.mdx#from-the-command-line)