---
title: "例: Context Position | Evals | Mastra Docs"
description: 応答の順序性を評価するためにContext Positionメトリクスを使用する例。
---

import { GithubLink } from "@/components/github-link";
import { ScorerCallout } from '@/components/scorer-callout'


# コンテキスト位置評価

<ScorerCallout />

`ContextPositionMetric` を使用して、応答が最も関連性の高いコンテキストセグメントに支えられているかどうかを評価します。このメトリックは `query` と `response` を受け取り、スコアと、その理由を含む `info` オブジェクトを返します。

## インストール

```bash copy
npm install @mastra/evals
```


## 高い位置づけの例

この例では、提供されたコンテキストの最初の記述に基づき、応答がクエリに直接答えています。周辺のコンテキストも一貫して補強的な情報を示しており、強固な位置づけの整合が得られます。

```typescript filename="src/example-high-position.ts" showLineNumbers copy
import { openai } from "@ai-sdk/openai";
import { ContextPositionMetric } from "@mastra/evals/llm";

const metric = new ContextPositionMetric(openai("gpt-4o-mini"), {
  context: [
    "フランスの首都はパリです。",
    "パリは508年から首都です。",
    "パリはフランスの政治の中心地として機能しています。",
    "首都にはフランス政府が置かれています。"
  ]
});

const query = "フランスの首都はどこですか？";
const response = "フランスの首都はパリです。";

const result = await metric.measure(query, response);

console.log(result);
```


### 高い位置での出力

関連情報がコンテキストの先頭にあり、余計な要素やノイズに邪魔されることなく回答を直接裏付けているため、この出力は満点となります。

```typescript
{
  score: 1,
  info: {
    reason: 'スコアが1なのは、提供されたすべてのコンテキストが、フランスの首都がパリであることを確認し、出力を直接裏付けているためであり、各記述が歴史的・政治的・機能的な観点から回答を補強しているからです。'
  }
}
```


## 位置が混在した例

この例では、応答が非常に関連性の高い情報に、文脈の後半から得られた追加の詳細を組み合わせています。体重に関する事実はクエリに答えているものの、関連性の低い事実が含まれることで、応答の位置的な精度が下がっています。

```typescript filename="src/example-mixed-position.ts" showLineNumbers copy
import { openai } from "@ai-sdk/openai";
import { ContextPositionMetric } from "@mastra/evals/llm";

const metric = new ContextPositionMetric(openai("gpt-4o-mini"), {
  context: [
    "ゾウは草食動物です。",
    "成長したゾウは最大で13,000ポンドにもなります。",
    "ゾウは陸上最大の動物です。",
    "ゾウは植物や草を食べます。"
  ]
});

const query = "ゾウはどのくらいの重さですか？";
const response = "成体のゾウは最大で13,000ポンドにもなり、陸上最大の動物です。";

const result = await metric.measure(query, response);

console.log(result);

```


### 位置が混在した出力

関連情報は含まれているものの、優先度の低い文脈と混ざっているため、出力は中程度の評価にとどまります。これにより、文脈の並びと応答の焦点との整合性が弱まります。

```typescript
{
  score: 0.4,
  info: {
    reason: 'スコアが0.4なのは、成体のゾウの体重に関する直接的な回答が含まれており、これは非常に関連性が高いからです。一方で、ゾウが草食動物であることや食習性といった、体重の理解に寄与しない無関係な情報も含まれています。関連性の高い内容と低い内容が混在しているため、全体のスコアは低くなっています。'
  }
}
```


## 低位置の例

この例では、応答はコンテキストの末尾にある関連情報を参照しています。コンテキストの前半では無関係な説明的な詳細が導入されており、想定される根拠情報の順序が乱されています。

```typescript filename="src/example-low-position.ts" showLineNumbers copy
import { openai } from "@ai-sdk/openai";
import { ContextPositionMetric } from "@mastra/evals/llm";

const metric = new ContextPositionMetric(openai("gpt-4o-mini"), {
  context: [
    "虹は空に現れます。",
    "虹はさまざまな色があります。",
    "虹は弧を描く形をしています。",
    "虹は日光が水滴に当たるときに生じます。"
  ]
});

const query = "虹はどのようにしてできるのですか？";
const response = "虹は、空気中の水滴と日光が相互作用することで生じます。"

const result = await metric.measure(query, response);

console.log(result);
```


### 低位置の出力

クエリに関連する重要な根拠情報が文脈の後半でようやく現れ、前半の内容がほとんど（あるいはまったく）寄与しないため、この出力は低いスコアとなります。

```typescript
{
  score: 0.12,
  info: {
    reason: 'スコアが0.12なのは、関連する文脈が虹の生成過程を直接説明している一方、他の記述は無関係か、生成過程にせいぜい周辺的にしか関係しない情報しか示していないためです。'
  }
}
```


## メトリクスの設定

期待される情報の順序を表す `context` 配列を指定して、`ContextPositionMetric` インスタンスを作成できます。`scale` などのオプションパラメータを設定して、到達可能な最大スコアを指定することもできます。

```typescript showLineNumbers copy
const metric = new ContextPositionMetric(openai("gpt-4o-mini"), {
  context: [""],
  scale: 1
});
```

> 設定オプションの一覧は、[ContextPositionMetric](/reference/evals/context-position.mdx)を参照してください。


## 結果の理解

`ContextPositionMetric` は次の形の結果を返します:

```typescript
{
  score: 数値,
  info: {
    reason: 文字列
  }
}
```


### 位置スコア

0〜1 の範囲の位置スコア:

- **1.0**: 理想的な位置づけ – 最も重要な情報が最初にある。
- **0.7–0.9**: 強い位置づけ – 重要な情報の多くが冒頭にある。
- **0.4–0.6**: ばらつきのある位置づけ – 重要な情報が全体に散らばっている。
- **0.1–0.3**: 弱い位置づけ – 重要な情報の多くが末尾にある。
- **0.0**: 位置づけなし – まったく無関係、または並びが逆。

### 位置情報

スコアの説明（以下を含む）:

- クエリと応答に対するコンテキストの関連性
- コンテキスト列内における関連コンテンツの位置
- 後半よりも前半のコンテキストを重視すること
- コンテキストの全体的な整理と構成

<GithubLink
  outdated={true}
  marginTop='mt-16'
  link="https://github.com/mastra-ai/mastra/blob/main/examples/basics/evals/context-position"
/>