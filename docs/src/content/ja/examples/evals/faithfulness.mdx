---
title: "例: Faithfulness | Evals | Mastra Docs"
description: コンテキストと照らし合わせて、応答の事実忠実性を評価するために Faithfulness メトリックを用いる例。
---

import { GithubLink } from "@/components/github-link";
import { ScorerCallout } from '@/components/scorer-callout'


## Faithfulness Evaluation（忠実性評価）

<ScorerCallout />

`FaithfulnessMetric` を使って、レスポンスの主張が提供されたコンテキストによって裏付けられているかを評価します。このメトリクスは `query` と `response` を受け取り、スコアと理由を含む `info` オブジェクトを返します。

## インストール

```bash copy
npm install @mastra/evals
```


## 高い忠実度の例

この例では、応答が文脈と密接に整合しています。出力内の各記述は検証可能で、提供されたコンテキスト項目によって裏付けられており、高いスコアにつながります。

```typescript filename="src/example-high-faithfulness.ts" showLineNumbers copy
import { openai } from "@ai-sdk/openai";
import { FaithfulnessMetric } from "@mastra/evals/llm";

const metric = new FaithfulnessMetric(openai("gpt-4o-mini"), {
  context: [
    "Tesla Model 3 は 2017 年に発売されました。",
    "航続距離は最長で 358 マイルです。",
    "ベースモデルは 0～60 mph 加速が 5.8 秒です。"
  ]
});

const query = "Tesla Model 3 について教えてください。";
const response = "Tesla Model 3 は 2017 年に発表されました。1 回の充電で最長 358 マイル走行でき、ベースバージョンは 0～60 mph を 5.8 秒で達成します。";

const result = await metric.measure(query, response);

console.log(result);
```


### 高い忠実度の出力

この出力は、示されているすべての情報が文脈に直接たどれるため、スコア1となります。欠落や矛盾はありません。

```typescript
{
  score: 1,
  info: {
    reason: 'スコアが1であるのは、出力中のすべての主張が提供されたコンテキストによって裏付けられているためです。'
  }
}
```


## 忠実性が混在する例

この例では、裏付けのある主張と、裏付けのない主張が混在しています。応答の一部はコンテキストによって支えられていますが、他の部分はソース資料にない新たな情報を持ち込んでいます。

```typescript filename="src/example-mixed-faithfulness.ts" showLineNumbers copy
import { openai } from "@ai-sdk/openai";
import { FaithfulnessMetric } from "@mastra/evals/llm";

const metric = new FaithfulnessMetric(openai("gpt-4o-mini"), {
  context: [
    "Python は Guido van Rossum によって作られました。",
    "最初のバージョンは 1991 年にリリースされました。",
    "Python はコードの可読性を重視しています。"
  ]
});

const query = "Python について教えてください。";
const response = "Python は Guido van Rossum によって作られ、1991 年にリリースされました。現在、最も人気のあるプログラミング言語の一つで、世界中の何百万人もの開発者に利用されています。";

const result = await metric.measure(query, response);

console.log(result);
```


### 忠実性が混在した出力

検証可能なのが応答の一部にとどまるため、スコアは低くなります。いくつかの主張は文脈と一致する一方、他は未確認または範囲外であり、全体としての忠実性を損なっています。

```typescript
{
  score: 0.5,
  info: {
    reason: "スコアが0.5であるのは、文脈で裏付けられる主張が2つ（「PythonはGuido van Rossumによって作られた」「Pythonは1991年にリリースされた」）ある一方で、Pythonの人気や利用状況に関する残りの2つの主張は文脈に記載がなく検証できないためです。"
  }
}
```


## 忠実度が低い例

この例では、回答が文脈と直接矛盾しています。どの主張にも根拠がなく、いくつかは提示された事実と矛盾しています。

```typescript filename="src/example-low-faithfulness.ts" showLineNumbers copy
import { openai } from "@ai-sdk/openai";
import { FaithfulnessMetric } from "@mastra/evals/llm";

const metric = new FaithfulnessMetric(openai("gpt-4o-mini"), {
  context: [
    "火星は太陽から4番目の惑星です。",
    "主成分が二酸化炭素の薄い大気を持っています。",
    "フォボスとダイモスという2つの小さな衛星が火星の周りを回っています。"
  ]
});

const query = "火星について何が分かっていますか？";
const response = "火星は太陽から3番目の惑星です。酸素と窒素が豊富な濃い大気を持ち、3つの大きな衛星が周回しています。";

const result = await metric.measure(query, response);

console.log(result);
```


### 忠実度の低い出力

各主張が不正確、または文脈と矛盾しているため、スコアは0になります。

```typescript
{
  score: 0,
  info: {
    reason: "スコアが0なのは、出力内のすべての主張が提示されたコンテキストと矛盾しているためです。出力は火星が太陽から3番目の惑星だと述べていますが、コンテキストでは明確に4番目だとしています。さらに、火星には酸素と窒素に富む厚い大気があると主張していますが、これは主に二酸化炭素で構成された薄い大気だというコンテキストの記述と矛盾します。最後に、出力は火星が3つの大きな衛星に周回されていると述べていますが、コンテキストはフォボスとダイモスという2つの小さな衛星しかないと明記しています。以上より、裏付けられる主張はなく、スコアは0となります。"
  }
}
```


## メトリックの設定

評価における事実の参照元を定義する `context` 配列を指定して、`FaithfulnessMetric` インスタンスを作成できます。最大スコアを調整する `scale` などのオプションパラメータも設定できます。

```typescript showLineNumbers copy
const metric = new FaithfulnessMetric(openai("gpt-4o-mini"), {
  context: [""],
  scale: 1
});
```

> すべての設定オプションの一覧は、[FaithfulnessMetric](/reference/evals/faithfulness.mdx) を参照してください。


## 結果の理解

`FaithfulnessMetric` は次の形式で結果を返します:

```typescript
{
  score: number,
  info: {
    reason: 文字列
  }
}
```


### 忠実性スコア

0～1の範囲の忠実性スコア:

- **1.0**: すべての記述が正確で、文脈によって直接裏付けられている。
- **0.7–0.9**: ほとんどの記述は正しいが、軽微な付加や省略がある。
- **0.4–0.6**: 一部の記述は裏付けられているが、他は検証できない。
- **0.1–0.3**: 内容の大半が不正確、または裏付けがない。
- **0.0**: すべての記述が誤り、または文脈と矛盾している。

### 忠実性に関する情報

スコアの説明。以下を含みます:

- どの主張が検証されたか、あるいは反証されたか
- 事実との整合度
- 欠落や捏造された詳細に関する所見
- 応答全体の信頼性の要約

<GithubLink
  outdated={true}
  marginTop='mt-16'
  link="https://github.com/mastra-ai/mastra/blob/main/examples/basics/evals/faithfulness"
/>