---
title: "例: コンテキスト関連度 | Evals | Mastra Docs"
description: クエリに対してコンテキスト情報がどれだけ適合しているかを評価するために、コンテキスト関連度メトリックを用いる例。
---

import { GithubLink } from "@/components/github-link";
import { ScorerCallout } from '@/components/scorer-callout'


# コンテキスト適合性の評価

<ScorerCallout />

`ContextRelevancyMetric` を使って、取得したコンテキストが元のクエリにどれほど適合しているかを評価します。このメトリックは `query` と `response` を受け取り、スコアと、その理由を含む `info` オブジェクトを返します。

## インストール

```bash copy
npm install @mastra/evals
```


## 高い関連性の例

この例では、回答はクエリに直接関係するコンテキストのみを使用しています。すべてのコンテキスト項目が回答を支えており、その結果、関連性スコアは満点となります。

```typescript filename="src/example-high-context-relevancy.ts" showLineNumbers copy
import { openai } from "@ai-sdk/openai";
import { ContextRelevancyMetric } from "@mastra/evals/llm";

const metric = new ContextRelevancyMetric(openai("gpt-4o-mini"), {
  context: [
    "アインシュタインは光電効果の発見によりノーベル賞を受賞しました。",
    "彼は1905年に相対性理論を発表しました。",
    "彼の研究は近代物理学に革命をもたらしました。"
  ]
});

const query = "アインシュタインの主な業績にはどのようなものがありますか？";
const response = "アインシュタインは光電効果の発見でノーベル賞を受賞し、画期的な相対性理論を発表しました。";

const result = await metric.measure(query, response);

console.log(result);
```


### 関連性の高い出力

すべてのコンテキスト文が無関係な情報を含めずにクエリへの回答に直接寄与しているため、この出力は満点となります。

```typescript
{
  score: 1,
  info: {
    reason: "スコアが1なのは、検索で得られたコンテキストがアインシュタインの重要な業績を強調し、入力に直接対応していて、完全に関連しているためです。"
  }
}
```


## 関連性が混在する例

この例では、応答は1つ以上の関連するコンテキスト項目を用いている一方で、無関係または有用性の低い情報も含んでいます。そのため、全体としての関連性スコアが下がります。

```typescript filename="src/example-mixed-context-relevancy.ts" showLineNumbers copy
import { openai } from "@ai-sdk/openai";
import { ContextRelevancyMetric } from "@mastra/evals/llm";

const metric = new ContextRelevancyMetric(openai("gpt-4o-mini"), {
  context: [
    "日食は月が太陽を隠すときに起こります。",
    "日食の際、月は地球と太陽の間を通過します。",
    "月は夜に見えます。",
    "月には大気がありません。"
  ]
});

const query = "日食は何によって起こりますか？";
const response =
  "日食は、月が地球と太陽の間に入り、太陽光を遮るときに起こります。";

const result = await metric.measure(query, response);

console.log(result);
```


### 関連性が混在した出力

この出力は、日食の仕組みに関する関連情報を含んでいる一方で、全体的な関連性を損なう無関係な事実も含まれているため、評価は中程度にとどまります。

```typescript
{
  score: 0.5,
  info: {
    reason: "スコアが0.5であるのは、取得コンテキストに「月は夜に見える」や「月には大気がない」といった入力に無関係な記述が含まれており、日食の原因の説明になっていないためです。関連性のある情報が不足していることから、コンテキストの関連性スコアが大きく低下しています。"
  }
}
```


## 関連性の低い例

この例では、ほとんどの文脈がクエリと無関係です。関連する項目は1つだけのため、関連性スコアは低くなります。

```typescript filename="src/example-low-context-relevancy.ts" showLineNumbers copy
import { openai } from "@ai-sdk/openai";
import { ContextRelevancyMetric } from "@mastra/evals/llm";

const metric = new ContextRelevancyMetric(openai("gpt-4o-mini"), {
  context: [
    "グレートバリアリーフはオーストラリアにあります。",
    "サンゴ礁は生き残るために温かい海水が必要です。",
    "海洋生物はサンゴ礁に依存しています。",
    "オーストラリアの首都はキャンベラです。"
  ]
});

const query = "オーストラリアの首都はどこですか？";
const response = "オーストラリアの首都はキャンベラです。";

const result = await metric.measure(query, response);

console.log(result);
```


### 関連性の低い出力

クエリに関連するコンテキスト項目が1つしかないため、出力は低評価となります。残りの項目は無関係な情報を含み、回答の裏付けには役立ちません。

```typescript
{
  score: 0.25,
  info: {
    reason: "スコアが0.25であるのは、検索コンテキストにオーストラリアの首都に関する入力質問とまったく無関係な記述が含まれているためです。たとえば「The Great Barrier Reef is in Australia」や「Coral reefs need warm water to survive」といった文は、首都に関する地理的・政治的情報を提供しておらず、結果として質問に答えていません。"
  }
}
```


## メトリックの設定

`query` に関連する背景情報を表す `context` 配列を指定して、`ContextRelevancyMetric` インスタンスを作成できます。スコアの範囲を定義する `scale` などのオプションパラメータも設定できます。

```typescript showLineNumbers copy
const metric = new ContextRelevancyMetric(openai("gpt-4o-mini"), {
  context: [""],
  scale: 1
});
```

> 設定オプションの一覧については、[ContextRelevancyMetric](/reference/evals/context-relevancy.mdx) を参照してください。


## 結果の理解

`ContextRelevancyMetric` は、次の形式の結果を返します:

```typescript
{
  score: 数値,
  info: {
    reason: 文字列
  }
}
```


### 関連度スコア

0〜1の範囲の関連度スコア:

- **1.0**: 完全に関連 – すべての文脈がクエリに直接関連。
- **0.7–0.9**: 高い関連 – 文脈の大部分がクエリに関連。
- **0.4–0.6**: ばらつきあり – 一部の文脈のみがクエリに関連。
- **0.1–0.3**: 低い関連 – わずかな文脈のみがクエリに関連。
- **0.0**: 無関連 – クエリに関連する文脈がない。

### 関連性に関する情報

スコアの説明。詳細は次のとおりです：

- 入力クエリとの関連性
- コンテキストからの記述の抽出
- 応答の有用性
- コンテキスト全体の品質

<GithubLink
  outdated={true}
  marginTop='mt-16'
  link="https://github.com/mastra-ai/mastra/blob/main/examples/basics/evals/context-relevancy"
/>