---
title: "AI採用担当者の構築 | Mastra Workflows | ガイド"
description: Mastra で採用ワークフローを構築し、LLM を用いて候補者情報を収集・処理するためのガイド。
---

import { Steps } from "nextra/components";


# AIリクルーターを構築する

このガイドでは、Mastra が LLM を使ったワークフローの構築をどのように支援するかを学びます。

候補者の履歴書から情報を抽出し、候補者のプロフィールに基づいて技術系の質問か行動面の質問のいずれかへ分岐するワークフローを作成します。その過程で、ワークフローのステップ設計、分岐の扱い方、LLM 呼び出しの統合方法を確認します。

## 前提条件

- Node.js `v20.0` 以降がインストールされていること
- サポート対象の[モデルプロバイダー](/models)の API キー
- 既存の Mastra プロジェクト（新規プロジェクトをセットアップする場合は[インストールガイド](/docs/getting-started/installation)に従ってください）

## ワークフローの構築

ワークフローをセットアップし、候補者データを抽出・分類する手順を定義してから、適切なフォローアップの質問を行います。

<Steps>
  ### ワークフローを定義する

  新しいファイル `src/mastra/workflows/candidate-workflow.ts` を作成し、ワークフローを定義します:

  ```ts copy filename="src/mastra/workflows/candidate-workflow.ts"
  import { createWorkflow, createStep } from "@mastra/core/workflows";
  import { z } from "zod";

  export const candidateWorkflow = createWorkflow({
    id: "candidate-workflow",
    inputSchema: z.object({
      resumeText: z.string(),
    }),
    outputSchema: z.object({
      askAboutSpecialty: z.object({
        question: z.string(),
      }),
      askAboutRole: z.object({
        question: z.string(),
      }),
    }),
  }).commit();
  ```

  ### ステップ: 候補者情報を収集する

  履歴書のテキストから候補者の詳細を抽出し、その人物を「技術系」または「非技術系」に分類します。このステップでは、LLMを呼び出して履歴書を解析し、名前、技術系ステータス、専門分野、および元の履歴書テキストを含む構造化JSONを返します。`inputSchema`で定義することにより、`execute()`内で`resumeText`にアクセスできます。これを使ってLLMにプロンプトを送信し、整理されたフィールドを返します。

  既存の `src/mastra/workflows/candidate-workflow.ts` ファイルに以下を追加してください:

  ```ts copy filename="src/mastra/workflows/candidate-workflow.ts"
  import { Agent } from "@mastra/core/agent";
  import { openai } from "@ai-sdk/openai";

  const recruiter = new Agent({
    name: "Recruiter Agent",
    instructions: `あなたは採用担当者です。`,
    model: openai("gpt-4o-mini"),
  });

  const gatherCandidateInfo = createStep({
    id: "gatherCandidateInfo",
    inputSchema: z.object({
      resumeText: z.string(),
    }),
    outputSchema: z.object({
      candidateName: z.string(),
      isTechnical: z.boolean(),
      specialty: z.string(),
      resumeText: z.string(),
    }),
    execute: async ({ inputData }) => {
      const resumeText = inputData?.resumeText;

      const prompt = `以下の履歴書から詳細情報を抽出してください:
  "${resumeText}"`;

      const res = await recruiter.generate(prompt, {
        structuredOutput: {
          schema: z.object({
            candidateName: z.string(),
            isTechnical: z.boolean(),
            specialty: z.string(),
            resumeText: z.string(),
          })
        },
      });

      return res.object;
    },
  });
  ```

  `execute()`内でRecruiterエージェントを使用しているため、ステップの前でそれを定義し、必要なインポートを追加する必要があります。

  ### ステップ: 技術的な質問

  このステップでは、「技術系」と判定された候補者に対し、その専門分野に至った経緯についてより詳しい情報を求めます。LLMが適切なフォローアップ質問を作成できるよう、履歴書の全文を使用します。

  既存の `src/mastra/workflows/candidate-workflow.ts` ファイルに以下を追加してください:

  ```ts copy filename="src/mastra/workflows/candidate-workflow.ts"
  const askAboutSpecialty = createStep({
    id: "askAboutSpecialty",
    inputSchema: z.object({
      candidateName: z.string(),
      isTechnical: z.boolean(),
      specialty: z.string(),
      resumeText: z.string(),
    }),
    outputSchema: z.object({
      question: z.string(),
    }),
    execute: async ({ inputData: candidateInfo }) => {
      const prompt = `あなたは採用担当者です。以下の履歴書を参考に、${candidateInfo?.candidateName}さんが「${candidateInfo?.specialty}」の分野に進むことになったきっかけについて、簡潔な質問を作成してください。
  履歴書: ${candidateInfo?.resumeText}`;
  Resume: ${candidateInfo?.resumeText}`;
      const res = await recruiter.generate(prompt);

      return { question: res?.text?.trim() || "" };
    },
  });
  ```

  ### ステップ: 行動に関する質問

  候補者が「非技術職」の場合は、別のフォローアップ質問を用意します。このステップでは、候補者の履歴書全文を再度参照し、その職務について最も関心のある点を尋ねます。`execute()`関数は、LLMに職務に焦点を当てた質問を生成させます。

  既存の `src/mastra/workflows/candidate-workflow.ts` ファイルに以下を追加してください:

  ```ts filename="src/mastra/workflows/candidate-workflow.ts" copy
  const askAboutRole = createStep({
    id: "askAboutRole",
    inputSchema: z.object({
      candidateName: z.string(),
      isTechnical: z.boolean(),
      specialty: z.string(),
      resumeText: z.string(),
    }),
    outputSchema: z.object({
      question: z.string(),
    }),
    execute: async ({ inputData: candidateInfo }) => {
      const prompt = `あなたは採用担当者です。以下の履歴書を踏まえて、${candidateInfo?.candidateName}さんに、この職種について最も興味を持っている点を尋ねる簡潔な質問を作成してください。
  履歴書: ${candidateInfo?.resumeText}`;
  Resume: ${candidateInfo?.resumeText}`;
      const res = await recruiter.generate(prompt);
      return { question: res?.text?.trim() || "" };
    },
  });
  ```

  ### ワークフローにステップを追加する

  候補者の技術的なステータスに基づいて分岐ロジックを実装する手順を組み合わせます。ワークフローはまず候補者データを収集し、その後`isTechnical`に応じて、専門分野または役割について尋ねます。これは`gatherCandidateInfo`を`askAboutSpecialty`と`askAboutRole`にチェーンすることで実現されます。

  既存の `src/mastra/workflows/candidate-workflow.ts` ファイルの `candidateWorkflow` を次のように変更します:

  ```ts filename="src/mastra/workflows/candidate-workflow.ts" copy {10-14}
  export const candidateWorkflow = createWorkflow({
    id: "candidate-workflow",
    inputSchema: z.object({
      resumeText: z.string(),
    }),
    outputSchema: z.object({
      askAboutSpecialty: z.object({
        question: z.string(),
      }),
      askAboutRole: z.object({
        question: z.string(),
      }),
    }),
  })
    .then(gatherCandidateInfo)
    .branch([
      [async ({ inputData: { isTechnical } }) => isTechnical, askAboutSpecialty],
      [async ({ inputData: { isTechnical } }) => !isTechnical, askAboutRole],
    ])
    .commit();
  ```

  ### ワークフローをMastraに登録する

  `src/mastra/index.ts` ファイルで、ワークフローを登録します:

  ```ts copy filename="src/mastra/index.ts" {2, 5}
  import { Mastra } from "@mastra/core";
  import { candidateWorkflow } from "./workflows/candidate-workflow";

  export const mastra = new Mastra({
    workflows: { candidateWorkflow },
  });
  ```
</Steps>

## ワークフローのテスト

開発サーバーを起動し、Mastra の[playground](../../docs/server-db/local-dev-playground.mdx)内でワークフローをテストできます。

```bash copy
mastra dev
```

サイドバーで **Workflows** に移動し、**candidate-workflow** を選択します。中央にはワークフローのグラフビューが表示され、右側のサイドバーでは **Run** タブがデフォルトで選択されています。このタブで履歴書のテキストを入力できます。例：

```text copy
ソフトウェア開発で10年以上の経験を持つ経験豊富なソフトウェアエンジニア。データベースの設計・開発やユーザーインターフェースの最適化において確かな実績と専門性を有する。
```

履歴書のテキストを入力したら、**Run** ボタンを押します。すると、ワークフロー各ステップの出力を含む 2 つのステータスボックス（`GatherCandidateInfo` と `AskAboutSpecialty`）が表示されるはずです。

[`.createRunAsync()`](../../reference/workflows/create-run.mdx) と [`.start()`](../../reference/workflows/run-methods/start.mdx) を呼び出して、プログラムからワークフローをテストすることもできます。新しいファイル `src/test-workflow.ts` を作成し、次の内容を追加します。

```ts copy filename="src/test-workflow.ts"
import { mastra } from "./mastra";

const run = await mastra.getWorkflow("candidateWorkflow").createRunAsync();

const res = await run.start({
  inputData: {
    resumeText:
      "ソフトウェア開発で10年以上の経験を持つ、豊富な知識を備えたソフトウェアエンジニア。ソフトウェアデータベースの設計・開発やユーザーインターフェースの最適化において実績のある専門性を有する。",
  },
});

// ワークフローの結果をすべて出力（ステータス、ステップ、結果を含む）
console.log(JSON.stringify(res, null, 2));

// ワークフローの出力値を取得
if (res.status === "success") {
  const question = res.result.askAboutRole?.question ?? res.result.askAboutSpecialty?.question;

  console.log(`出力値: ${question}`);
}
```

では、ワークフローを実行して、出力をターミナルで確認しましょう。

```bash copy
npx tsx src/test-workflow.ts
```

履歴書を解析し、候補者の技術力に応じてどの質問をするかを判断するワークフローを作成できました。おめでとうございます、楽しいハックを！
