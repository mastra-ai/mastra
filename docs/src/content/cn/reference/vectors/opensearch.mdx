---
title: "参考文档：OpenSearch 向量存储 | 向量"
description: "Mastra 中 OpenSearchVector 类的文档，该类使用 OpenSearch 提供向量搜索。"
packages:
  - "@mastra/opensearch"
---

# OpenSearch 向量存储

OpenSearchVector 类使用 [OpenSearch](https://opensearch.org/)（一个开源搜索和分析引擎）提供向量搜索。它利用 OpenSearch 的 k-NN 功能执行向量相似性搜索。

## 构造函数选项

构造函数接受所有 [OpenSearch ClientOptions](https://opensearch.org/docs/cn/docs/latest/clients/javascript/index/) 加上必需的 `id` 字段。

<PropertiesTable
  content={[
    {
      name: "id",
      type: "string",
      description: "此向量存储实例的唯一标识符",
    },
    {
      name: "node",
      type: "string | string[] | NodeOptions | NodeOptions[]",
      description: "OpenSearch 节点 URL（例如：'http://localhost:9200'）",
    },
    {
      name: "auth",
      type: "BasicAuth | BearerAuth | AwsSigv4Auth",
      description: "认证配置",
      isOptional: true,
    },
    {
      name: "ssl",
      type: "ConnectionOptions",
      description: "SSL/TLS 配置",
      isOptional: true,
    },
    {
      name: "compression",
      type: "'gzip'",
      description: "启用 gzip 压缩",
      isOptional: true,
    },
  ]}
/>

## 方法

### createIndex()

创建具有指定配置的新索引。

<PropertiesTable
  content={[
    {
      name: "indexName",
      type: "string",
      description: "要创建的索引名称",
    },
    {
      name: "dimension",
      type: "number",
      description: "索引中要存储的向量的维度",
    },
    {
      name: "metric",
      type: "'cosine' | 'euclidean' | 'dotproduct'",
      description: "用于向量相似性的距离度量",
      defaultValue: "'cosine'",
      isOptional: true,
    },
  ]}
/>

### listIndexes()

列出 OpenSearch 实例中的所有索引。

返回：`Promise<string[]>`

### describeIndex()

获取索引信息。

<PropertiesTable
  content={[
    {
      name: "indexName",
      type: "string",
      description: "要描述的索引名称",
    },
  ]}
/>

### deleteIndex()

<PropertiesTable
  content={[
    {
      name: "indexName",
      type: "string",
      description: "要删除的索引名称",
    },
  ]}
/>

### upsert()

<PropertiesTable
  content={[
    {
      name: "indexName",
      type: "string",
      description: "要插入向量的索引名称",
    },
    {
      name: "vectors",
      type: "number[][]",
      description: "要插入的向量嵌入数组",
    },
    {
      name: "metadata",
      type: "Record<string, any>[]",
      description: "对应每个向量的元数据对象数组",
      isOptional: true,
    },
    {
      name: "ids",
      type: "string[]",
      description:
        "向量的可选 ID 数组。如果未提供，将生成随机 ID",
      isOptional: true,
    },
  ]}
/>

### query()

<PropertiesTable
  content={[
    {
      name: "indexName",
      type: "string",
      description: "要查询的索引名称",
    },
    {
      name: "queryVector",
      type: "number[]",
      description: "用于查找相似向量的查询向量",
    },
    {
      name: "topK",
      type: "number",
      description: "要返回的结果数量",
      defaultValue: "10",
      isOptional: true,
    },
    {
      name: "filter",
      type: "VectorFilter",
      description:
        "可选的要应用于查询的过滤器（MongoDB 风格的查询语法）",
      isOptional: true,
    },
  ]}
/>

### updateVector()

通过 ID 或元数据过滤器更新单个向量。必须提供 `id` 或 `filter` 之一，但不能同时提供两者。

<PropertiesTable
  content={[
    {
      name: "indexName",
      type: "string",
      description: "要更新向量的索引名称",
    },
    {
      name: "id",
      type: "string",
      isOptional: true,
      description: "要更新的向量 ID（与 filter 互斥）",
    },
    {
      name: "filter",
      type: "Record<string, any>",
      isOptional: true,
      description: "用于识别要更新的向量的元数据过滤器（与 id 互斥）",
    },
    {
      name: "update",
      type: "{ vector?: number[]; metadata?: Record<string, any>; }",
      description: "包含要更新的向量和/或元数据的对象",
    },
  ]}
/>

### deleteVector()

从索引中按 ID 删除单个向量。

<PropertiesTable
  content={[
    {
      name: "indexName",
      type: "string",
      description: "要从中删除向量的索引名称",
    },
    {
      name: "id",
      type: "string",
      description: "要删除的向量 ID",
    },
  ]}
/>

### deleteVectors()

通过 ID 或元数据过滤器删除多个向量。必须提供 `ids` 或 `filter` 之一，但不能同时提供两者。

<PropertiesTable
  content={[
    {
      name: "indexName",
      type: "string",
      description: "包含要删除向量的索引名称",
    },
    {
      name: "ids",
      type: "string[]",
      isOptional: true,
      description: "要删除的向量 ID 数组（与 filter 互斥）",
    },
    {
      name: "filter",
      type: "Record<string, any>",
      isOptional: true,
      description: "用于识别要删除的向量的元数据过滤器（与 ids 互斥）",
    },
  ]}
/>

## 相关内容

- [元数据过滤器](../rag/metadata-filters)
