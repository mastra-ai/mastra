---
title: "参考文档：Run.cancel() | 工作流"
description: "工作流中 `Run.cancel()` 方法的文档，用于取消工作流运行。"
packages:
  - "@mastra/core"
---

# Run.cancel()

`.cancel()` 方法取消工作流运行，停止执行并清理资源。

此方法中止任何正在运行的步骤，并将工作流状态更新为 'canceled'。它对主动运行的工作流和暂停/等待的工作流都有效。

## 使用示例

```typescript
const run = await workflow.createRun();

await run.cancel();
// 返回: { message: 'Workflow run canceled' }
```

## 参数

<PropertiesTable
  content={[
    {
      name: "无参数",
      type: "void",
      description: "此方法不接受参数",
      isOptional: false,
    },
  ]}
/>

## 返回值

<PropertiesTable
  content={[
    {
      name: "result",
      type: "Promise<{ message: string }>",
      description:
        "取消成功时解析为 { message: 'Workflow run canceled' } 的 Promise",
    },
  ]}
/>

## 取消的工作原理

调用时，工作流将：
1. **触发中止信号** - 使用标准 Web API AbortSignal 通知正在运行的步骤
2. **阻止后续步骤** - 不会再执行任何步骤

## 中止信号行为

检查 `abortSignal` 参数的步骤可以响应取消：
- 步骤可以监听 'abort' 事件：`abortSignal.addEventListener('abort', callback)`
- 步骤可以检查是否已中止：`if (abortSignal.aborted) { ... }`
- 用于取消超时、网络请求或长时间运行的操作

**注意：** 步骤必须主动检查中止信号才能在执行中间被取消。不检查信号的步骤将运行完成，但后续步骤不会执行。

## 扩展使用示例

### 在错误时取消工作流

```typescript
const run = await workflow.createRun();

try {
  const result = await run.start({ inputData: { value: "初始数据" } });
} catch (error) {
  await run.cancel();
}
```

### 创建响应取消的步骤

```typescript
const step = createStep({
  id: '长时间运行的步骤',
  execute: async ({ inputData, abortSignal, abort }) => {
    const timeout = new Promise((resolve) => {
      const timer = setTimeout(() => resolve('完成'), 10000);

      // 如果取消则清理
      abortSignal.addEventListener('abort', () => {
        clearTimeout(timer);
        resolve('已取消');
      });
    });

    const result = await timeout;

    // 异步操作后检查是否已中止
    if (abortSignal.aborted) {
      return abort(); // 停止执行
    }

    return { result };
  }
});
```

## 相关内容

- [工作流概述](/docs/cn/docs/workflows/overview#running-workflows)
- [Workflow.createRun()](../workflow-methods/create-run)
