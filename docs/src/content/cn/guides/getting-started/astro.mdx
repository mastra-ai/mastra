---
title: "Astro | æ¡†æ¶"
description: "å¼€å§‹ä½¿ç”¨ Mastra å’Œ Astro"
---

# åœ¨æ‚¨çš„ Astro é¡¹ç›®ä¸­é›†æˆ Mastra

åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæ‚¨å°†ä½¿ç”¨ Mastra æ„å»ºä¸€ä¸ªå·¥å…·è°ƒç”¨å‹ AI ä»£ç†ï¼Œç„¶åé€šè¿‡ä»è·¯ç”±ä¸­ç›´æ¥å¯¼å…¥å’Œè°ƒç”¨ä»£ç†å°†å…¶è¿æ¥åˆ° Astroã€‚

æ‚¨å°†ä½¿ç”¨ [AI SDK UI](https://ai-sdk.dev/docs/cn/docs/ai-sdk-ui/overview) å’Œ [AI Elements](https://ai-sdk.dev/elements) åˆ›å»ºä¸€ä¸ªç¾è§‚ã€äº¤äº’å¼çš„èŠå¤©ä½“éªŒã€‚

:::note

è™½ç„¶æœ¬æŒ‡å—å‘æ‚¨å±•ç¤ºå¦‚ä½•å°† Astro ä¸ React å’Œå®Œæ•´çš„æœåŠ¡å™¨ç«¯æ¸²æŸ“ (SSR) ä¸€èµ·ä½¿ç”¨ï¼Œä½†æœ‰è®¸å¤šæ–¹æ³•å¯ä»¥å°† Mastra ä¸ Astro ä¸€èµ·ä½¿ç”¨ã€‚æ‚¨å¯ä»¥æŒ‰æ–‡ä»¶[é€‰æ‹©åŠ å…¥ SSR](https://docs.astro.build/en/guides/on-demand-rendering/#enabling-on-demand-rendering)ï¼Œå¹¶ä½¿ç”¨å…¶ä»–æ¡†æ¶ï¼Œå¦‚ Svelteã€Vueã€Solid æˆ– Preactã€‚æ‚¨å¯ä»¥ä½¿ç”¨ Astro æ„å»ºèŠå¤©ç•Œé¢å¹¶[åœ¨ Astro ä¸­åŸç”Ÿè°ƒç”¨ç«¯ç‚¹](https://docs.astro.build/en/recipes/call-endpoints/)ã€‚

:::

## å‰ç½®æ¡ä»¶

- æ‚¨éœ€è¦ä¸€ä¸ªæ”¯æŒçš„[æ¨¡å‹æä¾›å•†](/models)çš„ API keyã€‚å¦‚æœæ‚¨æ²¡æœ‰åå¥½ï¼Œè¯·ä½¿ç”¨ [OpenAI](/models/providers/openai)ã€‚
- å®‰è£… Node.js `v22.13.0` æˆ–æ›´é«˜ç‰ˆæœ¬

## åˆ›å»ºæ–°çš„ Astro åº”ç”¨ç¨‹åºï¼ˆå¯é€‰ï¼‰

å¦‚æœæ‚¨å·²ç»æœ‰ä¸€ä¸ª Astro åº”ç”¨ç¨‹åºï¼Œè¯·è·³åˆ°ä¸‹ä¸€æ­¥ã€‚æ‚¨çš„ Astro åº”ç”¨ç¨‹åºåº”è¯¥è¿™æ ·è®¾ç½®ï¼š

- ä½¿ç”¨ SSRï¼ˆ`astro.config.mjs` ä¸­çš„ `output: "server"`ï¼‰
- ä½¿ç”¨ [React é›†æˆ](https://docs.astro.build/en/guides/integrations-guide/react/)
- å®‰è£…äº† Tailwind

ä¸ºäº†æ”¯æŒ[æŒ‰éœ€æ¸²æŸ“](https://docs.astro.build/en/guides/on-demand-rendering/)ï¼Œæœ¬æŒ‡å—å°†ä½¿ç”¨ [Node.js é€‚é…å™¨](https://docs.astro.build/en/guides/integrations-guide/node/)ï¼Œä½†ä»»ä½•å—æ”¯æŒçš„æœåŠ¡å™¨é€‚é…å™¨éƒ½å¯ä»¥å·¥ä½œã€‚

```bash npm2yarn
npm create astro@latest mastra-astro -- --add node --add react --add tailwind --install --skip-houston --template minimal --git
```

è¿™ä¼šåˆ›å»ºä¸€ä¸ªåä¸º `mastra-astro` çš„é¡¹ç›®ï¼Œä½†æ‚¨å¯ä»¥å°†å…¶æ›¿æ¢ä¸ºä»»ä½•æ‚¨æƒ³è¦çš„åç§°ã€‚

è¿›å…¥æ‚¨çš„é¡¹ç›®å¹¶ç¼–è¾‘ `astro.config.mjs` æ–‡ä»¶ï¼Œå°†[`è¾“å‡ºè®¾ç½®`](https://docs.astro.build/en/reference/configuration-reference/#output)è®¾ç½®ä¸º `"server"`ï¼š

```js title="astro.config.mjs {10}
// @ts-check
import { defineConfig } from 'astro/config';

import node from '@astrojs/node';
import react from '@astrojs/react';
import tailwindcss from '@tailwindcss/vite';

// https://astro.build/config
export default defineConfig({
  output: 'server',
  adapter: node({
    mode: 'standalone'
  }),

  integrations: [react()],

  vite: {
    plugins: [tailwindcss()]
  }
});
```

æœ€åï¼Œç¼–è¾‘ `tsconfig.json` ä»¥è§£æè·¯å¾„ï¼š

```ts title="tsconfig.json"
{
  "compilerOptions": {
    // ...
    "baseUrl": ".",
    "paths": {
      "@/*": [
        "./src/*"
      ]
    }
    // ...
  }
}
```

## åˆå§‹åŒ– Mastra

è¿è¡Œ [`mastra init`](/reference/cli/mastra#mastra-init)ã€‚å½“æç¤ºæ—¶ï¼Œé€‰æ‹©ä¸€ä¸ªæä¾›å•†ï¼ˆä¾‹å¦‚ OpenAIï¼‰å¹¶è¾“å…¥æ‚¨çš„ keyï¼š

```bash npm2yarn
npx mastra@latest init
```

è¿™ä¼šåˆ›å»ºä¸€ä¸ª `src/mastra` æ–‡ä»¶å¤¹ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªç¤ºä¾‹å¤©æ°”ä»£ç†ä»¥åŠä»¥ä¸‹æ–‡ä»¶ï¼š

- `index.ts` - Mastra é…ç½®ï¼ŒåŒ…æ‹¬å†…å­˜
- `tools/weather-tool.ts` - ç”¨äºè·å–ç»™å®šä½ç½®å¤©æ°”çš„å·¥å…·
- `agents/weather-agent.ts` - ä¸€ä¸ªå¸¦æœ‰ä½¿ç”¨å·¥å…·æç¤ºè¯çš„å¤©æ°”ä»£ç†

åœ¨æ¥ä¸‹æ¥çš„æ­¥éª¤ä¸­ï¼Œæ‚¨å°†ä» Astro è·¯ç”±ä¸­è°ƒç”¨ `weather-agent.ts`ã€‚

## å®‰è£… AI SDK UI å’Œ AI Elements

å®‰è£… AI SDK UI ä»¥åŠ Mastra é€‚é…å™¨ï¼š

```bash npm2yarn
npm install @mastra/ai-sdk@latest @ai-sdk/react ai
```

æ¥ä¸‹æ¥ï¼Œåˆå§‹åŒ– AI Elementsã€‚å½“æç¤ºæ—¶ï¼Œé€‰æ‹©é»˜è®¤é€‰é¡¹ï¼š

```bash npm2yarn
npx ai-elements@latest
```

è¿™ä¼šå°†æ•´ä¸ª AI Elements UI ç»„ä»¶åº“ä¸‹è½½åˆ° `@/components/ai-elements` æ–‡ä»¶å¤¹ä¸­ã€‚

## åˆ›å»ºèŠå¤©è·¯ç”±

åˆ›å»º `src/pages/api/chat.ts`ï¼š

```ts title="src/pages/api/chat.ts"
import type { APIRoute } from "astro";
import { handleChatStream } from '@mastra/ai-sdk';
import { toAISdkV5Messages } from '@mastra/ai-sdk/ui'
import { createUIMessageStreamResponse } from 'ai';
import { mastra } from '@/mastra';

const THREAD_ID = 'example-user-id';
const RESOURCE_ID = 'weather-chat';

export const POST: APIRoute = async ({ request }) => {
  const params = await request.json();
  const stream = await handleChatStream({
    mastra,
    agentId: 'weather-agent',
    params: {
      ...params,
      memory: {
        ...params.memory,
        thread: THREAD_ID,
        resource: RESOURCE_ID,
      }
    }
  })

  return createUIMessageStreamResponse({ stream })
}

export const GET: APIRoute = async () => {
  const memory = await mastra.getAgentById('weather-agent').getMemory()
  let response = null

  try {
    response = await memory?.recall({
      threadId: THREAD_ID,
      resourceId: RESOURCE_ID,
    })
  } catch {
    console.log('No previous messages found.')
  }

  const uiMessages = toAISdkV5Messages(response?.messages || []);

  return Response.json(uiMessages)
}
```

`POST` è·¯ç”±æ¥å—æç¤ºè¯å¹¶å°†ä»£ç†çš„å“åº”ä»¥ AI SDK æ ¼å¼æµå¼ä¼ è¾“å›æ¥ï¼Œè€Œ `GET` è·¯ç”±ä»å†…å­˜ä¸­è·å–æ¶ˆæ¯å†å²è®°å½•ï¼Œä»¥ä¾¿åœ¨å®¢æˆ·ç«¯é‡æ–°åŠ è½½æ—¶å¡«å…… UIã€‚

## åˆ›å»ºèŠå¤©ç»„ä»¶

åˆ›å»º `src/components/chat.tsx`ï¼š

```tsx title="src/components/chat.tsx"
import '@/styles/global.css';
import { useEffect, useState } from 'react';
import { DefaultChatTransport, type ToolUIPart } from 'ai';
import { useChat } from '@ai-sdk/react';

import {
  PromptInput,
  PromptInputBody,
  PromptInputTextarea,
} from '@/components/ai-elements/prompt-input';

import {
  Conversation,
  ConversationContent,
  ConversationScrollButton,
} from '@/components/ai-elements/conversation';

import { Message, MessageContent, MessageResponse } from '@/components/ai-elements/message';

import {
  Tool,
  ToolHeader,
  ToolContent,
  ToolInput,
  ToolOutput,
} from '@/components/ai-elements/tool';


function Chat() {
  const [input, setInput] = useState<string>('');

  const { messages, setMessages, sendMessage, status } = useChat({
    transport: new DefaultChatTransport({
      api: '/api/chat',
    }),
  });

  useEffect(() => {
    const fetchMessages = async () => {
      const res = await fetch('/api/chat');
      const data = await res.json();
      setMessages([...data]);
    };
    fetchMessages();
  }, [setMessages]);

  const handleSubmit = async () => {
    if (!input.trim()) return;

    sendMessage({ text: input });
    setInput('');
  };

  return (
    <div className="w-full p-6 relative size-full h-screen">
      <div className="flex flex-col h-full">
        <Conversation className="h-full">
          <ConversationContent>
            {messages.map((message) => (
              <div key={message.id}>
                {message.parts?.map((part, i) => {
                  if (part.type === 'text') {
                    return (
                      <Message
                        key={`${message.id}-${i}`}
                        from={message.role}>
                          <MessageContent>
                            <MessageResponse>{part.text}</MessageResponse>
                          </MessageContent>
                      </Message>
                    );
                  }

                  if (part.type?.startsWith('tool-')) {
                    return (
                      <Tool key={`${message.id}-${i}`}>
                        <ToolHeader
                          type={(part as ToolUIPart).type}
                          state={(part as ToolUIPart).state || 'output-available'}
                          className="cursor-pointer"
                        />
                        <ToolContent>
                          <ToolInput input={(part as ToolUIPart).input || {}} />
                          <ToolOutput
                            output={(part as ToolUIPart).output}
                            errorText={(part as ToolUIPart).errorText}
                          />
                        </ToolContent>
                      </Tool>
                    );
                  }

                  return null;
                })}
              </div>
            ))}
            <ConversationScrollButton />
          </ConversationContent>
        </Conversation>

        <PromptInput onSubmit={handleSubmit} className="mt-20">
          <PromptInputBody>
            <PromptInputTextarea
              onChange={(e) => setInput(e.target.value)}
              className="md:leading-10"
              value={input}
              placeholder="Type your message..."
              disabled={status !== 'ready'}
            />
          </PromptInputBody>
        </PromptInput>
      </div>
    </div>
  );
}

export default Chat;
```

æ­¤ç»„ä»¶å°† [`useChat()`](https://ai-sdk.dev/docs/cn/docs/reference/ai-sdk-ui/use-chat) è¿æ¥åˆ° `api/chat` ç«¯ç‚¹ï¼Œå°†æç¤ºè¯å‘é€è‡³æ­¤å¹¶å°†å“åº”åˆ†å—æµå¼ä¼ è¾“å›æ¥ã€‚

å®ƒä½¿ç”¨ [`<MessageResponse>`](https://ai-sdk.dev/elements/components/message#messageresponse-) ç»„ä»¶æ¸²æŸ“å“åº”æ–‡æœ¬ï¼Œå¹¶ä½¿ç”¨ [`<Tool>`](https://ai-sdk.dev/elements/components/tool) ç»„ä»¶æ˜¾ç¤ºä»»ä½•å·¥å…·è°ƒç”¨ã€‚

## æ¸²æŸ“èŠå¤©ç»„ä»¶

æœ€åä¸€æ­¥æ˜¯åœ¨æ‚¨çš„ç´¢å¼•é¡µé¢ä¸Šæ¸²æŸ“èŠå¤©ç»„ä»¶ã€‚ç¼–è¾‘ `src/pages/index.astro`ï¼š

```html title="src/pages/index.astro" {2,14}
---
import Chat from '@/components/chat';
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Astro</title>
	</head>
	<body>
		<Chat client:load />
	</body>
</html>
```

å¯¼å…¥ `Chat` ç»„ä»¶å¹¶ä½¿ç”¨ `client:load` [æŒ‡ä»¤](https://docs.astro.build/en/reference/directives-reference/#client-directives)å°†å…¶æ·»åŠ åˆ°æ­£æ–‡ï¼Œä»¥ä¾¿å®ƒåœ¨å®¢æˆ·ç«¯è¿è¡Œã€‚

## æµ‹è¯•æ‚¨çš„ä»£ç†

1. ä½¿ç”¨ `npm run dev` è¿è¡Œæ‚¨çš„ Astro åº”ç”¨ç¨‹åº
2. åœ¨ http://localhost:4321 æ‰“å¼€èŠå¤©
3. å°è¯•è¯¢é—®å¤©æ°”ã€‚å¦‚æœæ‚¨çš„ API key è®¾ç½®æ­£ç¡®ï¼Œæ‚¨ä¼šå¾—åˆ°å“åº”

## åç»­æ­¥éª¤

æ­å–œæ‚¨ä½¿ç”¨ Astro æ„å»ºäº† Mastra ä»£ç†ï¼ğŸ‰

ä»è¿™é‡Œå¼€å§‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è‡ªå·±çš„å·¥å…·å’Œé€»è¾‘æ‰©å±•é¡¹ç›®ï¼š

- äº†è§£æ›´å¤šå…³äº[ä»£ç†](/docs/cn/docs/agents/overview)
- ä¸ºæ‚¨çš„ä»£ç†æä¾›è‡ªå·±çš„[å·¥å…·](/docs/cn/docs/agents/using-tools)
- ä¸ºæ‚¨çš„ä»£ç†æ·»åŠ ç±»ä¼¼äººç±»çš„[å†…å­˜](/docs/cn/docs/agents/agent-memory)

å‡†å¤‡å°±ç»ªåï¼Œé˜…è¯»æ›´å¤šå…³äº Mastra å¦‚ä½•ä¸ AI SDK UI é›†æˆçš„ä¿¡æ¯ï¼Œä»¥åŠå¦‚ä½•å°†æ‚¨çš„ä»£ç†éƒ¨ç½²åˆ°ä»»ä½•åœ°æ–¹ï¼š

- å°† Mastra ä¸ [AI SDK UI](/guides/build-your-ui/ai-sdk-ui) é›†æˆ
- å°†æ‚¨çš„ä»£ç†éƒ¨ç½²åˆ°[ä»»ä½•åœ°æ–¹](/docs/cn/docs/deployment/overview)
