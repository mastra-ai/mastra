---
title: "Next.js | æ¡†æ¶"
description: "å¼€å§‹ä½¿ç”¨ Mastra å’Œ Next.js"
---

# åœ¨æ‚¨çš„ Next.js é¡¹ç›®ä¸­é›†æˆ Mastra

åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæ‚¨å°†ä½¿ç”¨ Mastra æ„å»ºä¸€ä¸ªå·¥å…·è°ƒç”¨å‹ AI ä»£ç†ï¼Œç„¶åé€šè¿‡ä»è·¯ç”±ä¸­ç›´æ¥å¯¼å…¥å’Œè°ƒç”¨ä»£ç†å°†å…¶è¿æ¥åˆ° Next.jsã€‚

æ‚¨å°†ä½¿ç”¨ [AI SDK UI](https://ai-sdk.dev/docs/cn/docs/ai-sdk-ui/overview) å’Œ [AI Elements](https://ai-sdk.dev/elements) åˆ›å»ºä¸€ä¸ªç¾è§‚ã€äº¤äº’å¼çš„èŠå¤©ä½“éªŒã€‚

<figure>

![èŠå¤©é£æ ¼ Web åº”ç”¨ç¨‹åºçš„å±å¹•æˆªå›¾ï¼Œæ˜¾ç¤ºå·²å®Œæˆçš„ "weatherTool" å·¥å…·è°ƒç”¨ï¼Œå›ç­” "What is the weather in London?" å¹¶è¿”å› JSON ç»“æœã€‚æ¶ˆæ¯å»ºè®®æä¾›æ´»åŠ¨å»ºè®®ï¼Œåº•éƒ¨æœ‰ä¸€ä¸ªæ–‡æœ¬è¾“å…¥æ¡†ã€‚](/img/nextjs-quickstart.png)

<figcaption class="text-sm text-center">æ‚¨å°†è¦æ„å»ºçš„å†…å®¹ï¼šä¸€ä¸ªå¯ä»¥è°ƒç”¨å¤©æ°”å·¥å…·çš„ä»£ç†ï¼Œåœ¨èŠå¤© UI ä¸­æ˜¾ç¤º JSON ç»“æœã€æµå¼ä¼ è¾“å¤©æ°”æ‘˜è¦ï¼Œå¹¶åœ¨é‡æ–°åŠ è½½æ—¶ä¿ç•™å¯¹è¯å†å²è®°å½•ã€‚</figcaption>

</figure>

## å‰ç½®æ¡ä»¶

- æ‚¨éœ€è¦ä¸€ä¸ªæ”¯æŒçš„[æ¨¡å‹æä¾›å•†](/models)çš„ API keyã€‚å¦‚æœæ‚¨æ²¡æœ‰åå¥½ï¼Œè¯·ä½¿ç”¨ [OpenAI](/models/providers/openai)ã€‚
- å®‰è£… Node.js `v22.13.0` æˆ–æ›´é«˜ç‰ˆæœ¬

## åˆ›å»ºæ–°çš„ Next.js åº”ç”¨ç¨‹åºï¼ˆå¯é€‰ï¼‰

å¦‚æœæ‚¨å·²ç»æœ‰ä¸€ä¸ª Next.js åº”ç”¨ç¨‹åºï¼Œè¯·è·³åˆ°ä¸‹ä¸€æ­¥ã€‚

è¿è¡Œä»¥ä¸‹å‘½ä»¤[åˆ›å»ºæ–°çš„ Next.js åº”ç”¨ç¨‹åº](https://nextjs.org/docs/cn/docs/app/getting-started/installation)ï¼š

```bash npm2yarn
npx create-next-app@latest my-nextjs-agent --yes --ts --eslint --tailwind --src-dir --app --turbopack --no-react-compiler --no-import-alias
```

è¿™ä¼šåˆ›å»ºä¸€ä¸ªåä¸º `my-nextjs-agent` çš„é¡¹ç›®ï¼Œä½†æ‚¨å¯ä»¥å°†å…¶æ›¿æ¢ä¸ºä»»ä½•æ‚¨æƒ³è¦çš„åç§°ã€‚

## åˆå§‹åŒ– Mastra

å¯¼èˆªåˆ°æ‚¨çš„ Next.js é¡¹ç›®ï¼š

```bash
cd my-nextjs-agent
```

è¿è¡Œ [`mastra init`](/reference/cli/mastra#mastra-init)ã€‚å½“æç¤ºæ—¶ï¼Œé€‰æ‹©ä¸€ä¸ªæä¾›å•†ï¼ˆä¾‹å¦‚ OpenAIï¼‰å¹¶è¾“å…¥æ‚¨çš„ keyï¼š

```bash npm2yarn
npx --force mastra@latest init
```

è¿™ä¼šåˆ›å»ºä¸€ä¸ª `src/mastra` æ–‡ä»¶å¤¹ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªç¤ºä¾‹å¤©æ°”ä»£ç†ä»¥åŠä»¥ä¸‹æ–‡ä»¶ï¼š

- `index.ts` - Mastra é…ç½®ï¼ŒåŒ…æ‹¬å†…å­˜
- `tools/weather-tool.ts` - ç”¨äºè·å–ç»™å®šä½ç½®å¤©æ°”çš„å·¥å…·
- `agents/weather-agent.ts` - ä¸€ä¸ªå¸¦æœ‰ä½¿ç”¨å·¥å…·æç¤ºè¯çš„å¤©æ°”ä»£ç†

åœ¨æ¥ä¸‹æ¥çš„æ­¥éª¤ä¸­ï¼Œæ‚¨å°†ä» Next.js è·¯ç”±ä¸­è°ƒç”¨ `weather-agent.ts`ã€‚

:::tip[åŒæ—¶ä½¿ç”¨ Mastra Studio å’Œ Next.js]
å¦‚æœæ‚¨æƒ³åœ¨ Next.js åº”ç”¨ç¨‹åºæ—è¾¹è¿è¡Œ `mastra dev`ï¼ˆMastra Studioï¼‰å¹¶è®©ä¸¤è€…å…±äº«åŒä¸€ä¸ªæ•°æ®åº“ï¼Œè¯·æ›´æ–° `src/mastra/index.ts` ä¸­çš„å­˜å‚¨ URL ä»¥ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼š

```typescript
url: "file:/absolute/path/to/your/project/mastra.db"
```

ç›¸å¯¹è·¯å¾„åŸºäºæ¯ä¸ªè¿›ç¨‹çš„å·¥ä½œç›®å½•è§£æï¼Œ`next dev` å’Œ `mastra dev` çš„å·¥ä½œç›®å½•æ˜¯ä¸åŒçš„ã€‚
:::

## å®‰è£… AI SDK UI å’Œ AI Elements

å®‰è£… AI SDK UI ä»¥åŠ Mastra é€‚é…å™¨ï¼š

```bash npm2yarn
npm install @mastra/ai-sdk@latest @ai-sdk/react ai
```

æ¥ä¸‹æ¥ï¼Œåˆå§‹åŒ– AI Elementsã€‚å½“æç¤ºæ—¶ï¼Œé€‰æ‹©é»˜è®¤é€‰é¡¹ï¼š

```bash npm2yarn
npx ai-elements@latest
```

è¿™ä¼šå°†æ•´ä¸ª AI Elements UI ç»„ä»¶åº“ä¸‹è½½åˆ° `@/components/ai-elements` æ–‡ä»¶å¤¹ä¸­ã€‚

## åˆ›å»ºèŠå¤©è·¯ç”±

åˆ›å»º `src/app/api/chat/route.ts`ï¼š

```ts title="src/app/api/chat/route.ts"
import { handleChatStream } from '@mastra/ai-sdk';
import { toAISdkV5Messages } from '@mastra/ai-sdk/ui'
import { createUIMessageStreamResponse } from 'ai';
import { mastra } from '@/mastra';
import { NextResponse } from 'next/server';

const THREAD_ID = 'example-user-id';
const RESOURCE_ID = 'weather-chat';

export async function POST(req: Request) {
  const params = await req.json();
  const stream = await handleChatStream({
    mastra,
    agentId: 'weather-agent',
    params: {
      ...params,
      memory: {
        ...params.memory,
        thread: THREAD_ID,
        resource: RESOURCE_ID,
      }
    },
  });
  return createUIMessageStreamResponse({ stream });
}

export async function GET() {
  const memory = await mastra.getAgentById('weather-agent').getMemory()
  let response = null

  try {
    response = await memory?.recall({
      threadId: THREAD_ID,
      resourceId: RESOURCE_ID,
    })
  } catch {
    console.log('No previous messages found.')
  }

  const uiMessages = toAISdkV5Messages(response?.messages || []);

  return NextResponse.json(uiMessages)
}
```

`POST` è·¯ç”±æ¥å—æç¤ºè¯å¹¶å°†ä»£ç†çš„å“åº”ä»¥ AI SDK æ ¼å¼æµå¼ä¼ è¾“å›æ¥ï¼Œè€Œ `GET` è·¯ç”±ä»å†…å­˜ä¸­è·å–æ¶ˆæ¯å†å²è®°å½•ï¼Œä»¥ä¾¿åœ¨å®¢æˆ·ç«¯é‡æ–°åŠ è½½æ—¶å¡«å…… UIã€‚

## åˆ›å»ºèŠå¤©é¡µé¢

åˆ›å»º `src/app/chat/page.tsx`ï¼š

```tsx title="src/app/chat/page.tsx"
'use client';

import '@/app/globals.css';
import { useEffect, useState } from 'react';
import { DefaultChatTransport, ToolUIPart } from 'ai';
import { useChat } from '@ai-sdk/react';

import {
  PromptInput,
  PromptInputBody,
  PromptInputTextarea,
} from '@/components/ai-elements/prompt-input';

import {
  Conversation,
  ConversationContent,
  ConversationScrollButton,
} from '@/components/ai-elements/conversation';

import { Message, MessageContent, MessageResponse } from '@/components/ai-elements/message';

import {
  Tool,
  ToolHeader,
  ToolContent,
  ToolInput,
  ToolOutput,
} from '@/components/ai-elements/tool';


function Chat() {
  const [input, setInput] = useState<string>('');

  const { messages, setMessages, sendMessage, status } = useChat({
    transport: new DefaultChatTransport({
      api: '/api/chat',
    }),
  });

  useEffect(() => {
    const fetchMessages = async () => {
      const res = await fetch('/api/chat');
      const data = await res.json();
      setMessages([...data]);
    };
    fetchMessages();
  }, [setMessages]);

  const handleSubmit = async () => {
    if (!input.trim()) return;

    sendMessage({ text: input });
    setInput('');
  };

  return (
    <div className="w-full p-6 relative size-full h-screen">
      <div className="flex flex-col h-full">
        <Conversation className="h-full">
          <ConversationContent>
            {messages.map((message) => (
              <div key={message.id}>
                {message.parts?.map((part, i) => {
                  if (part.type === 'text') {
                    return (
                      <Message
                        key={`${message.id}-${i}`}
                        from={message.role}>
                          <MessageContent>
                            <MessageResponse>{part.text}</MessageResponse>
                          </MessageContent>
                      </Message>
                    );
                  }

                  if (part.type?.startsWith('tool-')) {
                    return (
                      <Tool key={`${message.id}-${i}`}>
                        <ToolHeader
                          type={(part as ToolUIPart).type}
                          state={(part as ToolUIPart).state || 'output-available'}
                          className="cursor-pointer"
                        />
                        <ToolContent>
                          <ToolInput input={(part as ToolUIPart).input || {}} />
                          <ToolOutput
                            output={(part as ToolUIPart).output}
                            errorText={(part as ToolUIPart).errorText}
                          />
                        </ToolContent>
                      </Tool>
                    );
                  }

                  return null;
                })}
              </div>
            ))}
            <ConversationScrollButton />
          </ConversationContent>
        </Conversation>

        <PromptInput onSubmit={handleSubmit} className="mt-20">
          <PromptInputBody>
            <PromptInputTextarea
              onChange={(e) => setInput(e.target.value)}
              className="md:leading-10"
              value={input}
              placeholder="Type your message..."
              disabled={status !== 'ready'}
            />
          </PromptInputBody>
        </PromptInput>
      </div>
    </div>
  );
}

export default Chat;
```

æ­¤ç»„ä»¶å°† [`useChat()`](https://ai-sdk.dev/docs/cn/docs/reference/ai-sdk-ui/use-chat) è¿æ¥åˆ° `api/chat` ç«¯ç‚¹ï¼Œå°†æç¤ºè¯å‘é€è‡³æ­¤å¹¶å°†å“åº”åˆ†å—æµå¼ä¼ è¾“å›æ¥ã€‚

å®ƒä½¿ç”¨ [`<MessageResponse>`](https://ai-sdk.dev/elements/components/message#messageresponse-) ç»„ä»¶æ¸²æŸ“å“åº”æ–‡æœ¬ï¼Œå¹¶ä½¿ç”¨ [`<Tool>`](https://ai-sdk.dev/elements/components/tool) ç»„ä»¶æ˜¾ç¤ºä»»ä½•å·¥å…·è°ƒç”¨ã€‚

## æµ‹è¯•æ‚¨çš„ä»£ç†

1. ä½¿ç”¨ `npm run dev` è¿è¡Œæ‚¨çš„ Next.js åº”ç”¨ç¨‹åº
2. åœ¨ http://localhost:3000/chat æ‰“å¼€èŠå¤©
3. å°è¯•è¯¢é—®å¤©æ°”ã€‚å¦‚æœæ‚¨çš„ API key è®¾ç½®æ­£ç¡®ï¼Œæ‚¨ä¼šå¾—åˆ°å“åº”

## åç»­æ­¥éª¤

æ­å–œæ‚¨ä½¿ç”¨ Next.js æ„å»ºäº† Mastra ä»£ç†ï¼ğŸ‰

ä»è¿™é‡Œå¼€å§‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è‡ªå·±çš„å·¥å…·å’Œé€»è¾‘æ‰©å±•é¡¹ç›®ï¼š

- äº†è§£æ›´å¤šå…³äº[ä»£ç†](/docs/cn/docs/agents/overview)
- ä¸ºæ‚¨çš„ä»£ç†æä¾›è‡ªå·±çš„[å·¥å…·](/docs/cn/docs/agents/using-tools)
- ä¸ºæ‚¨çš„ä»£ç†æ·»åŠ ç±»ä¼¼äººç±»çš„[å†…å­˜](/docs/cn/docs/agents/agent-memory)

å‡†å¤‡å°±ç»ªåï¼Œé˜…è¯»æ›´å¤šå…³äº Mastra å¦‚ä½•ä¸ AI SDK UI å’Œ Next.js é›†æˆçš„ä¿¡æ¯ï¼Œä»¥åŠå¦‚ä½•å°†æ‚¨çš„ä»£ç†éƒ¨ç½²åˆ°ä»»ä½•åœ°æ–¹ï¼ˆåŒ…æ‹¬ Vercelï¼‰ï¼š

- å°† Mastra ä¸ [AI SDK UI](/guides/build-your-ui/ai-sdk-ui) é›†æˆ
- å°†æ‚¨çš„ä»£ç†éƒ¨ç½²åˆ° [Vercel](/guides/deployment/vercel-deployer)
- å°†æ‚¨çš„ä»£ç†éƒ¨ç½²åˆ°[ä»»ä½•åœ°æ–¹](/docs/cn/docs/deployment/overview)
