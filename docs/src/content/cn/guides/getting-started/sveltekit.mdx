---
title: "SvelteKit | æ¡†æ¶"
description: "å¼€å§‹ä½¿ç”¨ Mastra å’Œ SvelteKit"
---

# åœ¨æ‚¨çš„ SvelteKit é¡¹ç›®ä¸­é›†æˆ Mastra

åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæ‚¨å°†ä½¿ç”¨ Mastra æ„å»ºä¸€ä¸ªå·¥å…·è°ƒç”¨å‹ AI ä»£ç†ï¼Œç„¶åé€šè¿‡ä»è·¯ç”±ä¸­ç›´æ¥å¯¼å…¥å’Œè°ƒç”¨ä»£ç†å°†å…¶è¿æ¥åˆ° SvelteKitã€‚

æ‚¨å°†ä½¿ç”¨ [AI SDK UI](https://ai-sdk.dev/docs/cn/docs/ai-sdk-ui/overview) åˆ›å»ºä¸€ä¸ªç¾è§‚ã€äº¤äº’å¼çš„èŠå¤©ä½“éªŒã€‚

## å‰ç½®æ¡ä»¶

- æ‚¨éœ€è¦ä¸€ä¸ªæ”¯æŒçš„[æ¨¡å‹æä¾›å•†](/models)çš„ API keyã€‚å¦‚æœæ‚¨æ²¡æœ‰åå¥½ï¼Œè¯·ä½¿ç”¨ [OpenAI](/models/providers/openai)ã€‚
- å®‰è£… Node.js `v22.13.0` æˆ–æ›´é«˜ç‰ˆæœ¬

## åˆ›å»ºæ–°çš„ SvelteKit åº”ç”¨ç¨‹åºï¼ˆå¯é€‰ï¼‰

å¦‚æœæ‚¨å·²ç»æœ‰ä¸€ä¸ªä½¿ç”¨ Tailwind çš„ SvelteKit åº”ç”¨ç¨‹åºï¼Œè¯·è·³åˆ°ä¸‹ä¸€æ­¥ã€‚

è¿è¡Œä»¥ä¸‹å‘½ä»¤[åˆ›å»ºæ–°çš„ SvelteKit åº”ç”¨ç¨‹åº](https://svelte.dev/docs/cn/docs/kit/creating-a-project)ï¼š

```bash npm2yarn
npx sv create mastra-svelte --template minimal --types ts --add tailwindcss="plugins:forms" --install npm
```

è¿™ä¼šåˆ›å»ºä¸€ä¸ªåä¸º `mastra-svelte` çš„é¡¹ç›®ï¼Œä½†æ‚¨å¯ä»¥å°†å…¶æ›¿æ¢ä¸ºä»»ä½•æ‚¨æƒ³è¦çš„åç§°ã€‚ç¨åæ·»åŠ äº† Tailwind ç”¨äºæ ·å¼è®¾ç½®ã€‚

## åˆå§‹åŒ– Mastra

å¯¼èˆªåˆ°æ‚¨çš„ SvelteKit é¡¹ç›®ï¼š

```bash
cd mastra-svelte
```

è¿è¡Œ [`mastra init`](/reference/cli/mastra#mastra-init)ã€‚å½“æç¤ºæ—¶ï¼Œé€‰æ‹©ä¸€ä¸ªæä¾›å•†ï¼ˆä¾‹å¦‚ OpenAIï¼‰å¹¶è¾“å…¥æ‚¨çš„ keyï¼š

```bash npm2yarn
npx mastra@latest init
```

è¿™ä¼šåˆ›å»ºä¸€ä¸ª `src/mastra` æ–‡ä»¶å¤¹ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªç¤ºä¾‹å¤©æ°”ä»£ç†ä»¥åŠä»¥ä¸‹æ–‡ä»¶ï¼š

- `index.ts` - Mastra é…ç½®ï¼ŒåŒ…æ‹¬å†…å­˜
- `tools/weather-tool.ts` - ç”¨äºè·å–ç»™å®šä½ç½®å¤©æ°”çš„å·¥å…·
- `agents/weather-agent.ts` - ä¸€ä¸ªå¸¦æœ‰ä½¿ç”¨å·¥å…·æç¤ºè¯çš„å¤©æ°”ä»£ç†

åœ¨æ¥ä¸‹æ¥çš„æ­¥éª¤ä¸­ï¼Œæ‚¨å°†ä» SvelteKit è·¯ç”±ä¸­è°ƒç”¨ `weather-agent.ts`ã€‚

## å®‰è£… AI SDK UI

å®‰è£… AI SDK UI ä»¥åŠ Mastra é€‚é…å™¨ï¼š

```bash npm2yarn
npm install @mastra/ai-sdk@latest @ai-sdk/svelte ai
```

## åˆ›å»ºèŠå¤©è·¯ç”±

åˆ›å»º `src/routes/api/chat/+server.ts`ï¼š

```ts title="src/routes/api/chat/+server.ts"
import type { RequestHandler } from "./$types";
import { handleChatStream } from "@mastra/ai-sdk";
import { toAISdkV5Messages } from "@mastra/ai-sdk/ui";
import { createUIMessageStreamResponse } from "ai";
import { mastra } from "../../../mastra";

const THREAD_ID = "example-user-id";
const RESOURCE_ID = "weather-chat";

export const POST: RequestHandler = async ({ request }) => {
  const params = await request.json();
  const stream = await handleChatStream({
    mastra,
    agentId: "weather-agent",
    params: {
      ...params,
      memory: {
        ...params.memory,
        thread: THREAD_ID,
        resource: RESOURCE_ID,
      },
    },
  });

  return createUIMessageStreamResponse({ stream });
};

export const GET: RequestHandler = async () => {
  const memory = await mastra.getAgentById("weather-agent").getMemory();
  let response = null;

  try {
    response = await memory?.recall({
      threadId: THREAD_ID,
      resourceId: RESOURCE_ID,
    });
  } catch {
    console.log("No previous messages found.");
  }

  const uiMessages = toAISdkV5Messages(response?.messages || []);

  return Response.json(uiMessages);
};
```

`POST` è·¯ç”±æ¥å—æç¤ºè¯å¹¶å°†ä»£ç†çš„å“åº”ä»¥ AI SDK æ ¼å¼æµå¼ä¼ è¾“å›æ¥ï¼Œè€Œ `GET` è·¯ç”±ä»å†…å­˜ä¸­è·å–æ¶ˆæ¯å†å²è®°å½•ï¼Œä»¥ä¾¿åœ¨å®¢æˆ·ç«¯é‡æ–°åŠ è½½æ—¶å¡«å…… UIã€‚

ä¸ºäº†è°ƒç”¨ `GET` å¤„ç†ç¨‹åºï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ª `src/routes/+page.ts` æ–‡ä»¶ã€‚å®ƒçš„ `load()` å‡½æ•°ä¸ `+page.svelte` ä¸€èµ·è¿è¡Œã€‚

```ts title="src/routes/+page.ts"
import type { UIDataTypes, UIMessage, UITools } from "ai";
import type { PageLoad } from "./$types";

export const load: PageLoad = async ({ fetch }) => {
  const response = await fetch("/api/chat");
  const initialMessages = (await response.json()) as UIMessage<
    unknown,
    UIDataTypes,
    UITools
  >[];
  return { initialMessages };
};
```

## æ·»åŠ èŠå¤© UI

å°† `src/routes/+page.svelte` æ›¿æ¢ä¸ºä»¥ä¸‹å†…å®¹ã€‚

```html title="src/routes/+page.svelte"
<script lang="ts">
  import { Chat } from '@ai-sdk/svelte';
  import { DefaultChatTransport, type ToolUIPart } from 'ai';

  let input = $state('');
  const { data } = $props();
  let messages = $derived(data.initialMessages)

  const chat = new Chat({
    transport: new DefaultChatTransport({
      api: '/api/chat'
    }),
    get messages() {
      return messages;
    }
  });

  function handleSubmit(event: SubmitEvent) {
    event.preventDefault();
    chat.sendMessage({ text: input });
    input = '';
  }

  const STATE_TO_LABEL_MAP: Record<ToolUIPart["state"], string> = {
    "input-streaming": "Pending",
    "input-available": "Running",
    // @ts-expect-error - Only available in AI SDK v6
    "approval-requested": "Awaiting Approval",
    "approval-responded": "Responded",
    "output-available": "Completed",
    "output-error": "Error",
    "output-denied": "Denied",
  };
</script>

<main class="max-w-3xl mx-auto p-6 size-full h-screen">
  <div class="flex flex-col h-full">
    <div class="flex-1 min-h-0 overflow-y-auto" data-name="conversation">
      <div data-name="conversation-content" class="flex flex-col gap-8">
        {#each chat.messages as message, messageIndex (messageIndex)}
          <div>
            {#each message.parts as part, partIndex (partIndex)}
              {#if part.type === 'text'}
                <div data-name="message" class={[message.role === 'user' && 'ml-auto justify-end', 'group flex w-full max-w-[95%] flex-col gap-2', message.role === 'user' ? 'is-user' : 'is-assistant']}>
                  <div data-name="message-content" class={["is-user:dark flex w-fit max-w-full min-w-0 flex-col gap-2 overflow-hidden text-sm",
      "group-[.is-user]:ml-auto group-[.is-user]:rounded-lg group-[.is-user]:bg-blue-100 group-[.is-user]:px-4 group-[.is-user]:py-3 group-[.is-user]:text-foreground",
      "group-[.is-assistant]:text-foreground"]}>
                    <div data-name="message-response" class="size-full [&>*:first-child]:mt-0 [&>*:last-child]:mb-0">
                      {part.text}
                    </div>
                  </div>
                </div>
              {:else if part.type.startsWith('tool-')}
                <div data-name="tool" class="not-prose mb-6 w-full rounded-lg border border-gray-300 shadow">
                  <details data-name="tool-header" class="w-full p-3 hover:cursor-pointer">
                    <summary class="font-medium text-sm">{(part as ToolUIPart).type.split("-").slice(1).join("-")} - {STATE_TO_LABEL_MAP[(part as ToolUIPart).state ?? 'output-available']}</summary>
                    <div data-name="tool-content" class="">
                      <div data-name="tool-input" class="space-y-2 overflow-hidden py-4">
                        <div class="font-medium text-muted-foreground text-xs uppercase tracking-wide">Parameters</div>
                        <pre class="w-full overflow-x-auto rounded-md border border-gray-300 bg-gray-50 p-3 text-sm"><code>{JSON.stringify((part as ToolUIPart).input, null, 2)}</code></pre>
                      </div>
                      <div data-name="tool-output" class="space-y-2 overflow-hidden py-4">
                        <div class="font-medium text-muted-foreground text-xs uppercase tracking-wide">{(part as ToolUIPart).errorText ? 'Error' : 'Result'}</div>
                        <pre class="w-full overflow-x-auto rounded-md border border-gray-300 bg-gray-50 p-3 text-sm"><code>{JSON.stringify((part as ToolUIPart).output, null, 2)}</code></pre>
                        {#if (part as ToolUIPart).errorText}
                          <div data-name="tool-error" class="text-red-600">
                            {(part as ToolUIPart).errorText}
                          </div>
                        {/if}
                      </div>
                    </div>
                  </details>
                </div>
              {/if}
            {/each}
          </div>
        {/each}
      </div>
    </div>
    <form class="w-full grid grid-cols-[1fr_auto] gap-6 shrink-0 pt-4" onsubmit={handleSubmit} data-name="prompt-input">
      <input name="chat-input" class="rounded-lg border border-gray-300 shadow h-10" placeholder="City name" bind:value={input} />
      <button class="bg-blue-600 text-white shadow-lg border border-blue-400 px-4 whitespace-nowrap rounded-lg text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]" type="submit">Send</button>
    </form>
  </div>
</main>
```

æ­¤é¡µé¢å°† [`Chat`](https://ai-sdk.dev/docs/cn/docs/reference/ai-sdk-ui/use-chat) è¿æ¥åˆ° `api/chat` ç«¯ç‚¹ï¼Œå°†æç¤ºè¯å‘é€è‡³æ­¤å¹¶å°†å“åº”åˆ†å—æµå¼ä¼ è¾“å›æ¥ã€‚

å®ƒä½¿ç”¨è‡ªå®šä¹‰æ¶ˆæ¯å’Œå·¥å…·ç»„ä»¶æ¸²æŸ“å“åº”æ–‡æœ¬ã€‚

## æµ‹è¯•æ‚¨çš„ä»£ç†

1. ä½¿ç”¨ `npm run dev` è¿è¡Œæ‚¨çš„ SvelteKit åº”ç”¨ç¨‹åº
2. åœ¨ http://localhost:5173 æ‰“å¼€èŠå¤©
3. å°è¯•è¯¢é—®å¤©æ°”ã€‚å¦‚æœæ‚¨çš„ API key è®¾ç½®æ­£ç¡®ï¼Œæ‚¨ä¼šå¾—åˆ°å“åº”

## åç»­æ­¥éª¤

æ­å–œæ‚¨ä½¿ç”¨ SvelteKit æ„å»ºäº† Mastra ä»£ç†ï¼ğŸ‰

ä»è¿™é‡Œå¼€å§‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è‡ªå·±çš„å·¥å…·å’Œé€»è¾‘æ‰©å±•é¡¹ç›®ï¼š

- äº†è§£æ›´å¤šå…³äº[ä»£ç†](/docs/cn/docs/agents/overview)
- ä¸ºæ‚¨çš„ä»£ç†æä¾›è‡ªå·±çš„[å·¥å…·](/docs/cn/docs/agents/using-tools)
- ä¸ºæ‚¨çš„ä»£ç†æ·»åŠ ç±»ä¼¼äººç±»çš„[å†…å­˜](/docs/cn/docs/agents/agent-memory)

å‡†å¤‡å°±ç»ªåï¼Œé˜…è¯»æ›´å¤šå…³äº Mastra å¦‚ä½•ä¸ AI SDK UI å’Œ SvelteKit é›†æˆçš„ä¿¡æ¯ï¼Œä»¥åŠå¦‚ä½•å°†æ‚¨çš„ä»£ç†éƒ¨ç½²åˆ°ä»»ä½•åœ°æ–¹ï¼š

- å°† Mastra ä¸ [AI SDK UI](/guides/build-your-ui/ai-sdk-ui) é›†æˆ
- å°†æ‚¨çš„ä»£ç†éƒ¨ç½²åˆ°[ä»»ä½•åœ°æ–¹](/docs/cn/docs/deployment/overview)
- å°è¯•[éå®˜æ–¹çš„ Svelte AI Elements](https://svelte-ai-elements.vercel.app/)
