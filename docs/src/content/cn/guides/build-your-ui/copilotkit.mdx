---
title: "ä½¿ç”¨ CopilotKit | æ¡†æ¶"
description: "äº†è§£å¦‚ä½•å°† CopilotKit ä¸ Mastra é›†æˆ"
---

import Steps from "@site/src/components/Steps";
import StepItem from "@site/src/components/StepItem";

# ä½¿ç”¨ CopilotKit

[CopilotKit](https://www.copilotkit.ai/) æä¾› React ç»„ä»¶ï¼Œå¯å¿«é€Ÿå°†å¯å®šåˆ¶çš„ AI å‰¯é©¾é©¶é›†æˆåˆ°æ‚¨çš„åº”ç”¨ç¨‹åºä¸­ã€‚ç»“åˆ Mastraï¼Œæ‚¨å¯ä»¥æ„å»ºå…·æœ‰åŒå‘çŠ¶æ€åŒæ­¥å’Œäº¤äº’å¼ UI çš„å¤æ‚ AI åº”ç”¨ç¨‹åºã€‚

è®¿é—® [CopilotKit æ–‡æ¡£](https://docs.copilotkit.ai/) äº†è§£æ›´å¤šå…³äº CopilotKit æ¦‚å¿µã€ç»„ä»¶å’Œé«˜çº§ä½¿ç”¨æ¨¡å¼çš„ä¿¡æ¯ã€‚

:::info

å¯¹äº Mastra ç›´æ¥åœ¨æ‚¨çš„ Next.js API è·¯ç”±ä¸­è¿è¡Œçš„å…¨æ ˆé›†æˆæ–¹æ³•ï¼Œè¯·å‚é˜… [CopilotKit å¿«é€Ÿå…¥é—¨](https://docs.copilotkit.ai/mastra/quickstart) æŒ‡å—ã€‚

:::

:::tip

è®¿é—® Mastra çš„ [**"UI Dojo"**](https://ui-dojo.mastra.ai/) æŸ¥çœ‹ä¸ Mastra é›†æˆçš„ CopilotKit å®é™…ç¤ºä¾‹ã€‚

:::

## é›†æˆæŒ‡å—

å°† Mastra ä½œä¸ºç‹¬ç«‹æœåŠ¡å™¨è¿è¡Œï¼Œå¹¶å°†æ‚¨çš„ Next.js å‰ç«¯ï¼ˆå¸¦æœ‰ CopilotKitï¼‰è¿æ¥åˆ°å…¶ API ç«¯ç‚¹ã€‚

<Steps>

<StepItem>

è®¾ç½®æ‚¨çš„ç›®å½•ç»“æ„ã€‚å¯èƒ½çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```bash
project-root
â”œâ”€â”€ mastra-server
â”‚   â”œâ”€â”€ src
â”‚   â”‚   â””â”€â”€ mastra
â”‚   â””â”€â”€ package.json
â””â”€â”€ my-copilot-app
    â””â”€â”€ package.json
```

å¼•å¯¼æ‚¨çš„ Mastra æœåŠ¡å™¨ï¼š

```bash npm2yarn
npx create-mastra@latest
```

æ­¤å‘½ä»¤å°†å¯åŠ¨ä¸€ä¸ªäº¤äº’å¼å‘å¯¼æ¥å¸®åŠ©æ‚¨æ­å»ºæ–°çš„ Mastra é¡¹ç›®ï¼ŒåŒ…æ‹¬æç¤ºæ‚¨è¾“å…¥é¡¹ç›®åç§°å’Œè®¾ç½®åŸºæœ¬é…ç½®ã€‚æŒ‰ç…§æç¤ºåˆ›å»ºæ‚¨çš„æœåŠ¡å™¨é¡¹ç›®ã€‚

å¯¼èˆªåˆ°æ‚¨æ–°åˆ›å»ºçš„ Mastra æœåŠ¡å™¨ç›®å½•ï¼š

```bash
cd mastra-server # æ›¿æ¢ä¸ºæ‚¨æä¾›çš„å®é™…ç›®å½•åç§°
```

ç°åœ¨æ‚¨å·²å‡†å¤‡å¥½ä¸€ä¸ªåŸºæœ¬çš„ Mastra æœåŠ¡å™¨é¡¹ç›®ã€‚æ‚¨åº”è¯¥æœ‰ä»¥ä¸‹æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼š

```bash
src
â””â”€â”€ mastra
    â”œâ”€â”€ agents
    â”‚   â””â”€â”€ weather-agent.ts
    â”œâ”€â”€ scorers
    â”‚   â””â”€â”€ weather-scorer.ts
    â”œâ”€â”€ tools
    â”‚   â””â”€â”€ weather-tool.ts
    â”œâ”€â”€ workflows
    â”‚   â””â”€â”€ weather-workflow.ts
    â””â”€â”€ index.ts
```

:::note

ç¡®ä¿æ‚¨åœ¨ `.env` æ–‡ä»¶ä¸­ä¸ºæ‚¨çš„ LLM æä¾›ç¨‹åºè®¾ç½®äº†é€‚å½“çš„ç¯å¢ƒå˜é‡ã€‚

:::

</StepItem>

<StepItem>

ä½¿ç”¨ `@ag-ui/mastra` ä¸­çš„ `registerCopilotKit()` è¾…åŠ©å‡½æ•°ä¸º CopilotKit å‰ç«¯åˆ›å»ºèŠå¤©è·¯ç”±ã€‚å°†å…¶æ·»åŠ åˆ°æ‚¨çš„ Mastra é¡¹ç›®ï¼ˆåŠå…¶å¯¹ç­‰ä¾èµ–é¡¹ï¼‰ï¼š

```bash npm2yarn
npm install @ag-ui/mastra @mastra/client-js @mastra/core @ag-ui/core @ag-ui/client @copilotkit/runtime
```

åœ¨æ‚¨çš„ `src/mastra/index.ts` æ–‡ä»¶ä¸­ï¼Œæ³¨å†ŒèŠå¤©è·¯ç”±ï¼š

```typescript title="src/mastra/index.ts" {2,7-19}
import { Mastra } from '@mastra/core/mastra';
import { registerCopilotKit } from '@ag-ui/mastra/copilotkit';
// å…¶ä½™çš„å¯¼å…¥...

export const mastra = new Mastra({
  // å…¶ä½™çš„é…ç½®...
  server: {
    cors: {
      origin: "*",
      allowMethods: ["*"],
      allowHeaders: ["*"],
    },
    apiRoutes: [
      registerCopilotKit({
        path: '/chat',
        resourceId: 'weatherAgent'
      })
    ]
  }
});
```

è¿™å°†ä½¿ `weatherAgent` ä»¥ CopilotKit å…¼å®¹çš„æ ¼å¼åœ¨ `/chat` å¤„å¯ç”¨ã€‚æ‚¨å¿…é¡»æ·»åŠ  CORS é…ç½®ä»¥å…è®¸ CopilotKit å‰ç«¯è®¿é—® Mastra æœåŠ¡å™¨ã€‚å¯¹äºç”Ÿäº§éƒ¨ç½²ï¼Œè¯·ç¡®ä¿å°† CORS æ¥æºé™åˆ¶ä¸ºæ‚¨çš„å‰ç«¯åŸŸã€‚

</StepItem>

<StepItem>

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œ Mastra æœåŠ¡å™¨ï¼š

```bash npm2yarn
npm run dev
```

é»˜è®¤æƒ…å†µä¸‹ï¼ŒMastra æœåŠ¡å™¨å°†åœ¨ `http://localhost:4111` ä¸Šè¿è¡Œã€‚ä¿æŒæ­¤æœåŠ¡å™¨è¿è¡Œä»¥è¿›è¡Œä¸‹ä¸€æ­¥ï¼Œåœ¨é‚£é‡Œæˆ‘ä»¬å°†è®¾ç½® CopilotKit å‰ç«¯è¿æ¥åˆ°å®ƒã€‚

</StepItem>

<StepItem>

å‘ä¸Šç§»åŠ¨ä¸€çº§åˆ°é¡¹ç›®æ ¹ç›®å½•ã€‚

```bash
cd ..
```

ä½¿ç”¨åç§° `my-copilot-app` åˆ›å»ºä¸€ä¸ªæ–°çš„ Next.js é¡¹ç›®ï¼š

```bash npm2yarn
npx create-next-app@latest my-copilot-app
```

å¯¼èˆªåˆ°æ‚¨æ–°åˆ›å»ºçš„ Next.js é¡¹ç›®ç›®å½•ï¼š

```bash
cd my-copilot-app
```

</StepItem>

<StepItem>

å®‰è£… CopilotKit UI åŒ…ï¼Œæ‚¨å°†ä½¿ç”¨å®ƒä»¬æ¥æ˜¾ç¤ºèŠå¤©ç•Œé¢ï¼š

```bash npm2yarn
npm install @copilotkit/react-ui @copilotkit/react-core
```

æ‰“å¼€ Next.js åº”ç”¨ç¨‹åºçš„ä¸»é¡µè·¯ç”±ï¼ˆé€šå¸¸ä¸º `app/page.tsx` æˆ– `src/app/page.tsx`ï¼‰ï¼Œå¹¶ç”¨ä»¥ä¸‹ä»£ç æ›¿æ¢ç°æœ‰å†…å®¹ä»¥è®¾ç½®åŸºæœ¬çš„ CopilotKit èŠå¤©ç•Œé¢ï¼š

```typescript title="app/page.tsx"
import { CopilotChat } from "@copilotkit/react-ui";
import { CopilotKit } from "@copilotkit/react-core";
import "@copilotkit/react-ui/styles.css";

export default function Home() {
  return (
    <CopilotKit
      runtimeUrl="http://localhost:4111/chat"
      agent="weatherAgent"
    >
      <CopilotChat
        labels={{
          title: "Weather Agent",
          initial: "Hi! ğŸ‘‹ Ask me about the weather, forecasts, and climate.",
        }}
      />
    </CopilotKit>
  );
}
```

</StepItem>

<StepItem>

æ‚¨å·²å‡†å¤‡å¥½è¿æ¥å„ä¸ªéƒ¨åˆ†ï¼ç¡®ä¿ Mastra æœåŠ¡å™¨å’Œ CopilotKit å‰ç«¯éƒ½åœ¨è¿è¡Œã€‚å¯åŠ¨ Next.js å¼€å‘æœåŠ¡å™¨ï¼š

```bash npm2yarn
npm run dev
```

ç°åœ¨æ‚¨åº”è¯¥èƒ½å¤Ÿåœ¨æµè§ˆå™¨ä¸­ä¸æ‚¨çš„ä»£ç†èŠå¤©ã€‚

</StepItem>

</Steps>

æ­å–œï¼æ‚¨å·²æˆåŠŸä½¿ç”¨ç‹¬ç«‹æœåŠ¡å™¨æ–¹æ³•å°† Mastra ä¸ CopilotKit é›†æˆã€‚æ‚¨çš„ CopilotKit å‰ç«¯ç°åœ¨ä¸ç‹¬ç«‹çš„ Mastra ä»£ç†æœåŠ¡å™¨é€šä¿¡ã€‚

## éƒ¨ç½²

ä½¿ç”¨ CopilotKit éƒ¨ç½² Mastra æœåŠ¡å™¨æ—¶ï¼Œå¿…é¡»å°† `@copilotkit/runtime` ä»åŒ…ä¸­æ’é™¤ã€‚æ­¤åŒ…åŒ…å«ä¸æ‰“åŒ…ä¸å…¼å®¹çš„ä¾èµ–é¡¹ï¼Œå¦‚æœåŒ…å«ä¼šå¯¼è‡´ 500 é”™è¯¯ã€‚

:::note

åœ¨å¼€å‘ä¸­ä½¿ç”¨ `mastra dev` æ—¶ä¸ä¼šå‡ºç°æ­¤é—®é¢˜ï¼Œå› ä¸ºå®ƒä¸éœ€è¦æ‰“åŒ…ã€‚ä½†æ˜¯ï¼Œä»»ä½•è¿è¡Œ `mastra build` è¿›è¡Œéƒ¨ç½²çš„äººéƒ½ä¼šé‡åˆ°æ­¤é—®é¢˜ã€‚

:::

å°† `@copilotkit/runtime` åŒ…æ·»åŠ åˆ°æ‚¨çš„æ‰“åŒ…å™¨å¤–éƒ¨é…ç½®ï¼š

```typescript title="src/mastra/index.ts"
export const mastra = new Mastra({
  bundler: {
    externals: ['@copilotkit/runtime'],
  },
});
```
