---
title: "æŒ‡å—ï¼šåœ¨ GitHub Actions ä¸­è‡ªåŠ¨åŒ–å¤šè¯­è¨€ PR æè¿° | Mastra | æŒ‡å—"
description: ä½¿ç”¨ GitHub Actions å·¥ä½œæµè‡ªåŠ¨åŒ–å¤šè¯­è¨€æ‹‰å–è¯·æ±‚æè¿°ï¼Œè¯¥å·¥ä½œæµä½¿ç”¨ Mastra è¯»å–å·®å¼‚å¹¶ç”Ÿæˆç®€æ´çš„ PR æè¿°ã€‚
---

# ä¸º GitHub Actions æ„å»º PR æè¿°ä»£ç†

åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæ‚¨å°†æ„å»ºä¸€ä¸ª [GitHub Action](https://docs.github.com/en/actions)ï¼Œå®ƒä½¿ç”¨ Mastra ä»£ç†è¯»å–æ‹‰å–è¯·æ±‚å·®å¼‚ï¼Œç”Ÿæˆå¤šè¯­è¨€æ‘˜è¦ï¼Œå¹¶ç›´æ¥å°†å…¶å†™å…¥ GitHub UI ä¸­çš„ PR æè¿°ã€‚è¯¥æ“ä½œåœ¨åˆ›å»ºæˆ–æ›´æ–°æ‹‰å–è¯·æ±‚æ—¶è¿è¡Œï¼Œå¹¶éšç€å·®å¼‚çš„å˜åŒ–é‡æ–°ç”Ÿæˆæè¿°ã€‚

è¿™ç§æ–¹æ³•ç±»ä¼¼äº AI é©±åŠ¨çš„ PR å·¥å…·ï¼Œå¦‚ [CodeRabbit](https://coderabbit.ai/) å’Œ [Greptile](https://www.greptile.com/)ï¼Œä½†ä½¿ç”¨åŸç”Ÿ GitHub Actions å·¥ä½œæµå’Œ Mastra ä»£ç†æ„å»ºã€‚

è¯¥è®¾ç½®ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š

- ç”Ÿæˆæè¿°çš„ Mastra ä»£ç†
- åœ¨æ‹‰å–è¯·æ±‚ä¸Šè§¦å‘çš„ GitHub Actions å·¥ä½œæµ
- å°†å·¥ä½œæµè¿æ¥åˆ°ä»£ç†çš„ Node.js è„šæœ¬

å®Œæˆçš„æ“ä½œä¼šå†™å…¥åŒ…å«è‹±è¯­ã€è¥¿ç­ç‰™è¯­å’Œæ—¥è¯­æ‘˜è¦çš„æè¿°ï¼Œæ¯ä¸ªéƒ½ç”¨æ——å¸œè¡¨æƒ…ç¬¦å·æ ‡è®°ä»¥ä¾¿è½»æ¾æ‰«æã€‚ä¾‹å¦‚ï¼š

```text
ğŸ‡¬ğŸ‡§ English
This PR integrates Astro into the project, adding configuration files and updating scripts to support Astro development.

ğŸ‡ªğŸ‡¸ EspaÃ±ol
Este PR integra Astro en el proyecto, aÃ±adiendo archivos de configuraciÃ³n y actualizando scripts para soportar el desarrollo con Astro.

ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª
ã“ã®PRã¯ã€Astroã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«çµ±åˆã—ã€Astroé–‹ç™ºã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãŸã‚ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ã—ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ›´æ–°ã—ã¾ã™ã€‚
```


## å¼€å§‹ä¹‹å‰

- ä¸€ä¸ª Mastra é¡¹ç›®ï¼ˆè¯·å‚é˜…[å¿«é€Ÿå…¥é—¨](/guides/getting-started/quickstart)ï¼‰
- æ¥è‡ªæ”¯æŒçš„[æ¨¡å‹æä¾›å•†](/models)çš„ API å¯†é’¥ã€‚å¦‚æœæ‚¨æ²¡æœ‰åå¥½ï¼Œè¯·ä½¿ç”¨ [OpenAI](/models/providers/openai)
- Node.js `v22.13.0` æˆ–æ›´é«˜ç‰ˆæœ¬

### è®¾ç½®ä»“åº“å¯†é’¥

å·¥ä½œæµéœ€è¦è®¿é—®æ‚¨çš„æ¨¡å‹æä¾›å•† API å¯†é’¥ã€‚å°†å…¶ä½œä¸ºä»“åº“å¯†é’¥æ·»åŠ åˆ° GitHubï¼š

1. è½¬åˆ° GitHub ä¸Šçš„æ‚¨çš„ä»“åº“
2. å¯¼èˆªåˆ° **Settings** > **Secrets and variables** > **Actions**
3. ç‚¹å‡» **New repository secret**
4. ä½¿ç”¨åç§° `OPENAI_API_KEY` æ·»åŠ æ‚¨çš„ API å¯†é’¥ï¼ˆæˆ–æ‚¨æä¾›å•†çš„ç›¸åº”å¯†é’¥ï¼‰

    ![Screenshot of repository secrets in GitHub UI](/img/guides/github-action-repository-secrets.jpg)

å·¥ä½œæµå°†æ­¤å¯†é’¥å¼•ç”¨ä¸º `${{ secrets.OPENAI_API_KEY }}` å¹¶åœ¨è¿è¡Œæ—¶ä½¿å…¶å¯¹ Mastra ä»£ç†å¯ç”¨ã€‚

## åˆ›å»ºæè¿°ä»£ç†

PR æè¿°ä»£ç†è´Ÿè´£å°† git å·®å¼‚è½¬æ¢ä¸ºæ¸…æ™°ã€å¯¹å®¡æŸ¥è€…å‹å¥½çš„æ‹‰å–è¯·æ±‚æè¿°ã€‚

æ­¤ä»£ç†æ¥æ”¶æ¥è‡ªæ‹‰å–è¯·æ±‚çš„åŸå§‹å·®å¼‚ã€‚å®ƒä»¥é…ç½®çš„è¯­è¨€ç”Ÿæˆæè¿°ï¼Œå¹¶ä½¿ç”¨è¡¨æƒ…ç¬¦å·æ ‡å¿—æ ¼å¼åŒ–è¾“å‡ºï¼Œä»¥ä¾¿ PR ä¸­çš„æ¯ä¸ªè¯­è¨€éƒ¨åˆ†éƒ½æ˜“äºæ‰«æã€‚

```ts title="src/mastra/agents/description-agent.ts"
import { Agent } from "@mastra/core/agent";

export const descriptionAgent = new Agent({
  id: "description-agent",
  name: "PR Description Agent",
  instructions: `You are a helpful assistant that creates clear, concise PR descriptions.

When given a git diff of changed files, you will:
1. Analyze the changes to understand what was modified
2. Write a brief summary and list of changes
3. Output the same content in English, Spanish, and Japanese

Guidelines:
- Be concise but informative
- Focus on the "what" and "why" of changes
- Use technical terms appropriately
- Keep bullet points short and scannable
- Each language section should contain the same information, naturally translated

Output format:

### ğŸ‡¬ğŸ‡§ English

[1-2 sentence summary]

- [Change 1]
- [Change 2]
- [Change 3]

---

### ğŸ‡ªğŸ‡¸ EspaÃ±ol

[Same summary in Spanish]

- [Same changes in Spanish]

---

### ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª

[Same summary in Japanese]

- [Same changes in Japanese]
`,
  model: "openai/gpt-4o"
});
```

### æœ¬åœ°æµ‹è¯•ä»£ç†

åœ¨éƒ¨ç½²å·¥ä½œæµä¹‹å‰ï¼Œæ‚¨å¯ä»¥åœ¨ [Mastra Studio](/docs/cn/docs/getting-started/studio) ä¸­æµ‹è¯•ä»£ç†ï¼ŒéªŒè¯å®ƒæ˜¯å¦æ­£ç¡®ç”Ÿæˆæè¿°ã€‚

1. é€šè¿‡åœ¨ PR URL åé™„åŠ  `.diff` ä»ä»»ä½•å…¬å…± GitHub PR è·å–å·®å¼‚ï¼š

    ```
    https://github.com/owner/repo/pull/123.diff
    ```

2. åœ¨å·¥ä½œå®¤ä¸­æ‰“å¼€ PR æè¿°ä»£ç†ï¼Œå¹¶ä½¿ç”¨ä»¥ä¸‹æç¤ºç²˜è´´å·®å¼‚å†…å®¹ï¼š

"Please create a PR description for the following changes. `<paste the diff content here>`"

ä»£ç†å°†è¿”å›åŒ…å«è‹±è¯­ã€è¥¿ç­ç‰™è¯­å’Œæ—¥è¯­éƒ¨åˆ†çš„æ ¼å¼åŒ–æè¿°ã€‚

## GitHub Actions

GitHub Actions åœ¨ GitHub åŸºç¡€è®¾æ–½ä¸Šçš„çŸ­æœŸç¯å¢ƒä¸­è¿è¡Œæ‚¨çš„å·¥ä½œæµã€‚æ¯æ¬¡è¿è¡Œéƒ½ä»å¹²å‡€çš„è™šæ‹Ÿæœºå¼€å§‹ï¼Œæ£€å‡ºæ‚¨çš„ä»£ç ï¼Œå®‰è£…ä¾èµ–é¡¹ï¼Œè¿è¡Œå·¥ä½œæµæ­¥éª¤ï¼Œç„¶åå…³é—­ã€‚é™¤éæ‚¨æ˜ç¡®å°†å…¶ä¿å­˜ä¸ºå·¥ä»¶æˆ–ç¼“å­˜ï¼Œå¦åˆ™ä¸ä¼šåœ¨è¿è¡Œä¹‹é—´ä¿ç•™ä»»ä½•å†…å®¹ã€‚

### åˆ›å»ºå·¥ä½œæµ

GitHub Actions å·¥ä½œæµä½äº `.github/workflows` ç›®å½•ä¸­ã€‚åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª `.github` ç›®å½•ï¼Œç„¶ååœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ª `workflows` ç›®å½•ã€‚æ·»åŠ ä¸€ä¸ªåä¸º `pr-description.yml` çš„æ–‡ä»¶ã€‚

æ­¤å·¥ä½œæµåœ¨æ‰“å¼€æˆ–æ›´æ–°æ‹‰å–è¯·æ±‚æ—¶è¿è¡Œã€‚å®ƒä¸º PR ç”Ÿæˆå·®å¼‚ï¼Œè°ƒç”¨ Mastra ä»£ç†æ¥æè¿°æ›´æ”¹ï¼Œå¹¶å°†æè¿°ç›´æ¥å†™å…¥ GitHub UI ä¸­çš„ PRã€‚

```yaml title=".github/workflows/pr-description.yml"
name: PR Description Generator

on:
  pull_request:
    types: [opened, synchronize]

permissions:
  contents: read
  pull-requests: write

env:
  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
  PR_DIFF_FILE: /tmp/pr_diff.txt
  PR_DESCRIPTION_FILE: /tmp/pr_description.md

jobs:
  generate-description:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - uses: actions/setup-node@v4
        with:
          node-version: '22'
          cache: 'npm'

      - run: npm ci

      - id: pr
        run: |
          BASE_REF=$(gh pr view ${{ github.event.pull_request.number }} --json baseRefName -q '.baseRefName')
          git fetch origin $BASE_REF
          git diff origin/$BASE_REF...HEAD -- . ':!package-lock.json' > $PR_DIFF_FILE

      - run: npx tsx .github/scripts/generate-description.ts

      - run: gh pr edit ${{ github.event.pull_request.number }} --body-file $PR_DESCRIPTION_FILE
```

#### å·¥ä½œæµè§£é‡Š

- **`on: pull_request`**ï¼šåœ¨æ‰“å¼€æˆ–æ›´æ–°æ‹‰å–è¯·æ±‚æ—¶è¿è¡Œã€‚
- **`permissions: pull-requests: write`**ï¼šå…è®¸å·¥ä½œæµæ›´æ–° PR æè¿°ã€‚
- **`env`**ï¼šå®šä¹‰è·¨æ­¥éª¤ä½¿ç”¨çš„å…±äº«æ–‡ä»¶è·¯å¾„ï¼Œå¹¶ä»ä»“åº“å¯†é’¥è¯»å–å¿…éœ€çš„å€¼ï¼ŒåŒ…æ‹¬ Mastra ä»£ç†ä½¿ç”¨çš„æ¨¡å‹ API å¯†é’¥ã€‚
- **`actions/checkout@v4` + git å‘½ä»¤**ï¼šæ£€å‡ºå®Œæ•´çš„ä»“åº“å†å²è®°å½•ï¼Œè·å– PR åŸºç¡€åˆ†æ”¯ï¼Œå¹¶å°† PR å·®å¼‚å†™å…¥ `/tmp/pr_diff.txt`ã€‚
- **`actions/setup-node@v4`**ï¼šè®¾ç½®å·¥ä½œæµä½¿ç”¨çš„ Node.js è¿è¡Œæ—¶ã€‚
- **`npm ci`**ï¼šä» lockfile å®‰è£…ä»“åº“çš„ Node.js ä¾èµ–é¡¹ã€‚
- **`generate-description.ts`**ï¼šè¯»å– `/tmp/pr_diff.txt`ï¼Œè°ƒç”¨ Mastra ä»£ç†ï¼Œå¹¶å°†ç”Ÿæˆçš„æè¿°å†™å…¥ `/tmp/pr_description.md`ã€‚
- **`gh pr edit`**ï¼šä½¿ç”¨ `/tmp/pr_description.md` çš„å†…å®¹æ›´æ–°æ‹‰å–è¯·æ±‚æè¿°ã€‚

:::note

å·¥ä½œæµåœ¨ç”Ÿæˆå·®å¼‚æ—¶æ’é™¤ `package-lock.json`ã€‚Lockfile é€šå¸¸å¾ˆå¤§ä¸”å˜ˆæ‚ï¼ŒåŒ…å«å®ƒä»¬å¯èƒ½ä¼šä½¿ä»£ç†çš„ä¸Šä¸‹æ–‡çª—å£è¿‡è½½ï¼Œå¹¶ä½¿ç”Ÿæˆçš„æè¿°æ›´éš¾æ¨ç†ã€‚

:::

### åˆ›å»ºå·¥ä½œæµè„šæœ¬

åœ¨ `.github` å†…åˆ›å»ºä¸€ä¸ª `scripts` ç›®å½•ï¼Œå¹¶æ·»åŠ ä¸€ä¸ªåä¸º `generate-description.ts` çš„æ–‡ä»¶ã€‚

æ­¤è„šæœ¬ä» `PR_DIFF_FILE` è¯»å– PR å·®å¼‚ï¼Œä½¿ç”¨ Mastra ä»£ç†ç”Ÿæˆæè¿°ï¼Œå¹¶å°†ç»“æœå†™å…¥ `PR_DESCRIPTION_FILE` ä»¥ä¾¿å·¥ä½œæµå‘å¸ƒåˆ°æ‹‰å–è¯·æ±‚ã€‚

```typescript title=".github/scripts/generate-description.ts"
import { readFileSync, writeFileSync } from "fs";
import { mastra } from "../../src/mastra";

const agent = mastra.getAgent("descriptionAgent");

await agent.generate(
  `Please create a PR description for the following changes.

Git diff:
\`\`\`diff
${readFileSync(process.env.PR_DIFF_FILE!, "utf-8")}
\`\`\``,
  {
    onError: () => {
      writeFileSync(
        process.env.PR_DESCRIPTION_FILE!,
        "This PR diff is too large to generate a description automatically."
      );
    },
    onFinish: (result) => {
      writeFileSync(process.env.PR_DESCRIPTION_FILE!, result.text);
    }
  }
);
```

#### å·¥ä½œæµè„šæœ¬è§£é‡Š

- **`mastra.getAgent("descriptionAgent")`**ï¼šè·å–ç”Ÿæˆ PR æè¿°çš„ Mastra ä»£ç†ã€‚
- **`agent.generate(...)`**ï¼šä» `PR_DIFF_FILE` è¯»å–æ‹‰å–è¯·æ±‚å·®å¼‚ï¼Œå¹¶è¦æ±‚ä»£ç†ç¼–å†™ PR æè¿°ã€‚
- **`onError` å›è°ƒ**ï¼šåœ¨å·®å¼‚å¤ªå¤§æ— æ³•å¤„ç†æ—¶å‘ `PR_DESCRIPTION_FILE` å†™å…¥å›é€€æ¶ˆæ¯ã€‚
- **`onFinish` å›è°ƒ**ï¼šå°†ç”Ÿæˆçš„ PR æè¿°å†™å…¥ `PR_DESCRIPTION_FILE`ã€‚

## åç»­æ­¥éª¤

æ‚¨ç°åœ¨æœ‰äº†ä¸€ä¸ªä½¿ç”¨ Mastra ä»£ç†ç”Ÿæˆå¤šè¯­è¨€ PR æè¿°çš„ GitHub Actionsã€‚ä¸€æ—¦å·¥ä½œæµå’Œæ”¯æŒæ–‡ä»¶åˆå¹¶åˆ°æ‚¨çš„ä¸»åˆ†æ”¯ï¼Œä»£ç†å°†åœ¨ä¸‹æ¬¡åˆ›å»ºæˆ–æ›´æ–°æ‹‰å–è¯·æ±‚æ—¶è‡ªåŠ¨è¿è¡Œã€‚æ‚¨å¯ä»¥åœ¨ä»“åº“çš„ **Actions** é€‰é¡¹å¡ä¸­ç›‘æ§è¿è¡Œæƒ…å†µã€‚

ä»è¿™é‡Œï¼Œæ‚¨å¯ä»¥è‡ªå®šä¹‰ä»£ç†æŒ‡ä»¤ã€æ›´æ”¹è¾“å‡ºè¯­è¨€ï¼Œæˆ–æ‰©å±•å·¥ä½œæµä»¥å¤„ç†å…¶ä»–äº‹ä»¶ã€‚

è¦äº†è§£æ›´å¤šä¿¡æ¯ï¼š

- é˜…è¯»[ä»£ç†](/docs/cn/docs/agents/overview)æ–‡æ¡£
- ä¸ºæ‚¨çš„ä»£ç†æä¾›[å·¥å…·](/docs/cn/docs/tools-mcp/overview)ä»¥è·å–é¢å¤–ä¸Šä¸‹æ–‡
- æ¢ç´¢å…¶ä»– [GitHub Actions è§¦å‘å™¨](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows)ï¼Œå¦‚é—®é¢˜è¯„è®ºæˆ–å‘å¸ƒ
