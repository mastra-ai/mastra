---
title: "处理器 | v1 迁移指南"
description: "了解在升级到 v1 时如何迁移处理器相关的更改。"
---

# 处理器

处理器接口已更新为使用一致的命名模式和数据库消息类型。

## 变更

### 处理器配置从 `name` 改为 `id`

处理器现在需要 `id` 字段而不是 `name`。`name` 字段现在是可选的。此更改提供了与评分器和代理等其他 Mastra 实体的一致性。

要迁移，请更新处理器定义以使用 `id` 作为必需字段。

```diff
  import type { InputProcessor } from '@mastra/core/processors';

  const processor: InputProcessor = {
-   name: 'my-processor',
+   id: 'my-processor',
+   name: 'My Processor', // 可选
    processInput: async ({ messages }) => {
      // ...
    },
  };
```

### 处理器消息类型从 `MastraMessageV2` 改为 `MastraDBMessage`

处理器消息类型已从 `MastraMessageV2` 更改为 `MastraDBMessage`。此更改通过与数据库消息格式保持一致来提供与评分器配置的一致性和更好的类型安全性。

要迁移，请更新处理器消息类型导入和使用。

```diff
  import type { InputProcessor } from '@mastra/core/processors';
- import type { MastraMessageV2 } from '@mastra/core/agent';
+ import type { MastraDBMessage } from '@mastra/core/agent';

  const processor: InputProcessor = {
    id: 'my-processor',
-   processInput: async ({ messages }: { messages: MastraMessageV2[] }) => {
+   processInput: async ({ messages }: { messages: MastraDBMessage[] }) => {
      // ...
    },
  };
```

## 移除

### 已弃用的输入处理器导出

已弃用的输入处理器导出（包括内置处理器）已从 `@mastra/core/agent/input-processors/processors` 中移除。请改用 `@mastra/core/processors`。此更改将处理器类型统一在 `Processor` 接口下。

如果您使用了 `InputProcessor`，请将其替换为实现 `processInput` 函数的 `Processor`。

```diff
- import { InputProcessor, ModerationProcessor } from '@mastra/core/agent/input-processors/processors';
+ import { Processor, ModerationProcessor } from '@mastra/core/processors';
```

### 内存处理器导出移至核心

`@mastra/memory/processors` 导出已被移除。所有处理器现在都从 `@mastra/core/processors` 导出。此更改将所有处理器导出合并到一个位置。

要迁移，请将您的导入路径从 `@mastra/memory/processors` 更新为 `@mastra/core/processors`。

```diff
- import { TokenLimiter, ToolCallFilter } from '@mastra/memory/processors';
+ import { TokenLimiter, ToolCallFilter } from '@mastra/core/processors';
```
