---
title: "Upgrade to Mastra v1 | Migration Guide"
description: "Learn how to upgrade through breaking changes in pre-v1 versions of Mastra."
---

import { Callout } from "nextra/components";

# Upgrade to Mastra v1

In this guide you'll learn how to upgrade through breaking changes in pre-v1 versions of Mastra. It'll also help you upgrade to Mastra v1.

Use your package manager to update your project's versions. Be sure to update **all** Mastra packages at the same time.

<Callout type="info">

Versions mentioned in the headings refer to the `@mastra/core` package. If necessary, versions of other Mastra packages are called out in the detailed description.

All Mastra packages have a peer dependency on `@mastra/core` so your package manager can inform you about compatibility.

</Callout>

## Migrate to v0.23 (unreleased)

<Callout>

This version isn't released yet but we're adding changes as we make them.

</Callout>

### Updated APIs

#### Agent class

- Removed `generateVNext()` method. Use `generate()` instead.
- Removed `streamVNext()` method. Use `stream()` instead.
- `agent.llm` → `agent.getLLM()`
- `agent.tools` → `agent.getTools()`
- `agent.instructions` → `agent.getInstructions()`
- `agent.speak()` → `agent.voice.speak()`
- `agent.getSpeakers()` → `agent.voice.getSpeakers()`
- `agent.listen` → `agent.voice.listen()`
- `agent.fetchMemory` → `(await agent.getMemory()).query()`
- `agent.toStep` → Add agent directly to the step, workflows handle the transformation
- `getDefaultGenerateOptions()` → `getDefaultGenerateOptionsLegacy()`
- `getDefaultStreamOptions()` → `getDefaultStreamOptionsLegacy()`
- `getDefaultVNextStreamOptions()` → `getDefaultStreamOptions()`

#### Output Options

- Removed deprecated `output` field from `generate()`/`stream()` options. Use `structuredOutput.schema` instead:

```typescript
// Before
const result = await agent.generate(messages, {
  output: z.object({
    answer: z.string()
  })
});

// After
const result = await agent.generate(messages, {
  structuredOutput: {
    schema: z.object({
      answer: z.string()
    })
  }
});
```

#### Abort Signal

- Removed `modelSettings.abortSignal`. Use the top-level `abortSignal` option instead:

```typescript
// Before
const result = await agent.stream(messages, {
  modelSettings: {
    abortSignal: controller.signal,
    temperature: 0.7
  }
});

// After
const result = await agent.stream(messages, {
  abortSignal: controller.signal,
  modelSettings: {
    temperature: 0.7
  }
});
```

#### MCP tools

- Removed `elicitation` and `extra` from top level arguments. Use the `mcp` property instead.

```typescript
export const accountBalance = createTool({
  id: 'account-balance',
  description: 'Fetches the current account balance for a given account',
  inputSchema: z.object({
    accountId: z.string(),
  }),
  outputSchema: z.object({
    balance: z.number(),
  }),
  execute: async ({ context, mcp }) => {    
    if (mcp) {
      await checkAuth(mcp.extra.authInfo)

      const result = await mcp.elicitation.sendRequest({
        message: `Is it ok to fetch the account balance for account ${context.accountId}?`,
        requestedSchema: {
          type: 'object',
          properties: {
            confirm: { type: 'boolean' },
          },
          required: ['confirm'],
        }
      });

      if (result.action === 'accept') {
        return {
          balance: getAccountBalance(context.accountId),
        };
      }
    }
  }
})
```

## Migrate to v0.22

### Deprecated: `format: "aisdk"`

The `format: "aisdk"` option in `stream()`/`generate()` methods is deprecated. Use the `@mastra/ai-sdk` package instead. Learn more in the [Using Vercel AI SDK documentation](../../docs/frameworks/agentic-uis/ai-sdk.mdx).

### Removed: MCP Classes

`@mastra/mcp` - `0.14.0`

- Removed `MastraMCPClient` class. Use [`MCPClient`](../../reference/tools/mcp-client.mdx) class instead.
- Removed `MCPConfigurationOptions` type. Use [`MCPClientOptions`](../../reference/tools/mcp-client.mdx#mcpclientoptions) type instead. The API is identical.
- Removed `MCPConfiguration` class. Use [`MCPClient`](../../reference/tools/mcp-client.mdx) class instead.

### Removed: CLI flags & commands

`mastra` - `0.17.0`

- Removed the `mastra deploy` CLI command. Use the deploy instructions of your individual platform.
- Removed `--env` flag from `mastra build` command. To start the build output with a custom env use `mastra start --env <env>` instead.
- Remove `--port` flag from `mastra dev`. Use `server.port` on the `new Mastra()` class instead.

## Migrate to v0.21

No changes needed.

## Migrate to v0.20

- [VNext to Standard APIs](./vnext-to-standard-apis.mdx)
- [AgentNetwork to .network()](./agentnetwork.mdx)