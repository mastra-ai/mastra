---
title: "Migration: Upgrade to Mastra v1 | Migration Guide"
description: "Learn how to upgrade through breaking changes in pre-v1 versions of Mastra."
---

# Upgrade to Mastra v1

In this guide you'll learn how to upgrade through breaking changes in pre-v1 versions of Mastra. It'll also help you upgrade to Mastra v1.

Use your package manager to update your project's versions. Be sure to update **all** Mastra packages at the same time.

:::info

Versions mentioned in the headings refer to the `@mastra/core` package. If necessary, versions of other Mastra packages are called out in the detailed description.

All Mastra packages have a peer dependency on `@mastra/core` so your package manager can inform you about compatibility.

:::

## Migrate to v1.0.0-beta


### Agent class

- Removed `generateVNext()` method. Use `generate()` instead.
- Removed `streamVNext()` method. Use `stream()` instead.
- `agent.llm` → `agent.getLLM()`
- `agent.tools` → `agent.listTools()`
- `agent.instructions` → `agent.getInstructions()`
- `agent.speak()` → `agent.voice.speak()`
- `agent.getSpeakers()` → `agent.voice.getSpeakers()`
- `agent.listen` → `agent.voice.listen()`
- `agent.fetchMemory` → `(await agent.getMemory()).query()`
- `agent.toStep` → Add agent directly to the step, workflows handle the transformation
- `getDefaultGenerateOptions()` → `getDefaultGenerateOptionsLegacy()`
- `getDefaultStreamOptions()` → `getDefaultStreamOptionsLegacy()`
- `getDefaultVNextStreamOptions()` → `getDefaultOptions()`

### Removed: `format` Parameter from `agent.stream()`

**Breaking Changes:**

The `format` parameter has been removed from `agent.stream()`/`agent.generate()`. AI SDK stream transformations are now handled by the `@mastra/ai-sdk` package.

**Why this change?**

- **Better separation of concerns**: AI SDK-specific formatting logic is now in a dedicated package
- **Improved tree-shaking**: Applications that don't use AI SDK don't bundle conversion code
- **Clearer API**: Stream methods focus on generation, while formatting is handled explicitly
- **Framework flexibility**: Makes it easier to support different UI frameworks without bloating the core

**Migration:**

If you were using `format: "aisdk"` for streaming, update your code to use `toAISdkStream` from `@mastra/ai-sdk`:

```typescript
// Before
const stream = await agent.stream(messages, {
  format: "aisdk", // ❌ No longer supported
});

// After
import { toAISdkStream } from "@mastra/ai-sdk";

const stream = await agent.stream(messages);
const aiSdkStream = toAISdkStream(stream, { from: "agent" }); // ✅ Explicit conversion
```

**Working with AI SDK UI components:**

The `@mastra/ai-sdk` package provides the `chatRoute()` utility for seamless integration with Vercel AI SDK. Instead of manually handling stream conversion, register a chat route in your Mastra server configuration:

```typescript
// src/mastra/index.ts
import { Mastra } from "@mastra/core";
import { chatRoute } from "@mastra/ai-sdk";

export const mastra = new Mastra({
  server: {
    apiRoutes: [
      chatRoute({
        path: "/chat",
        agent: "weatherAgent", // Fixed agent
      }),
      // Or use dynamic agents:
      chatRoute({
        path: "/chat/:agentId", // Dynamic agent ID
      }),
    ],
  },
});
```

Then use the `useChat()` hook in your frontend:

```typescript
import { useChat } from "@ai-sdk/react";
import { DefaultChatTransport } from "ai";

const { messages, sendMessage } = useChat({
  transport: new DefaultChatTransport({
    api: "http://localhost:4111/chat/weatherAgent",
  }),
});
```

**Advanced: Manual transformation**

If you need more control over the stream conversion, you can manually transform streams using `toAISdkStream`. See the [Using Vercel AI SDK documentation](/docs/frameworks/agentic-uis/ai-sdk) for details.

**Note:** The `/api/agents/:agentId/stream/ui` HTTP endpoint has also been deprecated. Use the standard `/api/agents/:agentId/stream` endpoint with `@mastra/ai-sdk` transformations instead.


#### Input processors

- Removed the `@mastra/core/agent/input-processors` exports. They can found at `@mastra/core/processors` now.
- `InputProcessor` type removed in favour of `Processor` which implements a `processInput` function.

#### Abort Signal

- Removed `modelSettings.abortSignal`. Use the top-level `abortSignal` option instead:

```typescript
// Before
const result = await agent.stream(messages, {
  modelSettings: {
    abortSignal: controller.signal,
    temperature: 0.7,
  },
});

// After
const result = await agent.stream(messages, {
  abortSignal: controller.signal,
  modelSettings: {
    temperature: 0.7,
  },
});
```


#### Output Options

- Removed deprecated `output` field from `generate()`/`stream()` options. Use `structuredOutput.schema` instead:

```typescript
// Before
const result = await agent.generate(messages, {
  output: z.object({
    answer: z.string(),
  }),
});

// After
const result = await agent.generate(messages, {
  structuredOutput: {
    schema: z.object({
      answer: z.string(),
    }),
  },
});
```