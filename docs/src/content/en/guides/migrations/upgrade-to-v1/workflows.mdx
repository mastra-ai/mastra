---
title: "Workflows | v1 Migration Guide"
description: "Learn how to migrate workflow-related changes when upgrading to v1."
---

# Workflows

Legacy workflow features have been removed.

## Changed

### `getWorkflows` to `listWorkflows`

The `mastra.getWorkflows()` method has been renamed to `mastra.listWorkflows()`. This change aligns with the naming convention used across the API where plural getter methods use the `list` prefix.

To migrate, replace all calls to `mastra.getWorkflows()` with `mastra.listWorkflows()`.

```diff
- const workflows = mastra.getWorkflows();
+ const workflows = mastra.listWorkflows();
```

:::tip[Codemod]

You can use Mastra's codemod CLI to update your imports automatically:

```shell
npx @mastra/codemod@beta v1/mastra-plural-apis .
```

:::

### `RuntimeContext` to `RequestContext` in step context

The parameter name `runtimeContext` has been changed to `requestContext` in workflow step execution context. This change aligns with the global rename for clarity.

To migrate, update references from `runtimeContext` to `requestContext` in step execution functions.

```diff
  createStep({
-   execute: async ({ runtimeContext } ) => {
-     const userTier = context.runtimeContext.get('userTier');
+   execute: async ({ requestContext } ) => {
+     const userTier = requestContext.get('userTier');
      return { result: userTier };
    },
  });
```

:::tip[Codemod]

You can use Mastra's codemod CLI to update your imports automatically:

```shell
npx @mastra/codemod@beta v1/runtime-context .
```

:::

### `createRunAsync` to `createRun`

The `createRunAsync()` method has been renamed to `createRun()`. This change simplifies the API by removing the redundant "Async" suffix since all run creation is asynchronous.

To migrate, rename method calls from `createRunAsync` to `createRun`.

```diff
- await workflow.createRunAsync({ input: { ... } });
+ await workflow.createRun({ input: { ... } });
```

:::tip[Codemod]

You can use Mastra's codemod CLI to update your code automatically:

```shell
npx @mastra/codemod@beta v1/workflow-create-run-async .
```

:::

### `runCount` to `retryCount` (deprecated)

The `runCount` parameter has been deprecated in favor of `retryCount` in workflow step execution. This change provides clearer naming that better describes retry behavior. The old `runCount` still works but shows deprecation warnings.

To migrate, rename `runCount` to `retryCount` in step execution functions.

```diff
  createStep({
    execute: async (inputData, context) => {
-     console.log(`Step run ${context.runCount} times`);
+     console.log(`Step retry count: ${context.retryCount}`);
    },
  });
```

:::tip[Codemod]

You can use Mastra's codemod CLI to update your code automatically:

```shell
npx @mastra/codemod@beta v1/workflow-run-count .
```

:::

### `getWorkflowRuns` to `listWorkflowRuns`

The `getWorkflowRuns()` method has been renamed to `listWorkflowRuns()`. This change aligns with the convention that `list*` methods return collections.

To migrate, rename method calls from `getWorkflowRuns` to `listWorkflowRuns`.

```diff
- const runs = await workflow.getWorkflowRuns({ fromDate, toDate });
+ const runs = await workflow.listWorkflowRuns({ fromDate, toDate });
```

:::tip[Codemod]

You can use Mastra's codemod CLI to update your code automatically:

```shell
npx @mastra/codemod@beta v1/workflow-list-runs .
```

:::

### Inputs are validated by default

Previously, inputs weren't validated by default. The [`validateInputs`](/reference/v1/workflows/workflow#workflowoptions) flag determines whether to validate the workflow inputs or not. This boolean has been flipped to `true`. If you want the old behavior or have workflows whose schemas don't need to be validated, set `validateInputs: false`.

```diff
createWorkflow({
+  options: {
+    validateInputs: false
+  }
})
```

### Step `suspendPayload` validation

Step `suspendPayload` is now validated for steps that have a `suspendSchema` defined. This also uses the `validateInputs` flag to determine whether to validate the `suspendPayload` or not.

```diff
  createStep({
    id: "suspend-resume-step",
    // ... other step properties
    suspendSchema: z.object({
      reason: z.string(),
      otherReason: z.string()
    }),
    execute: async ({ suspend, resumeData}) => {
      if (!resumeData) {
-       return suspend({ reason: "Suspension reason" }); // Missing otherReason
+       return suspend({ reason: "Suspension reason", otherReason: "Other reason" });
      }
      //... continue execution logic
    },
  });
```

### Branch result fields are now optional

The `.branch()` method now returns a schema where all branch output fields are optional. This reflects the runtime behavior where each branch only executes if its condition is truthy, so outputs from any branch may be undefined.

To migrate, update any code that consumes branch outputs to handle optional values.

```diff
  const workflow = createWorkflow({...})
    .branch([
      [condition1, stepA],  // outputSchema: { result: z.string() }
      [condition2, stepB],  // outputSchema: { data: z.number() }
    ])
-   // Previously: stepA.result typed as string, stepB.data typed as number
+   // Now: stepA.result typed as string | undefined, stepB.data typed as number | undefined
    .then(nextStep);
```

If your code depends on non-optional types, add runtime checks or provide default values when accessing branch outputs.

### Enhanced streaming APIs are now standard

The experimental streaming APIs (`streamVNext`, `resumeStreamVNext`, `observeStreamVNext`) are now the standard streaming methods for workflows. The enhanced streaming system provides a more robust and feature-rich API for workflow execution monitoring.

#### Key changes

**Event structure**

The event types have been updated to use workflow-specific prefixes for better clarity:

- `start` → `workflow-start`
- `step-start` → `workflow-step-start`
- `step-finish` → `workflow-step-result`
- `finish` → `workflow-finish`
- Added: `workflow-step-output` for custom step outputs

**Return type**

The `stream()` method now returns a `MastraWorkflowStream` object that extends `ReadableStream` with additional workflow-specific properties:

- `stream.status`: Promise resolving to the current workflow run status
- `stream.result`: Promise resolving to the final workflow result
- `stream.usage`: Promise resolving to token usage statistics
- `stream.traceId`: Optional trace ID for execution tracking

**New method: resumeStream()**

A new `resumeStream()` method is now available for resuming suspended workflows with streaming support. This method was previously only available as `resumeStreamVNext()`.

**New parameter: closeOnSuspend**

The `stream()` method now accepts a `closeOnSuspend` parameter (default: `true`) to control whether the stream closes when a workflow suspends or remains open until completion.

#### Migration examples

**Event handling**

Update your event type checks to use the new workflow-prefixed event names:

```diff
  const stream = await run.stream({ inputData });

  for await (const chunk of stream) {
-   if (chunk.type === 'step-start') {
+   if (chunk.type === 'workflow-step-start') {
      console.log('Step started:', chunk.payload);
    }
-   if (chunk.type === 'finish') {
+   if (chunk.type === 'workflow-finish') {
      console.log('Workflow finished:', chunk.payload);
    }
  }
```

**Stream properties**

The stream now returns properties directly on the stream object instead of a separate function:

```diff
- const { stream, getWorkflowState } = await run.stream({ inputData });
- const result = await getWorkflowState();
+ const stream = await run.stream({ inputData });
+ const result = await stream.result;
+ const status = await stream.status;
+ const usage = await stream.usage;
```

**Resume streaming**

The new `resumeStream()` method enables resuming suspended workflows with streaming:

```diff
  const result = await stream.result;

  if (result.status === 'suspended') {
-   // Not available in old API
+   const resumedStream = await run.resumeStream({
+     resumeData: { value: 'resume data' },
+   });
+   const finalResult = await resumedStream.result;
  }
```

**Observe streaming**

The `observeStream()` method now uses the same enhanced event structure:

```diff
  const stream = await run.observeStream();

  for await (const chunk of stream) {
-   if (chunk.type === 'step-start') { ... }
+   if (chunk.type === 'workflow-step-start') { ... }
  }
```

## Removed

### Legacy workflows export

The `./workflows/legacy` export path has been removed from `@mastra/core`. Legacy workflows are no longer supported.

To migrate, use the new workflow API. There is no direct migration path from legacy workflows.

```diff
- import { LegacyWorkflow } from '@mastra/core/workflows/legacy';
+ // Legacy workflows are no longer supported
+ // Migrate to the new workflow API
```

### `pipeThrough` and `pipeTo` methods from WorkflowRunOutput

The `pipeThrough()` and `pipeTo()` methods on `WorkflowRunOutput` are deprecated. These methods still work but show console warnings.

To migrate, use the `fullStream` property instead of calling methods directly on the run output.

```diff
  const run = await workflow.createRun({ input: { ... } });
- await run.pipeTo(writableStream);
- const transformed = run.pipeThrough(transformStream);
+ await run.fullStream.pipeTo(writableStream);
+ const transformed = run.fullStream.pipeThrough(transformStream);
```

### Watch events API

Legacy watch events have been removed and consolidated on the v2 events API. The `watch()` method and related watch endpoints are no longer available.

To migrate, use the workflow events API or streaming instead of watch events.

```diff
- const workflow = mastraClient.getWorkflow('my-workflow');
- const run = await workflow.createRun();
- await run.watch((event) => {
-   console.log('Step completed:', event);
- });

+ const workflow = mastraClient.getWorkflow('my-workflow');
+ const run = await workflow.createRun();
+ const stream = await run.stream({ inputData: { ... } });
+ for await (const chunk of stream) {
+   console.log('Step completed:', chunk);
+ }
```

### `waitForEvent` API

The `waitForEvent` API has been removed from workflows. Use the suspend/resume API instead.

To migrate, use suspend/resume API for waiting on workflow execution milestones.

```diff
- workflow.waitForEvent('step-complete', step1).commit();
+ workflow.then(step1).commit();
+ // Use suspend/resume API instead, in step1 execute function
createStep({
- execute: async (inputData, context) => {
-  // ... execution logic 
- }
+ execute: async (inputData, context) => {
+   if (!context.resumeData) {
+     return context.suspend({})
+   }
+   //..continue execution logic
+ }
});
+
+ // after workflow is suspended, you can resume it
+ const result = await run.start({ inputData: { ... } });
+ if (result.status === 'suspended') {
+   const resumedResult = await run.resume({
+     resumeData: {
+       event: 'step-complete',
+     },
+     step: 'step1',
+   });
+ }
```
