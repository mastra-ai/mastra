---
title: "Reference: processSchema | Core"
description: "Documentation for the `processSchema` utilities in Mastra, which transform Zod schemas for provider-specific requirements."
---

# processSchema

Schema compatibility utilities for transforming Zod schemas to meet provider-specific requirements. These utilities ensure schemas work correctly with different model providers while maintaining the same schema for both backend generation and frontend validation.

## Overview

Different AI model providers have specific schema requirements. For example, OpenAI's strict mode requires all properties to be in the `required` array. The `processSchema` utilities automatically apply the necessary transformations for each provider.

## Available Methods

### processSchema.openai()

Transform schemas for OpenAI models with strict mode.

Converts `.optional()` fields to `.nullable()` to ensure all properties are in the required array, which is required by OpenAI's strict mode.

```typescript copy
import { z } from "zod";
import { processSchema } from "@mastra/core";

const schema = z.object({
  name: z.string(),
  age: z.number().optional(), // Would fail with OpenAI strict mode
});

const openaiSchema = processSchema.openai(schema);
```

### processSchema.openaiReasoning()

Transform schemas for OpenAI reasoning models.

Applies the same transformations as `openai()` but specifically for reasoning models.

```typescript copy
const schema = z.object({
  thought: z.string(),
  reasoning: z.string().optional(),
});

const reasoningSchema = processSchema.openaiReasoning(schema);
```

### processSchema.anthropic()

Transform schemas for Anthropic (Claude) models.

```typescript copy
const schema = z.object({
  response: z.string(),
  confidence: z.number().optional(),
});

const claudeSchema = processSchema.anthropic(schema);
```

### processSchema.google()

Transform schemas for Google (Gemini) models.

```typescript copy
const schema = z.object({
  answer: z.string(),
  sources: z.array(z.string()).optional(),
});

const geminiSchema = processSchema.google(schema);
```

### processSchema.deepseek()

Transform schemas for DeepSeek models.

```typescript copy
const schema = z.object({
  code: z.string(),
  explanation: z.string().optional(),
});

const deepseekSchema = processSchema.deepseek(schema);
```

### processSchema.meta()

Transform schemas for Meta (Llama) models.

```typescript copy
const schema = z.object({
  text: z.string(),
  metadata: z.record(z.any()).optional(),
});

const llamaSchema = processSchema.meta(schema);
```

## Usage Example

Transform a schema once and use it for both backend generation and frontend validation:

```typescript copy
import { z } from "zod";
import { processSchema } from "@mastra/core";

// Define your schema once
const userSchema = z.object({
  name: z.string(),
  email: z.string().email(),
  age: z.number().optional(),
  bio: z.string().optional(),
});

// Transform for OpenAI
const openaiSchema = processSchema.openai(userSchema);

// Use in agent for generation
const result = await agent.generate("Extract user information", {
  structuredOutput: {
    schema: openaiSchema,
  },
});

console.log(result.object);

// Use the same schema for frontend validation
const validatedData = openaiSchema.parse(formData);
```

## Parameters

All `processSchema` methods accept a single parameter:

<PropertiesTable
  content={[
    {
      name: "schema",
      type: "ZodType",
      description:
        "The Zod schema to transform. Can be any valid Zod schema type.",
    },
  ]}
/>

## Returns

All methods return the transformed schema with the same TypeScript type as the input:

<PropertiesTable
  content={[
    {
      name: "transformedSchema",
      type: "T (same as input type)",
      description:
        "The transformed Zod schema with provider-specific compatibility fixes applied.",
    },
  ]}
/>

## Common Transformations

### OpenAI Strict Mode

OpenAI's strict mode requires:
- All properties must be in the `required` array
- Fields that can be omitted should use `.nullable()` instead of `.optional()`

**Before transformation:**
```typescript
z.object({
  name: z.string(),
  age: z.number().optional(), // Not in required array
})
```

**After transformation:**
```typescript
z.object({
  name: z.string(),
  age: z.number().nullable(), // In required array, accepts null
})
```

## Related

- [Agents: Structured Output](/docs/v1/agents/overview#structured-output)
- [Agent.generate()](/reference/v1/agents/generate)
