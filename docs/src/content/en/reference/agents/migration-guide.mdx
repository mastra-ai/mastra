import { Callout } from 'nextra/components';
import { Tag } from '@/components/tag';

# Migration Guide: VNext to Standard APIs

<Callout type="info">
 The `streamVNext()` and `generateVNext()` methods in Mastra agents are becoming the default `stream()` and `generate()` methods respectively.
</Callout>

<Callout type="warning">
  **Important Naming Clarification**: 
  - The `streamVNext()` and `generateVNext()` methods have been renamed to `stream()` and `generate()` respectively. These are now the primary APIs for AI SDK v5.
  - The original `stream()` and `generate()` methods have been renamed to `streamLegacy()` and `generateLegacy()` to maintain backward compatibility with AI SDK v4.
  - If your code currently uses `agent.stream()` and you're getting an error about needing AI SDK v5 models, it means you need to use `agent.streamLegacy()` instead to continue using v5 models.
  - Similarly, if your code uses `agent.generate()` and encounters the same error, you should use `agent.generateLegacy()` for v4 model compatibility.
</Callout>

## Overview

As of `v 0.20.00`, the `streamVNext()` and `generateVNext()` methods in Mastra agents have been renamed to `stream()` and `generate()` respectively. These are now the standard APIs for V2 models with full AI SDK v5 compatibility. The original `stream()` and `generate()` methods have been renamed to `streamLegacy()` and `generateLegacy()` to maintain backward compatibility with V1 models.

## Key Differences

### 1. Model Version Support

- **Legacy APIs (`generateLegacy`, `streamLegacy`)**: Only support AI SDK v4 models
- **Current APIs (`generate`, `stream`)**: Only support AI SDK v5 models

### 2. Output Format Options

- **Legacy APIs**: Limited output formatting
- **Current APIs**: Support both Mastra native format and AI SDK v5 compatibility mode via the `format` option

### 3. Return Types

- **Legacy `generateLegacy()`**: Returns `GenerateTextResult` or `GenerateObjectResult`
- **Current `generate()`**: Returns the full output from `getFullOutput()` method
- **Legacy `streamLegacy()`**: Returns streaming response with callbacks
- **Current `stream()`**: Returns `MastraModelOutput` or `AISDKV5OutputStream`

## `output` is deprecated

The `output` property is deprecated in favour of `structuredOutput`. `structuredOutput` uses a dedicated model of your choice to return JSON.

```typescript
const result = await agent.generate(messages, {
  structuredOutput: {
    schema: z.object({
      name: z.string(),
      age: z.number()
    })
    model: openai(gpt-4o-mini),
    errorStrategy: 'fallback'
    fallbackValue: { name: 'unknown', age: 0 }
    instructions: 'Do something' // override the default instructions for the structuring LLM
  },
});
```

## `temperature` settings has moved

```typescript
const result = await agent.generate(messages, {
  modelSettings: {
    temperature: 0.7
  }
});
```

## Format Options
The current APIs support a `format` option that allows you to choose between Mastra's native format, AI SDK v5, and other frontends like `copilotkit` and `assistant-ui`:

```typescript
// Mastra native format (default)
const result = await agent.stream(messages, {
  format: 'mastra'
});

// AI SDK v5 compatibility
const result = await agent.stream(messages, {
  format: 'aisdk'
});
```

## Return Type Differences


## Migration Checklist

### If you're already using `streamVNext` and `generateVNext`

Just find/replace the methods to `stream` and `generate` respectively.

### If you're using the old `stream` and `generate`

Decide whether you want to upgrade or not. If you don't, just find/replace to `streamLegacy` and `generateLegacy`. Otherwise, follow this list: 


- [ ] Move model settings to `modelSettings` object
- [ ] Move callbacks to `callbacks` object
- [ ] Test return type handling in your application
- [ ] Update any TypeScript type definitions or interfaces
- [ ] Verify structured output usage with new schema options
- [ ] Check memory configuration compatibility
- [ ] Update provider-specific options if needed
