---
title: "Reference: Couchbase Vector Store | Vector Databases | RAG | Mastra Docs"
description: Documentation for using Couchbase as a vector store in Mastra, including CouchbaseSearchStore and CouchbaseQueryStore.
---

# Couchbase Vector Store

Mastra provides two vector store implementations for Couchbase, enabling vector similarity search and advanced metadata filtering within your Couchbase collections.

- **`CouchbaseQueryStore`**: Utilizes Couchbase's Hyperscale or Composite Vector Indexes. Recommended for most use cases, especially vector-first workloads, applications requiring complex filtering, or those that need to scale to billions of vectors.
- **`CouchbaseSearchStore`**: Leverages Couchbase's Search Vector Index. Recommended for hybrid search use cases where a high recall rate is a priority.

## Choosing Your Store and Index Type

The primary choice is between `CouchbaseSearchStore` and `CouchbaseQueryStore`. If you choose `CouchbaseQueryStore`, you then select between a Hyperscale or Composite index.

For more information about choosing the right vector index type, see [Choose the Right Vector Index](https://docs.couchbase.com/cloud/vector-index/use-vector-indexes.html).

### `CouchbaseSearchStore` vs. `CouchbaseQueryStore`

| Feature         | `CouchbaseSearchStore`                                  | `CouchbaseQueryStore`                                                       |
| --------------- | ------------------------------------------------------------- | --------------------------------------------------------------------------------- |
| **Best For**    | Hybrid search and high recall rates.                          | Vector-first workloads, complex filtering, and high QPS performance.              |
| **Couchbase Version** | 7.6.4+                                                        | 8.0.0+                                                                            |
| **Filtering**   | Pre-filtering with flexible ordering.                         | Pre-filtering with `WHERE` clauses (Composite) or post-filtering (Hyperscale).       |
| **Scalability** | Up to 10 million vectors.                                     | Up to billions of vectors (Hyperscale).                                                |

### Choosing the Right Index Type for `CouchbaseQueryStore`

#### Hyperscale Vector Indexes

- **Best for**: Pure vector searches like content discovery, recommendations, and semantic search.
- **Use when**: You primarily perform vector-only queries without complex scalar filtering.
- **Features**: High performance with a low memory footprint, optimized for concurrent operations, and designed to scale to billions of vectors.

For more information, see [Vector Search Using Hyperscale Vector Indexes](https://docs.couchbase.com/cloud/vector-index/hyperscale-vector-index.html).

#### Composite Vector Indexes

- **Best for**: Filtered vector searches that combine vector similarity with scalar value filtering.
- **Use when**: Your queries combine vector similarity with scalar filters that eliminate large portions of the dataset.
- **Features**: Efficient pre-filtering where scalar attributes reduce the vector comparison scope.

## `CouchbaseQueryStore`

This store uses the Hyperscale or Composite Vector Indexes.

### Requirements

- **Couchbase Server 8.0.0+** or a compatible Capella cluster.
- **Hyperscale or Composite Vector Indexes** available on your Couchbase deployment.

### Usage Example

```typescript copy showLineNumbers
import { CouchbaseQueryStore } from '@mastra/couchbase';

const store = new CouchbaseQueryStore({
  connectionString: process.env.COUCHBASE_CONNECTION_STRING,
  username: process.env.COUCHBASE_USERNAME,
  password: process.env.COUCHBASE_PASSWORD,
  bucketName: process.env.COUCHBASE_BUCKET,
  scopeName: process.env.COUCHBASE_SCOPE,
  collectionName: process.env.COUCHBASE_COLLECTION,
});
```

### Constructor Options

(Same as `CouchbaseSearchStore`)

### Methods

#### createIndex()

Creates a new Hyperscale or Composite Vector Index. You can choose the index type with the `vector_index_type` parameter.

> **Important**: A vector index can only be created on a collection that contains at least one document with the target vector field (`embedding`). For optimal performance, it is recommended to delete and recreate the index after significant data changes, as this allows Couchbase to retrain the index centroids on the updated dataset.

<PropertiesTable
  content={[
    {
      name: "indexName",
      type: "string",
      description: "Name of the index to create",
    },
    {
      name: "dimension",
      type: "number",
      description: "Vector dimension",
    },
    {
      name: "metric",
      type: "'cosine' | 'euclidean' | 'dotproduct'",
      isOptional: true,
      defaultValue: "cosine",
      description: "Distance metric",
    },
    {
        name: "vector_index_type",
        type: "'hyperscale' | 'composite'",
        isOptional: true,
        defaultValue: "'hyperscale'",
        description: "The type of vector index to create. Can be 'hyperscale' or 'composite'. Learn more about the differences between the two at https://docs.couchbase.com/cloud/vector-index/use-vector-indexes.html."
    },
    {
        name: "fields_to_index",
        type: "string[]",
        isOptional: true,
        description: "Metadata fields to include in the index."
    },
    {
        name: "index_metadata",
        type: "Record<string, any>",
        isOptional: true,
        description: "Additional metadata for the index, such as a 'description' for quantization and centroid settings."
    }
  ]}
/>

##### Understanding Index Configuration (`index_metadata.description`)

The `description` field within `index_metadata` controls how Couchbase optimizes vector storage and search performance. The format is `'IVF[<centroids>],{PQ|SQ}<settings>'`.

- **Centroids (IVF)**: Controls how the dataset is subdivided. More centroids lead to faster searches but slower training. If omitted (e.g., `IVF,SQ8`), Couchbase auto-selects based on dataset size.
- **Quantization (PQ/SQ)**: Compresses vectors to save memory. `SQ` (Scalar) and `PQ` (Product) offer different levels of precision and performance.

**Common Examples**:
- `IVF,SQ8`: Auto-selected centroids with 8-bit scalar quantization. A good default.
- `IVF1000,SQ6`: 1000 centroids with 6-bit scalar quantization.
- `IVF,PQ32x8`: Auto-selected centroids with 32 subquantizers of 8 bits each.

#### query()

Searches for similar vectors using a Hyperscale or Composite Vector Index.

> **Note:** In Hyperscale or Composite vector search, the score represents the vector distance. A lower score indicates higher similarity.

<PropertiesTable
  content={[
    {
      name: "indexName",
      type: "string",
      description: "Name of the index to search in",
    },
    {
      name: "queryVector",
      type: "number[]",
      description: "Query vector",
    },
    {
      name: "topK",
      type: "number",
      isOptional: true,
      defaultValue: "10",
      description: "Number of results to return",
    },
    {
      name: "filter",
      type: "Record<string, any>",
      isOptional: true,
      description: "Metadata filters. All field names must be prefixed with 'metadata.'. See [Metadata Filters](./metadata-filters).",
    },
    {
      name: "includeVector",
      type: "boolean",
      isOptional: true,
      defaultValue: "false",
      description: "Whether to include vector data in results.",
    },
  ]}
/>

## `CouchbaseSearchStore`

This store uses the Search Vector Index and is ideal for scenarios where high recall rate is needed.

For more information about Couchbase Search Vector Index, see [Search](https://docs.couchbase.com/cloud/search/search.html).

### Requirements

- **Couchbase Server 7.6.4+** or a compatible Capella cluster.
- **Search Vector Index** available on your Couchbase deployment.

### Usage Example

```typescript copy showLineNumbers
import { CouchbaseSearchStore } from '@mastra/couchbase';

const store = new CouchbaseSearchStore({
  connectionString: process.env.COUCHBASE_CONNECTION_STRING,
  username: process.env.COUCHBASE_USERNAME,
  password: process.env.COUCHBASE_PASSWORD,
  bucketName: process.env.COUCHBASE_BUCKET,
  scopeName: process.env.COUCHBASE_SCOPE,
  collectionName: process.env.COUCHBASE_COLLECTION,
});
```

### Constructor Options

<PropertiesTable
  content={[
    {
      name: "id",
      type: "string",
      description: "Unique identifier for this vector store instance",
    },
    {
      name: "connectionString",
      type: "string",
      description: "Couchbase connection string",
    },
    {
      name: "username",
      type: "string",
      description: "Couchbase username",
    },
    {
      name: "password",
      type: "string",
      description: "Couchbase password",
    },
    {
      name: "bucketName",
      type: "string",
      description: "Name of the Couchbase bucket to use",
    },
    {
      name: "scopeName",
      type: "string",
      description: "Name of the Couchbase scope to use",
    },
    {
      name: "collectionName",
      type: "string",
      description: "Name of the Couchbase collection to use",
    },
  ]}
/>

### Methods

#### createIndex()

Creates a new Search index in Couchbase.

> **Note:** Index creation is asynchronous. After calling `createIndex`, allow time (typically 1â€“5 seconds for small datasets, longer for large ones) before querying.

<PropertiesTable
  content={[
    {
      name: "indexName",
      type: "string",
      description: "Name of the index to create",
    },
    {
      name: "dimension",
      type: "number",
      description: "Vector dimension (must match your embedding model)",
    },
    {
      name: "metric",
      type: "'cosine' | 'euclidean' | 'dotproduct'",
      isOptional: true,
      defaultValue: "cosine",
      description: "Distance metric for similarity search",
    },
    {
        name: "fields_to_index",
        type: "{ name: string; type: string }[]",
        isOptional: true,
        description: "Metadata fields to index for filtering."
    }
  ]}
/>

#### query()

Searches for similar vectors using a Search index.

> **Note:** The `includeVector` parameter is not supported by `CouchbaseSearchStore`.

<PropertiesTable
  content={[
    {
      name: "indexName",
      type: "string",
      description: "Name of the index to search in",
    },
    {
      name: "queryVector",
      type: "number[]",
      description: "Query vector",
    },
    {
      name: "topK",
      type: "number",
      isOptional: true,
      defaultValue: "10",
      description: "Number of results to return",
    },
    {
      name: "filter",
      type: "Record<string, any>",
      isOptional: true,
      description: "Metadata filters. All field names must be prefixed with 'metadata.'. See [Metadata Filters](./metadata-filters).",
    },
    {
      name: "includeVector",
      type: "boolean",
      isOptional: true,
      defaultValue: "false",
      description: "Not supported.",
    },
  ]}
/>

## `CouchbaseQueryStore`

This store uses the Hyperscale or Composite Vector Indexes.

### Requirements

- **Couchbase Server 8.0.0+** or a compatible Capella cluster.
- **Hyperscale or Composite Vector Indexes** available on your Couchbase deployment.

### Usage Example

```typescript copy showLineNumbers
import { CouchbaseQueryStore } from '@mastra/couchbase';

const store = new CouchbaseQueryStore({
  connectionString: process.env.COUCHBASE_CONNECTION_STRING,
  username: process.env.COUCHBASE_USERNAME,
  password: process.env.COUCHBASE_PASSWORD,
  bucketName: process.env.COUCHBASE_BUCKET,
  scopeName: process.env.COUCHBASE_SCOPE,
  collectionName: process.env.COUCHBASE_COLLECTION,
});
```

### Constructor Options

(Same as `CouchbaseSearchStore`)

### Methods

#### createIndex()

Creates a new Hyperscale or Composite Vector Index. You can choose the index type with the `vector_index_type` parameter.

> **Important**: A vector index can only be created on a collection that contains at least one document with the target vector field (`embedding`). For optimal performance, it is recommended to delete and recreate the index after significant data changes, as this allows Couchbase to retrain the index centroids on the updated dataset.

<PropertiesTable
  content={[
    {
      name: "indexName",
      type: "string",
      description: "Name of the index to create",
    },
    {
      name: "dimension",
      type: "number",
      description: "Vector dimension",
    },
    {
      name: "metric",
      type: "'cosine' | 'euclidean' | 'dotproduct'",
      isOptional: true,
      defaultValue: "cosine",
      description: "Distance metric",
    },
    {
        name: "vector_index_type",
        type: "'hyperscale' | 'composite'",
        isOptional: true,
        defaultValue: "'hyperscale'",
        description: "The type of vector index to create. Can be 'hyperscale' or 'composite'. Learn more about the differences between the two at https://docs.couchbase.com/cloud/vector-index/use-vector-indexes.html."
    },
    {
        name: "fields_to_index",
        type: "string[]",
        isOptional: true,
        description: "Metadata fields to include in the index."
    },
    {
        name: "index_metadata",
        type: "Record<string, any>",
        isOptional: true,
        description: "Additional metadata for the index, such as a 'description' for quantization and centroid settings."
    }
  ]}
/>

##### Understanding Index Configuration (`index_metadata.description`)

The `description` field within `index_metadata` controls how Couchbase optimizes vector storage and search performance. The format is `'IVF[<centroids>],{PQ|SQ}<settings>'`.

- **Centroids (IVF)**: Controls how the dataset is subdivided. More centroids lead to faster searches but slower training. If omitted (e.g., `IVF,SQ8`), Couchbase auto-selects based on dataset size.
- **Quantization (PQ/SQ)**: Compresses vectors to save memory. `SQ` (Scalar) and `PQ` (Product) offer different levels of precision and performance.

**Common Examples**:
- `IVF,SQ8`: Auto-selected centroids with 8-bit scalar quantization. A good default.
- `IVF1000,SQ6`: 1000 centroids with 6-bit scalar quantization.
- `IVF,PQ32x8`: Auto-selected centroids with 32 subquantizers of 8 bits each.

#### query()

Searches for similar vectors using a Hyperscale or Composite Vector Index.

> **Note:** In Hyperscale or Composite vector search, the score represents the vector distance. A lower score indicates higher similarity.

<PropertiesTable
  content={[
    {
      name: "indexName",
      type: "string",
      description: "Name of the index to search in",
    },
    {
      name: "queryVector",
      type: "number[]",
      description: "Query vector",
    },
    {
      name: "topK",
      type: "number",
      isOptional: true,
      defaultValue: "10",
      description: "Number of results to return",
    },
    {
      name: "filter",
      type: "Record<string, any>",
      isOptional: true,
      description: "Metadata filters. All field names must be prefixed with 'metadata.'. See [Metadata Filters](./metadata-filters).",
    },
    {
      name: "includeVector",
      type: "boolean",
      isOptional: true,
      defaultValue: "false",
      description: "Whether to include vector data in results.",
    },
  ]}
/>


## Common Methods

The following methods are available on both `CouchbaseSearchStore` and `CouchbaseQueryStore`.

### upsert()

Adds or updates vectors and their metadata.

<PropertiesTable
  content={[
    {
      name: "indexName",
      type: "string",
      description: "Name of the index for dimension validation",
    },
    {
      name: "vectors",
      type: "number[][]",
      description: "Array of embedding vectors",
    },
    {
      name: "metadata",
      type: "Record<string, any>[]",
      isOptional: true,
      description: "Metadata for each vector",
    },
    {
      name: "ids",
      type: "string[]",
      isOptional: true,
      description: "Optional vector IDs (auto-generated if not provided)",
    },
  ]}
/>

### describeIndex()

Returns information about an index.

<PropertiesTable
  content={[
    {
      name: "indexName",
      type: "string",
      description: "Name of the index to describe",
    },
  ]}
/>

### deleteIndex()

Deletes an index.

<PropertiesTable
  content={[
    {
      name: "indexName",
      type: "string",
      description: "Name of the index to delete",
    },
  ]}
/>

### listIndexes()

Lists all vector indexes.

### updateVector()

Updates a specific vector entry by its ID with new vector data and/or metadata. **Note:** Filter-based updates are not yet implemented for Couchbase.

<PropertiesTable
  content={[
    {
      name: "id",
      type: "string",
      description: "ID of the vector entry to update",
    },
    {
      name: "update",
      type: "object",
      description: "Update data containing vector and/or metadata",
    },
  ]}
/>

### deleteVector()

Deletes a vector entry by its ID.

<PropertiesTable
  content={[
    {
      name: "id",
      type: "string",
      description: "ID of the vector to delete",
    },
  ]}
/>

### deleteVectors()

Deletes multiple vectors by their IDs. **Note:** Filter-based deletion is not yet implemented for Couchbase.

<PropertiesTable
  content={[
    {
      name: "indexName",
      type: "string",
      description: "Name of the index containing the vectors to delete",
    },
    {
      name: "ids",
      type: "string[]",
      description: "Array of vector IDs to delete",
    },
  ]}
/>

### disconnect()

Closes the Couchbase client connection.

## Notes

- **Asynchronous Operations**: Index creation and upserts are asynchronous. Allow time for processing before querying.
- **Permissions**: The Couchbase user must have permissions to connect, read/write documents, and manage Search Vector Indexes or Hyperscale/Composite Vector Indexes.
- **Composite Index Filtering**: When using Composite indexes, scalar filters take precedence over vector similarity.

## Related

- [Metadata Filters](./metadata-filters)
- [Choose the Right Vector Index](https://docs.couchbase.com/cloud/vector-index/use-vector-indexes.html)
- [Vector Search Using Hyperscale Vector Indexes](https://docs.couchbase.com/cloud/vector-index/hyperscale-vector-index.html)
- [Vector Search](https://docs.couchbase.com/cloud/vector-search/vector-search.html)
- [Search](https://docs.couchbase.com/cloud/search/search.html)
- [Couchbase Node.js SDK](https://docs.couchbase.com/nodejs-sdk/current/hello-world/start-using-sdk.html)
