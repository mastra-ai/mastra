---
title: "Reference: DynamoDB Storage | Storage"
description: "Documentation for the DynamoDB storage implementation in Mastra, using a single-table design with ElectroDB."
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import StorageDomainsNoObservability from "./_storage-domains-no-observability.mdx";

# DynamoDB Storage

The DynamoDB storage implementation provides a scalable and performant NoSQL database solution for Mastra, leveraging a single-table design pattern with [ElectroDB](https://electrodb.dev/).

## Installation

<Tabs>
<TabItem value="npm" label="npm">

```bash copy
npm install @mastra/dynamodb@beta
```

</TabItem>
<TabItem value="pnpm" label="pnpm">

```bash copy
pnpm add @mastra/dynamodb@beta
```

</TabItem>
<TabItem value="yarn" label="yarn">

```bash copy
yarn add @mastra/dynamodb@beta
```

</TabItem>
<TabItem value="bun" label="bun">

```bash copy
bun add @mastra/dynamodb@beta
```

</TabItem>
</Tabs>

## Usage

```typescript copy showLineNumbers
import { DynamoDBStore } from "@mastra/dynamodb";

// Initialize the DynamoDB storage
const storage = new DynamoDBStore({
  name: "dynamodb", // A name for this storage instance
  config: {
    id: "dynamodb-storage", // Unique identifier for this instance
    tableName: "mastra-single-table", // Name of your DynamoDB table
  },
});
```
## Parameters

<PropertiesTable
  content={[
    {
      name: "name",
      type: "string",
      description: "A name for the storage instance.",
      isOptional: false,
    },
    {
      name: "config.id",
      type: "string",
      description: "Unique identifier for this storage instance.",
      isOptional: false,
    },
    {
      name: "config.tableName",
      type: "string",
      description: "The name of your DynamoDB table. Must be 3-255 characters and contain only alphanumeric characters, underscores, dots, or hyphens.",
      isOptional: false,
    },
    {
      name: "config.region",
      type: "string",
      description:
        "AWS region. Defaults to 'us-east-1' if not provided.",
      isOptional: true,
    },
    {
      name: "config.endpoint",
      type: "string",
      description:
        "Custom endpoint for DynamoDB (e.g., 'http://localhost:8000' for local development).",
      isOptional: true,
    },
    {
      name: "config.credentials",
      type: "{ accessKeyId: string; secretAccessKey: string }",
      description:
        "AWS credentials object with `accessKeyId` and `secretAccessKey`. If not provided, the AWS SDK will attempt to source credentials from environment variables, IAM roles (e.g., for EC2/Lambda), or the shared AWS credentials file.",
      isOptional: true,
    },
  ]}
/>


## Storage Domains

DynamoDBStore supports the following domains:

<StorageDomainsNoObservability />

To access domain-specific operations, use `getStore()`:

```typescript copy
const storage = new DynamoDBStore({
  name: "dynamodb",
  config: {
    id: 'dynamodb-storage',
    tableName: "mastra-single-table",
    region: "us-east-1",
  },
});

// Access memory domain for threads and messages
const memoryStore = await storage.getStore('memory');

const threads = await memoryStore.listThreads({
  resourceId: 'user-123',
  page: 0,
  perPage: 20,
});

// Access workflows domain for workflow snapshots
const workflowsStore = await storage.getStore('workflows');

const snapshot = await workflowsStore.getWorkflowSnapshot({
  workflowId: 'my-workflow',
  runId: 'run-123',
});

// Access evals domain for scores
const evalsStore = await storage.getStore('evals');

const scores = await evalsStore.listScoresByScorerId({
  scorerId: 'my-scorer',
  pagination: { page: 0, perPage: 50 },
});
```

See the [Storage overview](/docs/v1/server-db/storage) for more information about storage domains and composite storage.

## Setup

### Prerequisites

Before using this package, you **must** create a DynamoDB table with a specific structure, including primary keys and Global Secondary Indexes (GSIs). This adapter expects the DynamoDB table and its GSIs to be provisioned externally.

Detailed instructions for setting up the table using AWS CloudFormation or AWS CDK are available in [TABLE_SETUP.md](https://github.com/mastra-ai/mastra/blob/main/stores/dynamodb/TABLE_SETUP.md). Please ensure your table is configured according to those instructions before proceeding.


### Local Development

For local development, you can use [DynamoDB Local](https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/DynamoDBLocal.html).

1.  **Run DynamoDB Local (e.g., using Docker):**

    ```bash
    docker run -p 8000:8000 amazon/dynamodb-local
    ```

2.  **Configure `DynamoDBStore` to use the local endpoint:**

    ```typescript copy showLineNumbers
    import { DynamoDBStore } from "@mastra/dynamodb";

    const storage = new DynamoDBStore({
      name: "dynamodb-local",
      config: {
        tableName: "mastra-single-table", // Ensure this table is created in your local DynamoDB
        region: "localhost", // Can be any string for local, 'localhost' is common
        endpoint: "http://localhost:8000",
        // For DynamoDB Local, credentials are not typically required unless configured.
        // If you've configured local credentials:
        // credentials: { accessKeyId: "fakeMyKeyId", secretAccessKey: "fakeSecretAccessKey" }
      },
    });
    ```

    You will still need to create the table and GSIs in your local DynamoDB instance.


### AWS IAM Permissions

The IAM role or user executing the code needs appropriate permissions to interact with the specified DynamoDB table and its indexes. Below is a sample policy. Replace `${YOUR_TABLE_NAME}` with your actual table name and `${YOUR_AWS_REGION}` and `${YOUR_AWS_ACCOUNT_ID}` with appropriate values.

```json copy
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "dynamodb:DescribeTable",
        "dynamodb:GetItem",
        "dynamodb:PutItem",
        "dynamodb:UpdateItem",
        "dynamodb:DeleteItem",
        "dynamodb:Query",
        "dynamodb:Scan",
        "dynamodb:BatchGetItem",
        "dynamodb:BatchWriteItem"
      ],
      "Resource": [
        "arn:aws:dynamodb:${YOUR_AWS_REGION}:${YOUR_AWS_ACCOUNT_ID}:table/${YOUR_TABLE_NAME}",
        "arn:aws:dynamodb:${YOUR_AWS_REGION}:${YOUR_AWS_ACCOUNT_ID}:table/${YOUR_TABLE_NAME}/index/*"
      ]
    }
  ]
}
```

## Architecture

This storage adapter utilizes a **single-table design pattern** leveraging [ElectroDB](https://electrodb.dev/), a common approach for DynamoDB.

Within the single DynamoDB table, different Mastra data entities (such as Threads, Messages, Traces, Evals, and Workflows) are managed and distinguished using ElectroDB. ElectroDB defines specific models for each entity type, which include unique key structures and attributes. This allows the adapter to store and retrieve diverse data types efficiently within the same table.

For example, a `Thread` item might have a primary key like `THREAD#<threadId>`, while a `Message` item belonging to that thread might use `THREAD#<threadId>` as a partition key and `MESSAGE#<messageId>` as a sort key. The Global Secondary Indexes (GSIs), detailed in `TABLE_SETUP.md`, are strategically designed to support common access patterns across these different entities, such as fetching all messages for a thread or querying traces associated with a particular workflow.