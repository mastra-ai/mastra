---
title: "Inngest Workflows | Workflows (vNext) | Mastra Docs"
description: "Inngest workflow allows you to run Mastra vNext workflows with Inngest"
---

# Inngest Workflow

[Inngest](https://www.inngest.com/docs) is a developer platform for building and running background workflows, without managing infrastructure.

## How Inngest Works with Mastra

Inngest provides an event delivery and orchestration layer for running Mastra vNext workflows in response to events. The integration connects Inngest’s event system to Mastra’s workflow engine, enabling event-driven execution, step-level monitoring, and suspend/resume functionality.

### Integration Architecture

- **Workflow Registration:**  
  Workflows are defined using the `createWorkflow` and `createStep` helpers from `@mastra/inngest`. These helpers produce workflow and step objects compatible with both Mastra and Inngest.

- **Event Handling:**  
  Each workflow is registered as an Inngest function. When an event matching the workflow’s trigger is received, Inngest invokes the workflow handler. The handler starts or resumes a workflow run using the event payload as input.

- **Run Management:**  
  Workflow runs are managed by the `InngestRun` class. This class sends events to Inngest to start or resume runs, polls for run status, and retrieves results. Workflow state is persisted using Mastra’s storage system.

- **Suspend and Resume:**  
  If a workflow step suspends (for example, waiting for external input), the run is paused. To resume, a new event is sent to Inngest with the required resume data and step information. The workflow continues from the suspended step.

- **Real-Time Monitoring:**  
  The `watch` method on a workflow run subscribes to Inngest’s realtime API. This provides step-level execution updates, including status changes and outputs, which can be used for dashboards or debugging.

### Data Flow

1. **Event Trigger:**  
   An event is sent to Inngest Cloud (or a local Inngest dev server) with a payload matching the workflow’s input schema.

2. **Function Invocation:**  
   Inngest matches the event to a registered workflow function and invokes it, passing the event data to the workflow handler.

3. **Workflow Execution:**  
   The handler creates a workflow run and starts execution. Each step is executed in order, and state is persisted after each step.

4. **Suspend/Resume:**  
   If a step suspends, the workflow run is paused. To continue, a new event is sent with resume data, and the workflow resumes from the suspended step.

5. **Result Retrieval:**
   When the workflow completes, fails, or suspends, the result is available via Inngest’s API and dashboard. The result includes the status, step outputs, and any error or suspension information.


## Setup

```sh
npm install @mastra/inngest @mastra/core @mastra/deployer @hono/node-server
```

## Building an Inngest Workflow

This guide walks through creating a workflow with Inngest and Mastra, demonstrating a counter application that increments a value until it reaches 10.

### Inngest Initialization

Initialize the Inngest integration to obtain Mastra-compatible workflow helpers. The createWorkflow and createStep functions are used to create workflow and step objects that are compatible with Mastra and inngest.

```ts showLineNumbers copy filename="src/mastra/inngest/index.ts"
import { Inngest } from 'inngest'
import { realtimeMiddleware } from '@inngest/realtime'

export const inngest = new Inngest({
    id: 'mastra',
    baseUrl: process.env.NODE_ENV === 'production'
      ? 'https://api.inngest.com'
      : 'http://localhost:8288',
    isDev: process.env.NODE_ENV !== 'production',
    middleware: [realtimeMiddleware()],
})
```

### Creating Steps

Define the individual steps that will compose your workflow:

```ts showLineNumbers copy filename="src/mastra/workflows/index.ts"
import { z } from 'zod'
import { inngest } from '../inngest'

// Initialize Inngest with Mastra, pointing to your local Inngest server
const { createWorkflow, createStep } = init(inngest)

// Step 1: Increment the counter value
const incrementStep = createStep({
  id: 'increment',
  inputSchema: z.object({
    value: z.number(),
  }),
  outputSchema: z.object({
    value: z.number(),
  }),
  execute: async ({ inputData }) => {
    return { value: inputData.value + 1 }
  },
})

// Step 2: Log the current value (side effect)
const sideEffectStep = createStep({
  id: 'side-effect',
  inputSchema: z.object({
    value: z.number(),
  }),
  outputSchema: z.object({
    value: z.number(),
  }),
  execute: async ({ inputData }) => {
    console.log('Current value:', inputData.value)
    return { value: inputData.value }
  },
})

// Step 3: Final step after loop completion
const finalStep = createStep({
  id: 'final',
  inputSchema: z.object({
    value: z.number(),
  }),
  outputSchema: z.object({
    value: z.number(),
  }),
  execute: async ({ inputData }) => {
    return { value: inputData.value }
  },
})
```

### Creating the Workflow

Compose the steps into a workflow using the `dountil` loop pattern. The createWorkflow function creates a function on inngest server that is invokable.

```ts showLineNumbers copy filename="src/mastra/workflows/index.ts"
// workflow that is registered as a function on inngest server
const workflow = createWorkflow({
  id: 'increment-workflow',
  inputSchema: z.object({
    value: z.number(),
  }),
  outputSchema: z.object({
    value: z.number(),
  }),
})
  // Loop until the condition is met (value reaches 10)
  .dountil(
    createWorkflow({
      id: 'increment-subworkflow',
      inputSchema: z.object({
        value: z.number(),
      }),
      outputSchema: z.object({
        value: z.number(),
      }),
      steps: [incrementStep, sideEffectStep],
    })
      .then(incrementStep)
      .then(sideEffectStep)
      .commit(),
    async ({ inputData }) => inputData.value >= 10
  )
  .then(finalStep)

workflow.commit()

export { workflow as incrementWorkflow }
```

### Configuring the Mastra Instance and Executing the Workflow

Register the workflow with Mastra and configure the Inngest API endpoint:

```ts showLineNumbers copy filename="src/mastra/index.ts"
import { Mastra } from '@mastra/core/mastra'
import { serve as inngestServe } from '@mastra/inngest'
import { createLogger } from '@mastra/core/logger'
import { incrementWorkflow } from './workflows'
import { inngest } from './inngest'


// Configure Mastra with the workflow and Inngest API endpoint
export const mastra = new Mastra({
  vnext_workflows: {
    incrementWorkflow
  },
  server: {
    host: '0.0.0.0',
    apiRoutes: [
      // This API route is used to register the Mastra workflow (inngest function) on the inngest server
      {
        path: '/api/inngest',
        method: 'ALL',
        createHandler: async ({ mastra }) => inngestServe({ mastra, inngest }),
      },
    ],
  },
  logger: createLogger({
    name: 'Mastra',
    level: 'info',
  }),
})
```

### Running the Workflow locally

> **Prerequisites:**
> - Docker installed and running
> - Mastra project set up
> - Dependencies installed (`npm install`)

1. Run `npx mastra dev` to start the Mastra server on local to serve the server on port 4111.
2. Start the Inngest Dev Server (via Docker)
In a new terminal, run:
```sh
docker run --rm -p 8288:8288 \
  inngest/inngest \
  inngest dev -u http://host.docker.internal:4111/inngest/api
```
> **Note:** The URL after `-u` tells the Inngest dev server where to find your Mastra `/api/inngest` endpoint.

3. Open the Inngest Dashboard
- Visit [http://localhost:8288](http://localhost:8288) in your browser.
- Go to the **Apps** section in the sidebar.
- You should see your Mastra workflow registered.
![Inngest Dashboard](/inngest-apps-dashboard.png)

4. Invoke the Workflow
- Go to the **Functions** section in the sidebar.
- Select your Mastra workflow.
- Click **Invoke** and use the following input:
```json
{
  "data": {
    "inputData" : {
        "value": 5
    }
  }
}
```
![Inngest Function](/inngest-function-dashboard.png)

5. Monitor the Workflow Execution**
- Go to the **Runs** tab in the sidebar.
- Click on the latest run to see step-by-step execution progress.
![Inngest Function Run](/inngest-runs-dashboard.png)

### Running the Workflow in Production

> **Prerequisites:**
> - Vercel account and Vercel CLI installed (`npm i -g vercel`)
> - Inngest account
> - Vercel token (recommended: set as environment variable)

1. Add Vercel Deployer to Mastra instance
```ts showLineNumbers copy filename="src/mastra/index.ts"
import { VercelDeployer } from '@mastra/deployer-vercel'

export const mastra = new Mastra({
  // ...other config
  deployer: new VercelDeployer({
    teamSlug: "your_team_slug",
    projectName: "your_project_name",
    // you can get your vercel token from the vercel dashboard by clicking on the user icon in the top right corner 
    // and then clicking on "Account Settings" and then clicking on "Tokens" on the left sidebar.
    token: "your_vercel_token",
  }),
})
```

> **Note:** Set your Vercel token in your environment:
> ```sh
> export VERCEL_TOKEN=your_vercel_token
> ```

2. Build the mastra instance
```sh
npx mastra build
```

3. Deploy to Vercel
```sh
cd .mastra/output
vercel --prod
```
> **Tip:** If you haven't already, log in to Vercel CLI with `vercel login`.

4. Sync with Inngest Dashboard
- Go to the [Inngest dashboard](https://app.inngest.com/env/production/apps).
- Click **Sync new app with Vercel** and follow the instructions.
- You should see your Mastra workflow registered as an app.
![Inngest Dashboard](/inngest-apps-dashboard-prod.png)

5. Invoke the Workflow
- In the **Functions** section, select `workflow.increment-workflow`.
- Click **All actions** (top right) > **Invoke**.
- Provide the following input:
```json
{
  "data": {
    "inputData" : {
        "value": 5
    }
  }
}
```
![Inngest Function Run](/inngest-function-dashboard-prod.png)

6.  Monitor Execution
- Go to the **Runs** tab.
- Click the latest run to see step-by-step execution progress.
![Inngest Function Run](/inngest-runs-dashboard-prod.png)

