---
title: "Search and Indexing | Workspace"
description: Index workspace content and search using BM25 keyword search, vector semantic search, or hybrid mode.
packages:
  - "@mastra/core"
---

# Search and Indexing

Workspaces support three search modes: BM25 keyword search, vector semantic search, and hybrid search that combines both. Configure search when creating a workspace to enable the `workspace_search` and `workspace_index` tools for agents.

## BM25 keyword search

BM25 (Best Matching 25) is a ranking function for keyword-based search. It scores documents based on term frequency and document length, working well for exact matches and specific terminology.

Enable BM25 with the `bm25` option:

```typescript
import { Workspace, LocalFilesystem } from '@mastra/core/workspace';

const workspace = new Workspace({
  filesystem: new LocalFilesystem({ basePath: './workspace' }),
  bm25: true,
});
```

For custom BM25 parameters:

```typescript
const workspace = new Workspace({
  filesystem: new LocalFilesystem({ basePath: './workspace' }),
  bm25: {
    k1: 1.2,   // Term frequency saturation (default: 1.2)
    b: 0.75,  // Document length normalization (default: 0.75)
  },
});
```

## Vector search

Vector search uses embeddings to find semantically similar content. It requires a vector store and an embedder function.

```typescript
import { Workspace, LocalFilesystem } from '@mastra/core/workspace';
import { PineconeVector } from '@mastra/pinecone';
import { embed } from 'ai';
import { openai } from '@ai-sdk/openai';

const workspace = new Workspace({
  filesystem: new LocalFilesystem({ basePath: './workspace' }),
  vectorStore: new PineconeVector({
    apiKey: process.env.PINECONE_API_KEY,
    index: 'workspace-index',
  }),
  embedder: async (text: string) => {
    const { embedding } = await embed({
      model: openai.embedding('text-embedding-3-small'),
      value: text,
    });
    return embedding;
  },
});
```

## Hybrid search

When both BM25 and vector search are configured, hybrid mode combines their results. This gives the precision of keyword matching with the semantic understanding of embeddings.

```typescript
const workspace = new Workspace({
  filesystem: new LocalFilesystem({ basePath: './workspace' }),
  bm25: true,
  vectorStore: pineconeVector,
  embedder: embedderFn,
});
```

## Indexing content

### Manual indexing

Use `workspace.index()` to add content to the search index:

```typescript
await workspace.index('/docs/guide.md', 'Content of the guide...');
```

Include metadata for filtering:

```typescript
await workspace.index('/docs/api.md', 'API documentation content...', {
  type: 'text',
  mimeType: 'text/markdown',
  metadata: {
    category: 'api',
    version: '2.0',
  },
});
```

### Batch indexing

Index multiple documents at once:

```typescript
await workspace.indexMany([
  { path: '/docs/intro.md', content: 'Introduction...' },
  { path: '/docs/setup.md', content: 'Setup guide...' },
  { path: '/docs/faq.md', content: 'FAQ content...' },
]);
```

### Auto-indexing

Configure `autoIndexPaths` to index files automatically when the workspace initializes:

```typescript
const workspace = new Workspace({
  filesystem: new LocalFilesystem({ basePath: './workspace' }),
  bm25: true,
  autoIndexPaths: ['/docs', '/support/faq'],
});

await workspace.init(); // Indexes all files in /docs and /support/faq
```

### Removing from index

```typescript
await workspace.unindex('/docs/deprecated.md');
```

### Rebuilding the index

Clear and re-index all content from specified paths:

```typescript
await workspace.rebuildIndex(['/docs', '/support']);
```

Or use the configured `autoIndexPaths`:

```typescript
await workspace.rebuildIndex(); // Uses autoIndexPaths from config
```

## Searching

### Basic search

```typescript
const results = await workspace.search('password reset');
```

### Search options

```typescript
const results = await workspace.search('authentication flow', {
  topK: 10,         // Maximum results (default: 5)
  mode: 'hybrid',   // 'bm25' | 'vector' | 'hybrid'
  threshold: 0.5,   // Minimum score threshold
});
```

### Search modes

| Mode | When to use |
|------|-------------|
| `bm25` | Exact term matching, technical queries, code search |
| `vector` | Conceptual queries, natural language questions |
| `hybrid` | General search combining both approaches |

### Search results

Results include the document path, content, score, and any metadata:

```typescript
interface SearchResult {
  id: string;           // Document path
  content: string;      // Indexed content
  score: number;        // Relevance score
  metadata?: {
    type?: string;
    mimeType?: string;
    startLine?: number; // Line number for chunk start
    endLine?: number;   // Line number for chunk end
    [key: string]: unknown;
  };
}
```

## Line number tracking

When indexing file chunks, use `startLineOffset` to track line numbers:

```typescript
// Index a chunk starting at line 50
await workspace.index('/docs/guide.md#chunk-2', chunkContent, {
  startLineOffset: 50,
});
```

Search results include `startLine` and `endLine` in metadata, allowing agents to reference specific line ranges in their responses.

## Agent tools

When an agent has a workspace with search configured, it receives:

- `workspace_search` - Search indexed content
- `workspace_index` - Index new content

The agent can search for information and index new content as part of its task execution.

```typescript
const agent = new Agent({
  workspace: workspace,
  // Agent automatically gets workspace_search and workspace_index tools
});
```

## Checking search capabilities

```typescript
workspace.canBM25;    // true if BM25 is configured
workspace.canVector;  // true if vector search is configured
workspace.canHybrid;  // true if both are configured
```

## Related

- [Workspace Overview](/docs/workspace/overview)
- [RAG Overview](/docs/rag/overview)
- [Vector Databases](/docs/rag/vector-databases)
