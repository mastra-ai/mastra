---
title: "Workspace Safety | Workspace"
description: Configure safety controls for workspace operations including read-only mode, approval flows, and read-before-write guards.
packages:
  - "@mastra/core"
---

# Workspace Safety

Workspaces include safety features to control how agents interact with the filesystem and sandbox. Configure these through the `safety` option when creating a workspace.

## Configuration

```typescript
import { Workspace, LocalFilesystem, LocalSandbox } from '@mastra/core/workspace';

const workspace = new Workspace({
  filesystem: new LocalFilesystem({ basePath: './workspace' }),
  sandbox: new LocalSandbox({ workingDirectory: './workspace' }),
  safety: {
    readOnly: false,
    requireReadBeforeWrite: true,
    requireSandboxApproval: 'all',
    requireFilesystemApproval: 'none',
  },
});
```

## Read-only mode

When `readOnly: true`, all write operations are blocked. Read operations and sandbox execution remain available.

```typescript
const workspace = new Workspace({
  filesystem: new LocalFilesystem({ basePath: './workspace' }),
  safety: {
    readOnly: true,
  },
});
```

With read-only mode:
- `workspace_write_file`, `workspace_delete_file`, and `workspace_mkdir` tools are not included
- Direct calls to `workspace.writeFile()` throw `WorkspaceReadOnlyError`
- Agents can still read files, list directories, and search content

## Read-before-write guards

When `requireReadBeforeWrite: true` (the default), agents must read a file before writing to it. This prevents accidental overwrites when the agent doesn't know the current file contents.

```typescript
const workspace = new Workspace({
  filesystem: new LocalFilesystem({ basePath: './workspace' }),
  safety: {
    requireReadBeforeWrite: true,
  },
});
```

The guard tracks file reads and validates writes:

1. **New files** - Can be written without reading (they don't exist yet)
2. **Existing files** - Must be read first
3. **Modified files** - If a file was modified externally after the agent read it, the write fails

When a write is blocked, the agent receives a `FileReadRequiredError` with a message explaining what to do:

```
File "/config.json" has not been read. You must read a file before writing to it.
```

Or for externally modified files:

```
File "/config.json" was modified since last read. Please re-read the file to get the latest contents.
```

After a successful write, the read record is cleared. The agent must read the file again before making another write.

## Sandbox approval

Control whether sandbox operations require user approval with `requireSandboxApproval`:

| Value | `execute_code` | `execute_command` | `install_package` |
|-------|---------------|-------------------|-------------------|
| `'none'` | No approval | No approval | No approval |
| `'commands'` | No approval | Requires approval | Requires approval |
| `'all'` | Requires approval | Requires approval | Requires approval |

```typescript
const workspace = new Workspace({
  filesystem: new LocalFilesystem({ basePath: './workspace' }),
  sandbox: new LocalSandbox({ workingDirectory: './workspace' }),
  safety: {
    requireSandboxApproval: 'commands',
  },
});
```

With `'commands'`, sandboxed code execution runs without approval (the sandbox isolates it), but shell commands require approval since they can affect the system.

When a tool requires approval, it uses the [agent approval flow](/docs/agents/agent-approval). The agent pauses and waits for user confirmation before executing.

## Filesystem approval

Control whether filesystem operations require user approval with `requireFilesystemApproval`:

| Value | Read ops | Write ops |
|-------|----------|-----------|
| `'none'` | No approval | No approval |
| `'write'` | No approval | Requires approval |
| `'all'` | Requires approval | Requires approval |

Read operations: `workspace_read_file`, `workspace_list_files`, `workspace_file_exists`, `workspace_search`

Write operations: `workspace_write_file`, `workspace_delete_file`, `workspace_mkdir`, `workspace_index`

```typescript
const workspace = new Workspace({
  filesystem: new LocalFilesystem({ basePath: './workspace' }),
  safety: {
    requireFilesystemApproval: 'write',
  },
});
```

## Default values

| Option | Default |
|--------|---------|
| `readOnly` | `false` |
| `requireReadBeforeWrite` | `true` |
| `requireSandboxApproval` | `'all'` |
| `requireFilesystemApproval` | `'none'` |

New workspaces are secure by default:
- Agents must read files before writing
- All sandbox operations require approval
- Filesystem reads don't require approval (reading is generally safe)

## Examples

### Development workspace (full access)

Disable safety features for local development:

```typescript
const devWorkspace = new Workspace({
  filesystem: new LocalFilesystem({ basePath: './workspace' }),
  sandbox: new LocalSandbox({ workingDirectory: './workspace' }),
  safety: {
    requireReadBeforeWrite: false,
    requireSandboxApproval: 'none',
  },
});
```

### Production workspace (supervised)

Require approval for all potentially destructive operations:

```typescript
const prodWorkspace = new Workspace({
  filesystem: new LocalFilesystem({ basePath: './workspace' }),
  sandbox: new LocalSandbox({ workingDirectory: './workspace' }),
  safety: {
    requireReadBeforeWrite: true,
    requireSandboxApproval: 'all',
    requireFilesystemApproval: 'write',
  },
});
```

### Read-only browser

Allow browsing and searching without modification:

```typescript
const browserWorkspace = new Workspace({
  filesystem: new LocalFilesystem({ basePath: './workspace' }),
  bm25: true,
  safety: {
    readOnly: true,
  },
});
```

## Errors

| Error | Cause |
|-------|-------|
| `WorkspaceReadOnlyError` | Write operation attempted on read-only workspace |
| `FileReadRequiredError` | Write attempted without reading first, or file modified since last read |

Both errors include a descriptive message the agent can use to understand what went wrong and how to proceed.

## Related

- [Workspace Overview](/docs/workspace/overview)
- [Agent Approval](/docs/agents/agent-approval)
