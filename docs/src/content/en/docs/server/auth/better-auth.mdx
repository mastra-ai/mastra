---
title: MastraAuthBetterAuth Class
description: Authenticate your Mastra server using Better Auth (self-hosted, open-source auth).
packages:
  - "@mastra/auth-better-auth"
  - "@mastra/client-js"
  - "@mastra/core"
sidebar_label: Better Auth
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

The `MastraAuthBetterAuth` class provides authentication for Mastra using Better Auth. It verifies incoming requests using your Better Auth instance and integrates with the Mastra server via the `server.auth` option.

## How it works

`MastraAuthBetterAuth` authenticates requests by calling `auth.api.getSession({ headers })`. It forwards the incoming `Authorization` and `Cookie` headers, so you can use either bearer tokens or cookie-based sessions.

## Prerequisites

This example uses Better Auth. Make sure your Better Auth instance is configured and your environment variables are set.

```env title=".env"
# Required by Better Auth
BETTER_AUTH_SECRET=...   # at least 32 chars
BETTER_AUTH_URL=http://localhost:3000

# Example DB URL used by the snippet below (adjust for your setup)
DATABASE_URL=postgres://...
```

:::note

Better Auth recommends setting `baseURL` explicitly (or via `BETTER_AUTH_URL`) for security and stability.

:::

If you haven't mounted Better Auth's handler yet (so your app can sign users in / create sessions), follow the [Better Auth installation guide](https://www.better-auth.com/docs/installation) to mount the `/api/auth/*` route (or your configured base path).

### Mount the Better Auth handler

Below is a minimal example using Next.js App Router. If you're using a different framework, follow the Better Auth installation guide for the equivalent handler setup.

```ts title="app/api/auth/[...all]/route.ts"
import { auth } from "@/lib/auth";
import { toNextJsHandler } from "better-auth/next-js";

export const { GET, POST } = toNextJsHandler(auth);
```

## Installation

Install the Mastra provider package and Better Auth:

```bash npm2yarn
npm install @mastra/auth-better-auth@latest better-auth@latest
```

## Usage example

```ts
import { betterAuth } from "better-auth";
import { MastraAuthBetterAuth } from "@mastra/auth-better-auth";
import { Mastra } from "@mastra/core";

// 1) Create your Better Auth instance
const auth = betterAuth({
  database: {
    provider: "postgresql",
    url: process.env.DATABASE_URL!,
  },
  emailAndPassword: {
    enabled: true,
  },
  baseURL: process.env.BETTER_AUTH_URL,
  secret: process.env.BETTER_AUTH_SECRET,
});

// 2) Create the Mastra auth provider
const mastraAuth = new MastraAuthBetterAuth({
  auth,
});

// 3) Use with Mastra
const mastra = new Mastra({
  server: {
    auth: mastraAuth,
  },
});
```

:::info

Visit [MastraAuthBetterAuth](/reference/auth/better-auth) for all available configuration options.

:::

## Configuration options

| Option          | Type | Required | Description |
| --------------- | ---- | -------- | ----------- |
| `auth` | `Auth` | Yes | Your Better Auth instance created via `betterAuth({ ... })` |
| `name` | `string` | No | Custom provider name (default: `"better-auth"`) |
| `authorizeUser` | `(user, request) => Promise<boolean>` | No | Custom authorization logic |
| `public` | `Array<string \| RegExp \| [string, Methods \| Methods[]]>` | No | Public routes that don't require authentication |
| `protected` | `Array<string \| RegExp \| [string, Methods \| Methods[]]>` | No | Protected routes that require authentication |

## Custom authorization

```ts
const mastraAuth = new MastraAuthBetterAuth({
  auth,
  async authorizeUser(user) {
    // Example: only allow verified emails
    return user?.user?.emailVerified === true;
  },
});
```

## Route configuration

```ts
const mastraAuth = new MastraAuthBetterAuth({
  auth,
  public: ["/health", "/api/status"],
  protected: ["/api/*", "/admin/*"],
});
```

### Matching rules

- `public` and `protected` accept exact paths, wildcard patterns (like `/api/*`), and path params (like `/users/:id`).
- For method-specific rules, use tuples like `["/api/agents", ["GET", "POST"]]`.
- If a route matches both `public` and `protected`, `public` wins and no auth is required.
- If neither matches, routes are treated as protected by default (unless a route is explicitly marked `requiresAuth: false`).

## Client-side setup

When auth is enabled, requests to Mastra's built-in routes require authentication. In practice, that means your client needs to send whatever credential your Better Auth setup uses for authenticated requests.

### Cookie session (recommended)

If your Better Auth setup uses cookies, configure the client to send credentials and ensure your Mastra server CORS allows credentials for cross-origin requests.

```ts
import { MastraClient } from "@mastra/client-js";

export const mastraClient = new MastraClient({
  baseUrl: "http://localhost:4111",
  credentials: "include",
});
```

If you are calling the API directly, include credentials in `fetch` as well:

```ts
await fetch("http://localhost:4111/api/agents/weatherAgent/generate", {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
  },
  credentials: "include",
  body: JSON.stringify({ messages: "Weather in London" }),
});
```

### Bearer token

If your Better Auth setup issues bearer tokens, include them in the `Authorization` header:

```ts
import { MastraClient } from "@mastra/client-js";

export const mastraClient = new MastraClient({
  baseUrl: "http://localhost:4111",
  headers: {
    Authorization: `Bearer ${accessToken}`,
  },
});
```

:::info

Visit [Mastra Client SDK](/docs/server/mastra-client) for more configuration options.

:::

### Making authenticated requests

<Tabs>
  <TabItem value="react" label="React">

    ```tsx title="src/components/test-agent.tsx"
    import { mastraClient } from "../lib/mastra-client";

    export const TestAgent = () => {
      async function handleClick() {
        const agent = mastraClient.getAgent("weatherAgent");

        const response = await agent.generate("Weather in London");

        console.log(response);
      }

      return <button onClick={handleClick}>Test Agent</button>;
    };
    ```

  </TabItem>
  <TabItem value="curl" label="cURL">

    ```bash
    curl -X POST http://localhost:4111/api/agents/weatherAgent/generate \
      -H "Content-Type: application/json" \
      -H "Authorization: Bearer <your-token>" \
      -d '{
        "messages": "Weather in London"
      }'
    ```

  </TabItem>
</Tabs>

## Troubleshooting

* **401/403 on every request**: confirm your Better Auth handler is mounted and your app can create a valid session/token.
* **Cookies not sent**: set `credentials: "include"` in `MastraClient` and enable CORS credentials on the Mastra server.
* **Authorization header missing**: ensure the client attaches `Authorization: Bearer <token>` when using bearer tokens.
* **Base URL issues**: set `baseURL` in `betterAuth({ ... })` or set `BETTER_AUTH_URL`.
* **DB connection errors**: verify `DATABASE_URL` and database provider configuration.

## Further reading

* [Better Auth Installation](https://www.better-auth.com/docs/installation)
* [Better Auth Options](https://www.better-auth.com/docs/options)
* [Mastra Auth Overview](/docs/server/auth)
* [MastraAuthBetterAuth Reference](/reference/auth/better-auth)
