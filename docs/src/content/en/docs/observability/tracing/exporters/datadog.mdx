---
title: "Datadog Exporter | Tracing | Observability"
description: "Send traces to Datadog for LLM observability and analytics"
---

# Datadog Exporter

[Datadog](https://datadoghq.com/) is a comprehensive monitoring platform with dedicated LLM Observability features. The Datadog exporter sends your traces to Datadog's LLM Observability product, providing insights into model performance, token usage, and conversation flows.

## Installation

```bash npm2yarn
npm install @mastra/datadog@beta
```

## Configuration

### Prerequisites

1. **Datadog Account**: Sign up at [datadoghq.com](https://datadoghq.com/) with LLM Observability enabled
2. **API Key**: Get your API key from Datadog Organization Settings â†’ API Keys
3. **Environment Variables**: Set your credentials

```bash title=".env"
DD_API_KEY=your-datadog-api-key
DD_LLMOBS_ML_APP=my-llm-app
DD_SITE=datadoghq.com  # Optional: defaults to datadoghq.com
DD_ENV=production      # Optional: environment name
```

### Basic Setup

```typescript title="src/mastra/index.ts"
import { Mastra } from "@mastra/core";
import { Observability } from "@mastra/observability";
import { DatadogExporter } from "@mastra/datadog";

export const mastra = new Mastra({
  observability: new Observability({
    configs: {
      datadog: {
        serviceName: "my-service",
        exporters: [
          new DatadogExporter({
            mlApp: process.env.DD_LLMOBS_ML_APP!,
            apiKey: process.env.DD_API_KEY!,
          }),
        ],
      },
    },
  }),
});
```

## Configuration Options

### Complete Configuration

```typescript
new DatadogExporter({
  // Required settings
  mlApp: process.env.DD_LLMOBS_ML_APP!, // Groups traces under this ML app name
  apiKey: process.env.DD_API_KEY!, // Required for agentless mode (default)

  // Optional settings
  site: "datadoghq.com", // Datadog site (datadoghq.eu, us3.datadoghq.com, etc.)
  service: "my-service", // Service name (defaults to mlApp)
  env: "production", // Environment name
  agentless: true, // true = direct HTTPS, false = local Datadog Agent

  // Advanced settings
  integrationsEnabled: false, // Enable dd-trace auto-instrumentation
  defaultUserId: "anonymous", // Default user ID for all spans
  defaultSessionId: undefined, // Default session ID for all spans

  // Diagnostic logging
  logLevel: "info", // debug | info | warn | error
});
```

### With Local Datadog Agent

If you have a Datadog Agent running locally, you can route traces through it instead of direct HTTPS:

```typescript
new DatadogExporter({
  mlApp: process.env.DD_LLMOBS_ML_APP!,
  agentless: false, // Use local Datadog Agent
  env: "production",
});
```

Note: When using agent mode, the API key is read from the local agent's configuration.

## Using Tags

Tags help you categorize and filter traces in the Datadog LLM Observability dashboard. Add tags when executing agents or workflows:

```typescript
const result = await agent.generate({
  messages: [{ role: "user", content: "Hello" }],
  tracingOptions: {
    tags: ["production", "experiment-v2", "user-request"],
  },
});
```

Tags appear in Datadog's trace view and can be used for filtering. Common use cases include:

- Environment labels: `"production"`, `"staging"`
- Experiment tracking: `"experiment-v1"`, `"control-group"`
- Priority levels: `"priority-high"`, `"batch-job"`
- User segments: `"beta-user"`, `"enterprise"`

## Evaluation Scoring

Submit evaluation scores to track quality metrics in Datadog:

```typescript
await datadog.addScoreToTrace({
  traceId: "trace-123",
  spanId: "span-456", // Optional: defaults to root span if only one exists
  score: 0.95,
  reason: "Response was accurate and helpful",
  scorerName: "quality_scorer",
  metadata: { category: "helpfulness" },
});
```

**Important**: Evaluations must be submitted within 60 seconds of the trace completing. Scores submitted after trace cleanup will be dropped with a warning log.

## Span Type Mapping

Mastra span types are automatically mapped to Datadog LLMObs span kinds:

| Mastra SpanType      | Datadog Kind |
| -------------------- | ------------ |
| `AGENT_RUN`          | `agent`      |
| `MODEL_GENERATION`   | `llm`        |
| `MODEL_STEP`         | `llm`        |
| `TOOL_CALL`          | `tool`       |
| `MCP_TOOL_CALL`      | `tool`       |
| `WORKFLOW_RUN`       | `workflow`   |
| Other workflow types | `task`       |
| `GENERIC`            | `task`       |

## Related

- [Tracing Overview](/docs/v1/observability/tracing/overview)
- [Datadog LLM Observability Documentation](https://docs.datadoghq.com/llm_observability/)
