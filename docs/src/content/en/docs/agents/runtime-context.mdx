---
title: "Runtime Context | Agents | Mastra Docs"
description: Learn how to use Mastra's RuntimeContext to provide dynamic, request-specific configuration to agents.
---

# Runtime Context

Mastra provides `RuntimeContext`, a dependency injection system that lets you configure agents with runtime variables. If you find yourself creating multiple agents that perform similar tasks, runtime context allows you to consolidate them into a single, more flexible agent.

## Overview

The dependency injection system allows you to:

1. Pass runtime configuration variables to agents through a type-safe `runtimeContext`
2. Access these variables within tool execution contexts
3. Modify agent behavior without changing the underlying code
4. Share configuration across multiple tools within the same agent

## Using `runtimeContext` with agents

Agents can access `runtimeContext` via the `instructions` parameter, and retrieve variables using `runtimeContext.get()`. This allows agent behavior to adapt dynamically based on user input or external configuration, without changing the underlying implementation.

```typescript {7-8,15} filename="src/mastra/agents/test-weather-agent.ts" showLineNumbers copy
import { openai } from "@ai-sdk/openai";
import { Agent } from "@mastra/core/agent";
import { testWeatherTool } from "../tools/test-weather-tool";

export const testWeatherAgent = new Agent({
  name: "test-weather-agent",
  instructions: async ({ runtimeContext }) => {
    const temperatureUnit = runtimeContext.get("temperature-unit");

    return `You are a weather assistant that provides current weather information for any city.

    When a user asks for weather:
    - Extract the city name from their request
    - Respond with: temperature, feels-like temperature, humidity, wind speed, and conditions
    - Use ${temperatureUnit} for all temperature values
    - If no city is mentioned, ask for a city name
    `;
  },
  model: openai("gpt-4o-mini"),
  tools: { testWeatherTool }
});
```

### Example tool

This tool exports a `WeatherRuntimeContext` type, enabling type-safe access to runtime config wherever `RuntimeContext` is used. It extracts `city` from `context` derived from the user message passed to `.generate()`, and uses it to query a weather service API.

```typescript {4-6, 15} filename="src/mastra/tools/test-weather-tool.ts" showLineNumbers copy
import { createTool } from "@mastra/core/tools";
import { z } from "zod";

export type WeatherRuntimeContext = {
  "temperature-unit": "celsius" | "fahrenheit";
};

export const testWeatherTool = createTool({
  id: "test-weather-tool",
  description: "Fetches the current weather for a given city",
  inputSchema: z.object({
    city: z.string()
  }),
  execute: async ({ context, runtimeContext }) => {
    const { city } = context;
    const unit = runtimeContext.get("temperature-unit") as WeatherRuntimeContext["temperature-unit"];

    const response = await fetch(`https://weather.service?city=${city}`);
    const { temperature, conditions } = await response.json();

    return {
      metric: unit === "celsius" ? "°C" : "°F",
      temperature,
      conditions
    };
  }
});
```

### Example usage

In this example, `temperature-unit` is set using `runtimeContext.set()` to either **celsius** or **fahrenheit**, allowing the agent to respond with temperatures in the appropriate unit.

```typescript {9, 12} filename="src/test-weather-agent.ts" showLineNumbers copy
import { mastra } from "./mastra";
import { RuntimeContext } from "@mastra/core/runtime-context";
import { WeatherRuntimeContext } from "./mastra/tools/test-weather-tool";

const agent = mastra.getAgent("testWeatherAgent");

const runtimeContext = new RuntimeContext<WeatherRuntimeContext>();

runtimeContext.set("temperature-unit", "celsius");

const response = await agent.generate("What's the weather in London?", {
  runtimeContext
});

console.log(response.text);
```

## Accessing `runtimeContext` with server middleware

You can populate `runtimeContext` dynamically in server middleware by extracting information from the request. In this example, the `temperature-unit` is set based on the Cloudflare `CF-IPCountry` header to ensure responses match the user's locale.

```typescript {2,4,9-18} filename="src/mastra/index.ts" showLineNumbers copy
import { Mastra } from "@mastra/core/mastra";
import { RuntimeContext } from "@mastra/core/runtime-context";
import { testWeatherAgent } from "./agents/test-weather-agent";
import { WeatherRuntimeContext } from "./mastra/tools/test-weather-tool";

export const mastra = new Mastra({
  agents: { testWeatherAgent },
  server: {
    middleware: [
      async (context, next) => {
        const country = context.req.header("CF-IPCountry");
        const runtimeContext = context.get("runtimeContext") as RuntimeContext<WeatherRuntimeContext>;

        runtimeContext.set("temperature-unit", country === "US" ? "fahrenheit" : "celsius");

        await next();
      }
    ]
  }
});
```

## Related

- [Dynamic Agents](./dynamic-agents.mdx)
- [Tool Runtime Context](../tools-mcp/runtime-context.mdx)
