---
title: "Agent Approval | Agents"
description: Learn how to require approvals and suspend tool execution while keeping humans in control of agent workflows.
---

# Agent Approval

Agents sometimes require the same [human-in-the-loop](/docs/v1/workflows/human-in-the-loop) oversight used in workflows when calling tools that handle sensitive operations, like deleting resources or performing running long processes. With agent approval you can suspend a tool call mid execution, or prevent a tool from being called entirely until the agent receives human input.

## Tool call approval

Tool call approval can be enabled at the agent level and apply to every tool the agent uses, or at the tool level providing more specific control over individual tool calls.

### Storage

Agent approval uses a snapshot to capture the state of the request, ensure you've enabled a storage provider in your main Mastra instance. If storage isn't enabled you'll see an error relating to snapshot not found.

```typescript title="src/mastra/index.ts"
import { Mastra } from "@mastra/core/mastra";
import { LibSQLStore } from "@mastra/libsql";

export const mastra = new Mastra({
  // ...
  storage: new LibSQLStore({
    id: "mastra-storage",
    url: ":memory:"
  })
});
```


## Agent level approval

When calling an agent using `.stream()` set `requireToolApproval` to `true` which will prevent the agent from calling any of the tools defined in it's configuration.

```typescript showLineNumbers
const stream = await agent.stream("Plan my trip to London", {
  requireToolApproval: true
});
```

### Approving tool calls

To approve a tool call, access `approveToolCall` from the `agent`, passing in the `runId` of the stream. This will let the agent know it's now ok to call it's tools.

```typescript showLineNumbers
const handleApproval = async () => {
  const approvedStream = await agent.approveToolCall({ runId: stream.runId });

  for await (const chunk of approvedStream.textStream) {
    process.stdout.write(chunk);
  }
  process.stdout.write("\n");
};
```

### Declining tool calls

To decline a tool call, access the `declineToolCall` from the `agent`. You will see the streamed response from the agent, but it won't call it's tools.

```typescript showLineNumbers
const handleDecline = async () => {
  const declinedStream = await agent.declineToolCall({ runId: stream.runId });

  for await (const chunk of declinedStream.textStream) {
    process.stdout.write(chunk);
  }
  process.stdout.write("\n");
};
```


## Tool level approval

```typescript

```
## ----   OLD

Sometimes agents need human oversight before they can run potentially sensitive tools or long-running workflows. Mastra lets you pause tool execution to wait for approval, decline a tool call entirely, or suspend a tool mid-flight until the required data is available.

## Tool approvals

### Enforcing approval on every tool

Pass `requireToolApproval: true` when calling `stream` (or `generate`) to automatically pause execution whenever the agent tries to invoke a tool. The stream closes until you explicitly approve or decline the tool call using the original run’s `runId`.

```typescript {2,6} title="Require approval before executing any tool" showLineNumbers copy
const stream = await myAgent.stream("Find the user with name - John Smith", {
  requireToolApproval: true,
});

const approvedToolCallStream = await myAgent.approveToolCall({ runId: stream.runId });
const declinedToolCallStream = await myAgent.declineToolCall({ runId: stream.runId });
```

### Requiring approval per tool

You can also enforce approval on specific tools. Set `requireApproval: true` when creating a tool so the agent pauses only when it tries to invoke that tool.

```typescript {8} title="Mark a tool as approval-only" showLineNumbers copy
const findUserTool = createTool({
  id: "Find user tool",
  description: "Returns the name and email for a matching user",
  inputSchema: z.object({
    name: z.string(),
  }),
  execute: async inputData => {
    return mockFindUser(inputData);
  },
  requireApproval: true,
});
```

When the agent reaches this tool, it emits a tool-call event you can approve or decline with the same `approveToolCall` or `declineToolCall` helpers.

## Tool suspension

Sometimes a tool can’t finish immediately—maybe it's waiting for external confirmation or extra input. You can suspend and later resume execution using `agent.suspend`, `resumeStream`, and optional schemas that define what data is required at each step.

```typescript {10,14} title="Suspend and resume a tool" showLineNumbers copy
const findUserTool = createTool({
  id: "Find user tool",
  description: "Returns the name and email for a matching user",
  inputSchema: z.object({
    name: z.string(),
  }),
  suspendSchema: z.object({
    message: z.string(),
  }),
  resumeSchema: z.object({
    name: z.string(),
  }),
  execute: async (inputData, { agent }) => {
    if (!agent.resumeData) {
      return agent.suspend({ message: "Please provide the name of the user" });
    }

    return {
      name: agent.resumeData.name,
      email: "test@test.com",
    };
  },
});
```

To continue execution, call `resumeStream` with the run’s `runId` and the `resumeData` that satisfies the `resumeSchema`. When using `suspend` directly in the tool, you don’t need to add `requireToolApproval: true` to the agent stream/generate call, nor `requireApproval: true` to the tool definition.

```typescript {1} title="Resume a suspended tool call" showLineNumbers copy
const resumedStream = await myAgent.resumeStream(
  { name: "John Smith" },
  { runId: stream.runId },
);
```

## Related

- [Using Tools](./using-tools)
- [Agent Overview](./overview)
- [Tools Overview](../mcp/overview)
- [Agent Memory](./agent-memory)
- [Request Context](/docs/v1/server-db/request-context)
- [Calling Agents](/examples/v1/agents/calling-agents)
