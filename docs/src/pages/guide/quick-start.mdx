import { Callout, Steps, Tabs } from 'nextra/components';

## Quick Start

### Prerequisites

- [Node.js v20.0+](https://nodejs.org/)

<Steps>

## Get an LLM provider API key

If you don't have an API key for an LLM provider, you can get one from the following services:

- [OpenAI](https://platform.openai.com/)
- [Anthropic](https://console.anthropic.com/settings/keys)
- [Google Gemini](https://ai.google.dev/gemini-api/docs)

If you don't have an account with these providers, you can sign up and get an API key. OpenAI and Anthropic require a credit card to get an API key. Gemini does not and has a generous free tier for its API.

## Install the CLI 

```bash copy
npm i -g mastra
```
## Create a new project

Create a project directory and navigate into it:

```bash copy
mkdir hello-mastra
cd hello-mastra
```

Next, initialize a TypeScript project using npm:

```bash copy npm2yarn
npm init -y
npm install zod typescript tsx @types/node --save-dev
npx tsc --init
```

### Install the core package
The core package provides the `agents` and `workflows` we'll be using.
```bash copy npm2yarn
npm install @mastra/core@alpha
```

### Add an index.ts file

```bash
mkdir src
touch src/index.ts
```

### Initialize agents

```bash copy
mastra init
```

This `init` command creates two sample agents and wires them
up to the mastra `class`

```ts copy filename="src/mastra/index" {3,6} showLineNumbers
import { Mastra, createLogger } from '@mastra/core';

import { agentOne, agentTwo } from './agents/agent';

export const mastra = new Mastra({
  agents: [agentOne, agentTwo],
  logger: createLogger({
    type: 'CONSOLE',
    level: 'INFO',
  }),
});
```
Update agent one to the following code below:
```ts copy filename="src/mastra/agents/agent.ts" {2-3} showLineNumbers
export const agentOne = new Agent({
  name: 'cat-one',
  instructions: 'You have the knowledge of cat species, a cat connoisseur',
  model: {
    provider: 'ANTHROPIC',
    name: 'claude-3-5-sonnet-20240620',
    toolChoice: 'auto',
  },
});
// rest of code
```

### Create workflow 

Create a workflow directory under mastra with an `index.ts` file
and add the following code block:

```ts copy filename="mastra/workflow/index.ts" showLineNumbers
import { Workflow, Step } from '@mastra/core';
import { z } from 'zod';

const logName = new Step({
  id: 'log',
  inputSchema: z.object({
    name: z.string()
  }),
  outputSchema: z.object({
    rawText: z.string()
  }),
  action: async ({ name }) => {
    console.log(`Hello, ${name} 🐈`);
      return { rawText: `Hello ${name}` };
  },
})

export const helloWorkflow = new Workflow({
  name: 'hello-workflow',
  triggerSchema: z.object({
    name: z.string(),
  }),
  steps: [logName]
});

helloWorkflow.step("log", {
  variables: {
    name: {
      stepId: 'trigger',
      path: "" // passes in entire payload
    }
  }
})
```

### Execute the agent 
Import the mastra instance and use it inside of an `async` function. You have access to the `agent` and it's methods
```ts filename="src/index.ts" showLineNumbers copy {4,20-21}
import { mastra } from "./mastra";

const main = async () => {
  const agentCat = mastra.getAgent("cat-one");

  try {
    const result = await agentCat.textObject({
      messages: ["What is the most popular cat specie?"],
      structuredOutput: {
        catSpecie: {
          type: "object",
          items: {
            specie: {
              type: "string",
            },
          },
        },
      },
    });
    const { catSpecie: { specie }} = await result.toJsonResponse().json() as { catSpecie: { specie: string }}
    console.log(specie)
  } catch (err) {
    console.error(err);
  }
};
main();
```

### Add the workflow
Add the workflow which executes after you receive data from your agent

```ts filename="src/index.ts" showLineNumbers copy {1,22}
import { helloWorkflow } from "./mastra/workflow/index";
import { mastra } from "./mastra";

const main = async () => {
  const agentCat = mastra.getAgent("cat-one");

  try {
    const result = await agentCat.textObject({
      messages: ["What is the most popular cat specie?"],
      structuredOutput: {
        catSpecie: {
          type: "object",
          items: {
            specie: {
              type: "string",
            },
          },
        },
      },
    });
    const { catSpecie: { specie }} = await result.toJsonResponse().json() as { catSpecie: { specie: string }}
    await helloWorkflow.execute({ name: specie });
  } catch (err) {
    console.error(err);
  }
};
main();

```

</Steps>

### Accessing Mastra agent through REST endpoints

Mastra provides you with api endpoints to communicate with your agent. Let's see how below:

<Steps>
### Add your API key

Create a `.env` file and add your provider api key

```bash filename=".env"
OPENAI_API_KEY=<your-openai-api-key> 
```

If you're using Anthropic, set the `ANTHROPIC_API_KEY`. If you're using Gemini, set the `GOOGLE_GENERATIVE_AI_API_KEY`.

### Run mastra serve

```bash copy
mastra serve
```

Mastra serve creates the following POST endpoints:

1. `localhost:4111/agent/:agentId/text` for the agent

`agentId` is the name of the agent.

### Test out the rest endpoint
 
**Agent**
<Tabs items={['curl', 'fetch']}>
  <Tabs.Tab>
```bash copy
curl -X POST http://localhost:4111/agent/cat-one/text \
-H "Content-Type: application/json" \
-d '{"messages": ["What is the most popular cat by adoption rate?"]}'
```
  </Tabs.Tab>
  <Tabs.Tab>
```js copy
fetch(`http://localhost:4111/agent/cat-one/text`, {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
  },
  body: JSON.stringify({
    messages: ["What is the most popular cat by adoption rate?"],
  }),
})
.then((data) => {
  console.log("Response:", data);
})
.catch((error) => {
  console.error("Error:", error);
});
```
  </Tabs.Tab>
</Tabs>
</Steps>

### That's it 🎉

You have just setup Mastra. Mastra also provides you with an instance that can be used in your `node` based project.
You aren't limited to just using the `REST` endpoints to communicate with your agents.


