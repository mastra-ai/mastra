# Building Chat UIs with Memory

Memory features are essential for creating seamless conversational experiences in user interfaces. This section covers how to connect Mastra's memory system with frontend frameworks to build chat applications that maintain context across interactions.

## Quick Start

Here's a minimal example of integrating memory with a Next.js frontend using the AI SDK:

```typescript
// components/Chat.tsx
import { useChat } from "ai/react";

export function Chat({ threadId, resourceId }) {
  const { messages, input, handleInputChange, handleSubmit } = useChat({
    api: "/api/chat",
    // Pass just the latest message and custom IDs
    experimental_prepareRequestBody({ messages }) {
      return {
        message: messages.at(-1),
        threadId,
        resourceId
      };
    },
  });

  return (
    <div>
      <div>
        {messages.map((m) => (
          <div key={m.id}>{m.content}</div>
        ))}
      </div>
      <form onSubmit={handleSubmit}>
        <input value={input} onChange={handleInputChange} />
        <button type="submit">Send</button>
      </form>
    </div>
  );
}

// app/api/chat/route.ts
import { Agent } from "@mastra/core/agent";
import { Memory } from "@mastra/memory";
import { openai } from "@ai-sdk/openai";

const agent = new Agent({
  name: "ChatAgent",
  instructions: "You are a helpful assistant.",
  model: openai("gpt-4o"),
  memory: new Memory(),
});

export async function POST(request: Request) {
  // Get data from frontend
  const { message, threadId, resourceId } = await request.json();

  // Process with memory
  const stream = await agent.stream(message.content, {
    threadId,
    resourceId,
  });

  return stream.toDataStreamResponse();
}
```

For more details on the `useChat` hook, see the [AI SDK useChat documentation](https://sdk.vercel.ai/docs/reference/ai-sdk-ui/use-chat).

## Common Integration Challenges

### Preventing Message Duplication

To prevent duplicate messages in memory, configure `useChat` to send only the latest message instead of the entire history:

```typescript
const { messages } = useChat({
  api: "/api/chat",
  experimental_prepareRequestBody({ messages }) {
    return {
      message: messages.at(-1),
      threadId: "thread_12345",
    };
  },
});
```

See the [AI SDK documentation on message persistence](https://sdk.vercel.ai/docs/ai-sdk-ui/chatbot-message-persistence) for more details.

### Svelte Example

**Important:** When using Svelte, you must extract only the most recent message on the server side to prevent duplicate messages in memory.

```typescript
// Svelte component
import { useChat } from "ai/svelte";

// In your component
const { messages, input, handleSubmit } = useChat({
  api: "/api/chat",
  body: {
    // Include the threadId and resourceId in every request
    threadId: "thread_12345",
    resourceId: "user_12345",
  },
});

// Server endpoint
export async function POST({ request }) {
  const { messages, threadId, resourceId } = await request.json();

  // IMPORTANT: Only use the most recent message to prevent duplicates
  const latestMessage = messages.at(-1);

  const stream = await agent.stream(latestMessage.content, {
    threadId,
    resourceId,
  });

  return new Response(stream.toDataStreamResponse());
}
```

For more on integrating with different frameworks, see our [AI SDK integration guide](/docs/frameworks/ai-sdk#usechat).

## Working with Working Memory

When using working memory, configure it to use the tool-call mode to avoid working memory tags appearing in the UI:

```typescript
// Configure memory with tool-call mode
const memory = new Memory({
  options: {
    workingMemory: {
      enabled: true,
      use: "tool-call", // Prevents tags from appearing in the UI
    },
  },
});

// Create agent with this memory
const agent = new Agent({
  // Other configuration...
  memory: memory,
});
```

## Managing Threads with Client.js

The `@mastra/client-js` package provides methods for managing memory threads from your frontend:

```typescript
import { MastraClient } from "@mastra/client-js";

// Initialize client
const client = new MastraClient({
  apiKey: process.env.MASTRA_API_KEY,
});

// Get all threads for a user
const threads = await client.getMemoryThreads({
  resourceId: "user_12345",
  agentId: "agent_12345",
});

// Create a new thread
const thread = await client.createMemoryThread({
  title: "New Conversation",
  metadata: { category: "support" },
  resourceId: "user_12345",
  agentId: "agent_12345",
});

// Get a specific thread
const existingThread = client.getMemoryThread("thread_12345", "agent_12345");

// Delete a thread
await existingThread.delete();
```

For complete API details, refer to the [Client.js Memory API documentation](/docs/reference/client-js/memory).

## Thread Management UI

You can build interfaces for users to manage their conversation threads:

```typescript
// Thread list component (simplified)
function ThreadList() {
  const [threads, setThreads] = useState([]);

  useEffect(() => {
    async function loadThreads() {
      const client = new MastraClient({ apiKey: process.env.MASTRA_API_KEY });
      const threads = await client.getMemoryThreads({
        resourceId: "user_12345",
        agentId: "agent_12345"
      });
      setThreads(threads);
    }
    loadThreads();
  }, []);

  return (
    <div>
      <h2>Your Conversations</h2>
      <ul>
        {threads.map(thread => (
          <li key={thread.id}>
            <a href={`/chat/${thread.id}`}>
              {thread.title || `Conversation ${thread.id}`}
            </a>
          </li>
        ))}
      </ul>
      <button onClick={() => createNewThread()}>New Conversation</button>
    </div>
  );
}
```

## Related Features

- **[Last Messages](./3.1-last-messages.md)**: For implementing recent conversation history in UIs
- **[Working Memory](./3.3-working-memory.md)**: For maintaining persistent user information
- **[Memory Threads](../4-memory-threads/index.md)**: For understanding thread management
- **[Client.js Memory API](/docs/reference/client-js/memory)**: For complete client-side memory management APIs
- **[Next.js Integration Guide](/docs/frameworks/next-js)**: For integrating Mastra into Next.js projects

