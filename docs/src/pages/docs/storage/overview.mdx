---
title: Storage in Mastra | Mastra Docs
description: Overview of Mastra's storage system and data persistence capabilities.
---

# Storage System

Mastra's storage system provides a unified interface for managing conversation data, workflow states, and evaluation metrics. The system abstracts away database implementation details, allowing you to focus on your application logic.

## Core Concepts

### 1. Storage Abstraction

The storage system provides a consistent interface regardless of the underlying database:

- Write code once, run anywhere
- Switch databases without code changes
- Same behavior across environments

[DIAGRAM SUGGESTION 1: Storage Abstraction Layer
Show application code at the top, connecting to a "Storage Interface" layer in the middle, which then connects to different database implementations (LibSQL, PostgreSQL, Redis) at the bottom]

### 2. Process Isolation

Storage automatically handles process isolation:

- Tests run in isolated memory
- Development server has separate storage
- Production shares a database

[DIAGRAM SUGGESTION 2: Process Isolation
Show multiple processes (Test Runner, Dev Server, Production Server) each with their own storage instance, and how they interact with the databases]

### 3. Data Model

The system manages four core types of data:

1. **Messages** - Conversation content
2. **Threads** - Group related messages
3. **Workflows** - Track execution state
4. **Evaluations** - Store metrics

[DIAGRAM SUGGESTION 3: Data Model
Entity relationship diagram showing how Messages belong to Threads, how Workflows track state, and how Evaluations connect to everything]

## Storage Providers

Choose the right storage for your needs:

### Development (LibSQL)
- In-memory for tests
- File-based for persistence
- SQLite compatibility

### Production (PostgreSQL)
- Cloud-native deployments
- ACID compliance
- Connection pooling

### Optional (Redis)
- High-performance cache
- Real-time operations
- Distributed setups

[DIAGRAM SUGGESTION 4: Provider Characteristics
Compare the three providers across key metrics like Performance, Scalability, Development Experience, etc.]

## Data Schema

All providers use the same schema:

### Core Tables

```sql
-- Threads: Group related messages
CREATE TABLE threads (
  id TEXT PRIMARY KEY,
  resource_id TEXT,    -- External reference
  title TEXT,
  metadata JSONB,      -- Custom attributes
  created_at TIMESTAMP,
  updated_at TIMESTAMP
);

-- Messages: Conversation content
CREATE TABLE messages (
  id TEXT PRIMARY KEY,
  thread_id TEXT,
  role TEXT,          -- user/assistant/system
  content TEXT,
  created_at TIMESTAMP,
  FOREIGN KEY (thread_id) REFERENCES threads(id)
);

-- Workflows: Execution state
CREATE TABLE workflows (
  id TEXT PRIMARY KEY,
  name TEXT,
  state JSONB,        -- Current state
  created_at TIMESTAMP,
  updated_at TIMESTAMP
);

-- Evaluations: Quality metrics
CREATE TABLE evaluations (
  id TEXT PRIMARY KEY,
  input TEXT,
  output TEXT,
  metrics JSONB,      -- Performance data
  created_at TIMESTAMP
);
```

[DIAGRAM SUGGESTION 5: Schema Relationships
Visual representation of the database schema showing relationships between tables]

## Configuration

Configure storage when initializing Mastra:

```typescript
const mastra = new Mastra({
  storage: {
    url: process.env.DATABASE_URL,  // Connection string
    type: 'postgres',               // Provider type
  },
});
```