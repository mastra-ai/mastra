---
title: Mastra Storage | Mastra Reference
description: Reference documentation for the MastraStorage interface.
---

# MastraStorage

The `MastraStorage` class defines the database interface for message, thread, workflow, trace, and evaluation operations. Storage implementations conform to this interface to ensure consistent data structures across different database types.

## Usage

```typescript
import { MastraStorage } from '@mastra/core';

// Implement the abstract class
class CustomStorage extends MastraStorage {
  async createTable({ tableName, schema }) {
    // Implementation
  }
  
  async getMessages({ threadId }) {
    // Implementation
  }
  
  // ... implement other required methods
}
```

## Parameters

<PropertiesTable
  content={[
    {
      name: "name",
      type: "string",
      description: "Name of the storage implementation.",
      isOptional: false
    }
  ]}
/>

## Tables

<PropertiesTable
  content={[
    {
      name: "TABLE_MESSAGES",
      type: "string",
      description: "Table for storing conversation messages."
    },
    {
      name: "TABLE_THREADS",
      type: "string",
      description: "Table for storing conversation threads."
    },
    {
      name: "TABLE_WORKFLOW_SNAPSHOT",
      type: "string",
      description: "Table for storing workflow execution states."
    },
    {
      name: "TABLE_EVALS",
      type: "string",
      description: "Table for storing evaluation results."
    },
    {
      name: "TABLE_TRACES",
      type: "string",
      description: "Table for storing execution traces."
    }
  ]}
/>

## Methods

### Initialization

<PropertiesTable
  content={[
    {
      name: "init",
      type: "async function",
      description: "Creates required database tables with schemas. Called automatically before operations.",
      returns: "Promise<void>"
    }
  ]}
/>

### Table Operations

<PropertiesTable
  content={[
    {
      name: "createTable",
      type: "async function",
      description: "Creates a table with specified schema.",
      parameters: "{ tableName: TABLE_NAMES, schema: Record<string, StorageColumn> }"
    },
    {
      name: "clearTable",
      type: "async function",
      description: "Removes all records from specified table.",
      parameters: "{ tableName: TABLE_NAMES }"
    },
    {
      name: "insert",
      type: "async function", 
      description: "Inserts a single record into specified table.",
      parameters: "{ tableName: TABLE_NAMES, record: Record<string, any> }"
    },
    {
      name: "batchInsert",
      type: "async function",
      description: "Inserts multiple records into specified table.",
      parameters: "{ tableName: TABLE_NAMES, records: Record<string, any>[] }"
    }
  ]}
/>

### Thread Operations

<PropertiesTable
  content={[
    {
      name: "getThreadById",
      type: "async function",
      description: "Retrieves a thread by its ID.",
      parameters: "{ threadId: string }",
      returns: "Promise<StorageThreadType | null>"
    },
    {
      name: "getThreadsByResourceId",
      type: "async function",
      description: "Retrieves all threads associated with a resource.",
      parameters: "{ resourceId: string }",
      returns: "Promise<StorageThreadType[]>"
    },
    {
      name: "saveThread",
      type: "async function",
      description: "Saves a thread to storage.",
      parameters: "{ thread: StorageThreadType }",
      returns: "Promise<StorageThreadType>"
    },
    {
      name: "updateThread",
      type: "async function",
      description: "Updates thread title and metadata.",
      parameters: "{ id: string, title: string, metadata: Record<string, unknown> }",
      returns: "Promise<StorageThreadType>"
    },
    {
      name: "deleteThread",
      type: "async function",
      description: "Deletes a thread by its ID.",
      parameters: "{ threadId: string }"
    }
  ]}
/>

### Message Operations

<PropertiesTable
  content={[
    {
      name: "getMessages",
      type: "async function",
      description: "Retrieves messages for a thread.",
      parameters: "StorageGetMessagesArg",
      returns: "Promise<MessageType[]>"
    },
    {
      name: "saveMessages",
      type: "async function",
      description: "Saves multiple messages to storage.",
      parameters: "{ messages: MessageType[] }",
      returns: "Promise<MessageType[]>"
    }
  ]}
/>

### Workflow Operations

<PropertiesTable
  content={[
    {
      name: "persistWorkflowSnapshot",
      type: "async function",
      description: "Saves workflow execution state.",
      parameters: "{ workflowName: string, runId: string, snapshot: WorkflowRunState }"
    },
    {
      name: "loadWorkflowSnapshot",
      type: "async function",
      description: "Retrieves workflow execution state.",
      parameters: "{ workflowName: string, runId: string }",
      returns: "Promise<WorkflowRunState | null>"
    }
  ]}
/>

### Evaluation Operations

<PropertiesTable
  content={[
    {
      name: "getEvalsByAgentName",
      type: "async function",
      description: "Retrieves evaluation results for an agent.",
      parameters: "agentName: string, type?: 'test' | 'live'",
      returns: "Promise<EvalRow[]>"
    }
  ]}
/>

### Trace Operations

<PropertiesTable
  content={[
    {
      name: "getTraces",
      type: "async function",
      description: "Retrieves traces with pagination.",
      parameters: "{ name?: string, scope?: string, page: number, perPage: number, attributes?: Record<string, string> }",
      returns: "Promise<any[]>"
    }
  ]}
/>

## Implementations

Implementations of the storage interface:

- [LibSQL Storage](./libsql.mdx)
- [PostgreSQL Storage](./postgresql.mdx)
- [Upstash Storage](./upstash.mdx)