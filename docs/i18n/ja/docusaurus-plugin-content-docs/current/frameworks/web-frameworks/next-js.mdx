---
title: "Next.js プロジェクトへの Mastra の統合 | フレームワーク | Mastra ドキュメント"
description: Mastra を Next.js に統合するための手順ガイド。
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import Steps from "@site/src/components/Steps";
import StepItem from "@site/src/components/StepItem";


# Next.js プロジェクトに Mastra を統合する

Mastra は Next.js と連携しており、次のことが簡単に行えます:

- AI 機能を提供する柔軟な API の構築
- フロントエンドとバックエンドを単一のコードベースにまとめてデプロイを簡素化
- 効率的なサーバー・クライアント間のワークフローのために、Next.js の組み込みの Server Actions（App Router）または API Routes（Pages Router）を活用

このガイドに従って、Next.js プロジェクトに Mastra をセットアップし、統合しましょう。

<Tabs>
  <TabItem value="app ルーター" label="アプリルーター">
    :::warning

    このガイドは、プロジェクトのルートで Next.js の App Router を使用していることを前提としています（例: `app`。`src/app` ではありません）。

    :::

    <Steps>
      <StepItem>
        プロジェクトに Mastra を組み込む方法は次の2つです。

        * ワンライナーを使う

          次のコマンドを実行すると、適切なデフォルト設定で Weather エージェントを素早く作成できます。

          ```bash copy
          npx mastra@latest init --dir . --components agents,tools --example --llm openai
          ```

          > 詳細は [mastra init](/reference/cli/create-mastra) を参照してください。

        * 対話型 CLI を使う

          セットアップをカスタマイズしたい場合は、`init` コマンドを実行し、プロンプトの指示に従ってオプションを選択してください。

          ```bash copy
          npx mastra@latest init
          ```

          :::warning

          既定では、`mastra init` はインストール先として `src` を提案します。プロジェクトのルートで App Router（例: `app`。`src/app` ではない）を使用している場合は、プロンプトで `.` を入力してください。

          :::
      </StepItem>

      <StepItem>
        API キーを設定する

        ```bash title=".env" copy
        OPENAI_API_KEY=<your-api-key>
        ```

        > LLM プロバイダーごとに異なる環境変数名を使用します。詳細は [Model Capabilities](https://sdk.vercel.ai/providers) を参照してください。
      </StepItem>

      <StepItem>
        `next.config.ts` に次を追加します。

        ```typescript title="next.config.ts" showLineNumbers copy
        import type { NextConfig } from "next";

        const nextConfig: NextConfig = {
          serverExternalPackages: ["@mastra/*"],
        };

        export default nextConfig;
        ```
      </StepItem>

      <StepItem>
        あとは通常どおり Next.js アプリを起動できます。
      </StepItem>

      <StepItem>
        テスト用の Page、Action、Form を格納する新しいディレクトリを作成します。

        ```bash copy
        mkdir app/test
        ```
      </StepItem>

      <StepItem>
        新しい Action を作成し、サンプルコードを追加します。

        ```bash copy
        touch app/test/action.ts
        ```

        ```typescript title="app/test/action.ts" showLineNumbers copy
        "use server";

        import { mastra } from "../../mastra";

        export async function getWeatherInfo(formData: FormData) {
          const city = formData.get("city")?.toString();
          const agent = mastra.getAgent("weatherAgent");

          const result = await agent.generate(`What's the weather like in ${city}?`);

          return result.text;
        }
        ```
      </StepItem>

      <StepItem>
        新しい Form コンポーネントを作成し、サンプルコードを追加します。

        ```bash copy
        touch app/test/form.tsx
        ```

        ```typescript title="app/test/form.tsx" showLineNumbers copy
        "use client";

        import { useState } from "react";
        import { getWeatherInfo } from "./action";

        export function Form() {
          const [result, setResult] = useState<string | null>(null);

          async function handleSubmit(formData: FormData) {
            const res = await getWeatherInfo(formData);
            setResult(res);
          }

          return (
            <>
              <form action={handleSubmit}>
                <input name="city" placeholder="Enter city" required />
                <button type="submit">Get Weather</button>
              </form>
              {result && <pre>{result}</pre>}
            </>
          );
        }
        ```
      </StepItem>

      <StepItem>
        新しい Page を作成し、サンプルコードを追加します。

        ```bash copy
        touch app/test/page.tsx
        ```

        ```typescript title="app/test/page.tsx" showLineNumbers copy
        import { Form } from "./form";

        export default async function Page() {
          return (
            <>
              <h1>Test</h1>
              <Form />
            </>
          );
        }
        ```

        > ブラウザで `/test` にアクセスして試せます。

        都市に **London** を指定して送信すると、次のような結果が返ってきます。

        ```plaintext
        Agent response: The current weather in London is as follows:

        - **Temperature:** 12.9°C (Feels like 9.7°C)
        - **Humidity:** 63%
        - **Wind Speed:** 14.7 km/h
        - **Wind Gusts:** 32.4 km/h
        - **Conditions:** Overcast

        Let me know if you need more information!
        ```
      </StepItem>
    </Steps>
  </TabItem>

  <TabItem value="Pages Router" label="Pages ルーター">
    :::warning

    このガイドは、プロジェクトのルートで Next.js の Pages Router を使用していることを前提としています（例: `src/pages` ではなく `pages`）。

    :::

    <Steps>
      <StepItem>
        プロジェクトに Mastra を導入する方法は次の2通りです:

        * ワンライナーを使う

          既定の Weather エージェントを妥当な設定で手早く作成するには、次のコマンドを実行します:

          ```bash copy
          npx mastra@latest init --dir . --components agents,tools --example --llm openai
          ```

          > 詳細は [mastra init](/reference/cli/create-mastra) を参照してください。

        * 対話型 CLI を使う

          セットアップをカスタマイズしたい場合は、`init` コマンドを実行し、プロンプトで表示されるオプションから選択してください:

          ```bash copy
          npx mastra@latest init
          ```

          :::warning

          既定では、`mastra init` はインストール先として `src` を提案します。プロジェクトのルートで Pages Router を使用している場合（例: `pages`、`src/pages` ではない）、プロンプトが表示されたら `.` を入力してください。

          :::
      </StepItem>

      <StepItem>
        API キーを設定する

        ```bash title=".env" copy
        OPENAI_API_KEY=<your-api-key>
        ```

        > 各 LLM プロバイダーは異なる環境変数を使用します。詳細は [Model Capabilities](https://sdk.vercel.ai/providers) を参照してください。
      </StepItem>

      <StepItem>
        `next.config.ts` に以下を追加します:

        ```typescript title="next.config.ts" showLineNumbers copy
        import type { NextConfig } from "next";

        const nextConfig: NextConfig = {
          serverExternalPackages: ["@mastra/*"],
        };

        export default nextConfig;
        ```
      </StepItem>

      <StepItem>
        これで、通常どおり Next.js アプリを起動できます。
      </StepItem>

      <StepItem>
        新しい API ルートを作成し、次のサンプルコードを追加します:

        ```bash copy
        touch pages/api/test.ts
        ```

        ```typescript title="pages/api/test.ts" showLineNumbers copy
        import type { NextApiRequest, NextApiResponse } from "next";

        import { mastra } from "../../mastra";

        export default async function getWeatherInfo(
          req: NextApiRequest,
          res: NextApiResponse,
        ) {
          const city = req.body.city;
          const agent = mastra.getAgent("weatherAgent");

          const result = await agent.generate(`What's the weather like in ${city}?`);

          return res.status(200).json(result.text);
        }
        ```
      </StepItem>

      <StepItem>
        新しいページを作成し、次のサンプルコードを追加します:

        ```bash copy
        touch pages/test.tsx
        ```

        ```typescript title="pages/test.tsx" showLineNumbers copy
        import { useState } from "react";

        export default function Test() {
          const [result, setResult] = useState<string | null>(null);

          async function handleSubmit(event: React.FormEvent<HTMLFormElement>) {
            event.preventDefault();

            const formData = new FormData(event.currentTarget);
            const city = formData.get("city")?.toString();

            const response = await fetch("/api/test", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ city })
            });

            const text = await response.json();
            setResult(text);
          }

          return (
            <>
              <h1>Test</h1>
              <form onSubmit={handleSubmit}>
                <input name="city" placeholder="Enter city" required />
                <button type="submit">Get Weather</button>
              </form>
              {result && <pre>{result}</pre>}
            </>
          );
        }
        ```

        > これで、ブラウザで `/test` にアクセスして試せます。

        都市として **London** を送信すると、次のような結果が返ります:

        ```plaintext
        Agent response: The current weather in London is as follows:

        - **Temperature:** 12.9°C (Feels like 9.7°C)
        - **Humidity:** 63%
        - **Wind Speed:** 14.7 km/h
        - **Wind Gusts:** 32.4 km/h
        - **Conditions:** Overcast

        Let me know if you need more information!
        ```
      </StepItem>
    </Steps>
  </TabItem>
</Tabs>

## 次のステップ

- [デプロイ | Vercel 上の Next.js](/docs/deployment/web-framework#with-nextjs-on-vercel)
- [モノレポのデプロイ](../../deployment/monorepo)