---
title: "CopilotKit ã‚’ Mastra ã¨çµ±åˆã™ã‚‹ | ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ | Mastra ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ"
description: "Mastra ãŒ CopilotKit ã® AGUI ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã©ã®ã‚ˆã†ã«æ´»ç”¨ã—ã¦ã„ã‚‹ã‹ã€ã¾ãŸãã‚Œã‚’ç”¨ã„ã¦å„ªã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã‚’å­¦ã³ã¾ã—ã‚‡ã†"
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import Steps from "@site/src/components/Steps";
import StepItem from "@site/src/components/StepItem";


<div id="integrate-copilotkit-with-mastra">
  # Mastra ã¨ CopilotKit ã‚’çµ±åˆã™ã‚‹
</div>

CopilotKit ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ãª AI ã‚³ãƒ‘ã‚¤ãƒ­ãƒƒãƒˆã‚’æ‰‹æ—©ãçµ„ã¿è¾¼ã‚€ãŸã‚ã® React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æä¾›ã—ã¾ã™ã€‚Mastra ã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€åŒæ–¹å‘ã®çŠ¶æ…‹åŒæœŸã‚„ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãª UI ã‚’å‚™ãˆãŸé«˜åº¦ãª AI ã‚¢ãƒ—ãƒªã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚

CopilotKit ã®ã‚³ãƒ³ã‚»ãƒ—ãƒˆã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€ç™ºå±•çš„ãªæ´»ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã¤ã„ã¦ã¯ã€[CopilotKit ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.copilotkit.ai/)ã‚’ã”è¦§ãã ã•ã„ã€‚

ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€æ¬¡ã® 2 ã¤ã®çµ±åˆæ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

1. Mastra ã‚µãƒ¼ãƒãƒ¼ã« CopilotKit ã‚’çµ±åˆã—ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯åˆ¥ã® React ã¨ã—ã¦æ§‹ç¯‰ã™ã‚‹
2. Next.js ã‚¢ãƒ—ãƒªã« CopilotKit ã‚’çµ±åˆã™ã‚‹

<Tabs>
  <TabItem value="mastra-server" label="Mastra ã‚µãƒ¼ãƒãƒ¼">
    <Steps>
      <StepItem>
        React ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§å¿…è¦ãª CopilotKit ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ï¼š

        <Tabs>
          <TabItem value="npm" label="npm">
            ```bash copy
            npm install @copilotkit/react-core @copilotkit/react-ui
            ```
          </TabItem>

          <TabItem value="yarn" label="yarn">
            ```bash copy
            yarn add @copilotkit/react-core @copilotkit/react-ui
            ```
          </TabItem>

          <TabItem value="pnpm" label="pnpm">
            ```bash copy
            pnpm add @copilotkit/react-core @copilotkit/react-ui
            ```
          </TabItem>
        </Tabs>
      </StepItem>

      <StepItem>
        React ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã« CopilotKit ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ï¼š

        ```tsx title="components/copilotkit-component.tsx" copy
        import { CopilotChat } from "@copilotkit/react-ui";
        import { CopilotKit } from "@copilotkit/react-core";
        import "@copilotkit/react-ui/styles.css";

        export function CopilotKitComponent({ runtimeUrl }: { runtimeUrl: string }) {
          return (
            <CopilotKit runtimeUrl={runtimeUrl} agent="weatherAgent">
              <CopilotChat
                labels={{
                  title: "Your Assistant",
                  initial: "Hi! ğŸ‘‹ How can I assist you today?",
                }}
              />
            </CopilotKit>
          );
        }
        ```
      </StepItem>

      <StepItem>
        ã¾ã  Mastra ã‚µãƒ¼ãƒãƒ¼ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¦ã„ãªã„å ´åˆã¯ã€[ã¯ã˜ã‚ã«](/docs/getting-started/installation)ã«å¾“ã£ã¦æ–°ã—ã„ Mastra ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚

        Mastra ã‚µãƒ¼ãƒãƒ¼ã§ã€CopilotKit é€£æºç”¨ã®è¿½åŠ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ï¼š

        <Tabs>
          <TabItem value="npm" label="npm">
            ```bash copy
            npm install @copilotkit/runtime @ag-ui/mastra
            ```
          </TabItem>

          <TabItem value="yarn" label="yarn">
            ```bash copy
            yarn add @copilotkit/runtime @ag-ui/mastra
            ```
          </TabItem>

          <TabItem value="pnpm" label="pnpm">
            ```bash copy
            pnpm add @copilotkit/runtime @ag-ui/mastra
            ```
          </TabItem>
        </Tabs>
      </StepItem>

      <StepItem>
        Mastra ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¨­å®šã—ã€CopilotKit ã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å«ã‚ã¾ã™ï¼š

        ```typescript title="src/mastra/index.ts" copy {2,5-8,12-28}
        import { Mastra } from "@mastra/core/mastra";
        import { registerCopilotKit } from "@ag-ui/mastra/copilotkit";
        import { weatherAgent } from "./agents/weather-agent";

        type WeatherRuntimeContext = {
          "user-id": string;
          "temperature-scale": "celsius" | "fahrenheit";
        };

        export const mastra = new Mastra({
          agents: { weatherAgent },
          server: {
            cors: {
              origin: "*",
              allowMethods: ["*"],
              allowHeaders: ["*"],
            },
            apiRoutes: [
              registerCopilotKit<WeatherRuntimeContext>({
                path: "/copilotkit",
                resourceId: "weatherAgent",
                setContext: (c, runtimeContext) => {
                  runtimeContext.set(
                    "user-id",
                    c.req.header("X-User-ID") || "anonymous",
                  );
                  runtimeContext.set("temperature-scale", "celsius");
                },
              }),
            ],
          },
        });
        ```
      </StepItem>

      <StepItem>
        React ã‚¢ãƒ—ãƒªã§ã€Mastra ã‚µãƒ¼ãƒãƒ¼ã® URL ã‚’æŒ‡å®šã—ã¦ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¾ã™ï¼š

        ```tsx title="App.tsx" copy {5}
        import { CopilotKitComponent } from "./components/copilotkit-component";

        function App() {
          return <CopilotKitComponent runtimeUrl="http://localhost:4111/copilotkit" />;
        }

        export default App;
        ```

        ã“ã‚Œã§ã€Mastra ã‚µãƒ¼ãƒãƒ¼ã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ä¸¡æ–¹ã‚’èµ·å‹•ã§ãã¾ã™ã€‚
      </StepItem>
    </Steps>
  </TabItem>

  <TabItem value="Next.js" label="Next.js">
    <Steps>
      <StepItem>
        Next.js ã‚¢ãƒ—ãƒªã§å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™:

        <Tabs>
          <TabItem value="npm" label="npm">
            ```bash copy
            npm install @copilotkit/react-core @copilotkit/react-ui @copilotkit/runtime @ag-ui/mastra
            ```
          </TabItem>

          <TabItem value="yarn" label="yarn">
            ```bash copy
            yarn add @copilotkit/react-core @copilotkit/react-ui @copilotkit/runtime @ag-ui/mastra
            ```
          </TabItem>

          <TabItem value="pnpm" label="pnpm">
            ```bash copy
            pnpm add @copilotkit/react-core @copilotkit/react-ui @copilotkit/runtime @ag-ui/mastra
            ```
          </TabItem>
        </Tabs>
      </StepItem>

      <StepItem>
        CopilotKit ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹:

        ```tsx title="components/copilotkit-component.tsx" copy
        'use client';
        import { CopilotChat } from "@copilotkit/react-ui";
        import { CopilotKit } from "@copilotkit/react-core";
        import "@copilotkit/react-ui/styles.css";

        export function CopilotKitComponent({ runtimeUrl }: { runtimeUrl: string}) {
          return (
            <CopilotKit
              runtimeUrl={runtimeUrl}
              agent="weatherAgent"
            >
              <CopilotChat
                labels={{
                  title: "ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ",
                  initial: "ã“ã‚“ã«ã¡ã¯!ğŸ‘‹ ä»Šæ—¥ã¯ã©ã†ã•ã‚Œã¾ã—ãŸã‹?",
                }}
              />
            </CopilotKit>
          );
        }
        ```
      </StepItem>

      <StepItem>
        Mastra ã‚’ Next.js ã‚¢ãƒ—ãƒªã«ã©ã†çµ±åˆã™ã‚‹ã‹ã«ã‚ˆã£ã¦ã€API ãƒ«ãƒ¼ãƒˆã®å®Ÿè£…ã«ã¯ 2 ã¤ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒã‚ã‚Šã¾ã™ã€‚

        1. ã‚¢ãƒ—ãƒªå†…ã« Mastra ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’çµ„ã¿è¾¼ã‚“ã ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ Next.js ã‚¢ãƒ—ãƒªå‘ã‘
        2. åˆ¥ã® Mastra ã‚µãƒ¼ãƒãƒ¼ã¨ Mastra Client SDK ã‚’ç”¨ã„ã‚‹ Next.js ã‚¢ãƒ—ãƒªå‘ã‘

        <Tabs>
          <TabItem value="mastra-instance" label="Mastra ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’åˆ©ç”¨">
            ãƒ­ãƒ¼ã‚«ãƒ«ã® Mastra ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«æ¥ç¶šã™ã‚‹ API ãƒ«ãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

            ```typescript title="app/api/copilotkit/route.ts" copy {1-7,11-26}
            import { mastra } from "../../mastra";
            import {
              CopilotRuntime,
              ExperimentalEmptyAdapter,
              copilotRuntimeNextJSAppRouterEndpoint,
            } from "@copilotkit/runtime";
            import { MastraAgent } from "@ag-ui/mastra";
            import { NextRequest } from "next/server";

            export const POST = async (req: NextRequest) => {
              const mastraAgents = MastraAgent.getLocalAgents({
                mastra,
                agentId: "weatherAgent",
              });

              const runtime = new CopilotRuntime({
                agents: mastraAgents,
              });

              const { handleRequest } = copilotRuntimeNextJSAppRouterEndpoint({
                runtime,
                serviceAdapter: new ExperimentalEmptyAdapter(),
                endpoint: "/api/copilotkit",
              });

              return handleRequest(req);
            };
            ```
          </TabItem>

          <TabItem value="mastra-client" label="Mastra Client SDK ã‚’åˆ©ç”¨">
            Mastra Client SDK ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

            <Tabs>
              <TabItem value="npm" label="npm">
                ```bash copy
                npm install @mastra/client-js
                ```
              </TabItem>

              <TabItem value="yarn" label="yarn">
                ```bash copy
                yarn add @mastra/client-js
                ```
              </TabItem>

              <TabItem value="pnpm" label="pnpm">
                ```bash copy
                pnpm add @mastra/client-js
                ```
              </TabItem>
            </Tabs>

            ãƒªãƒ¢ãƒ¼ãƒˆã® Mastra ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«æ¥ç¶šã™ã‚‹ API ãƒ«ãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

            ```typescript title="app/api/copilotkit/route.ts" copy {1-7,12-26}
            import { MastraClient } from "@mastra/client-js";
            import {
              CopilotRuntime,
              ExperimentalEmptyAdapter,
              copilotRuntimeNextJSAppRouterEndpoint,
            } from "@copilotkit/runtime";
            import { MastraAgent } from "@ag-ui/mastra";
            import { NextRequest } from "next/server";

            export const POST = async (req: NextRequest) => {
              const baseUrl = process.env.MASTRA_BASE_URL || "http://localhost:4111";
              const mastraClient = new MastraClient({ baseUrl });

              const mastraAgents = await MastraAgent.getRemoteAgents({ mastraClient });

              const runtime = new CopilotRuntime({
                agents: mastraAgents,
              });

              const { handleRequest } = copilotRuntimeNextJSAppRouterEndpoint({
                runtime,
                serviceAdapter: new ExperimentalEmptyAdapter(),
                endpoint: "/api/copilotkit",
              });

              return handleRequest(req);
            };
            ```
          </TabItem>
        </Tabs>
      </StepItem>

      <StepItem>
        ãƒ­ãƒ¼ã‚«ãƒ«ã® API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½¿ã£ã¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’åˆ©ç”¨ã—ã¾ã™:

        ```tsx title="App.tsx" copy {5}
        import { CopilotKitComponent } from "./components/copilotkit-component";

        function App() {
          return <CopilotKitComponent runtimeUrl="/api/copilotkit" />;
        }

        export default App;
        ```
      </StepItem>
    </Steps>
  </TabItem>
</Tabs>

æœªæ¥ã‚’ç¯‰ãå§‹ã‚ã‚ˆã†ï¼

<br />

<img
  className="rounded-lg"
  src="/img/copilotkit/cpkoutput.jpg"
  alt="CopilotKitã®å‡ºåŠ›"
  style={{ maxWidth: "700px", width: "100%" }}
/>

<div id="next-steps">
  ## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—
</div>

- [CopilotKit Documentation](https://docs.copilotkit.ai) - CopilotKit ã®åŒ…æ‹¬çš„ãªãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹
- [React Hooks with CopilotKit](https://docs.copilotkit.ai/reference/hooks/useCoAgent) - React ã®é«˜åº¦ãªçµ±åˆãƒ‘ã‚¿ãƒ¼ãƒ³
- [Next.js Integration with Mastra](/docs/frameworks/web-frameworks/next-js) - ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ã® Next.js ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰