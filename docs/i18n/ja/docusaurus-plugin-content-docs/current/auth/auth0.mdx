---
title: "MastraAuthAuth0 クラス | 認証 | Mastra ドキュメント"
description: "Auth0 を用いて Mastra アプリケーションを認証する MastraAuthAuth0 クラスのドキュメント。"
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";


<div id="mastraauthauth0-class">
  # MastraAuthAuth0 クラス
</div>

`MastraAuthAuth0` クラスは、Auth0 を用いて Mastra の認証を提供します。Auth0 が発行した JWT トークンで受信リクエストを検証し、`experimental_auth` オプションを使用して Mastra サーバーと連携します。

<div id="prerequisites">
  ## 前提条件
</div>

この例では Auth0 認証を使用します。次を実施してください:

1. [auth0.com](https://auth0.com/) で Auth0 アカウントを作成する
2. Auth0 ダッシュボードでアプリケーションを設定する
3. 識別子（audience）を指定して Auth0 ダッシュボードで API を設定する
4. アプリケーションの許可されたコールバック URL、Web オリジン、ログアウト URL を設定する

```env title=".env" copy
AUTH0_DOMAIN=your-tenant.auth0.com
AUTH0_AUDIENCE=your-api-identifier
```

> **注意:** Auth0 Dashboard の Applications &gt; Settings でドメインを確認できます。audience は、Auth0 Dashboard &gt; APIs で設定した API の識別子です。

> 詳細なセットアップ手順は、使用しているプラットフォーム向けの [Auth0 クイックスタート](https://auth0.com/docs/quickstarts) を参照してください。


<div id="installation">
  ## インストール
</div>

`MastraAuthAuth0` クラスを使用する前に、`@mastra/auth-auth0` パッケージをインストールする必要があります。

```bash copy
npm install @mastra/auth-auth0@latest
```


<div id="usage-examples">
  ## 使用例
</div>

<div id="basic-usage-with-environment-variables">
  ### 環境変数を使った基本的な使い方
</div>

```typescript {2,7} title="src/mastra/index.ts" showLineNumbers copy
import { Mastra } from "@mastra/core/mastra";
import { MastraAuthAuth0 } from "@mastra/auth-auth0";

export const mastra = new Mastra({
  // ..
  server: {
    experimental_auth: new MastraAuthAuth0(),
  },
});
```


<div id="custom-configuration">
  ### カスタム設定
</div>

```typescript {2,7-10} title="src/mastra/index.ts" showLineNumbers copy
import { Mastra } from "@mastra/core/mastra";
import { MastraAuthAuth0 } from "@mastra/auth-auth0";

export const mastra = new Mastra({
  // ..
  server: {
    experimental_auth: new MastraAuthAuth0({
      domain: process.env.AUTH0_DOMAIN,
      audience: process.env.AUTH0_AUDIENCE,
    }),
  },
});
```


<div id="configuration">
  ## 構成
</div>

<div id="user-authorization">
  ### ユーザー認可
</div>

デフォルトでは、`MastraAuthAuth0` は指定した audience に対して有効な Auth0 トークンを持つ、認証済みのすべてのユーザーを許可します。トークン検証では次の点を確認します:

1. トークンが Auth0 によって正しく署名されていること
2. トークンが期限切れではないこと
3. トークンの audience が設定した audience と一致していること
4. トークンの issuer があなたの Auth0 ドメインと一致していること

ユーザー認可をカスタマイズするには、カスタムの `authorizeUser` 関数を指定します:

```typescript title="src/mastra/auth.ts" showLineNumbers copy
import { MastraAuthAuth0 } from "@mastra/auth-auth0";

const auth0Provider = new MastraAuthAuth0({
  authorizeUser: async (user) => {
    // カスタム認可ロジック
    return user.email?.endsWith("@yourcompany.com") || false;
  },
});
```

> 利用可能なすべての設定オプションについては、[MastraAuthAuth0](/reference/auth/auth0) の API リファレンスを参照してください。


<div id="client-side-setup">
  ## クライアント側のセットアップ
</div>

Auth0 認証を使用する場合は、Auth0 React SDK を設定し、ユーザーを認証して、Mastra へのリクエストに渡すためのアクセストークンを取得する必要があります。

<div id="setting-up-auth0-react-sdk">
  ### Auth0 React SDK のセットアップ
</div>

まず、アプリケーションに Auth0 React SDK をインストールして設定します：

```bash copy
npm install @auth0/auth0-react
```

```typescript title="src/auth0-provider.tsx" showLineNumbers copy
import React from 'react';
import { Auth0Provider } from '@auth0/auth0-react';

const Auth0ProviderWithHistory = ({ children }) => {
  return (
    <Auth0Provider
      domain={process.env.REACT_APP_AUTH0_DOMAIN}
      clientId={process.env.REACT_APP_AUTH0_CLIENT_ID}
      authorizationParams={{
        redirect_uri: window.location.origin,
        audience: process.env.REACT_APP_AUTH0_AUDIENCE,
        scope: "read:current_user update:current_user_metadata"
      }}
    >
      {children}
    </Auth0Provider>
  );
};

export default Auth0ProviderWithHistory;
```


<div id="retrieving-access-tokens">
  ### アクセス トークンの取得
</div>

Auth0 React SDK を使ってユーザーを認証し、アクセス トークンを取得します:

```typescript title="lib/auth.ts" showLineNumbers copy
import { useAuth0 } from "@auth0/auth0-react";

export const useAuth0Token = () => {
  const { getAccessTokenSilently } = useAuth0();

  const getAccessToken = async () => {
    const token = await getAccessTokenSilently();
    return token;
  };

  return { getAccessToken };
};
```

> その他の認証方法や設定オプションについては、[Auth0 React SDK のドキュメント](https://auth0.com/docs/libraries/auth0-react)を参照してください。


<div id="configuring-mastraclient">
  ## `MastraClient` の設定
</div>

`experimental_auth` が有効な場合、`MastraClient` で行うすべてのリクエストには、`Authorization` ヘッダーに有効な Auth0 のアクセストークンを含める必要があります。

```typescript title="lib/mastra/mastra-client.ts" showLineNumbers copy
import { MastraClient } from "@mastra/client-js";

export const createMastraClient = (accessToken: string) => {
  return new MastraClient({
    baseUrl: "https://<mastra-api-url>",
    headers: {
      Authorization: `Bearer ${accessToken}`,
    },
  });
};
```

> 注意: Authorization ヘッダーではアクセストークンの前に `Bearer` を付ける必要があります。

> 設定の詳細については [Mastra Client SDK](/docs/server-db/mastra-client) を参照してください。


<div id="making-authenticated-requests">
  ### 認証付きリクエストの送信
</div>

`MastraClient` に Auth0 のアクセストークンを設定すると、認証付きリクエストを送信できます。

<Tabs>
  <TabItem value="react" label="React">
    ```tsx title="src/components/mastra-api-test.tsx" showLineNumbers copy
    import React, { useState } from 'react';
    import { useAuth0 } from '@auth0/auth0-react';
    import { MastraClient } from '@mastra/client-js';

    export const MastraApiTest = () => {
      const { getAccessTokenSilently } = useAuth0();
      const [result, setResult] = useState(null);

      const callMastraApi = async () => {
        const token = await getAccessTokenSilently();

        const mastra = new MastraClient({
          baseUrl: "http://localhost:4111",
          headers: {
            Authorization: `Bearer ${token}`
          }
        });

        const weatherAgent = mastra.getAgent("weatherAgent");
        const response = await weatherAgent.generate({
          messages: "What's the weather like in New York"
        });

        setResult(response.text);
      };

      return (
        <div>
          <button onClick={callMastraApi}>
            Test Mastra API
          </button>

          {result && (
            <div className="result">
              <h6>Result:</h6>
              <pre>{result}</pre>
            </div>
          )}
        </div>
      );
    };
    ```
  </TabItem>
  <TabItem value="curl" label="cURL">
    ```bash copy
    curl -X POST http://localhost:4111/api/agents/weatherAgent/generate \
      -H "Content-Type: application/json" \
      -H "Authorization: Bearer <your-auth0-access-token>" \
      -d '{
        "messages": "Weather in London"
      }'
    ```
  </TabItem>
</Tabs>