---
title: "ワークフローにおけるステップの定義（レガシー） | Workflows（レガシー） | Mastra Docs"
sidebar_position: 2
sidebar_label: "ステップ"
description: "Mastra のワークフローにおけるステップは、入力・出力・実行ロジックを定義することで、処理を体系的に管理するための枠組みを提供します。"
---

<div id="defining-steps-in-a-workflow-legacy">
  # ワークフローにおけるステップの定義（レガシー）
</div>

ワークフローを構築する際は、処理をリンクして再利用できる小さなタスクに分解するのが一般的です。ステップは、入力・出力・実行ロジックを定義することで、これらのタスクを体系的に管理する手段を提供します。

以下のコードは、ステップをインラインで定義する方法と、別途定義する方法を示しています。

<div id="inline-step-creation">
  ## インラインでのステップ作成
</div>

`.step()` と `.then()` を使って、ワークフロー内で直接ステップを作成できます。以下のコードは、2つのステップを順に定義・接続して実行する方法を示しています。

```typescript showLineNumbers title="src/mastra/workflows/index.ts" copy
import { Mastra } from "@mastra/core";
import { LegacyStep, LegacyWorkflow } from "@mastra/core/workflows/legacy";
import { z } from "zod";

export const myWorkflow = new LegacyWorkflow({
  name: "my-workflow",
  triggerSchema: z.object({
    inputValue: z.number(),
  }),
});

myWorkflow
  .step(
    new LegacyStep({
      id: "stepOne",
      outputSchema: z.object({
        doubledValue: z.number(),
      }),
      execute: async ({ context }) => ({
        doubledValue: context.triggerData.inputValue * 2,
      }),
    }),
  )
  .then(
    new LegacyStep({
      id: "stepTwo",
      outputSchema: z.object({
        incrementedValue: z.number(),
      }),
      execute: async ({ context }) => {
        if (context.steps.stepOne.status !== "success") {
          return { incrementedValue: 0 };
        }

        return {
          incrementedValue: context.steps.stepOne.output.doubledValue + 1,
        };
      },
    }),
  )
  .commit();

// ワークフローをMastraに登録
export const mastra = new Mastra({
  legacy_workflows: { myWorkflow },
});
```


<div id="creating-steps-separately">
  ## ステップを個別に作成する
</div>

ステップのロジックを別のエンティティとして管理したい場合は、ステップを外部で定義してからワークフローに追加できます。次のコードは、ステップを独立して定義し、その後でワークフローに紐づける方法を示しています。

```typescript showLineNumbers title="src/mastra/workflows/index.ts" copy
import { Mastra } from "@mastra/core";
import { LegacyStep, LegacyWorkflow } from "@mastra/core/workflows/legacy";
import { z } from "zod";

// ステップを個別に定義
const stepOne = new LegacyStep({
  id: "stepOne",
  outputSchema: z.object({
    doubledValue: z.number(),
  }),
  execute: async ({ context }) => ({
    doubledValue: context.triggerData.inputValue * 2,
  }),
});

const stepTwo = new LegacyStep({
  id: "stepTwo",
  outputSchema: z.object({
    incrementedValue: z.number(),
  }),
  execute: async ({ context }) => {
    if (context.steps.stepOne.status !== "success") {
      return { incrementedValue: 0 };
    }
    return { incrementedValue: context.steps.stepOne.output.doubledValue + 1 };
  },
});

// ワークフローを構築
const myWorkflow = new LegacyWorkflow({
  name: "my-workflow",
  triggerSchema: z.object({
    inputValue: z.number(),
  }),
});

myWorkflow.step(stepOne).then(stepTwo);
myWorkflow.commit();

// ワークフローをMastraに登録
export const mastra = new Mastra({
  legacy_workflows: { myWorkflow },
});
```
