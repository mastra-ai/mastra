---
title: "Azure App Services | デプロイ | Mastra ドキュメント"
description: "Mastra アプリを Azure App Services にデプロイする方法。"
---

import Steps from "@site/src/components/Steps";
import StepItem from "@site/src/components/StepItem";


<div id="azure-app-services">
  # Azure App Services
</div>

Mastra アプリケーションを Azure App Services にデプロイします。

:::note
このガイドは、Mastra アプリケーションが既定の
`npx create-mastra@latest` コマンドで作成されていることを前提としています。
新しい Mastra アプリケーションの作成方法については、
[クイックスタートガイド](/docs/getting-started/installation)をご覧ください。
:::

<div id="prerequisites">
  ## 前提条件
</div>

- 有効なサブスクリプションがある [Azure アカウント](https://azure.microsoft.com/)
- Mastra アプリケーションを含む [GitHub リポジトリ](https://github.com/)
- Mastra アプリケーションが `npx create-mastra@latest` で作成されていること

<div id="deployment-steps">
  ## デプロイ手順
</div>

<Steps>

<StepItem>

新しい App Service を作成します:

- [Azure Portal](https://portal.azure.com) にログイン
- **[App Services](https://docs.microsoft.com/en-us/azure/app-service/)** に移動、または上部の検索バーで検索
- **Create** をクリックして新しい App Service を作成
- ドロップダウンで **Web App** を選択

</StepItem>

<StepItem>

App Service の設定を行います:

- **Subscription**: 使用する Azure サブスクリプションを選択
- **Resource Group**: 新規作成するか既存のリソースグループを選択
- **Instance name**: アプリの一意の名前を入力（URL の一部になります）
- **Publish**: **Code** を選択
- **Runtime stack**: **Node 22 LTS** を選択
- **Operating System**: **Linux** を選択
- **Region**: ユーザーに近いリージョンを選択
- **Linux Plan**: 選択したリージョンによってはプランを選択できます。ニーズに合ったものを選んでください。
- **Review + Create** をクリック
- 検証が完了するのを待ち、**Create** をクリック

</StepItem>

<StepItem>

デプロイ完了を待ちます:

- デプロイが完了するまで待機
- 完了したら、「次の手順」セクションの **Go to resource** をクリック

</StepItem>

<StepItem>

デプロイ設定の前に、環境変数を構成します:

- 左サイドバーの **Settings** > **Environment variables** に移動
- 次のような必要な環境変数を追加:
  - モデルプロバイダーの API キー（例: `OPENAI_API_KEY`）
  - データベース接続文字列
  - Mastra アプリケーションに必要なその他の設定値
- **Apply** をクリックして変更を保存

</StepItem>

<StepItem>

GitHub デプロイをセットアップします:

- 左サイドバーの **Deployment Center** に移動
- ソースとして **GitHub** を選択
- まだ Azure と認証していない場合は GitHub にサインイン
- この例ではプロバイダーとして [GitHub Actions](https://docs.github.com/en/actions) を使用します
- 組織、リポジトリ、ブランチを選択
- Azure が GitHub のワークフローファイルを生成し、進む前にプレビューできます
- **Save** をクリック（保存ボタンはページ上部にあります）

</StepItem>

<StepItem>

Azure がワークフローを作成すると、GitHub Actions の実行がトリガーされ、ワークフローファイルがブランチにマージされます。必要な修正がないと失敗するため、**この最初の実行をキャンセル** してください。

:::warning
Azure が生成するデフォルトのワークフローは Mastra アプリケーションでは失敗するため、修正が必要です。
:::

最新の変更をローカルリポジトリにプルし、生成されたワークフローファイル（`.github/workflows/main_<your-app-name>.yml`）を修正します:

1. **ビルドステップを更新**: "npm install, build, and test" という名前のステップを見つけて、以下を実施:
   - ステップ名を "npm install and build" に変更
   - Mastra アプリケーションで適切なテストを設定していない場合、既定のテストスクリプトが失敗してデプロイに支障をきたすため、run セクションから `npm test` コマンドを削除してください。動作するテストがある場合は、テストコマンドを残して構いません。

2. **zip アーティファクトのステップを更新**: "Zip artifact for deployment" ステップを見つけ、zip コマンドを次のものに置き換えます:

   ```yaml
   run: (cd .mastra/output && zip ../../release.zip -r .)
   ```

   これにより、`.mastra/output` のビルド出力のみがデプロイパッケージに含まれるようになります。

</StepItem>

<StepItem>

変更をデプロイします:

- ワークフローの修正をコミットしてプッシュ
- ビルドは Azure ダッシュボードの **Deployment Center** で自動的にトリガーされます
- 完了するまでデプロイの進行状況を監視

</StepItem>

<StepItem>

デプロイ済みアプリケーションにアクセス:

- ビルドが成功したら、アプリケーションの起動まで少し待ちます
- Azure ポータルの **Overview** タブにある既定の URL を使ってデプロイ済みアプリケーションにアクセス
- アプリケーションは `https://<your-app-name>.azurewebsites.net` で利用可能です

</StepItem>

</Steps>

<div id="connect-to-your-mastra-server">
  ## Mastra サーバーに接続する
</div>

`@mastra/client-js` パッケージの `MastraClient` を使うと、クライアントアプリケーションから Mastra サーバーに接続できます。

詳しくは、[`MastraClient` のドキュメント](/reference/client-js/mastra-client)をご覧ください。

```typescript copy showLineNumbers
import { MastraClient } from "@mastra/client-js";

const mastraClient = new MastraClient({
  baseUrl: "https://<your-app-name>.azurewebsites.net",
});
```

:::note
Azure App Services では、一部の料金プランで一時的なファイルシステムが使用されます。
本番環境のアプリケーションでは、`LibSQLStore` のファイル URL のようにローカルファイルシステムに依存する Mastra のストレージプロバイダーは使用しないでください。代わりに、クラウドベースのストレージソリューションの利用を検討してください。
:::


<div id="next-steps">
  ## 次のステップ
</div>

- [Mastra クライアント SDK](/reference/client-js/mastra-client)
- [カスタム ドメインの構成](https://docs.microsoft.com/en-us/azure/app-service/app-service-web-tutorial-custom-domain)
- [HTTPS の有効化](https://docs.microsoft.com/en-us/azure/app-service/configure-ssl-bindings)
- [Azure App Service のドキュメント](https://docs.microsoft.com/en-us/azure/app-service/)