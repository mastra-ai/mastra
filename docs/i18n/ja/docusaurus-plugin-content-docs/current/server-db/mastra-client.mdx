---
title: "Mastra クライアント SDK | サーバー & DB | Mastra ドキュメント"
description: "Mastra クライアント SDK のセットアップ方法と使い方を解説"
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";


<div id="mastra-client-sdk">
  # Mastra Client SDK
</div>

Mastra Client SDK は、クライアント環境から [Mastra Server](/docs/server-db/production-server) とやり取りするための、シンプルで型安全なインターフェースを提供します。

<div id="prerequisites">
  ## 前提条件
</div>

ローカル開発をスムーズに行うため、次をご用意ください:

- Node.js `v18` 以上
- TypeScript `v4.7` 以上（TypeScript を使用する場合）
- ローカルの Mastra サーバーが起動していること（通常はポート `4111`）

<div id="usage">
  ## 使い方
</div>

Mastra Client SDK はブラウザ環境向けに設計されており、Mastra サーバーへの HTTP リクエストにはネイティブの `fetch` API を使用します。

<div id="installation">
  ## インストール
</div>

Mastra Client SDK を使用するには、必要な依存関係をインストールしてください。

<Tabs>
  <TabItem value="npm" label="npm">

    ```bash copy
    npm install @mastra/client-js@latest
    ```

  </TabItem>
  <TabItem value="pnpm" label="pnpm">

    ```bash copy
    pnpm add @mastra/client-js@latest
    ```

  </TabItem>
  <TabItem value="yarn" label="yarn">

    ```bash copy
    yarn add @mastra/client-js@latest
    ```

  </TabItem>
  <TabItem value="bun" label="bun">

    ```bash copy
    bun add @mastra/client-js@latest
    ```

  </TabItem>
</Tabs>

<div id="initialize-the-mastraclient">
  ### `MastraClient` を初期化する
</div>

`baseUrl` を指定して初期化すると、`MastraClient` はエージェント、ツール、ワークフローを呼び出すための型安全なインターフェースを提供します。

```typescript title="lib/mastra-client.ts" showLineNumbers copy
import { MastraClient } from "@mastra/client-js";

export const mastraClient = new MastraClient({
  baseUrl: process.env.MASTRA_API_URL || "http://localhost:4111",
});
```


<div id="core-apis">
  ## コア API
</div>

Mastra Client SDK は、Mastra Server が提供するすべてのリソースを公開します。

- **[Agents](/reference/client-js/agents)**: 応答を生成し、会話をストリーミングします。
- **[Memory](/reference/client-js/memory)**: 会話スレッドとメッセージ履歴を管理します。
- **[Tools](/reference/client-js/tools)**: ツールを実行・管理します。
- **[Workflows](/reference/client-js/workflows)**: ワークフローを起動し、実行状況を追跡します。
- **[Vectors](/reference/client-js/vectors)**: セマンティック検索のためにベクトル埋め込みを活用します。
- **[Logs](/reference/client-js/logs)**: ログを閲覧し、システムの挙動をデバッグします。
- **[Telemetry](/reference/client-js/telemetry)**: アプリのパフォーマンスを監視し、アクティビティをトレースします。

<div id="generating-responses">
  ## 応答の生成
</div>

`role` と `content` を含むメッセージオブジェクトの配列を渡して `.generate()` を呼び出します。

```typescript showLineNumbers copy
import { mastraClient } from "lib/mastra-client";

const testAgent = async () => {
  try {
    const agent = mastraClient.getAgent("testAgent");

    const response = await agent.generate({
      messages: [
        {
          role: "user",
          content: "Hello",
          content: "こんにちは",
      ],
    });

    console.log(response.text);
  } catch (error) {
    return "応答の生成中にエラーが発生しました";
  }
};
```

> 詳細は [.generate()](/reference/client-js/agents#generate-response) を参照してください。


<div id="streaming-responses">
  ## ストリーミング応答
</div>

`role` と `content` を含むメッセージオブジェクトの配列を使ってリアルタイムに応答を得るには、`.stream()` を使用します：

```typescript showLineNumbers copy
import { mastraClient } from "lib/mastra-client";

const testAgent = async () => {
  try {
    const agent = mastraClient.getAgent("testAgent");

    const stream = await agent.stream({
      messages: [
        {
          role: "user",
          content: "こんにちは",
        },
      ],
    });

    stream.processDataStream({
      onTextPart: (text) => {
        console.log(text);
      },
    });
  } catch (error) {
    return "応答の生成中にエラーが発生しました";
  }
};
```

> 詳細は [.stream()](/reference/client-js/agents#stream-response) を参照してください。


<div id="configuration-options">
  ## 設定オプション
</div>

`MastraClient` は、リクエストの動作を制御するために `retries`、`backoffMs`、`headers` などの任意パラメータを受け付けます。これらのパラメータは、リトライの挙動を調整したり、診断用のメタデータを付加するのに役立ちます。

```typescript title="lib/mastra-client.ts" showLineNumbers copy
import { MastraClient } from "@mastra/client-js";

export const mastraClient = new MastraClient({
  // ...
  retries: 3,
  backoffMs: 300,
  maxBackoffMs: 5000,
  headers: {
    "X-Development": "true",
  },
});
```

> 追加の設定オプションについては、[MastraClient](/reference/client-js/mastra-client) を参照してください。


<div id="adding-request-cancelling">
  ## リクエストのキャンセルを追加する
</div>

`MastraClient` は、標準的な Node.js の `AbortSignal` API によるリクエストのキャンセルに対応しています。ユーザーが操作を中止したときや、不要になったネットワーク呼び出しを整理する際など、進行中のリクエストをキャンセルするのに便利です。

すべてのリクエストでキャンセルを有効にするには、クライアントのコンストラクターに `AbortSignal` を渡します。

```typescript {3,7} title="lib/mastra-client.ts" showLineNumbers copy
import { MastraClient } from "@mastra/client-js";

export const controller = new AbortController();

export const mastraClient = new MastraClient({
  baseUrl: process.env.MASTRA_API_URL || "http://localhost:4111",
  abortSignal: controller.signal,
});
```


<div id="using-the-abortcontroller">
  ### `AbortController` の使用
</div>

`.abort()` を呼び出すと、そのシグナルに結び付けられた進行中のリクエストがキャンセルされます。

```typescript {4} showLineNumbers copy
import { mastraClient, controller } from "lib/mastra-client";

const handleAbort = () => {
  controller.abort();
};
```


<div id="client-tools">
  ## クライアントツール
</div>

`createTool()` 関数を使用して、クライアントサイドのアプリケーション内でツールを定義します。`.generate()` や `.stream()` の呼び出し時に、`clientTools` パラメータとして渡します。

これにより、エージェントは DOM 操作、ローカルストレージへのアクセス、その他の Web API といったブラウザ側の機能を呼び出せるようになり、サーバーではなくユーザーの環境でツールを実行できます。

```typescript {27} showLineNumbers copy
import { createTool } from "@mastra/client-js";
import { z } from "zod";

const handleClientTool = async () => {
  try {
    const agent = mastraClient.getAgent("colorAgent");

    const colorChangeTool = createTool({
      id: "color-change-tool",
      description: "HTMLの背景色を変更します",
      inputSchema: z.object({
        color: z.string(),
      }),
      outputSchema: z.object({
        success: z.boolean(),
      }),
      execute: async ({ context }) => {
        const { color } = context;

        document.body.style.backgroundColor = color;
        return { success: true };
      },
    });

    const response = await agent.generate({
      messages: "背景を青に変更して",
      clientTools: { colorChangeTool },
    });

    console.log(response);
  } catch (error) {
    console.error(error);
  }
};
```


<div id="client-tools-agent">
  ### クライアントツールのエージェント
</div>

これは、上で定義したブラウザベースのクライアントツールと連携し、16進数のカラーコードを返すように設定された標準的な Mastra の[エージェント](../agents/overview#setting-up-agents)です。

```typescript title="src/mastra/agents/color-agent" showLineNumbers copy
import { openai } from "@ai-sdk/openai";
import { Agent } from "@mastra/core/agent";

export const colorAgent = new Agent({
  name: "test-agent",
  instructions: `あなたは親切なCSSアシスタントです。
  Webページの背景色を変更できます。
  ユーザーがリクエストした色を16進数カラーコードで返してください`,
  model: openai("gpt-4o-mini"),
});
```


<div id="server-side-environments">
  ## サーバーサイド環境
</div>

`MastraClient` は、API ルート、サーバーレス関数やアクションなどのサーバーサイド環境でも使用できます。基本的な使い方はほぼ同じですが、クライアントに返すレスポンスを再構築する必要が生じる場合があります。

```typescript {8} showLineNumbers
export async function action() {
  const agent = mastraClient.getAgent("testAgent");

  const stream = await agent.stream({
    messages: [{ role: "user", content: "Hello" }],
  });

  return new Response(stream.body);
}
```


<div id="best-practices">
  ## ベストプラクティス
</div>

1. **エラーハンドリング**: 開発環境向けに適切な[エラーハンドリング](/reference/client-js/error-handling)を実装します。
2. **環境変数**: 設定には環境変数を使用します。
3. **デバッグ**: 必要に応じて詳細な[ログ](/reference/client-js/logs)を有効化します。
4. **パフォーマンス**: アプリケーションのパフォーマンス、[テレメトリー](/reference/client-js/telemetry)、トレースを監視します。