---
title: "リファレンス: Lance Vector Store | Vectors | Mastra ドキュメント"
description: "Mastra の LanceVectorStore クラスに関するドキュメント。Lance 列指向フォーマットを採用した組み込み型ベクターデータベースである LanceDB を使用して、ベクター検索を提供します。"
---

<div id="lance-vector-store">
  # Lance Vector Store
</div>

LanceVectorStore クラスは、Lance 列指向フォーマット上に構築された組み込み型ベクターデータベースである [LanceDB](https://lancedb.github.io/lancedb/) を用いたベクトル検索を提供します。ローカル開発から本番環境まで、効率的なストレージと高速な類似検索を実現します。

<div id="factory-method">
  ## ファクトリメソッド
</div>

LanceVectorStore は作成にファクトリーパターンを採用しています。コンストラクタを直接使わず、静的な `create()` メソッドを使用してください。

<PropertiesTable
  content={[
    {
      name: "uri",
      type: "string",
      description: "LanceDB データベースへのパス、またはクラウド環境向けの URI",
    },
    {
      name: "options",
      type: "ConnectionOptions",
      description: "LanceDB の追加の接続オプション",
      isOptional: true,
    },
  ]}
/>

<div id="constructor-examples">
  ## コンストラクターの例
</div>

`LanceVectorStore` インスタンスは、静的な `create` メソッドを使って作成できます。

```ts
import { LanceVectorStore } from "@mastra/lance";

// ローカルデータベースに接続
const vectorStore = await LanceVectorStore.create("/path/to/db");

// LanceDB クラウドデータベースに接続
const cloudStore = await LanceVectorStore.create("db://host:port");

// オプションを指定してクラウドデータベースに接続
const s3Store = await LanceVectorStore.create("s3://bucket/db", {
  storageOptions: { timeout: "60s" },
});
```


<div id="methods">
  ## メソッド
</div>

<div id="createindex">
  ### createIndex()
</div>

<PropertiesTable
  content={[
    {
      name: "tableName",
      type: "string",
      description: "インデックスを作成するテーブル名",
    },
    {
      name: "indexName",
      type: "string",
      description: "作成するインデックス（列）の名前",
    },
    {
      name: "dimension",
      type: "number",
      description: "ベクトルの次元数（使用する埋め込みモデルと一致している必要があります）",
    },
    {
      name: "metric",
      type: "'cosine' | 'euclidean' | 'dotproduct'",
      isOptional: true,
      defaultValue: "cosine",
      description: "類似検索に用いる距離指標",
    },
    {
      name: "indexConfig",
      type: "LanceIndexConfig",
      isOptional: true,
      defaultValue: "{ type: 'hnsw' }",
      description: "インデックスの設定",
    },
  ]}
/>

<div id="lanceindexconfig">
  #### LanceIndexConfig
</div>

<PropertiesTable
  content={[
    {
      name: "type",
      type: "'ivfflat' | 'hnsw'",
      description: "インデックス種別",
      defaultValue: "hnsw",
      properties: [
        {
          type: "string",
          parameters: [
            {
              name: "ivfflat",
              type: "ivfflat",
              description:
                "近似検索のためにベクトルをクラスタ化し、リストに分割します。",
            },
            {
              name: "hnsw",
              type: "hnsw",
              description:
                "高速検索と高い再現率を実現するグラフベースのインデックス。",
            },
          ],
        },
      ],
    },
    {
      name: "numPartitions",
      type: "number",
      isOptional: true,
      defaultValue: "128",
      description: "IVF インデックスのパーティション数",
    },
    {
      name: "numSubVectors",
      type: "number",
      isOptional: true,
      defaultValue: "16",
      description: "積量子化で用いるサブベクトル数",
    },
    {
      name: "hnsw",
      type: "HNSWConfig",
      isOptional: true,
      description: "HNSW の構成",
      properties: [
        {
          type: "object",
          parameters: [
            {
              name: "m",
              type: "number",
              description:
                "ノードあたりの最大接続数（既定値: 16）",
              isOptional: true,
            },
            {
              name: "efConstruction",
              type: "number",
              description: "構築時の探索幅（既定値: 100）",
              isOptional: true,
            },
          ],
        },
      ],
    },
  ]}
/>

<div id="createtable">
  ### createTable()
</div>

<PropertiesTable
  content={[
    {
      name: "tableName",
      type: "string",
      description: "作成するテーブル名",
    },
    {
      name: "data",
      type: "Record<string, unknown>[] | TableLike",
      description: "テーブルの初期データ",
    },
    {
      name: "options",
      type: "Partial<CreateTableOptions>",
      isOptional: true,
      description: "テーブル作成時の追加オプション",
    },
  ]}
/>

<div id="upsert">
  ### upsert()
</div>

<PropertiesTable
  content={[
    {
      name: "tableName",
      type: "string",
      description: "ベクターをアップサートする対象テーブル名",
    },
    {
      name: "vectors",
      type: "number[][]",
      description: "埋め込みベクターの配列",
    },
    {
      name: "metadata",
      type: "Record<string, any>[]",
      isOptional: true,
      description: "各ベクターに対応するメタデータ",
    },
    {
      name: "ids",
      type: "string[]",
      isOptional: true,
      description: "ベクターID（省略時は自動生成）",
    },
  ]}
/>

<div id="query">
  ### query()
</div>

<PropertiesTable
  content={[
    {
      name: "tableName",
      type: "string",
      description: "クエリ対象のテーブル名",
    },
    {
      name: "queryVector",
      type: "number[]",
      description: "クエリ用ベクトル",
    },
    {
      name: "topK",
      type: "number",
      isOptional: true,
      defaultValue: "10",
      description: "返す結果の件数",
    },
    {
      name: "filter",
      type: "Record<string, any>",
      isOptional: true,
      description: "メタデータのフィルター",
    },
    {
      name: "includeVector",
      type: "boolean",
      isOptional: true,
      defaultValue: "false",
      description: "結果にベクトルを含めるかどうか",
    },
    {
      name: "columns",
      type: "string[]",
      isOptional: true,
      defaultValue: "[]",
      description: "結果に含める特定の列",
    },
    {
      name: "includeAllColumns",
      type: "boolean",
      isOptional: true,
      defaultValue: "false",
      description: "結果にすべての列を含めるかどうか",
    },
  ]}
/>

<div id="listtables">
  ### listTables()
</div>

テーブル名の文字列配列を返します。

```typescript copy
const tables = await vectorStore.listTables();
// ['my_vectors', 'embeddings', 'documents']
```


<div id="gettableschema">
  ### getTableSchema()
</div>

<PropertiesTable
  content={[
    {
      name: "tableName",
      type: "string",
      description: "スキーマを取得する対象のテーブル名",
    },
  ]}
/>

指定したテーブルのスキーマを返します。

<div id="deletetable">
  ### deleteTable()
</div>

<PropertiesTable
  content={[
    {
      name: "tableName",
      type: "string",
      description: "削除対象のテーブル名",
    },
  ]}
/>

<div id="deletealltables">
  ### deleteAllTables()
</div>

データベース内のすべてのテーブルを削除します。

<div id="listindexes">
  ### listIndexes()
</div>

インデックス名の文字列配列を返します。

<div id="describeindex">
  ### describeIndex()
</div>

<PropertiesTable
  content={[
{
  name: "indexName",
  type: "string",
  description: "対象のインデックス名",
},
]}
/>

インデックスに関する情報を返します。

```typescript copy
interface IndexStats {
  dimension: number;
  count: number;
  metric: "cosine" | "euclidean" | "dotproduct";
  type: "ivfflat" | "hnsw";
  config: {
    m?: number;
    efConstruction?: number;
    numPartitions?: number;
    numSubVectors?: number;
  };
}
```


<div id="deleteindex">
  ### deleteIndex()
</div>

<PropertiesTable
  content={[
    {
      name: "indexName",
      type: "string",
      description: "削除するインデックス名",
    },
  ]}
/>

<div id="updatevector">
  ### updateVector()
</div>

<PropertiesTable
  content={[
    {
      name: "indexName",
      type: "string",
      description: "ベクトルを含むインデックス名",
    },
    {
      name: "id",
      type: "string",
      description: "更新対象のベクトルID",
    },
    {
      name: "update",
      type: "object",
      description: "更新パラメータ",
      properties: [
        {
          type: "object",
          parameters: [
            {
              name: "vector",
              type: "number[]",
              description: "新しいベクトル値",
              isOptional: true,
            },
            {
              name: "metadata",
              type: "Record<string, any>",
              description: "新しいメタデータ",
              isOptional: true,
            },
          ],
        },
      ],
    },
  ]}
/>

<div id="deletevector">
  ### deleteVector()
</div>

<PropertiesTable
  content={[
    {
      name: "indexName",
      type: "string",
      description: "ベクターを含むインデックス名",
    },
    {
      name: "id",
      type: "string",
      description: "削除するベクターのID",
    },
  ]}
/>

<div id="close">
  ### close()
</div>

データベース接続を閉じる。

<div id="response-types">
  ## レスポンスの種類
</div>

クエリ結果は次の形式で返されます：

```typescript copy
interface QueryResult {
  id: string;
  score: number;
  metadata: Record<string, any>;
  vector?: number[]; // includeVectorがtrueの場合のみ含まれます
  document?: string; // 利用可能な場合はドキュメントテキスト
}
```


<div id="error-handling">
  ## エラー処理
</div>

ストアはキャッチ可能な型付きエラーをスローします。

```typescript copy
try {
  await store.query({
    tableName: "my_vectors",
    queryVector: queryVector,
  });
} catch (error) {
  if (error instanceof Error) {
    console.log(error.message);
  }
}
```


<div id="best-practices">
  ## ベストプラクティス
</div>

- ユースケースに適したインデックス種別を使用する:
  - メモリに余裕がある場合は、より高いリコールと性能のために HNSW を使用
  - 大規模データセットでは、メモリ効率を重視して IVF を使用
- 大規模データセットで最適な性能を得るには、`numPartitions` と `numSubVectors` の値の調整を検討する
- データベースの利用が完了したら、`close()` メソッドで接続を正しく閉じる
- フィルタリングを簡素化するため、メタデータは一貫したスキーマで保存する

<div id="related">
  ## 関連項目
</div>

- [メタデータフィルター](../rag/metadata-filters)