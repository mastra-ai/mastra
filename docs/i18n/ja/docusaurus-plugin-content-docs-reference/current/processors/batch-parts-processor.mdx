---
title: "リファレンス: BatchPartsProcessor | プロセッサ | Mastra ドキュメント"
description: "Mastra の BatchPartsProcessor に関するドキュメント。複数のストリームのパーツをまとめてバッチ化し、エミッション（出力）の頻度を抑えます。"
---

<div id="batchpartsprocessor">
  # BatchPartsProcessor
</div>

`BatchPartsProcessor` は、ストリーミング中の出力回数を減らすために複数のストリームのパートをまとめてバッチ化する **出力プロセッサ** です。小さなテキストチャンクをまとめてユーザー体験を向上させ、ネットワークオーバーヘッドを削減し、クライアントへのパートの送出タイミングを制御することでストリーミングのパフォーマンスを最適化できます。

<div id="usage-example">
  ## 使い方の例
</div>

```typescript copy
import { BatchPartsProcessor } from "@mastra/core/processors";

const processor = new BatchPartsProcessor({
  batchSize: 5,
  maxWaitTime: 100,
  emitOnNonText: true,
});
```


<div id="constructor-parameters">
  ## コンストラクタの引数
</div>

<PropertiesTable
  content={[
    {
      name: "options",
      type: "Options",
      description: "ストリームの一部をバッチ処理するための設定オプション",
      isOptional: true,
    },
  ]}
/>

<div id="options">
  ### オプション
</div>

<PropertiesTable
  content={[
    {
      name: "batchSize",
      type: "number",
      description: "出力前にまとめて処理する要素の数",
      isOptional: true,
      default: "5",
    },
    {
      name: "maxWaitTime",
      type: "number",
      description:
        "バッチを出力するまでの最大待機時間（ミリ秒）。設定されている場合、batchSize に達していなくても現在のバッチを出力します",
      isOptional: true,
      default: "undefined（タイムアウトなし）",
    },
    {
      name: "emitOnNonText",
      type: "boolean",
      description:
        "非テキスト要素に遭遇した場合に即時に出力するかどうか",
      isOptional: true,
      default: "true",
    },
  ]}
/>

<div id="returns">
  ## 戻り値
</div>

<PropertiesTable
  content={[
    {
      name: "name",
      type: "string",
      description: "プロセッサ名が 'batch-parts' に設定されます",
      isOptional: false,
    },
    {
      name: "processOutputStream",
      type: "(args: { part: ChunkType; streamParts: ChunkType[]; state: Record<string, any>; abort: (reason?: string) => never }) => Promise<ChunkType | null>",
      description: "ストリーミング出力のパーツを処理して一括化します",
      isOptional: false,
    },
    {
      name: "flush",
      type: "(state?: BatchPartsState) => ChunkType | null",
      description:
        "ストリーム終了時に残っている一括化済みのパーツを強制的にフラッシュします",
      isOptional: false,
    },
  ]}
/>

<div id="extended-usage-example">
  ## 追加の使用例
</div>

```typescript title="src/mastra/agents/batched-agent.ts" showLineNumbers copy
import { openai } from "@ai-sdk/openai";
import { Agent } from "@mastra/core/agent";
import { BatchPartsProcessor } from "@mastra/core/processors";

export const agent = new Agent({
  name: "batched-agent",
  instructions: "あなたは親切なアシスタントです",
  model: openai("gpt-4o-mini"),
  outputProcessors: [
    new BatchPartsProcessor({
      batchSize: 5,
      maxWaitTime: 100,
      emitOnNonText: true,
    }),
  ],
});
```


<div id="related">
  ## 関連
</div>

- [Output Processors ドキュメント](/docs/agents/guardrails)