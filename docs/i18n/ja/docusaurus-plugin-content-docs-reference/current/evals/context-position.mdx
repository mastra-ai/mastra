---
title: "リファレンス: ContextPositionMetric | Evals | Mastra ドキュメント"
description: Mastra における Context Position Metric のドキュメント。クエリや出力との関連性に基づいて、コンテキストノードの配置順を評価します。
---

<div id="contextpositionmetric">
  # ContextPositionMetric
</div>

:::info Scorers
このドキュメントはレガシーの evals API を参照しています。最新のスコアラー機能については [Scorers](/docs/scorers/overview) をご覧ください。
:::

`ContextPositionMetric` クラスは、クエリおよび出力との関連性に基づいて、コンテキストノードの並び順がどれだけ適切かを評価します。位置に重みを付けたスコアリングを用い、最も関連性の高いコンテキストがシーケンスの前方に現れることの重要性を強調します。

<div id="basic-usage">
  ## 基本の使い方
</div>

```typescript
import { openai } from "@ai-sdk/openai";
import { ContextPositionMetric } from "@mastra/evals/llm";

// 評価用にモデルを設定する
const model = openai("gpt-4o-mini");

const metric = new ContextPositionMetric(model, {
  context: [
    "光合成は、植物が太陽光からエネルギーを作り出すために行う生物学的な過程です。",
    "光合成の過程では、副産物として酸素が生成されます。",
    "植物は成長するために土壌から水分と栄養分を必要とします。",
  ],
});

const result = await metric.measure(
  "光合成とは何ですか？",
  "光合成は、植物が太陽光をエネルギーに変換する過程です。",
);

console.log(result.score); // 位置スコア（0～1）
console.log(result.info.reason); // スコアの説明
```


<div id="constructor-parameters">
  ## コンストラクターのパラメータ
</div>

<PropertiesTable
  content={[
    {
      name: "model",
      type: "ModelConfig",
      description:
        "コンテキスト配置の評価に使用するモデルの設定",
      isOptional: false,
    },
    {
      name: "options",
      type: "ContextPositionMetricOptions",
      description: "メトリクスの設定オプション",
      isOptional: false,
    },
  ]}
/>

<div id="contextpositionmetricoptions">
  ### ContextPositionMetricOptions
</div>

<PropertiesTable
  content={[
    {
      name: "scale",
      type: "number",
      description: "スコアの最大値",
      isOptional: true,
      defaultValue: "1",
    },
    {
      name: "context",
      type: "string[]",
      description: "取得順に並んだコンテキスト片の配列",
      isOptional: false,
    },
  ]}
/>

<div id="measure-parameters">
  ## measure() のパラメータ
</div>

<PropertiesTable
  content={[
    {
      name: "input",
      type: "string",
      description: "元のクエリまたはプロンプト",
      isOptional: false,
    },
    {
      name: "output",
      type: "string",
      description: "評価する生成結果",
      isOptional: false,
    },
  ]}
/>

<div id="returns">
  ## 戻り値
</div>

<PropertiesTable
  content={[
    {
      name: "score",
      type: "number",
      description: "位置スコア（0 〜 scale。標準では 0〜1）",
    },
    {
      name: "info",
      type: "object",
      description: "スコアの理由を含むオブジェクト",
      properties: [
        {
          type: "string",
          parameters: [
            {
              name: "reason",
              type: "string",
              description: "スコアの詳細な説明",
            },
          ],
        },
      ],
    },
  ]}
/>

<div id="scoring-details">
  ## スコアリングの詳細
</div>

この指標は、二値の関連性評価と位置に基づく重み付けを用いて、コンテキストの位置付けを評価します。

<div id="scoring-process">
  ### スコアリングプロセス
</div>

1. コンテキスト適合性を評価:
   - 各要素に二択の判定（yes/no）を付与
   - シーケンス内での位置を記録
   - 適合性の根拠を記録

2. 位置に基づく重み付けを適用:
   - 先頭に近いほど重みを大きくする（weight = 1/(position + 1)）
   - 適合すると判定された要素の重みを合計
   - 到達可能な最大スコアで正規化

最終スコア: `(weighted_sum / max_possible_sum) * scale`

<div id="score-interpretation">
  ### スコアの解釈
</div>

（スケールは0から、デフォルトは0〜1）

- 1.0: 最適 - 最も関連するコンテキストが最初に来る
- 0.7〜0.9: 良好 - 関連するコンテキストが主に早い段階にある
- 0.4〜0.6: ばらつきあり - 関連するコンテキストが散在している
- 0.1〜0.3: やや不十分 - 関連するコンテキストが主に後半にある
- 0.0: 並びが不適切 - 関連するコンテキストが末尾にある、または欠落している

<div id="example-with-analysis">
  ## 例と解説
</div>

```typescript
import { openai } from "@ai-sdk/openai";
import { ContextPositionMetric } from "@mastra/evals/llm";

// 評価用にモデルを設定する
const model = openai("gpt-4o-mini");

const metric = new ContextPositionMetric(model, {
  context: [
    "バランスの取れた食事は健康のために重要です。",
    "運動は心臓を強化し、血液循環を改善します。",
    "定期的な身体活動はストレスや不安を軽減します。",
    "運動器具は高価になり得ます。",
  ],
});

const result = await metric.measure(
  "運動の利点は何ですか？",
  "定期的な運動は心血管の健康とメンタルの健康を向上させます。",
);

// 出力例:
// {
//   score: 0.5,
//   info: {
//     reason: "スコアが0.5である理由は、2番目と3番目のコンテキストは運動の利点に強く関連しているものの、
//           それらがシーケンスの先頭に最適に配置されていないためです。
//           1番目と最後のコンテキストは問いに関連しておらず、
//           そのことが位置重み付きのスコアリングに影響しています。"
//   }
// }
```


<div id="related">
  ## 関連項目
</div>

- [コンテキスト精度メトリクス](./context-precision)
- [回答関連性メトリクス](./answer-relevancy)
- [完全性メトリクス](./completeness)

* [コンテキスト関連性メトリクス](./context-relevancy)