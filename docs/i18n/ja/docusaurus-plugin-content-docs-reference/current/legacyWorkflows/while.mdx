---
title: "リファレンス: Workflow.while() | レガシー ワークフロー | Mastra ドキュメント"
description: "Mastra のワークフローにおける `.while()` メソッドのドキュメント。指定した条件が真であるあいだ、ステップを繰り返します。"
---

<div id="workflowwhile">
  # Workflow.while()
</div>

`.while()` メソッドは、指定した条件が真である間、ステップを繰り返します。これにより、条件が偽になるまで指定したステップを実行し続けるループが作成されます。

<div id="usage">
  ## 使い方
</div>

```typescript
workflow.step(incrementStep).while(condition, incrementStep).then(finalStep);
```


<div id="parameters">
  ## パラメータ
</div>

<PropertiesTable
  content={[
    {
      name: "condition",
      type: "Function | ReferenceCondition",
      description:
        "ループを継続するかどうかを判定する関数または参照条件",
      isOptional: false,
    },
    {
      name: "step",
      type: "Step",
      description: "条件が真の間に繰り返し実行するステップ",
      isOptional: false,
    },
  ]}
/>

<div id="condition-types">
  ## 条件タイプ
</div>

<div id="function-condition">
  ### 関数による条件指定
</div>

真偽値を返す関数を使うことができます。

```typescript
workflow
  .step(incrementStep)
  .while(async ({ context }) => {
    const result = context.getStepResult<{ value: number }>("increment");
    return (result?.value ?? 0) < 10; // 値が10未満のあいだ処理を継続
  }, incrementStep)
  .then(finalStep);
```


<div id="reference-condition">
  ### 参照条件
</div>

比較演算子を使った参照ベースの条件を使用できます。

```typescript
workflow
  .step(incrementStep)
  .while(
    {
      ref: { step: incrementStep, path: "value" },
      query: { $lt: 10 }, // 値が10未満のあいだ処理を続行する
    },
    incrementStep,
  )
  .then(finalStep);
```


<div id="comparison-operators">
  ## 比較演算子
</div>

参照ベースの条件を使用する場合、次の比較演算子を使えます：

| 演算子 | 説明                 | 例            |
| ------ | -------------------- | ------------- |
| `$eq`  | 等しい               | `{ $eq: 10 }` |
| `$ne`  | 等しくない           | `{ $ne: 0 }`  |
| `$gt`  | より大きい           | `{ $gt: 5 }`  |
| `$gte` | 以上                 | `{ $gte: 10 }`|
| `$lt`  | より小さい           | `{ $lt: 20 }` |
| `$lte` | 以下                 | `{ $lte: 15 }`|

<div id="returns">
  ## 戻り値
</div>

<PropertiesTable
  content={[
    {
      name: "workflow",
      type: "LegacyWorkflow",
      description: "チェーン用のワークフローインスタンス",
    },
  ]}
/>

<div id="example">
  ## 例
</div>

```typescript
import { LegacyWorkflow, LegacyStep } from "@mastra/core/workflows/legacy";
import { z } from "zod";

// カウンターを1増やすステップを作成
const incrementStep = new LegacyStep({
  id: "increment",
  description: "カウンターを1増やす",
  outputSchema: z.object({
    value: z.number(),
  }),
  execute: async ({ context }) => {
    // 前回の実行結果から現在値を取得、なければ0から開始
    const currentValue =
      context.getStepResult<{ value: number }>("increment")?.value ||
      context.getStepResult<{ startValue: number }>("trigger")?.startValue ||
      0;

    // 値を1増やす
    const value = currentValue + 1;
    console.log(`${value} に増加中`);

    return { value };
  },
});

// 最終ステップを作成
const finalStep = new LegacyStep({
  id: "final",
  description: "ループ完了後の最終ステップ",
  execute: async ({ context }) => {
    const finalValue = context.getStepResult<{ value: number }>(
      "increment",
    )?.value;
    console.log(`最終値でループが完了しました: ${finalValue}`);
    return { finalValue };
  },
});

// ワークフローを作成
const counterWorkflow = new LegacyWorkflow({
  name: "counter-workflow",
  triggerSchema: z.object({
    startValue: z.number(),
    targetValue: z.number(),
  }),
});

// whileループでワークフローを構成
counterWorkflow
  .step(incrementStep)
  .while(async ({ context }) => {
    const targetValue = context.triggerData.targetValue;
    const currentValue =
      context.getStepResult<{ value: number }>("increment")?.value ?? 0;
    return currentValue < targetValue;
  }, incrementStep)
  .then(finalStep)
  .commit();

// ワークフローを実行
const run = counterWorkflow.createRun();
const result = await run.start({
  triggerData: { startValue: 0, targetValue: 5 },
});
// 0から4までインクリメントし、その後停止してfinalStepを実行
```


<div id="related">
  ## 関連
</div>

- [.until()](./until) - 条件が真になるまでループする
- [制御フローガイド](/docs/workflows-legacy/control-flow)
- [Workflow クラス リファレンス](./workflow)