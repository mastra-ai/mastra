---
title: "リファレンス: SensitiveDataFilter | オブザーバビリティ | Mastra ドキュメント"
description: SensitiveDataFilter プロセッサーの API リファレンス
---

import PropertiesTable from "@site/src/components/PropertiesTable";


<div id="sensitivedatafilter">
  # SensitiveDataFilter
</div>

スパンのフィールドから機密情報を編集（マスキング）する AISpanProcessor。

<div id="constructor">
  ## コンストラクタ
</div>

```typescript
new SensitiveDataFilter(options?: SensitiveDataFilterOptions)
```


<div id="sensitivedatafilteroptions">
  ## SensitiveDataFilterOptions
</div>

```typescript
interface SensitiveDataFilterOptions {
  /**
   * マスキング対象となる機密フィールド名のリスト。
   * マッチングは大文字小文字を区別せず、区切り文字を正規化します
   * (api-key, api_key, Api Key → apikey)。
   * デフォルトには以下が含まれます: password, token, secret, key, apikey, auth,
   * authorization, bearer, bearertoken, jwt, credential,
   * clientsecret, privatekey, refresh, ssn.
   */
  sensitiveFields?: string[];

  /**
   * 完全マスキングに使用されるトークン。
   * デフォルト: "[REDACTED]"
   */
  redactionToken?: string;

  /**
   * 使用するマスキングスタイル:
   * - "full": 常に redactionToken で置き換えます
   * - "partial": 先頭と末尾から3文字を表示し、中間をマスキングします
   * デフォルト: "full"
   */
  redactionStyle?: RedactionStyle;
}
```

<PropertiesTable
  props={[
{
  name: "sensitiveFields",
  type: "string[]",
  description:
    "伏字化するフィールド名（大文字小文字を区別せず、区切り記号の違いを問わない）",
  required: false,
},
{
  name: "redactionToken",
  type: "string",
  description: "完全伏字化時の置換トークン",
  required: false,
},
{
  name: "redactionStyle",
  type: "'full' | 'partial'",
  description: "伏字化スタイル",
  required: false,
},
]}
/>


<div id="redactionstyle">
  ## RedactionStyle
</div>

```typescript
type RedactionStyle = "full" | "partial";
```


<div id="methods">
  ## メソッド
</div>

<div id="process">
  ### プロセス
</div>

```typescript
process(span: AnyAISpan): AnyAISpan
```

span を、attributes、metadata、input、output、errorInfo といった主要フィールド全体にわたって機密データをフィルタリングすることで処理します。

<PropertiesTable
  props={[
{
  name: "span",
  type: "AnyAISpan",
  description: "フィルタリング対象の入力 span",
  required: true,
},
]}
/>

**戻り値:** 機密情報がマスクされた新しい span。


<div id="shutdown">
  ### シャットダウン
</div>

```typescript
async shutdown(): Promise<void>
```

このプロセッサにはクリーンアップは不要です。


<div id="properties">
  ## プロパティ
</div>

```typescript
readonly name = 'sensitive-data-filter';
```


<div id="default-sensitive-fields">
  ## 既定の機密フィールド
</div>

カスタムフィールドが指定されていない場合：

```typescript
[
  "password",
  "token",
  "secret",
  "key",
  "apikey",
  "auth",
  "authorization",
  "bearer",
  "bearertoken",
  "jwt",
  "credential",
  "clientsecret",
  "privatekey",
  "refresh",
  "ssn",
];
```


<div id="processing-behavior">
  ## 処理の挙動
</div>

<div id="field-matching">
  ### フィールドのマッチング
</div>

- **大文字小文字を区別しない**: `APIKey`、`apikey`、`ApiKey` はすべて一致する
- **区切り文字に依存しない**: `api-key`、`api_key`、`apiKey` は同一として扱われる
- **完全一致**: 正規化後、フィールドは完全に一致している必要がある
  - `token` は `token`、`Token`、`TOKEN` に一致する
  - `token` は `promptTokens` や `tokenCount` には一致しない

<div id="redaction-styles">
  ### マスキングスタイル
</div>

<div id="full-redaction-default">
  #### 全面マスキング（デフォルト）
</div>

一致したすべての値は redactionToken に置き換えられます。

<div id="partial-redaction">
  #### 部分マスキング
</div>

- 先頭3文字と末尾3文字を表示
- 値が6文字以下の場合は全てマスキング
- 文字列以外の値は、部分マスキングの前に文字列に変換

<div id="error-handling">
  ### エラー処理
</div>

フィールドのフィルタリングに失敗した場合、フィールドは次の値に置き換えられます：

```typescript
{
  error: {
    processor: "sensitive-data-filter";
  }
}
```


<div id="processed-fields">
  ### 処理対象フィールド
</div>

このフィルターは再帰的に処理します:

- `span.attributes` - Spanのメタデータとプロパティ
- `span.metadata` - カスタムメタデータ
- `span.input` - 入力データ
- `span.output` - 出力データ
- `span.errorInfo` - エラー情報

ネストされたオブジェクト、配列、循環参照も安全に処理します。