---
title: "リファレンス: CloudExporter | オブザーバビリティ | Mastra ドキュメント"
description: CloudExporter のAPIリファレンス
---

import PropertiesTable from "@site/src/components/PropertiesTable";


<div id="cloudexporter">
  # CloudExporter
</div>

トレースを Mastra Cloud に送信し、オンラインでの可視化と監視を可能にします。

<div id="constructor">
  ## コンストラクタ
</div>

```typescript
new CloudExporter(config?: CloudExporterConfig)
```

<PropertiesTable
  props={[
{
  name: "config",
  type: "CloudExporterConfig",
  description: "設定オプション",
  required: false,
},
]}
/>


<div id="cloudexporterconfig">
  ## CloudExporterConfig
</div>

```typescript
interface CloudExporterConfig {
  /** バッチあたりの最大スパン数。デフォルト: 1000 */
  maxBatchSize?: number;

  /** フラッシュ前の最大待機時間(ミリ秒)。デフォルト: 5000 */
  maxBatchWaitMs?: number;

  /** 最大再試行回数。デフォルト: 3 */
  maxRetries?: number;

  /** クラウドアクセストークン(環境変数または設定ファイルから取得) */
  accessToken?: string;

  /** クラウドAIトレーシングエンドポイント */
  endpoint?: string;

  /** オプションのロガー */
  logger?: IMastraLogger;
}
```


<div id="environment-variables">
  ## 環境変数
</div>

エクスポーターは、設定で指定されていない場合、次の環境変数を読み込みます:

- `MASTRA_CLOUD_ACCESS_TOKEN` - 認証用アクセストークン
- `MASTRA_CLOUD_AI_TRACES_ENDPOINT` - カスタムエンドポイント（既定: `https://api.mastra.ai/ai/spans/publish`）

<div id="properties">
  ## プロパティ
</div>

```typescript
readonly name = 'mastra-cloud-ai-tracing-exporter';
```


<div id="methods">
  ## 方法
</div>

<div id="exportevent">
  ### exportEvent
</div>

```typescript
async exportEvent(event: AITracingEvent): Promise<void>
```

トレーシングイベントを処理します。Cloud には SPAN&#95;ENDED イベントのみをエクスポートします。

<PropertiesTable
  props={[
{
  name: "event",
  type: "AITracingEvent",
  description: "エクスポートするトレーシングイベント",
  required: true,
},
]}
/>


<div id="shutdown">
  ### シャットダウン
</div>

```typescript
async shutdown(): Promise<void>
```

残りのイベントをフラッシュして、クリーンアップを実行します。


<div id="behavior">
  ## 挙動
</div>

<div id="authentication">
  ### 認証
</div>

設定または環境変数でアクセストークンが提供されない場合、エクスポーターは次の動作を行います:

- サインアップ方法に関する情報付きの警告をログに記録する
- no-op として動作する（すべてのイベントを破棄する）

<div id="batching">
  ### バッチ処理
</div>

エクスポーターはネットワークを効率的に利用するため、スパンをバッチ化します:

- バッチサイズが `maxBatchSize` に達するとフラッシュします
- バッチ内の最初のスパンから `maxBatchWaitMs` が経過するとフラッシュします
- `shutdown()` 時にフラッシュします

<div id="error-handling">
  ### エラー処理
</div>

- `maxRetries` 回の試行まで指数バックオフでリトライ
- すべてのリトライに失敗した場合、バッチを破棄
- エラーを記録しつつ、新規イベントの処理は継続

<div id="event-processing">
  ### イベント処理
</div>

- `SPAN_ENDED` イベントのみを処理
- `SPAN_STARTED` および `SPAN_UPDATED` イベントは無視
- スパンを MastraCloudSpanRecord 形式に整形

<div id="mastracloudspanrecord">
  ## MastraCloudSpanRecord
</div>

クラウドスパンの内部フォーマット:

```typescript
interface MastraCloudSpanRecord {
  traceId: string;
  spanId: string;
  parentSpanId: string | null;
  name: string;
  spanType: string;
  attributes: Record<string, any> | null;
  metadata: Record<string, any> | null;
  startedAt: Date;
  endedAt: Date | null;
  input: any;
  output: any;
  error: any;
  isEvent: boolean;
  createdAt: Date;
  updatedAt: Date | null;
}
```


<div id="usage">
  ## 使い方
</div>

```typescript
import { CloudExporter } from "@mastra/core/ai-tracing";

// トークンには環境変数を使用
const exporter = new CloudExporter();

// 明示的な構成
const customExporter = new CloudExporter({
  accessToken: "your-token",
  maxBatchSize: 500,
  maxBatchWaitMs: 2000,
});
```


<div id="see-also">
  ## 関連情報
</div>

<div id="documentation">
  ### ドキュメント
</div>

- [AI Tracing 概要](/docs/observability/ai-tracing/overview) - 総合ガイド
- [エクスポーター](/docs/observability/ai-tracing/overview#exporters) - エクスポーターの概念

<div id="other-exporters">
  ### その他のエクスポーター
</div>

- [DefaultExporter](/reference/observability/ai-tracing/exporters/default-exporter) - ストレージへの永続化
- [ConsoleExporter](/reference/observability/ai-tracing/exporters/console-exporter) - デバッグ出力
- [Langfuse](/reference/observability/ai-tracing/exporters/langfuse) - Langfuse との連携
- [Braintrust](/reference/observability/ai-tracing/exporters/braintrust) - Braintrust との連携

<div id="reference">
  ### 参考資料
</div>

- [Configuration](/reference/observability/ai-tracing/configuration) - 設定項目
- [Interfaces](/reference/observability/ai-tracing/interfaces) - インターフェース定義