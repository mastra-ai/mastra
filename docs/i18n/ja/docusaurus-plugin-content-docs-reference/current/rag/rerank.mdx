---
title: "リファレンス: rerank() | RAG | Mastra ドキュメント"
description: Mastra の rerank 関数に関するドキュメント。ベクトル検索結果に対する高度な再ランク付け機能を提供します。
---

<div id="rerank">
  # rerank()
</div>

`rerank()` 関数は、セマンティック関連性、ベクトル類似度、位置ベースのスコアリングを組み合わせて、ベクトル検索結果を高度に再ランキングします。

```typescript
function rerank(
  results: QueryResult[],
  query: string,
  modelConfig: ModelConfig,
  options?: RerankerFunctionOptions,
): Promise<RerankResult[]>;
```


<div id="usage-example">
  ## 使い方の例
</div>

```typescript
import { openai } from "@ai-sdk/openai";
import { rerank } from "@mastra/rag";

const model = openai("gpt-4o-mini");

const rerankedResults = await rerank(
  vectorSearchResults,
  "本番環境にはどうやってデプロイすればよいですか？",
  model,
  {
    weights: {
      semantic: 0.5,
      vector: 0.3,
      position: 0.2,
    },
    topK: 3,
  },
);
```


<div id="parameters">
  ## パラメータ
</div>

<PropertiesTable
  content={[
    {
      name: "results",
      type: "QueryResult[]",
      description: "再ランク付けするベクター検索結果",
      isOptional: false,
    },
    {
      name: "query",
      type: "string",
      description: "関連性の評価に用いる検索クエリのテキスト",
      isOptional: false,
    },
    {
      name: "model",
      type: "MastraLanguageModel",
      description: "再ランク付けに使用する言語モデル",
      isOptional: false,
    },
    {
      name: "options",
      type: "RerankerFunctionOptions",
      description: "再ランク付けモデルのオプション",
      isOptional: true,
    },
  ]}
/>

rerank 関数は Vercel AI SDK の任意の LanguageModel を受け付けます。Cohere の `rerank-v3.5` モデルを使用する場合は、Cohere の再ランク付け機能が自動的に利用されます。

> 注: 再ランク付け時にセマンティックスコアリングを正しく機能させるには、各結果の `metadata.text` フィールドにテキストコンテンツを含める必要があります。

<div id="rerankerfunctionoptions">
  ### RerankerFunctionOptions
</div>

<PropertiesTable
  content={[
    {
      name: "weights",
      type: "WeightConfig",
      description:
        "各スコアリング要素の重み（合計が 1 になる必要があります）",
      isOptional: true,
      properties: [
        {
          type: "number",
          parameters: [
            {
              name: "semantic",
              description: "セマンティック関連度の重み",
              isOptional: true,
              type: "number（デフォルト: 0.4）",
            },
          ],
        },
        {
          type: "number",
          parameters: [
            {
              name: "vector",
              description: "ベクトル類似度の重み",
              isOptional: true,
              type: "number（デフォルト: 0.4）",
            },
          ],
        },
        {
          type: "number",
          parameters: [
            {
              name: "position",
              description: "位置に基づくスコアの重み",
              isOptional: true,
              type: "number（デフォルト: 0.2）",
            },
          ],
        },
      ],
    },
    {
      name: "queryEmbedding",
      type: "number[]",
      description: "クエリの埋め込みベクトル",
      isOptional: true,
    },
    {
      name: "topK",
      type: "number",
      description: "返す上位結果数",
      isOptional: true,
      defaultValue: "3",
    },
  ]}
/>

<div id="returns">
  ## 返り値
</div>

この関数は `RerankResult` オブジェクトの配列を返します:

<PropertiesTable
  content={[
    {
      name: "result",
      type: "QueryResult",
      description: "元のクエリ結果",
    },
    {
      name: "score",
      type: "number",
      description: "再ランク付けの総合スコア（0〜1）",
    },
    {
      name: "details",
      type: "ScoringDetails",
      description: "スコアリングの詳細情報",
    },
  ]}
/>

<div id="scoringdetails">
  ### ScoringDetails
</div>

<PropertiesTable
  content={[
    {
      name: "semantic",
      type: "number",
      description: "セマンティック関連度スコア（0～1）",
    },
    {
      name: "vector",
      type: "number",
      description: "ベクトル類似度スコア（0～1）",
    },
    {
      name: "position",
      type: "number",
      description: "位置に基づくスコア（0～1）",
    },
    {
      name: "queryAnalysis",
      type: "object",
      description: "クエリ分析の詳細",
      isOptional: true,
      properties: [
        {
          type: "number",
          parameters: [
            {
              name: "magnitude",
              description: "クエリのマグニチュード",
            },
          ],
        },
        {
          type: "number[]",
          parameters: [
            {
              name: "dominantFeatures",
              description: "クエリの主要特徴",
            },
          ],
        },
      ],
    },
  ]}
/>

<div id="related">
  ## 関連項目
</div>

- [createVectorQueryTool](../tools/vector-query-tool)