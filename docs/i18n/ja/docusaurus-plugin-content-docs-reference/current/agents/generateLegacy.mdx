---
title: "リファレンス: Agent.generateLegacy()（レガシー） | Agents | Mastra ドキュメント"
description: "Mastra のエージェントにおける旧式の `Agent.generateLegacy()` メソッドのドキュメント。 このメソッドは非推奨で、今後のバージョンで削除されます。"
---

# Agent.generateLegacy()（レガシー）

:::warning

**非推奨**: このメソッドは非推奨で、V1 モデルでのみ動作します。V2 モデルでは新しい[`.generate()`](./generate)メソッドを使用してください。アップグレードの詳細は[移行ガイド](../../guides/migrations/vnext-to-standard-apis)を参照してください。

:::

`.generateLegacy()` メソッドは、エージェント生成 API のレガシー版で、V1 モデルのエージェントとやり取りしてテキストまたは構造化応答を生成するために使用されます。このメソッドはメッセージと任意の生成オプションを受け付けます。

## 使用例

```typescript copy
await agent.generateLegacy("エージェント用メッセージ");
```


## パラメータ

<PropertiesTable
  content={[
    {
      name: "messages",
      type: "string | string[] | CoreMessage[] | AiMessageType[] | UIMessageWithMetadata[]",
      description:
        "エージェントに送信するメッセージ。単一の文字列、文字列配列、またはマルチモーダルコンテンツ（テキスト、画像など）を含む構造化メッセージオブジェクトを指定できます。",
    },
    {
      name: "options",
      type: "AgentGenerateOptions",
      isOptional: true,
      description: "生成処理に関する任意の設定。",
    },
  ]}
/>

### オプションのパラメータ

<PropertiesTable
  content={[
  {
    name: "abortSignal",
    type: "AbortSignal",
    isOptional: true,
    description:
      "エージェントの実行を中止できるSignalオブジェクト。シグナルが中止されると、進行中のすべての操作が終了します。"
  },
  {
    name: "context",
    type: "CoreMessage[]",
    isOptional: true,
    description: "エージェントに提供する追加のコンテキストメッセージ。"
  },
  {
    name: "structuredOutput",
    type: "StructuredOutputOptions<S extends ZodTypeAny = ZodTypeAny>",
    isOptional: true,
    description:
      "より良い開発者体験で構造化出力生成を有効にします。内部的にStructuredOutputProcessorを自動的に作成して使用します。",
    properties: [
      {
        parameters: [
          {
            name: "schema",
            type: "z.ZodSchema<S>",
            isOptional: false,
            description: "出力を検証するためのZodスキーマ。"
          }
        ]
      },
      {
        parameters: [
          {
            name: "model",
            type: "MastraLanguageModel",
            isOptional: false,
            description: "内部構造化エージェントで使用するモデル。"
          }
        ]
      },
      {
        parameters: [
          {
            name: "errorStrategy",
            type: "'strict' | 'warn' | 'fallback'",
            isOptional: true,
            description:
              "パースまたは検証が失敗した場合の戦略。デフォルトは'strict'です。"
          }
        ]
      },
      {
        parameters: [
          {
            name: "fallbackValue",
            type: "<S extends ZodTypeAny>",
            isOptional: true,
            description: "errorStrategyが'fallback'の場合のフォールバック値。"
          }
        ]
      },
      {
        parameters: [
          {
            name: "instructions",
            type: "string",
            isOptional: true,
            description: "構造化エージェントへのカスタム指示。"
          }
        ]
      }
    ]
  },
  {
    name: "outputProcessors",
    type: "Processor[]",
    isOptional: true,
    description:
      "エージェントに設定された出力プロセッサーを上書きします。エージェントからのメッセージをユーザーに返す前に変更または検証できる出力プロセッサー。`processOutputResult`および`processOutputStream`関数のいずれか(または両方)を実装する必要があります。"
  },
  {
    name: "inputProcessors",
    type: "Processor[]",
    isOptional: true,
    description:
      "エージェントに設定された入力プロセッサーを上書きします。エージェントで処理される前にメッセージを変更または検証できる入力プロセッサー。`processInput`関数を実装する必要があります。"
  },
  {
    name: "experimental_output",
    type: "Zod schema | JsonSchema7",
    isOptional: true,
    description:
      "注意:`structuredOutput`プロパティの使用が推奨されます。テキスト生成とツール呼び出しと並行して構造化出力生成を有効にします。モデルは提供されたスキーマに準拠した応答を生成します。"
  },
  {
    name: "instructions",
    type: "string",
    isOptional: true,
    description:
      "この特定の生成に対してエージェントのデフォルト指示を上書きするカスタム指示。新しいエージェントインスタンスを作成せずにエージェントの動作を動的に変更するのに便利です。"
  },
  {
    name: "output",
    type: "Zod schema | JsonSchema7",
    isOptional: true,
    description:
      "出力の期待される構造を定義します。JSONスキーマオブジェクトまたはZodスキーマを指定できます。"
  },
  {
    name: "memory",
    type: "object",
    isOptional: true,
    description:
      "メモリの設定。これがメモリを管理するための推奨方法です。",
    properties: [
      {
        parameters: [
          {
            name: "thread",
            type: "string | { id: string; metadata?: Record<string, any>, title?: string }",
            isOptional: false,
            description:
              "会話スレッド。文字列IDまたは`id`とオプションの`metadata`を持つオブジェクトとして指定します。"
          }
        ]
      },
      {
        parameters: [
          {
            name: "resource",
            type: "string",
            isOptional: false,
            description:
              "スレッドに関連付けられたユーザーまたはリソースの識別子。"
          }
        ]
      },
      {
        parameters: [
          {
            name: "options",
            type: "MemoryConfig",
            isOptional: true,
            description:
              "メッセージ履歴やセマンティックリコールなど、メモリ動作の設定。以下の`MemoryConfig`を参照してください。"
          }
        ]
      }
    ]
  },
  {
    name: "maxSteps",
    type: "number",
    isOptional: true,
    defaultValue: "5",
    description: "許可される実行ステップの最大数。"
  },
  {
    name: "maxRetries",
    type: "number",
    isOptional: true,
    defaultValue: "2",
    description: "最大リトライ回数。リトライを無効にするには0に設定します。"
  },
  {
    name: "onStepFinish",
    type: "GenerateTextOnStepFinishCallback<any> | never",
    isOptional: true,
    description:
      "各実行ステップ後に呼び出されるコールバック関数。ステップの詳細をJSON文字列として受け取ります。構造化出力では使用できません。"
  },
  {
    name: "runId",
    type: "string",
    isOptional: true,
    description:
      "この生成実行の一意のID。追跡とデバッグの目的に役立ちます。"
  },
  {
    name: "telemetry",
    type: "TelemetrySettings",
    isOptional: true,
    description: "生成中のテレメトリ収集の設定。",
    properties: [
      {
        parameters: [
          {
            name: "isEnabled",
            type: "boolean",
            isOptional: true,
            description:
              "テレメトリを有効または無効にします。実験的機能のため、デフォルトでは無効です。"
          }
        ]
      },
      {
        parameters: [
          {
            name: "recordInputs",
            type: "boolean",
            isOptional: true,
            description:
              "入力記録を有効または無効にします。デフォルトでは有効です。機密情報の記録を避けるために入力記録を無効にすることができます。"
          }
        ]
      },
      {
        parameters: [
          {
            name: "recordOutputs",
            type: "boolean",
            isOptional: true,
            description:
              "出力記録を有効または無効にします。デフォルトでは有効です。機密情報の記録を避けるために出力記録を無効にすることができます。"
          }
        ]
      },
      {
        parameters: [
          {
            name: "functionId",
            type: "string",
            isOptional: true,
            description:
              "この関数の識別子。関数ごとにテレメトリデータをグループ化するために使用されます。"
          }
        ]
      }
    ]
  },
  {
    name: "temperature",
    type: "number",
    isOptional: true,
    description:
      "モデルの出力のランダム性を制御します。高い値(例:0.8)は出力をよりランダムにし、低い値(例:0.2)はより集中的で決定論的にします。"
  },
  {
    name: "toolChoice",
    type: "'auto' | 'none' | 'required' | { type: 'tool'; toolName: string }",
    isOptional: true,
    defaultValue: "'auto'",
    description: "生成中にエージェントがツールを使用する方法を制御します。",
    properties: [
      {
        parameters: [
          {
            name: "'auto'",
            type: "string",
            description: "モデルにツールを使用するかどうかを決定させます(デフォルト)。"
          }
        ]
      },
      {
        parameters: [
          {
            name: "'none'",
            type: "string",
            description: "ツールを使用しません。"
          }
        ]
      },
      {
        parameters: [
          {
            name: "'required'",
            type: "string",
            description: "モデルに少なくとも1つのツールを使用することを要求します。"
          }
        ]
      },
      {
        parameters: [
          {
            name: "{ type: 'tool'; toolName: string }",
            type: "object",
            description: "モデルに名前で特定のツールを使用することを要求します。"
          }
        ]
      }
    ]
  },
  {
    name: "toolsets",
    type: "ToolsetsInput",
    isOptional: true,
    description:
      "生成中にエージェントが使用できる追加のツールセット。"
  },
  {
    name: "clientTools",
    type: "ToolsInput",
    isOptional: true,
    description:
      "リクエストの'クライアント'側で実行されるツール。これらのツールは定義に実行関数を持ちません。"
  },
  {
    name: "savePerStep",
    type: "boolean",
    isOptional: true,
    description:
      "各ストリームステップが完了した後にメッセージを段階的に保存します(デフォルト:false)。"
  },
  {
    name: "providerOptions",
    type: "Record<string, Record<string, JSONValue>>",
    isOptional: true,
    description:
      "基盤となるLLMプロバイダーに渡される追加のプロバイダー固有のオプション。構造は`{ providerName: { optionKey: value } }`です。MastraはAI SDKを拡張しているため、完全なプロバイダーオプションについては[AI SDKドキュメント](https://sdk.vercel.ai/docs/providers/ai-sdk-providers)を参照してください。",
    properties: [
      {
        parameters: [
          {
            name: "openai",
            type: "Record<string, JSONValue>",
            isOptional: true,
            description:
              "OpenAI固有のオプション。例:`{ reasoningEffort: 'high' }`"
          }
        ]
      },
      {
        parameters: [
          {
            name: "anthropic",
            type: "Record<string, JSONValue>",
            isOptional: true,
            description:
              "Anthropic固有のオプション。例: `{ maxTokens: 1000 }`"
          }
        ]
      },
      {
        parameters: [
          {
            name: "google",
            type: "Record<string, JSONValue>",
            isOptional: true,
            description:
              "Google固有のオプション。例: `{ safetySettings: [...] }`"
          }
        ]
      },
      {
        parameters: [
          {
            name: "[providerName]",
            type: "Record<string, JSONValue>",
            isOptional: true,
            description:
              "その他のプロバイダー固有のオプション。キーはプロバイダー名、値はプロバイダー固有のオプションのレコードです。"
          }
        ]
      }
    ]
  },
  {
    name: "runtimeContext",
    type: "RuntimeContext",
    isOptional: true,
    description:
      "依存性注入とコンテキスト情報のためのランタイムコンテキスト。"
  },
  {
    name: "maxTokens",
    type: "number",
    isOptional: true,
    description: "生成するトークンの最大数。"
  },
  {
    name: "topP",
    type: "number",
    isOptional: true,
    description:
      "ニュークリアスサンプリング。0から1の間の数値です。`temperature`または`topP`のいずれかを設定することを推奨しますが、両方を設定しないでください。"
  },
  {
    name: "topK",
    type: "number",
    isOptional: true,
    description:
      "後続の各トークンについて、上位K個のオプションからのみサンプリングします。低確率の「ロングテール」応答を除去するために使用されます。"
  },
  {
    name: "presencePenalty",
    type: "number",
    isOptional: true,
    description:
      "プレゼンスペナルティ設定。プロンプトに既に存在する情報をモデルが繰り返す可能性に影響します。-1(繰り返しを増加)から1(最大ペナルティ、繰り返しを減少)の間の数値です。"
  },
  {
    name: "frequencyPenalty",
    type: "number",
    isOptional: true,
    description:
      "頻度ペナルティ設定。モデルが同じ単語やフレーズを繰り返し使用する可能性に影響します。-1(繰り返しを増加)から1(最大ペナルティ、繰り返しを減少)の間の数値です。"
  },
  {
    name: "stopSequences",
    type: "string[]",
    isOptional: true,
    description:
      "停止シーケンス。設定されている場合、いずれかの停止シーケンスが生成されるとモデルはテキストの生成を停止します。"
  },
  {
    name: "seed",
    type: "number",
    isOptional: true,
    description:
      "ランダムサンプリングに使用するシード(整数)。設定されていてモデルがサポートしている場合、呼び出しは決定論的な結果を生成します。"
  },
  {
    name: "headers",
    type: "Record<string, string | undefined>",
    isOptional: true,
    description:
      "リクエストと共に送信される追加のHTTPヘッダー。HTTPベースのプロバイダーにのみ適用されます。"
  }
]}
/>

## 戻り値

<PropertiesTable
  content={[
    {
      name: "text",
      type: "string",
      isOptional: true,
      description:
        "生成されたテキスト応答。出力が「text」（スキーマ未指定）の場合に返されます。",
    },
    {
      name: "object",
      type: "object",
      isOptional: true,
      description:
        "生成された構造化応答。`output`、`structuredOutput`、または `experimental_output` でスキーマが指定された場合に返されます。",
    },
    {
      name: "toolCalls",
      type: "Array<ToolCall>",
      isOptional: true,
      description:
        "生成処理中に行われたツール呼び出し。テキスト/オブジェクトのいずれのモードでも含まれます。",
      properties: [
        {
          parameters: [
            {
              name: "toolName",
              type: "string",
              required: true,
              description: "呼び出されたツール名。",
            },
          ],
        },
        {
          parameters: [
            {
              name: "args",
              type: "any",
              required: true,
              description: "ツールに渡された引数。",
            },
          ],
        },
      ],
    },
  ]}
/>

## 新しい API への移行

:::info

新しい `.generate()` メソッドは、AI SDK v5 への対応、構造化出力のより適切な取り扱い、ストリーミングサポートの強化など、機能が向上しています。詳しい移行手順は[移行ガイド](../../guides/migrations/vnext-to-standard-apis)をご覧ください。

:::

### クイック移行の例

#### 旧バージョン（レガシー）

```typescript
const result = await agent.generateLegacy("message", {
  temperature: 0.7,
  maxSteps: 3,
});
```


#### 変更後（新しい API）

```typescript
const result = await agent.generate("message", {
  modelSettings: {
    temperature: 0.7,
  },
  maxSteps: 3,
});
```


## 拡張使用例

```typescript showLineNumbers copy
import { z } from "zod";
import {
  ModerationProcessor,
  TokenLimiterProcessor,
} from "@mastra/core/processors";

await agent.generateLegacy(
  [
    { role: "user", content: "エージェントへのメッセージ" },
    {
      role: "user",
      content: [
        {
          type: "text",
          text: "エージェントへのメッセージ",
        },
        {
          type: "image",
          imageUrl: "https://example.com/image.jpg",
          mimeType: "image/jpeg",
        },
      ],
    },
  ],
  {
    temperature: 0.7,
    maxSteps: 3,
    memory: {
      thread: "user-123",
      resource: "test-app",
    },
    toolChoice: "auto",
    providerOptions: {
      openai: {
        reasoningEffort: "high",
      },
    },
    // 構造化出力(開発者体験の向上)
    structuredOutput: {
      schema: z.object({
        sentiment: z.enum(["positive", "negative", "neutral"]),
        confidence: z.number(),
      }),
      model: openai("gpt-4o-mini"),
      errorStrategy: "warn",
    },
    // レスポンス検証用の出力プロセッサー
    outputProcessors: [
      new ModerationProcessor({ model: openai("gpt-4.1-nano") }),
      new TokenLimiterProcessor({ maxTokens: 1000 }),
    ],
  },
);
```


## 関連

- [移行ガイド](../../guides/migrations/vnext-to-standard-apis)
- [新しい .generate() メソッド](./generate)
- [応答の生成](/docs/agents/overview#generating-responses)
- [ストリーミング応答](/docs/agents/overview#generating-responses)