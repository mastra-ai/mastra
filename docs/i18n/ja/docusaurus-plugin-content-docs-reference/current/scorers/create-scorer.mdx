---
title: "リファレンス: createScorer | Scorers | Mastra ドキュメント"
description: Mastra でカスタムスコアラーを作成するためのドキュメント。JavaScript 関数または LLM ベースのプロンプトを用いて、独自の評価ロジックを定義できます。
---

# createScorer

Mastra には、入出力ペアの評価に使うカスタムスコアラーを定義できる統一的な `createScorer` ファクトリがあります。各評価ステップでは、ネイティブな JavaScript 関数または LLM ベースのプロンプトオブジェクトのどちらも使用できます。カスタムスコアラーは、Agent や Workflow のステップに追加できます。

## カスタムスコアラーの作成方法

`createScorer` ファクトリを使用して、名前、説明、任意のジャッジ設定を指定し、スコアラーを定義します。次に、ステップメソッドをチェーンして評価パイプラインを構築します。少なくとも `generateScore` ステップは必須です。

```typescript
const scorer = createScorer({
  name: "My Custom Scorer",
  description: "カスタム条件に基づいてレスポンスを評価します",
  type: "agent", // オプション: 自動型付けを使用したエージェント評価用
  judge: {
    model: myModel,
    instructions: "あなたは評価の専門家です...",
  },
})
  .preprocess({
    /* step config */
  })
  .analyze({
    /* step config */
  })
  .generateScore(({ run, results }) => {
    // 数値を返します
  })
  .generateReason({
    /* step config */
  });
```


## createScorer のオプション

<PropertiesTable
  content={[
    {
      name: "name",
      type: "string",
      required: true,
      description: "スコアラーの名称。",
    },
    {
      name: "description",
      type: "string",
      required: true,
      description: "スコアラーの機能の説明。",
    },
    {
      name: "judge",
      type: "object",
      required: false,
      description:
        "LLM ベースのステップ向けの任意設定の Judge 構成。以下の Judge Object セクションを参照してください。",
    },
    {
      name: "type",
      type: "string",
      required: false,
      description:
        "入出力の型指定。自動エージェント型には 'agent' を使用します。カスタム型の場合はジェネリック手法を使用してください。",
    },
  ]}
/>

この関数は、ステップメソッドをチェーンできるスコアラーのビルダーを返します。`.run()` メソッドとその入出力の詳細は、[MastraScorer リファレンス](./mastra-scorer)を参照してください。

## Judge オブジェクト

<PropertiesTable
  content={[
    {
      name: "model",
      type: "LanguageModel",
      required: true,
      description: "評価に使用する LLM のモデルインスタンス。",
    },
    {
      name: "instructions",
      type: "string",
      required: true,
      description: "LLM 用のシステムプロンプト／指示。",
    },
  ]}
/>

## 型安全性

スコアラーを作成する際に入出力の型を指定すると、型推論や IntelliSense のサポートが向上します：

### エージェントタイプのショートカット

エージェントを評価する際は、`type: 'agent'` を使用すると、エージェントの入出力に対して適切な型が自動的に適用されます:

```typescript
import { createScorer } from "@mastra/core/scorers";

// 自動型付けされるエージェントスコアラー
const agentScorer = createScorer({
  name: "エージェント応答品質",
  description: "エージェントの応答を評価します",
  type: "agent", // ScorerRunInputForAgent/ScorerRunOutputForAgentが自動的に提供されます
})
  .preprocess(({ run }) => {
    // run.inputはScorerRunInputForAgentとして自動的に型付けされます
    const userMessage = run.input.inputMessages[0]?.content;
    return { userMessage };
  })
  .generateScore(({ run, results }) => {
    // run.outputはScorerRunOutputForAgentとして自動的に型付けされます
    const response = run.output[0]?.content;
    return response.length > 10 ? 1.0 : 0.5;
  });
```


### ジェネリクスを用いたカスタム型

カスタムの入出力型には、ジェネリクスを使う方法を採用します。

```typescript
import { createScorer } from "@mastra/core/scorers";

type CustomInput = { query: string; context: string[] };
type CustomOutput = { answer: string; confidence: number };

const customScorer = createScorer<CustomInput, CustomOutput>({
  name: "カスタムスコアラー",
  description: "カスタムデータを評価",
}).generateScore(({ run }) => {
  // run.input は CustomInput 型
  // run.output は CustomOutput 型
  return run.output.confidence;
});
```


### ビルトインのエージェント型

- **`ScorerRunInputForAgent`** - エージェント評価用の `inputMessages`、`rememberedMessages`、`systemMessages`、`taggedSystemMessages` を含む
- **`ScorerRunOutputForAgent`** - エージェントの応答メッセージの配列

これらの型を使うと、オートコンプリート、コンパイル時検証、およびスコアリングロジックのドキュメント化が向上します。

## エージェントタイプによるトレース採点

`type: 'agent'` を使用すると、スコアラーはエージェントへの直接追加と、エージェントのやり取りから得られたトレースの採点の両方に対応します。スコアラーはトレースデータを自動的に、適切なエージェントの入出力形式へ変換します。

```typescript
const agentTraceScorer = createScorer({
  name: "エージェントトレース長",
  description: "エージェントの応答長を評価します",
  type: "agent",
}).generateScore(({ run }) => {
  // トレースデータは自動的にエージェント形式に変換されます
  const userMessages = run.input.inputMessages;
  const agentResponse = run.output[0]?.content;

  // 応答長に基づいてスコアを算出
  return agentResponse?.length > 50 ? 0 : 1;
});

// トレーススコアリングのためにMastraに登録
const mastra = new Mastra({
  scorers: {
    agentTraceScorer,
  },
});
```


## ステップ メソッドのシグネチャ

### preprocess

分析前にデータを抽出または変換できる任意の前処理ステップ。

**関数モード:**
関数: `({ run, results }) => any`

<PropertiesTable
  content={[
    {
      name: "run.input",
      type: "any",
      required: true,
      description:
        "スコアラーに渡される入力レコード。スコアラーがエージェントに追加されている場合は、ユーザーメッセージの配列になります（例: `[{ role: 'user', content: 'hello world' }]`）。スコアラーがワークフローで使用されている場合は、ワークフローの入力になります。",
    },
    {
      name: "run.output",
      type: "any",
      required: true,
      description:
        "スコアラーに渡される出力レコード。エージェントの場合は通常、エージェントの応答です。ワークフローの場合はワークフローの出力です。",
    },
    {
      name: "run.runId",
      type: "string",
      required: true,
      description: "このスコアリング実行の一意の識別子。",
    },
    {
      name: "run.runtimeContext",
      type: "object",
      required: false,
      description:
        "評価対象のエージェントまたはワークフローステップのランタイムコンテキスト（任意）。",
    },
    {
      name: "results",
      type: "object",
      required: true,
      description: "空のオブジェクト（前段はなし）。",
    },
  ]}
/>

戻り値: `any`  
このメソッドは任意の値を返せます。返された値は、後続のステップで `preprocessStepResult` として利用可能になります。

**プロンプトオブジェクトモード:**

<PropertiesTable
  content={[
    {
      name: "description",
      type: "string",
      required: true,
      description: "この前処理ステップの内容の説明。",
    },
    {
      name: "outputSchema",
      type: "ZodSchema",
      required: true,
      description: "preprocess ステップの期待される出力に対する Zod スキーマ。",
    },
    {
      name: "createPrompt",
      type: "function",
      required: true,
      description:
        "関数: ({ run, results }) => string。LLM 用のプロンプトを返します。",
    },
    {
      name: "judge",
      type: "object",
      required: false,
      description:
        "（任意）このステップ用の LLM ジャッジ（メインのジャッジを上書き可能）。Judge Object セクションを参照。",
    },
  ]}
/>

### analyze

入力・出力および任意の前処理済みデータを扱うオプションの分析ステップ。

**関数モード:**
Function: `({ run, results }) => any`

<PropertiesTable
  content={[
    {
      name: "run.input",
      type: "any",
      required: true,
      description:
        "スコアラーに渡される入力レコード。スコアラーがエージェントに追加されている場合は、ユーザーメッセージの配列（例: `[{ role: 'user', content: 'hello world' }]`）。ワークフローで使用される場合は、そのワークフローの入力。",
    },
    {
      name: "run.output",
      type: "any",
      required: true,
      description:
        "スコアラーに渡される出力レコード。エージェントの場合は通常エージェントの応答。ワークフローの場合はワークフローの出力。",
    },
    {
      name: "run.runId",
      type: "string",
      required: true,
      description: "このスコアリング実行の一意の識別子。",
    },
    {
      name: "run.runtimeContext",
      type: "object",
      required: false,
      description:
        "評価対象のエージェントまたはワークフローステップからのランタイムコンテキスト（任意）。",
    },
    {
      name: "results.preprocessStepResult",
      type: "any",
      required: false,
      description: "preprocess ステップの結果（定義されている場合、任意）。",
    },
  ]}
/>

戻り値: `any`  
このメソッドは任意の値を返せます。返された値は後続のステップで `analyzeStepResult` として利用されます。

**Prompt Object モード:**

<PropertiesTable
  content={[
    {
      name: "description",
      type: "string",
      required: true,
      description: "この分析ステップの内容の説明。",
    },
    {
      name: "outputSchema",
      type: "ZodSchema",
      required: true,
      description: "analyze ステップの想定される出力に対する Zod スキーマ。",
    },
    {
      name: "createPrompt",
      type: "function",
      required: true,
      description:
        "Function: ({ run, results }) => string。LLM に渡すプロンプトを返します。",
    },
    {
      name: "judge",
      type: "object",
      required: false,
      description:
        "（任意）このステップの LLM ジャッジ（メインのジャッジを上書き可能）。Judge Object セクションを参照。",
    },
  ]}
/>

### generateScore

最終的な数値スコアを算出する**必須**ステップ。

**Function モード:**
Function: `({ run, results }) => number`

<PropertiesTable
  content={[
    {
      name: "run.input",
      type: "any",
      required: true,
      description:
        "スコアラーに渡される入力レコード。スコアラーがエージェントに追加されている場合は、ユーザーメッセージの配列（例: `[{ role: 'user', content: 'hello world' }]`）。スコアラーをワークフローで使用する場合は、そのワークフローの入力になります。",
    },
    {
      name: "run.output",
      type: "any",
      required: true,
      description:
        "スコアラーに渡される出力レコード。エージェントの場合は通常、エージェントの応答です。ワークフローの場合は、そのワークフローの出力です。",
    },
    {
      name: "run.runId",
      type: "string",
      required: true,
      description: "このスコアリング実行の一意の識別子。",
    },
    {
      name: "run.runtimeContext",
      type: "object",
      required: false,
      description:
        "評価対象のエージェントまたはワークフローステップからのランタイムコンテキスト（任意）。",
    },
    {
      name: "results.preprocessStepResult",
      type: "any",
      required: false,
      description: "preprocess ステップの結果（定義されている場合、任意）。",
    },
    {
      name: "results.analyzeStepResult",
      type: "any",
      required: false,
      description: "analyze ステップの結果（定義されている場合、任意）。",
    },
  ]}
/>

Returns: `number`  
このメソッドは数値スコアを返す必要があります。

**Prompt Object モード:**

<PropertiesTable
  content={[
    {
      name: "description",
      type: "string",
      required: true,
      description: "このスコアリングステップの内容の説明。",
    },
    {
      name: "outputSchema",
      type: "ZodSchema",
      required: true,
      description:
        "generateScore ステップの期待される出力に対する Zod スキーマ。",
    },
    {
      name: "createPrompt",
      type: "function",
      required: true,
      description:
        "Function: ({ run, results }) => string。LLM 用のプロンプトを返します。",
    },
    {
      name: "judge",
      type: "object",
      required: false,
      description:
        "（任意）このステップの LLM ジャッジ（メインのジャッジを上書き可能）。Judge Object セクションを参照。",
    },
  ]}
/>

Prompt Object モードを使用する場合は、LLM の出力を数値スコアに変換するための `calculateScore` 関数も提供する必要があります:

<PropertiesTable
  content={[
    {
      name: "calculateScore",
      type: "function",
      required: true,
      description:
        "Function: ({ run, results, analyzeStepResult }) => number。LLM の構造化出力を数値スコアに変換します。",
    },
  ]}
/>

### generateReason

スコアに対する説明を提供する任意のステップ。

**関数モード:**
関数: `({ run, results, score }) => string`

<PropertiesTable
  content={[
    {
      name: "run.input",
      type: "any",
      required: true,
      description:
        "スコアラーに渡される入力レコード。スコアラーがエージェントに追加されている場合は、ユーザーメッセージの配列になります（例: `[{ role: 'user', content: 'hello world' }]`）。スコアラーがワークフローで使用されている場合は、ワークフローの入力になります。",
    },
    {
      name: "run.output",
      type: "any",
      required: true,
      description:
        "スコアラーに渡される出力レコード。エージェントの場合は通常、エージェントの応答です。ワークフローの場合は、ワークフローの出力です。",
    },
    {
      name: "run.runId",
      type: "string",
      required: true,
      description: "このスコアリング実行の一意の識別子。",
    },
    {
      name: "run.runtimeContext",
      type: "object",
      required: false,
      description:
        "評価対象のエージェントまたはワークフローステップの実行時コンテキスト（任意）。",
    },
    {
      name: "results.preprocessStepResult",
      type: "any",
      required: false,
      description: "preprocess ステップの結果（定義されている場合、任意）。",
    },
    {
      name: "results.analyzeStepResult",
      type: "any",
      required: false,
      description: "analyze ステップの結果（定義されている場合、任意）。",
    },
    {
      name: "score",
      type: "number",
      required: true,
      description: "generateScore ステップで算出されたスコア。",
    },
  ]}
/>

戻り値: `string`  
このメソッドはスコアの理由を説明する文字列を返す必要があります。

**プロンプトオブジェクトモード:**

<PropertiesTable
  content={[
    {
      name: "description",
      type: "string",
      required: true,
      description: "この推論ステップの内容の説明。",
    },
    {
      name: "createPrompt",
      type: "function",
      required: true,
      description:
        "関数: ({ run, results, score }) => string。LLM へのプロンプトを返します。",
    },
    {
      name: "judge",
      type: "object",
      required: false,
      description:
        "（任意）このステップ用の LLM ジャッジ（メインのジャッジを上書き可能）。Judge Object セクションを参照。",
    },
  ]}
/>

すべてのステップ関数は非同期にできます。