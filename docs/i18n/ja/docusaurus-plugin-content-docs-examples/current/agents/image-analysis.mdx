---
title: "例: 画像解析 | エージェント | Mastra ドキュメント"
description: Unsplash の画像を分析し、物体の特定や種の判別、場所の説明を行うために Mastra の AI エージェントを使用する例。
---

import GithubLink from "@site/src/components/GithubLink";


<div id="image-analysis">
  # 画像解析
</div>

AI エージェントは、テキストの指示とあわせて視覚コンテンツを処理することで、画像を分析し理解できます。この機能により、エージェントは物体の特定、シーンの説明、画像に関する質問への回答、さらには複雑な視覚的推論タスクの実行が可能になります。

<div id="prerequisites">
  ## 前提条件
</div>

* [Unsplash](https://unsplash.com/documentation#creating-a-developer-account) の開発者アカウント、アプリケーション、API キー
* OpenAI の API キー

この例では `openai` モデルを使用します。`OPENAI_API_KEY` と `UNSPLASH_ACCESS_KEY` を両方とも `.env` ファイルに追加してください。

```bash title=".env" copy
OPENAI_API_KEY=<your-api-key>
UNSPLASH_ACCESS_KEY=<your-unsplash-access-key>
```


<div id="creating-an-agent">
  ## エージェントの作成
</div>

画像を解析して物体を認識し、シーンを記述し、視覚コンテンツに関する質問に回答するシンプルなエージェントを作成します。

```typescript title="src/mastra/agents/example-image-analysis-agent.ts" showLineNumbers copy
import { openai } from "@ai-sdk/openai";
import { Agent } from "@mastra/core/agent";

export const imageAnalysisAgent = new Agent({
  name: "image-analysis",
  description: "画像を分析して物体を識別し、シーンを説明します",
  instructions: `
    画像を確認して物体を識別し、シーンを説明し、内容に関する質問に答えることができます。
    また、動物の種類を特定したり、画像内の場所を説明したりすることもできます。
   `,
  model: openai("gpt-4o"),
});
```

> 設定オプションの一覧は [Agent](/reference/agents/agent) を参照してください。


<div id="registering-an-agent">
  ## エージェントの登録
</div>

エージェントを使用するには、メインの Mastra インスタンスに登録します。

```typescript title="src/mastra/index.ts" showLineNumbers copy
import { Mastra } from "@mastra/core/mastra";

import { imageAnalysisAgent } from "./agents/example-image-analysis-agent";

export const mastra = new Mastra({
  // ...
  agents: { imageAnalysisAgent },
});
```


<div id="creating-a-function">
  ## 関数の作成
</div>

この関数は、分析のためにエージェントへ渡す Unsplash のランダムな画像を取得します。

```typescript title="src/mastra/utils/get-random-image.ts" showLineNumbers copy
export const getRandomImage = async (): Promise<string> => {
  const queries = ["野生動物", "羽", "飛翔", "鳥"];
  const query = queries[Math.floor(Math.random() * queries.length)];
  const page = Math.floor(Math.random() * 20);
  const order_by = Math.random() < 0.5 ? "relevant" : "latest";

  const response = await fetch(
    `https://api.unsplash.com/search/photos?query=${query}&page=${page}&order_by=${order_by}`,
    {
      headers: {
        Authorization: `Client-ID ${process.env.UNSPLASH_ACCESS_KEY}`,
        "Accept-Version": "v1",
      },
      cache: "no-store",
    },
  );

  const { results } = await response.json();
  return results[Math.floor(Math.random() * results.length)].urls.regular;
};
```


<div id="example-usage">
  ## 使用例
</div>

`getAgent()` を使ってエージェントの参照を取得し、プロンプトとともに `generate()` を呼び出します。`content` 配列を用意し、画像の `type`、`imageUrl`、`mimeType`、そしてエージェントがどのように応答すべきかを示す明確な指示を含めてください。

```typescript title="src/test-image-analysis.ts" showLineNumbers copy
import "dotenv/config";

import { mastra } from "./mastra";
import { getRandomImage } from "./mastra/utils/get-random-image";

const imageUrl = await getRandomImage();
const agent = mastra.getAgent("imageAnalysisAgent");

const response = await agent.generate([
  {
    role: "user",
    content: [
      {
        type: "image",
        image: imageUrl,
        mimeType: "image/jpeg",
      },
      {
        type: "text",
        text: `この画像を分析し、主な物体や被写体を特定してください。動物が写っている場合は、一般名と学名を記載してください。また、場所や状況を1〜2文で簡潔に説明してください。`,
      },
    ],
  },
]);

console.log(response.text);
```

<GithubLink outdated={true} marginTop="mt-16" link="https://github.com/mastra-ai/mastra/blob/main/examples/basics/agents/bird-checker" />


<div id="related">
  ## 関連項目
</div>

- [エージェントの呼び出し](./calling-agents)