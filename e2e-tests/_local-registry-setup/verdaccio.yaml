storage: ./storage

# Increase max body size to handle large packages
max_body_size: 100mb

uplinks:
  npmjs:
    url: https://registry.npmjs.org/

packages:
  # Allow npm fallback for @mastra/client-js since third-party packages like
  # @ag-ui/mastra depend on specific semver ranges (^0.15.2) that our snapshot
  # versions don't satisfy. This is a temporary workaround until the deployer
  # supports passing pnpm.overrides to the output package.json.
  # TODO: Fix deployer to copy pnpm.overrides/resolutions from source package.json
  '@mastra/client-js':
    access: $all
    publish: $all
    unpublish: $all
    proxy: npmjs

  # Block npm fallback for other @mastra/* packages - they MUST be published locally
  # This ensures e2e tests fail fast if a package is missing from the publish list
  '@mastra/*':
    access: $all
    publish: $all
    unpublish: $all
    # No proxy - will 404 if not published locally

  # Same for the unscoped 'mastra' package
  'mastra':
    access: $all
    publish: $all
    unpublish: $all
    # No proxy - will 404 if not published locally

  # All other packages can fall back to npm
  '**':
    access: $all
    publish: $all
    unpublish: $all
    proxy: npmjs

# Security settings to allow everything
security:
  api:
    legacy: true

# Disable audit
middlewares:
  audit:
    enabled: false

web:
  enable: true

log:
  - { type: stdout, format: pretty, level: error }
