---
phase: 10-dataset-layout-update
plan: 03
type: execute
wave: 2
depends_on: ["10-01"]
files_modified:
  - packages/playground-ui/src/domains/datasets/components/dataset-detail/items-toolbar.tsx
  - packages/playground-ui/src/domains/datasets/components/dataset-detail/items-list.tsx
autonomous: true

must_haves:
  truths:
    - "Split button shows '+ New Item' as main action with Import options in dropdown"
    - "Import CSV option triggers existing import flow"
    - "Import JSON option is disabled with 'Coming Soon' indicator"
    - "Actions menu contains: Export Items, Create Dataset, Add to Dataset (disabled), Delete Items"
    - "Actions menu options enter selection mode as before"
  artifacts:
    - path: "packages/playground-ui/src/domains/datasets/components/dataset-detail/items-toolbar.tsx"
      provides: "Extracted toolbar component with split button and actions"
      exports: ["ItemsToolbar", "ItemsToolbarProps"]
  key_links:
    - from: "items-toolbar.tsx"
      to: "@/ds/components/SplitButton"
      via: "component import"
      pattern: "SplitButton"
    - from: "items-list.tsx"
      to: "items-toolbar.tsx"
      via: "component import"
      pattern: "ItemsToolbar"
---

<objective>
Restructure items toolbar with split button for Add/Import and updated actions menu.

Purpose: Consolidate Add Item + Import into split button, reorganize selection actions
Output: ItemsToolbar component with new layout
</objective>

<execution_context>
@/Users/grzegorzlobinski/.claude/get-shit-done/workflows/execute-plan.md
@/Users/grzegorzlobinski/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-dataset-layout-update/10-CONTEXT.md
@.planning/phases/10-dataset-layout-update/10-RESEARCH.md
@.planning/phases/10-dataset-layout-update/10-01-SUMMARY.md

# Current implementation
@packages/playground-ui/src/domains/datasets/components/dataset-detail/items-list.tsx
@packages/playground-ui/src/domains/datasets/components/dataset-detail/items-list-actions.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ItemsToolbar component</name>
  <files>packages/playground-ui/src/domains/datasets/components/dataset-detail/items-toolbar.tsx</files>
  <action>
Create extracted toolbar component:

```typescript
'use client';

import { useState } from 'react';
import { SplitButton } from '@/ds/components/SplitButton';
import { Popover, PopoverTrigger, PopoverContent } from '@/ds/components/Popover';
import { Button } from '@/ds/components/Button';
import { Icon } from '@/ds/icons/Icon';
import { Plus, Upload, FileJson, MoreVertical, Download, FolderPlus, FolderOutput, Trash2 } from 'lucide-react';

export interface ItemsToolbarProps {
  // Normal mode actions
  onAddClick: () => void;
  onImportClick: () => void;
  onExportClick: () => void;
  onCreateDatasetClick: () => void;
  onDeleteClick: () => void;
  hasItems: boolean;

  // Selection mode state
  isSelectionActive: boolean;
  selectedCount: number;
  onExecuteAction: () => void;
  onCancelSelection: () => void;
  selectionMode: 'idle' | 'export' | 'create-dataset' | 'delete';
}
```

Layout for normal mode (isSelectionActive=false):
```typescript
<div className="flex justify-end px-4 py-2 gap-2">
  {/* Split button: New Item + Import options */}
  <SplitButton
    mainLabel={<><Icon><Plus /></Icon> New Item</>}
    onMainClick={onAddClick}
    variant="primary"
    size="sm"
  >
    <div className="flex flex-col">
      <Button variant="ghost" size="sm" className="w-full justify-start gap-2" onClick={onImportClick}>
        <Icon><Upload /></Icon>
        Import CSV
      </Button>
      <Button variant="ghost" size="sm" className="w-full justify-start gap-2" disabled>
        <Icon><FileJson /></Icon>
        Import JSON (Coming Soon)
      </Button>
    </div>
  </SplitButton>

  {/* Actions menu (only when items exist) */}
  {hasItems && <ActionsMenu ... />}
</div>
```

ActionsMenu (internal component):
- Trigger: Button variant="ghost" with MoreVertical icon
- Options:
  1. Select and Export Items (Download icon) - triggers onExportClick
  2. Select Items to Create Dataset (FolderPlus icon) - triggers onCreateDatasetClick
  3. Select and Add to another Dataset (FolderOutput icon) - DISABLED "Coming Soon"
  4. Select Items to Delete (Trash2 icon) - triggers onDeleteClick, text-red-500

Layout for selection mode (isSelectionActive=true):
```typescript
<div className="flex justify-end px-4 py-2 gap-2">
  <span className="text-sm text-neutral3 flex items-center">
    {selectedCount} selected
  </span>
  <Button
    variant="primary"
    size="sm"
    disabled={selectedCount === 0}
    onClick={onExecuteAction}
  >
    {selectionMode === 'export' && 'Export CSV'}
    {selectionMode === 'create-dataset' && 'Create Dataset'}
    {selectionMode === 'delete' && 'Delete'}
  </Button>
  <Button variant="ghost" size="sm" onClick={onCancelSelection}>
    Cancel
  </Button>
</div>
```
  </action>
  <verify>
```bash
cd /Users/grzegorzlobinski/.superset/worktrees/mastra/dataset-layout-update/packages/playground-ui
pnpm exec tsc --noEmit src/domains/datasets/components/dataset-detail/items-toolbar.tsx
```
  </verify>
  <done>ItemsToolbar renders split button and actions menu correctly</done>
</task>

<task type="auto">
  <name>Task 2: Integrate ItemsToolbar into ItemsList</name>
  <files>packages/playground-ui/src/domains/datasets/components/dataset-detail/items-list.tsx</files>
  <action>
Update ItemsList to use extracted toolbar:

1. Import ItemsToolbar:
```typescript
import { ItemsToolbar } from './items-toolbar';
```

2. Remove imports no longer needed directly:
- Plus, Upload icons (moved to toolbar)
- ActionsMenu import (moved to toolbar internal)

3. Replace toolbar JSX with ItemsToolbar component:

Find the existing toolbar div:
```typescript
<div className="flex justify-end px-4 py-2 gap-2">
  {isSelectionActive ? (...) : (...)}
</div>
```

Replace with:
```typescript
<ItemsToolbar
  onAddClick={onAddClick}
  onImportClick={onImportClick ?? (() => {})}
  onExportClick={() => setSelectionMode('export')}
  onCreateDatasetClick={() => setSelectionMode('create-dataset')}
  onDeleteClick={() => setSelectionMode('delete')}
  hasItems={items.length > 0}
  isSelectionActive={isSelectionActive}
  selectedCount={selection.selectedCount}
  onExecuteAction={handleExecuteAction}
  onCancelSelection={handleCancelSelection}
  selectionMode={selectionMode}
/>
```

4. Keep all the state, handlers, and EntryList rendering unchanged

5. Remove unused ActionsMenu import since it's now internal to ItemsToolbar
  </action>
  <verify>
```bash
cd /Users/grzegorzlobinski/.superset/worktrees/mastra/dataset-layout-update/packages/playground-ui
pnpm exec tsc --noEmit src/domains/datasets/components/dataset-detail/items-list.tsx
```
  </verify>
  <done>ItemsList uses new ItemsToolbar component</done>
</task>

</tasks>

<verification>
```bash
cd /Users/grzegorzlobinski/.superset/worktrees/mastra/dataset-layout-update/packages/playground-ui
pnpm build

# Verify toolbar renders
grep "ItemsToolbar" dist/src/domains/datasets/components/dataset-detail/items-toolbar.d.ts
grep "SplitButton" dist/src/domains/datasets/components/dataset-detail/items-toolbar.js
```
</verification>

<success_criteria>
- ItemsToolbar component created with split button and actions menu
- Split button shows "New Item" + import dropdown
- Import JSON option disabled
- Actions menu has Export, Create Dataset, Add to Dataset (disabled), Delete
- Selection mode UI preserved
- Build passes
</success_criteria>

<output>
After completion, create `.planning/phases/10-dataset-layout-update/10-03-SUMMARY.md`
</output>
