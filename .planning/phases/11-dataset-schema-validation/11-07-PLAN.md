---
phase: 11-dataset-schema-validation
plan: 07
type: execute
wave: 5
depends_on: ['11-06']
files_modified: []
autonomous: false

must_haves:
  truths:
    - 'Complete schema validation flow works end-to-end'
    - 'All success criteria from ROADMAP.md are verified'
---

<objective>
Verify complete schema validation feature works end-to-end.

Purpose: Final human verification that all requirements are met.
Output: User approval of feature functionality.
</objective>

<execution_context>
@/Users/yj/.claude/get-shit-done/workflows/execute-plan.md
@/Users/yj/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-dataset-schema-validation/11-RESEARCH.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete dataset schema validation feature:
1. Dataset type extended with inputSchema/outputSchema fields
2. Ajv-based validation at storage layer
3. API routes for schema management and workflow schema extraction
4. CSV import with validation and skip reporting
5. Schema Settings dialog with workflow import
6. Field-level validation error display in all data entry points
  </what-built>

  <how-to-verify>
Start the playground and test the complete flow:

1. **Start playground:**

   ```bash
   cd packages/playground && pnpm dev
   # Open http://localhost:4111
   ```

2. **Create dataset without schema:**
   - Create new dataset "Test Schema"
   - Add a few items with mixed data (some strings, some objects)

3. **Configure schema:**
   - Open dataset, click three-dot menu → Schema Settings
   - Enable Input Schema
   - Set schema: `{"type": "object", "properties": {"name": {"type": "string"}}, "required": ["name"]}`
   - Try to save → should see error about existing items failing

4. **Fix and retry:**
   - Disable Input Schema, Save
   - Delete incompatible items or edit them to match schema
   - Re-enable Input Schema with same schema → should save successfully

5. **Test add item validation:**
   - Try adding item with `{"name": 123}` → should show error under input field
   - Add item with `{"name": "Alice"}` → should succeed

6. **Test edit item validation:**
   - Click on an item, click Edit
   - Change input to invalid value → should show error
   - Fix and save → should succeed

7. **Test workflow schema import:**
   - If you have workflows registered, try Schema Settings → Import from workflow
   - Schema should populate in editor

8. **Test CSV import with schema:**
   - Create CSV with mixed valid/invalid rows
   - Import CSV → should see validation report
   - Confirm count of rows to be skipped
   - Import → should show success with skipped count

**Expected Results:**

- [ ] Schema settings dialog opens from dataset menu
- [ ] Enabling schema with incompatible items shows error with count
- [ ] Add item with invalid data shows field-level error
- [ ] Edit item with invalid data shows field-level error
- [ ] CSV import shows validation summary with skip count
- [ ] Workflow schema import populates editor
- [ ] All 8 success criteria from ROADMAP.md are met
    </how-to-verify>

  <resume-signal>
Type "approved" if all verification steps pass.
If issues found, describe what failed and any error messages.
  </resume-signal>
</task>

</tasks>

<verification>
Human verification of all success criteria from ROADMAP.md Phase 11:
1. Users can enable/disable input and output schemas independently
2. Users can import schema from workflow or define custom JSON Schema
3. Imported schemas are copied (not referenced) and can be modified
4. Adding item validates with field-level error messages
5. CSV import skips invalid rows and reports count
6. Enabling schema validates all existing items
7. Up to 10 failing items shown with errors
8. Cannot enable schema if items would fail
</verification>

<success_criteria>
All verification checkboxes marked complete by user.
</success_criteria>

<output>
After completion, create `.planning/phases/11-dataset-schema-validation/11-07-SUMMARY.md`
</output>
