---
phase: 11-dataset-schema-validation
plan: 08
type: execute
wave: 6
depends_on: ['11-07']
files_modified:
  - packages/playground-ui/src/domains/datasets/components/edit-dataset-dialog.tsx
  - packages/playground-ui/src/domains/datasets/components/create-dataset-dialog.tsx
  - packages/playground-ui/src/domains/datasets/components/dataset-header.tsx
  - packages/playground-ui/src/domains/datasets/components/schema-settings/schema-field.tsx
  - packages/playground-ui/src/domains/datasets/hooks/use-agent-schema.ts
  - packages/playground-ui/src/domains/datasets/hooks/use-scorer-schema.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - 'Schema config integrated into Create Dataset dialog'
    - 'Schema config integrated into Edit Dataset dialog'
    - 'Source selector with Custom/Agent/Workflow/Scorer options'
    - 'Agent source auto-populates schema when field enabled'
    - 'Workflow source shows picker then auto-populates'
    - 'Scorer source auto-populates with ScorerRunInputForAgent/ScorerRunOutputForAgent schemas'
    - 'Separate Schema Settings dialog removed'
---

<objective>
Integrate schema configuration into Create/Edit Dataset dialogs with source-based auto-population.

Purpose: Simplify UX - schema is part of dataset definition, not a separate setting.
Output: Unified dataset forms with inline schema config and smart auto-population.
</objective>

<context>
@.planning/PROJECT.md
@.planning/phases/11-dataset-schema-validation/11-RESEARCH.md
@packages/playground-ui/src/domains/datasets/components/edit-dataset-dialog.tsx
@packages/playground-ui/src/domains/datasets/components/create-dataset-dialog.tsx
@packages/playground-ui/src/domains/datasets/components/dataset-header.tsx
@packages/playground-ui/src/domains/datasets/components/schema-settings/schema-settings-dialog.tsx
@packages/playground-ui/src/domains/datasets/components/schema-settings/schema-field.tsx
@packages/playground-ui/src/domains/datasets/hooks/use-workflow-schema.ts
@packages/core/src/evals/types.ts (ScorerRunInputForAgent, ScorerRunOutputForAgent)
</context>

<reference>
**Scorer schema types (from @mastra/core/evals):**

```typescript
// Input schema for agent-type scorers
type ScorerRunInputForAgent = {
  inputMessages: MastraDBMessage[];
  rememberedMessages: MastraDBMessage[];
  systemMessages: CoreMessage[];
  taggedSystemMessages: Record<string, CoreSystemMessage[]>;
};

// Output schema for agent-type scorers
type ScorerRunOutputForAgent = MastraDBMessage[];
```

**ScorerRun interface:**

```typescript
interface ScorerRun<TInput, TOutput> {
  input?: TInput; // maps to dataset item.input
  output: TOutput; // maps to dataset item.input (for scorer calibration)
  groundTruth?: any; // maps to dataset item.expectedOutput (no schema)
}
```

Note: Only agent-type scorers have defined schemas. Other scorer types have generic any types.
expectedOutput maps to groundTruth which is always `any` - no schema to import for that field.
</reference>

<tasks>

<task type="auto">
  <name>Create useAgentSchema hook</name>
  <files>packages/playground-ui/src/domains/datasets/hooks/use-agent-schema.ts</files>
  <action>
1. Create hook that returns agent input schema
2. Agents share same schema - no agentId param needed
3. Return static ScorerRunInputForAgent schema as JSONSchema7
4. Return { inputSchema, outputSchema: null, isLoading: false, error: null }
5. Export from hooks/index.ts
  </action>
  <verify>Hook returns agent schema</verify>
  <done>useAgentSchema hook created and exported</done>
</task>

<task type="auto">
  <name>Create useScorerSchema hook</name>
  <files>packages/playground-ui/src/domains/datasets/hooks/use-scorer-schema.ts</files>
  <action>
1. Create hook that returns scorer schemas for agent-type scorers
2. Return static schemas as JSONSchema7:
   - inputSchema: ScorerRunInputForAgent structure
   - outputSchema: ScorerRunOutputForAgent structure (MastraDBMessage[])
3. Note: expectedOutput maps to groundTruth which has no schema
4. Return { inputSchema, outputSchema, isLoading: false, error: null }
5. Export from hooks/index.ts
  </action>
  <verify>Hook returns scorer schemas</verify>
  <done>useScorerSchema hook created and exported</done>
</task>

<task type="auto">
  <name>Create SchemaConfigSection component</name>
  <files>packages/playground-ui/src/domains/datasets/components/schema-config-section.tsx</files>
  <action>
1. Create reusable component for schema configuration
2. Props: inputSchema, outputSchema, onChange, disabled
3. Include source selector: Custom | Agent | Workflow | Scorer
4. When source = Workflow, show workflow picker dropdown
5. Include two SchemaField components (input, expectedOutput)
6. Handle auto-population logic:
   - Custom: manual entry
   - Agent: auto-fill input when field enabled (no output schema)
   - Workflow: select workflow → auto-fill when field enabled
   - Scorer: auto-fill input/output when field enabled (for agent-type scorer calibration)
7. Collapsible/accordion style to keep forms manageable
8. Show helper text for Scorer: "For calibrating agent-type scorers"
  </action>
  <verify>Component renders with source selector and schema fields</verify>
  <done>SchemaConfigSection component created</done>
</task>

<task type="auto">
  <name>Update SchemaField for auto-population</name>
  <files>packages/playground-ui/src/domains/datasets/components/schema-settings/schema-field.tsx</files>
  <action>
1. Add props: sourceSchema?: JSONSchema7 | null, autoPopulate?: boolean
2. When enabled (checked) and autoPopulate=true and sourceSchema exists:
   - Auto-populate editor value with sourceSchema
3. Keep editor fully editable after population
4. Handle edge case: user enables, schema populates, user edits, user disables/re-enables
  </action>
  <verify>SchemaField auto-populates when given sourceSchema</verify>
  <done>SchemaField supports auto-population</done>
</task>

<task type="auto">
  <name>Integrate schema config into CreateDatasetDialog</name>
  <files>packages/playground-ui/src/domains/datasets/components/create-dataset-dialog.tsx</files>
  <action>
1. Add SchemaConfigSection below name/description fields
2. Add inputSchema/outputSchema to form state
3. Pass schema values to createDataset mutation
4. Use accordion/collapsible: "Schema Configuration (Optional)"
5. Default collapsed to keep form simple for basic use
  </action>
  <verify>Create dialog shows schema config, creates dataset with schemas</verify>
  <done>Create dialog has inline schema config</done>
</task>

<task type="auto">
  <name>Integrate schema config into EditDatasetDialog</name>
  <files>packages/playground-ui/src/domains/datasets/components/edit-dataset-dialog.tsx</files>
  <action>
1. Add SchemaConfigSection below name/description fields
2. Initialize with dataset's current inputSchema/outputSchema
3. Pass updated schemas to updateDataset mutation
4. Handle validation errors (existing items may fail new schema)
5. Display validation errors inline if schema change rejected
  </action>
  <verify>Edit dialog shows schema config, updates dataset schemas</verify>
  <done>Edit dialog has inline schema config</done>
</task>

<task type="auto">
  <name>Remove Schema Settings from dataset header menu</name>
  <files>packages/playground-ui/src/domains/datasets/components/dataset-header.tsx</files>
  <action>
1. Remove "Schema Settings" menu item from three-dot menu
2. Remove SchemaSettingsDialog import and usage
3. Keep Edit, Duplicate, Delete menu items
  </action>
  <verify>Three-dot menu no longer has Schema Settings option</verify>
  <done>Schema Settings removed from menu</done>
</task>

<task type="auto">
  <name>Clean up removed components</name>
  <files>packages/playground-ui/src/domains/datasets/components/schema-settings/</files>
  <action>
1. Remove schema-settings-dialog.tsx (functionality moved to forms)
2. Remove workflow-schema-import.tsx (replaced by source selector)
3. Keep schema-field.tsx (used by SchemaConfigSection)
4. Update index.ts exports
5. Remove any unused imports across codebase
  </action>
  <verify>No unused files, build passes, no dead imports</verify>
  <done>Cleanup complete</done>
</task>

</tasks>

<verification>
1. Create Dataset dialog has collapsible schema config section
2. Edit Dataset dialog has schema config section
3. Source selector shows Custom/Agent/Workflow/Scorer
4. Custom: manual entry works
5. Agent: enable Input Schema → auto-fills with agent input schema
6. Workflow: select workflow → enable Input/Output → auto-fills from workflow
7. Scorer: enable Input/Output → auto-fills with ScorerRunInputForAgent/ScorerRunOutputForAgent
8. Populated schemas are editable
9. Schema Settings removed from three-dot menu
10. Validation errors display when schema change would break existing items
11. Build passes, no TypeScript errors
</verification>

<success_criteria>

- Schema config in Create Dataset dialog (collapsible, optional)
- Schema config in Edit Dataset dialog
- Source selector with Custom/Agent/Workflow/Scorer options
- Auto-population behavior for all non-Custom sources
- Separate Schema Settings dialog removed
- Existing validation behavior preserved
  </success_criteria>

<output>
After completion, create `.planning/phases/11-dataset-schema-validation/11-08-SUMMARY.md`
</output>
