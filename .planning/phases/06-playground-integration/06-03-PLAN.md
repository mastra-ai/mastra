---
phase: 06-playground-integration
plan: 03
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - packages/playground-ui/src/domains/datasets/index.ts
  - packages/playground-ui/src/domains/datasets/hooks/use-datasets.ts
  - packages/playground-ui/src/domains/datasets/hooks/use-dataset-runs.ts
  - packages/playground-ui/src/domains/datasets/hooks/use-compare-runs.ts
  - packages/playground-ui/src/domains/datasets/hooks/use-dataset-mutations.ts
  - packages/playground-ui/src/index.ts
  - packages/playground-ui/src/lib/framework.tsx
autonomous: true

must_haves:
  truths:
    - "useDatasets() returns { data, isLoading, error }"
    - "useDataset(id) returns single dataset with items"
    - "useDatasetRuns(datasetId) returns run history"
    - "useDatasetRunResults(runId) returns run results"
    - "useCompareRuns(runIdA, runIdB) returns comparison"
    - "useDatasetMutations() returns mutation functions"
    - "useLinkComponent().paths.datasetLink(id) returns URL"
  artifacts:
    - path: "packages/playground-ui/src/domains/datasets/hooks/use-datasets.ts"
      provides: "TanStack Query hooks for dataset fetching"
    - path: "packages/playground-ui/src/domains/datasets/hooks/use-dataset-mutations.ts"
      provides: "Mutation hooks for create/update/delete/trigger"
    - path: "packages/playground-ui/src/domains/datasets/index.ts"
      provides: "Re-exports for datasets domain"
  key_links:
    - from: "packages/playground-ui/src/domains/datasets/hooks/*.ts"
      to: "@mastra/client-js"
      via: "useMastraClient() hook"
---

<objective>
Create TanStack Query hooks for datasets in playground-ui.

Purpose: Provide data fetching layer that UI components will consume.
Output: Complete hooks for datasets, runs, results, comparison, and mutations.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-playground-integration/06-RESEARCH.md

# Reference patterns
@packages/playground-ui/src/domains/agents/hooks/use-agents.ts
@packages/playground-ui/src/domains/workflows/hooks/use-workflows.ts
@packages/playground-ui/src/hooks/use-workflow-runs.ts
@packages/playground-ui/src/lib/framework.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create datasets domain structure and query hooks</name>
  <files>
    packages/playground-ui/src/domains/datasets/index.ts
    packages/playground-ui/src/domains/datasets/hooks/use-datasets.ts
    packages/playground-ui/src/domains/datasets/hooks/use-dataset-runs.ts
    packages/playground-ui/src/domains/datasets/hooks/use-compare-runs.ts
  </files>
  <action>
Create datasets domain following agents domain pattern.

1. Create directory structure:
   - packages/playground-ui/src/domains/datasets/
   - packages/playground-ui/src/domains/datasets/hooks/

2. Create use-datasets.ts:
```typescript
import { useMastraClient } from '@mastra/react';
import { useQuery } from '@tanstack/react-query';

export const useDatasets = (pagination?: { page?: number; perPage?: number }) => {
  const client = useMastraClient();
  return useQuery({
    queryKey: ['datasets', pagination],
    queryFn: () => client.listDatasets(pagination),
  });
};

export const useDataset = (datasetId: string) => {
  const client = useMastraClient();
  return useQuery({
    queryKey: ['dataset', datasetId],
    queryFn: () => client.getDataset(datasetId),
    enabled: Boolean(datasetId),
  });
};

export const useDatasetItems = (datasetId: string, pagination?: { page?: number; perPage?: number }) => {
  const client = useMastraClient();
  return useQuery({
    queryKey: ['dataset-items', datasetId, pagination],
    queryFn: () => client.listDatasetItems(datasetId, pagination),
    enabled: Boolean(datasetId),
  });
};
```

3. Create use-dataset-runs.ts with polling pattern (from use-workflow-runs.ts):
```typescript
import { useMastraClient } from '@mastra/react';
import { useQuery } from '@tanstack/react-query';

export const useDatasetRuns = (datasetId: string, pagination?: { page?: number; perPage?: number }) => {
  const client = useMastraClient();
  return useQuery({
    queryKey: ['dataset-runs', datasetId, pagination],
    queryFn: () => client.listDatasetRuns(datasetId, pagination),
    enabled: Boolean(datasetId),
  });
};

export const useDatasetRun = (runId: string) => {
  const client = useMastraClient();
  return useQuery({
    queryKey: ['dataset-run', runId],
    queryFn: () => client.getDatasetRun(runId),
    enabled: Boolean(runId),
    gcTime: 0,
    staleTime: 0,
    refetchInterval: (query) => {
      // Poll while running, stop when complete
      const status = query.state.data?.status;
      return status === 'running' || status === 'pending' ? 2000 : false;
    },
  });
};

export const useDatasetRunResults = (runId: string, pagination?: { page?: number; perPage?: number }) => {
  const client = useMastraClient();
  return useQuery({
    queryKey: ['dataset-run-results', runId, pagination],
    queryFn: () => client.listDatasetRunResults(runId, pagination),
    enabled: Boolean(runId),
  });
};
```

4. Create use-compare-runs.ts:
```typescript
import { useMastraClient } from '@mastra/react';
import { useQuery } from '@tanstack/react-query';
import type { CompareRunsParams } from '@mastra/client-js';

export const useCompareRuns = (runIdA: string, runIdB: string, options?: Omit<CompareRunsParams, 'runIdA' | 'runIdB'>) => {
  const client = useMastraClient();
  return useQuery({
    queryKey: ['compare-runs', runIdA, runIdB, options],
    queryFn: () => client.compareRuns({ runIdA, runIdB, ...options }),
    enabled: Boolean(runIdA) && Boolean(runIdB),
  });
};
```

5. Create index.ts with re-exports:
```typescript
// Hooks
export * from './hooks/use-datasets';
export * from './hooks/use-dataset-runs';
export * from './hooks/use-compare-runs';
```
  </action>
  <verify>TypeScript compiles: `cd packages/playground-ui && pnpm tsc --noEmit`</verify>
  <done>Query hooks created for datasets, runs, and comparison</done>
</task>

<task type="auto">
  <name>Task 2: Create mutation hooks and update framework paths</name>
  <files>
    packages/playground-ui/src/domains/datasets/hooks/use-dataset-mutations.ts
    packages/playground-ui/src/domains/datasets/index.ts
    packages/playground-ui/src/lib/framework.tsx
    packages/playground-ui/src/index.ts
  </files>
  <action>
1. Create use-dataset-mutations.ts:
```typescript
import { useMastraClient } from '@mastra/react';
import { useMutation, useQueryClient } from '@tanstack/react-query';
import type {
  CreateDatasetParams,
  UpdateDatasetParams,
  AddDatasetItemParams,
  UpdateDatasetItemParams,
  TriggerDatasetRunParams,
} from '@mastra/client-js';

export const useDatasetMutations = () => {
  const client = useMastraClient();
  const queryClient = useQueryClient();

  const createDataset = useMutation({
    mutationFn: (params: CreateDatasetParams) => client.createDataset(params),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['datasets'] });
    },
  });

  const updateDataset = useMutation({
    mutationFn: (params: UpdateDatasetParams) => client.updateDataset(params),
    onSuccess: (_, variables) => {
      queryClient.invalidateQueries({ queryKey: ['datasets'] });
      queryClient.invalidateQueries({ queryKey: ['dataset', variables.datasetId] });
    },
  });

  const deleteDataset = useMutation({
    mutationFn: (datasetId: string) => client.deleteDataset(datasetId),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['datasets'] });
    },
  });

  const addItem = useMutation({
    mutationFn: (params: AddDatasetItemParams) => client.addDatasetItem(params),
    onSuccess: (_, variables) => {
      queryClient.invalidateQueries({ queryKey: ['dataset-items', variables.datasetId] });
      queryClient.invalidateQueries({ queryKey: ['dataset', variables.datasetId] });
    },
  });

  const updateItem = useMutation({
    mutationFn: (params: UpdateDatasetItemParams) => client.updateDatasetItem(params),
    onSuccess: (_, variables) => {
      queryClient.invalidateQueries({ queryKey: ['dataset-items', variables.datasetId] });
    },
  });

  const deleteItem = useMutation({
    mutationFn: ({ datasetId, itemId }: { datasetId: string; itemId: string }) =>
      client.deleteDatasetItem(datasetId, itemId),
    onSuccess: (_, variables) => {
      queryClient.invalidateQueries({ queryKey: ['dataset-items', variables.datasetId] });
      queryClient.invalidateQueries({ queryKey: ['dataset', variables.datasetId] });
    },
  });

  const triggerRun = useMutation({
    mutationFn: (params: TriggerDatasetRunParams) => client.triggerDatasetRun(params),
    onSuccess: (_, variables) => {
      queryClient.invalidateQueries({ queryKey: ['dataset-runs', variables.datasetId] });
    },
  });

  return {
    createDataset,
    updateDataset,
    deleteDataset,
    addItem,
    updateItem,
    deleteItem,
    triggerRun,
  };
};
```

2. Update datasets/index.ts to export mutations:
```typescript
export * from './hooks/use-dataset-mutations';
```

3. Update lib/framework.tsx - add dataset paths to useLinkComponent:
Find the paths object in useLinkComponent and add:
```typescript
datasetLink: (datasetId: string) => `/datasets/${datasetId}`,
datasetRunLink: (datasetId: string, runId: string) => `/datasets/${datasetId}/runs/${runId}`,
```

4. Update playground-ui/src/index.ts - add datasets domain export:
```typescript
export * from './domains/datasets';
```
  </action>
  <verify>
1. TypeScript compiles: `cd packages/playground-ui && pnpm tsc --noEmit`
2. Exports exist: grep for "useDatasetMutations" in src/index.ts
  </verify>
  <done>Mutation hooks created and domain exported from playground-ui</done>
</task>

</tasks>

<verification>
1. All TypeScript compiles in playground-ui
2. useDatasets, useDatasetRuns, useCompareRuns hooks exported
3. useDatasetMutations hook exported with all mutations
4. useLinkComponent().paths includes datasetLink
5. Hooks follow TanStack Query patterns from existing domains
</verification>

<success_criteria>
- useDatasets() hook works with TanStack Query
- useDatasetRun() hook polls while status is 'running'
- useDatasetMutations() invalidates correct query keys
- All hooks exported from @mastra/playground-ui
</success_criteria>

<output>
After completion, create `.planning/phases/06-playground-integration/06-03-SUMMARY.md`
</output>
