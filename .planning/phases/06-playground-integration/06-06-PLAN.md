---
phase: 06-playground-integration
plan: 06
type: execute
wave: 3
depends_on: ["06-03"]
files_modified:
  - packages/playground-ui/src/domains/datasets/components/results/results-table.tsx
  - packages/playground-ui/src/domains/datasets/components/results/result-detail-dialog.tsx
  - packages/playground-ui/src/domains/datasets/components/comparison/comparison-view.tsx
  - packages/playground-ui/src/domains/datasets/components/comparison/score-delta.tsx
  - packages/playground-ui/src/domains/datasets/index.ts
  - packages/playground/src/pages/datasets/dataset/run/index.tsx
  - packages/playground/src/pages/datasets/dataset/compare/index.tsx
  - packages/playground/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "User can view per-item results in a table"
    - "User can click a result row to see full detail in SideDialog"
    - "User can compare two runs side-by-side"
    - "Version mismatch warning appears when dataset versions differ"
    - "Score deltas show with visual indicators (arrows, colors)"
  artifacts:
    - path: "packages/playground-ui/src/domains/datasets/components/results/results-table.tsx"
      provides: "Table of run results with expandable rows"
    - path: "packages/playground-ui/src/domains/datasets/components/results/result-detail-dialog.tsx"
      provides: "SideDialog for viewing result details"
    - path: "packages/playground-ui/src/domains/datasets/components/comparison/comparison-view.tsx"
      provides: "Side-by-side comparison of two runs"
  key_links:
    - from: "packages/playground-ui/src/domains/datasets/components/comparison/comparison-view.tsx"
      to: "useCompareRuns(runIdA, runIdB)"
      via: "hook call"
    - from: "packages/playground-ui/src/domains/datasets/components/results/result-detail-dialog.tsx"
      to: "SideDialog"
      via: "ds/components import"
---

<objective>
Create results view and comparison UI for dataset runs.

Purpose: Allow users to view run results and compare runs for regression detection.
Output: Complete results table, detail dialog, and comparison view.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-playground-integration/06-CONTEXT.md
@.planning/phases/06-playground-integration/06-RESEARCH.md
@.planning/phases/06-playground-integration/06-03-SUMMARY.md

# Reference patterns
@packages/playground-ui/src/domains/observability/components/trace-dialog.tsx
@packages/playground-ui/src/ds/components/SideDialog.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create results table and detail dialog</name>
  <files>
    packages/playground-ui/src/domains/datasets/components/results/results-table.tsx
    packages/playground-ui/src/domains/datasets/components/results/result-detail-dialog.tsx
  </files>
  <action>
Create results components following RESEARCH.md patterns.

1. Create results-table.tsx:
- Table columns: item ID, input (preview), output (preview), scores, status, error
- Status: checkmark for success, X for error
- Error column: show error message if present
- Scores column: show comma-separated scorer scores
- Row click opens result detail dialog
- Track selectedResultId in state
- Props: results: DatasetRunResult[], scores: ScoreData[], isLoading: boolean

```typescript
interface ResultsTableProps {
  results: DatasetRunResult[];
  scores: Record<string, ScoreData[]>; // keyed by itemId
  isLoading: boolean;
}

function ResultsTable({ results, scores, isLoading }: ResultsTableProps) {
  const [selectedResultId, setSelectedResultId] = useState<string | null>(null);
  const selectedResult = results.find(r => r.id === selectedResultId);

  // ... table implementation

  return (
    <>
      <Table>
        {/* ... rows with onClick={() => setSelectedResultId(result.id)} */}
      </Table>

      {selectedResult && (
        <ResultDetailDialog
          result={selectedResult}
          scores={scores[selectedResult.itemId] ?? []}
          isOpen={Boolean(selectedResultId)}
          onClose={() => setSelectedResultId(null)}
          onNext={handleNext}
          onPrevious={handlePrevious}
        />
      )}
    </>
  );
}
```

2. Create result-detail-dialog.tsx using SideDialog pattern:
- Use SideDialog from ds/components
- Show full input, output, error details
- Show scores table if present
- Navigation: onNext, onPrevious props for cycling through results
- Tabs: Input, Output, Scores (if applicable)

```typescript
interface ResultDetailDialogProps {
  result: DatasetRunResult;
  scores: ScoreData[];
  isOpen: boolean;
  onClose: () => void;
  onNext?: () => void;
  onPrevious?: () => void;
}

function ResultDetailDialog({ result, scores, isOpen, onClose, onNext, onPrevious }: ResultDetailDialogProps) {
  return (
    <SideDialog
      dialogTitle="Result Details"
      dialogDescription={`Item: ${result.itemId}`}
      isOpen={isOpen}
      onClose={onClose}
      level={2}
    >
      <SideDialog.Top>
        <span>Item {result.itemId}</span>
        <SideDialog.Nav onNext={onNext} onPrevious={onPrevious} />
      </SideDialog.Top>

      <SideDialog.Content>
        {/* Tabs for Input, Output, Scores */}
      </SideDialog.Content>
    </SideDialog>
  );
}
```
  </action>
  <verify>TypeScript compiles: `cd packages/playground-ui && pnpm tsc --noEmit`</verify>
  <done>Results table and detail dialog created</done>
</task>

<task type="auto">
  <name>Task 2: Create comparison view and pages</name>
  <files>
    packages/playground-ui/src/domains/datasets/components/comparison/comparison-view.tsx
    packages/playground-ui/src/domains/datasets/components/comparison/score-delta.tsx
    packages/playground-ui/src/domains/datasets/index.ts
    packages/playground/src/pages/datasets/dataset/run/index.tsx
    packages/playground/src/pages/datasets/dataset/compare/index.tsx
    packages/playground/src/App.tsx
  </files>
  <action>
1. Create score-delta.tsx helper component:
```typescript
interface ScoreDeltaProps {
  delta: number;
  regressed: boolean;
}

function ScoreDelta({ delta, regressed }: ScoreDeltaProps) {
  const color = regressed ? 'text-red-500' : delta > 0 ? 'text-green-500' : 'text-neutral3';
  const arrow = delta > 0 ? '↑' : delta < 0 ? '↓' : '–';
  return (
    <span className={cn('font-mono text-sm', color)}>
      {arrow} {Math.abs(delta).toFixed(2)}
    </span>
  );
}
```

2. Create comparison-view.tsx following RESEARCH.md pattern:
- Use useCompareRuns(runIdA, runIdB) hook
- Show version mismatch warning with Alert if versionMismatch is true
- Summary section: show per-scorer stats (avgA, avgB, delta, regressed)
- Per-item table: itemId, output A preview, output B preview, score deltas
- Handle loading state
- Props: runIdA: string, runIdB: string

3. Update datasets/index.ts to export new components:
```typescript
export { ResultsTable } from './components/results/results-table';
export { ResultDetailDialog } from './components/results/result-detail-dialog';
export { ComparisonView } from './components/comparison/comparison-view';
export { ScoreDelta } from './components/comparison/score-delta';
```

4. Create packages/playground/src/pages/datasets/dataset/run/index.tsx:
- Get runId from params
- Use useDatasetRun(runId) and useDatasetRunResults(runId)
- Show run status, target info, created time
- Render ResultsTable with results and scores
```typescript
function DatasetRun() {
  const { datasetId, runId } = useParams<{ datasetId: string; runId: string }>();
  const { data: run, isLoading: runLoading } = useDatasetRun(runId!);
  const { data: resultsData, isLoading: resultsLoading } = useDatasetRunResults(runId!);

  // ... render run header and ResultsTable
}
```

5. Create packages/playground/src/pages/datasets/dataset/compare/index.tsx:
- Get runIdA and runIdB from query params (e.g., ?runA=xxx&runB=yyy)
- Render ComparisonView with runIdA and runIdB
```typescript
function DatasetCompare() {
  const { datasetId } = useParams<{ datasetId: string }>();
  const [searchParams] = useSearchParams();
  const runIdA = searchParams.get('runA') ?? '';
  const runIdB = searchParams.get('runB') ?? '';

  if (!runIdA || !runIdB) {
    return <div>Select two runs to compare</div>;
  }

  return (
    <MainContentLayout>
      <MainContentContent>
        <ComparisonView runIdA={runIdA} runIdB={runIdB} />
      </MainContentContent>
    </MainContentLayout>
  );
}
```

6. Update App.tsx - add routes:
```typescript
{
  path: '/datasets/:datasetId/runs/:runId',
  lazy: async () => {
    const { DatasetRun } = await import('./pages/datasets/dataset/run');
    return { Component: DatasetRun };
  },
},
{
  path: '/datasets/:datasetId/compare',
  lazy: async () => {
    const { DatasetCompare } = await import('./pages/datasets/dataset/compare');
    return { Component: DatasetCompare };
  },
},
```
  </action>
  <verify>
1. TypeScript compiles: `cd packages/playground && pnpm tsc --noEmit`
2. Routes exist: grep for "compare" in App.tsx
  </verify>
  <done>Comparison view and pages created</done>
</task>

</tasks>

<verification>
1. All TypeScript compiles
2. ResultsTable shows per-item results with expandable detail
3. ResultDetailDialog shows full input/output/scores
4. ComparisonView shows side-by-side with score deltas
5. Version mismatch warning appears when applicable
6. Routes for /datasets/:datasetId/runs/:runId and /datasets/:datasetId/compare work
</verification>

<success_criteria>
- User can view run results at /datasets/:datasetId/runs/:runId
- User can click result row to see full detail in SideDialog
- User can compare runs at /datasets/:datasetId/compare?runA=...&runB=...
- Comparison shows version mismatch warning when needed
- Score deltas show visual indicators (arrows, colors)
</success_criteria>

<output>
After completion, create `.planning/phases/06-playground-integration/06-06-SUMMARY.md`
</output>
