---
phase: 08-item-selection-actions
plan: 04
type: execute
wave: 3
depends_on: ["08-01", "08-02", "08-03"]
files_modified:
  - packages/playground-ui/src/domains/datasets/components/dataset-detail/items-list.tsx
  - packages/playground-ui/src/domains/datasets/components/dataset-detail/dataset-detail.tsx
autonomous: true

must_haves:
  truths:
    - "User can select items via checkboxes (single click toggles, shift-click ranges)"
    - "Three-dot menu appears when dataset has â‰¥1 item"
    - "Export to CSV downloads selected items immediately"
    - "Create Dataset opens modal with selected items"
    - "Delete Items shows confirmation and removes selected items"
    - "Selection clears after action completes with success toast"
  artifacts:
    - path: "packages/playground-ui/src/domains/datasets/components/dataset-detail/items-list.tsx"
      provides: "Items list with selection checkboxes and action bar"
      min_lines: 200
    - path: "packages/playground-ui/src/domains/datasets/components/dataset-detail/dataset-detail.tsx"
      provides: "Dataset detail with bulk action dialogs"
  key_links:
    - from: "items-list.tsx"
      to: "use-item-selection.ts"
      via: "hook usage"
      pattern: "useItemSelection"
    - from: "items-list.tsx"
      to: "csv-export.ts"
      via: "function call"
      pattern: "exportItemsToCSV"
    - from: "dataset-detail.tsx"
      to: "create-dataset-from-items-dialog.tsx"
      via: "component usage"
      pattern: "CreateDatasetFromItemsDialog"
---

<objective>
Integrate selection, actions, and dialogs into ItemsList and DatasetDetail.

Purpose: Complete the bulk operations UI flow
Output: Fully functional item selection with Export/Create Dataset/Delete actions
</objective>

<execution_context>
@/Users/yj/.claude/get-shit-done/workflows/execute-plan.md
@/Users/yj/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-item-selection-actions/08-RESEARCH.md
@.planning/phases/08-item-selection-actions/08-01-SUMMARY.md
@.planning/phases/08-item-selection-actions/08-02-SUMMARY.md
@.planning/phases/08-item-selection-actions/08-03-SUMMARY.md

# Files to modify
@packages/playground-ui/src/domains/datasets/components/dataset-detail/items-list.tsx
@packages/playground-ui/src/domains/datasets/components/dataset-detail/dataset-detail.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add selection mode to ItemsList</name>
  <files>packages/playground-ui/src/domains/datasets/components/dataset-detail/items-list.tsx</files>
  <action>
Modify ItemsList to add selection checkboxes and selection mode state.

New imports:
```typescript
import { Checkbox } from '@/ds/components/Checkbox';
import { useItemSelection } from '../../hooks/use-item-selection';
import { exportItemsToCSV } from '../../utils/csv-export';
import { ActionsMenu } from './items-list-actions';
import { toast } from '@/lib/toast';
```

Add to ItemsListProps:
```typescript
onBulkDeleteClick?: (itemIds: string[]) => void;
onCreateDatasetClick?: (items: DatasetItem[]) => void;
datasetName?: string;  // For CSV filename
```

Inside ItemsList component:
1. Add selection = useItemSelection()
2. Track selectionMode state: 'idle' | 'export' | 'create-dataset' | 'delete'
3. Compute allIds = items.map(i => i.id)
4. Compute selectedItems = items.filter(i => selection.isSelected(i.id))

Add checkbox column to table header (only when selectionMode !== 'idle'):
```tsx
{selectionMode !== 'idle' && (
  <Th style={{ width: 40 }}>
    <Checkbox
      checked={selection.selectedCount === items.length && items.length > 0}
      onCheckedChange={(checked) => {
        if (checked) selection.selectAll(allIds);
        else selection.clearSelection();
      }}
      aria-label="Select all items"
    />
  </Th>
)}
```

Add checkbox cell to each row (only when selectionMode !== 'idle'):
```tsx
{selectionMode !== 'idle' && (
  <Cell>
    <Checkbox
      checked={selection.isSelected(item.id)}
      onCheckedChange={() => {}}
      onClick={(e) => {
        e.stopPropagation();
        selection.toggle(item.id, e.shiftKey, allIds);
      }}
      aria-label={`Select item ${item.id}`}
    />
  </Cell>
)}
```

Replace action buttons area with selection mode UI:
```tsx
{selectionMode !== 'idle' ? (
  <div className="flex items-center gap-2">
    <span className="text-sm text-neutral3">
      {selection.selectedCount} selected
    </span>
    <Button
      variant="primary"
      size="sm"
      disabled={selection.selectedCount === 0}
      onClick={handleExecuteAction}
    >
      {selectionMode === 'export' && 'Export CSV'}
      {selectionMode === 'create-dataset' && 'Create Dataset'}
      {selectionMode === 'delete' && 'Delete'}
    </Button>
    <Button variant="ghost" size="sm" onClick={handleCancelSelection}>
      Cancel
    </Button>
  </div>
) : (
  <div className="flex items-center gap-2">
    {onImportClick && (
      <Button variant="outline" size="sm" onClick={onImportClick}>
        <Icon><Upload /></Icon>
        Import CSV
      </Button>
    )}
    <Button variant="outline" size="sm" onClick={onAddClick}>
      <Icon><Plus /></Icon>
      Add Item
    </Button>
    {items.length > 0 && (
      <ActionsMenu
        onExportClick={() => setSelectionMode('export')}
        onCreateDatasetClick={() => setSelectionMode('create-dataset')}
        onDeleteClick={() => setSelectionMode('delete')}
      />
    )}
  </div>
)}
```

Add handler functions:
```typescript
const handleCancelSelection = () => {
  setSelectionMode('idle');
  selection.clearSelection();
};

const handleExecuteAction = () => {
  if (selection.selectedCount === 0) return;

  if (selectionMode === 'export') {
    exportItemsToCSV(selectedItems, `${datasetName || 'dataset'}-items.csv`);
    toast.success(`Exported ${selection.selectedCount} items to CSV`);
    handleCancelSelection();
  } else if (selectionMode === 'create-dataset') {
    onCreateDatasetClick?.(selectedItems);
    // Don't clear selection yet - dialog will handle it
  } else if (selectionMode === 'delete') {
    onBulkDeleteClick?.(Array.from(selection.selectedIds));
    // Don't clear selection yet - confirmation will handle it
  }
};
```
  </action>
  <verify>
```bash
cd /Users/yj/.superset/worktrees/mastra/test-gsd/packages/playground-ui
pnpm exec tsc --noEmit src/domains/datasets/components/dataset-detail/items-list.tsx
```
  </verify>
  <done>ItemsList has checkbox selection and action mode UI</done>
</task>

<task type="auto">
  <name>Task 2: Wire dialogs and callbacks in DatasetDetail</name>
  <files>packages/playground-ui/src/domains/datasets/components/dataset-detail/dataset-detail.tsx</files>
  <action>
First read the current dataset-detail.tsx to understand its structure.

Add new imports:
```typescript
import { CreateDatasetFromItemsDialog } from '../create-dataset-from-items-dialog';
import { AlertDialog } from '@/ds/components/AlertDialog';
```

Add state for bulk operations:
```typescript
const [createDialogOpen, setCreateDialogOpen] = useState(false);
const [itemsForCreate, setItemsForCreate] = useState<DatasetItem[]>([]);
const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);
const [itemIdsToDelete, setItemIdsToDelete] = useState<string[]>([]);
```

Get deleteItems from useDatasetMutations:
```typescript
const { deleteItems } = useDatasetMutations();
```

Add handlers:
```typescript
const handleCreateDatasetClick = (items: DatasetItem[]) => {
  setItemsForCreate(items);
  setCreateDialogOpen(true);
};

const handleBulkDeleteClick = (itemIds: string[]) => {
  setItemIdsToDelete(itemIds);
  setDeleteDialogOpen(true);
};

const handleBulkDeleteConfirm = async () => {
  await deleteItems.mutateAsync({ datasetId, itemIds: itemIdsToDelete });
  toast.success(`Deleted ${itemIdsToDelete.length} items`);
  setDeleteDialogOpen(false);
  setItemIdsToDelete([]);
};

const handleCreateSuccess = (newDatasetId: string) => {
  setCreateDialogOpen(false);
  setItemsForCreate([]);
  // Optionally navigate to new dataset
  onNavigateToDataset?.(newDatasetId);
};
```

Pass new props to ItemsList:
```tsx
<ItemsList
  items={items}
  isLoading={isLoading}
  onAddClick={onAddItemClick}
  onEditItem={onEditItem}
  onDeleteItem={onDeleteItem}
  onImportClick={onImportClick}
  onBulkDeleteClick={handleBulkDeleteClick}
  onCreateDatasetClick={handleCreateDatasetClick}
  datasetName={dataset?.name}
/>
```

Add dialogs after existing dialogs:
```tsx
<CreateDatasetFromItemsDialog
  open={createDialogOpen}
  onOpenChange={setCreateDialogOpen}
  items={itemsForCreate}
  onSuccess={handleCreateSuccess}
/>

<AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>
  <AlertDialog.Content>
    <AlertDialog.Header>
      <AlertDialog.Title>Delete Items</AlertDialog.Title>
      <AlertDialog.Description>
        Are you sure you want to delete {itemIdsToDelete.length} items? This action cannot be undone.
      </AlertDialog.Description>
    </AlertDialog.Header>
    <AlertDialog.Footer>
      <AlertDialog.Cancel>Cancel</AlertDialog.Cancel>
      <AlertDialog.Action onClick={handleBulkDeleteConfirm}>
        {deleteItems.isPending ? 'Deleting...' : 'Delete'}
      </AlertDialog.Action>
    </AlertDialog.Footer>
  </AlertDialog.Content>
</AlertDialog>
```

Add optional onNavigateToDataset prop to DatasetDetailProps if not already present.
  </action>
  <verify>
```bash
cd /Users/yj/.superset/worktrees/mastra/test-gsd/packages/playground-ui
pnpm build
```
  </verify>
  <done>DatasetDetail wires bulk actions to dialogs and mutations</done>
</task>

</tasks>

<verification>
```bash
cd /Users/yj/.superset/worktrees/mastra/test-gsd
pnpm build:packages

# Manual verification checklist (for UAT):
# 1. Open dataset with items in playground
# 2. Click three-dot menu - should show Export/Create Dataset/Delete
# 3. Click Export - should enter selection mode
# 4. Click checkboxes to select items
# 5. Shift-click to range select
# 6. Click "Export CSV" - should download file
# 7. Cancel and try Create Dataset - should open dialog
# 8. Cancel and try Delete - should show confirmation
```
</verification>

<success_criteria>
- Checkboxes appear in selection mode
- Shift-click range selection works
- Export downloads CSV immediately
- Create Dataset opens dialog with selected items
- Delete shows confirmation and removes items
- Selection clears after action completes
</success_criteria>

<output>
After completion, create `.planning/phases/08-item-selection-actions/08-04-SUMMARY.md`
</output>
