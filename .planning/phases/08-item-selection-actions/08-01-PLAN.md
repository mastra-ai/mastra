---
phase: 08-item-selection-actions
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/playground-ui/src/domains/datasets/hooks/use-item-selection.ts
  - packages/playground-ui/src/domains/datasets/utils/csv-export.ts
  - packages/playground-ui/src/domains/datasets/index.ts
autonomous: true

must_haves:
  truths:
    - "Selection state hook tracks selected IDs with add/remove/toggle/clear"
    - "Shift-click range selection works based on visible item order"
    - "CSV export generates valid CSV from dataset items"
  artifacts:
    - path: "packages/playground-ui/src/domains/datasets/hooks/use-item-selection.ts"
      provides: "Selection state management hook"
      exports: ["useItemSelection"]
    - path: "packages/playground-ui/src/domains/datasets/utils/csv-export.ts"
      provides: "CSV export utility"
      exports: ["exportItemsToCSV"]
  key_links:
    - from: "use-item-selection.ts"
      to: "items-list.tsx (plan 02)"
      via: "hook import"
      pattern: "useItemSelection"
    - from: "csv-export.ts"
      to: "items-list-actions.tsx (plan 02)"
      via: "function import"
      pattern: "exportItemsToCSV"
---

<objective>
Create foundation utilities for item selection and CSV export.

Purpose: Enable selection state management and CSV export before integrating into UI
Output: useItemSelection hook + exportItemsToCSV utility
</objective>

<execution_context>
@/Users/yj/.claude/get-shit-done/workflows/execute-plan.md
@/Users/yj/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-item-selection-actions/08-RESEARCH.md

# Existing patterns
@packages/playground-ui/src/domains/datasets/hooks/use-csv-parser.ts
@packages/playground-ui/src/domains/datasets/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useItemSelection hook</name>
  <files>packages/playground-ui/src/domains/datasets/hooks/use-item-selection.ts</files>
  <action>
Create selection state hook with:
- `selectedIds: Set<string>` state
- `lastClickedId: string | null` for range selection anchor
- `isSelected(id: string): boolean` helper
- `toggle(id: string, shiftKey: boolean, allIds: string[])` - single toggle or range select
- `selectAll(ids: string[])` - select all provided IDs
- `clearSelection()` - reset to empty
- `selectedCount: number` derived from set size

Range selection logic (toggle with shiftKey=true):
1. Find lastClickedId index in allIds
2. Find current id index in allIds
3. Add all IDs between indices (inclusive) to selection
4. Update lastClickedId to current id

Single toggle logic (shiftKey=false):
1. If ID in set, remove it
2. If ID not in set, add it
3. Update lastClickedId to current id

Use `useCallback` for all methods to prevent unnecessary re-renders.
Add 'use client' directive at top.
  </action>
  <verify>
```bash
cd /Users/yj/.superset/worktrees/mastra/test-gsd/packages/playground-ui
pnpm exec tsc --noEmit src/domains/datasets/hooks/use-item-selection.ts
```
  </verify>
  <done>Hook exports all required methods and types</done>
</task>

<task type="auto">
  <name>Task 2: Create CSV export utility</name>
  <files>packages/playground-ui/src/domains/datasets/utils/csv-export.ts</files>
  <action>
Create exportItemsToCSV function:
```typescript
import Papa from 'papaparse';
import type { DatasetItem } from '@mastra/client-js';

export function exportItemsToCSV(items: DatasetItem[], filename: string): void
```

Implementation:
1. Map items to rows with columns: input, expectedOutput, createdAt
2. For input/expectedOutput: if string keep as-is, else JSON.stringify
3. For createdAt: convert to ISO string
4. Use Papa.unparse with { quotes: true, header: true }
5. Create Blob with type 'text/csv;charset=utf-8;'
6. Create object URL, programmatically click link, revoke URL

Handle edge cases:
- Empty items array: create CSV with headers only
- null/undefined expectedOutput: use empty string
  </action>
  <verify>
```bash
cd /Users/yj/.superset/worktrees/mastra/test-gsd/packages/playground-ui
pnpm exec tsc --noEmit src/domains/datasets/utils/csv-export.ts
```
  </verify>
  <done>exportItemsToCSV function creates downloadable CSV from items</done>
</task>

<task type="auto">
  <name>Task 3: Export from domain index</name>
  <files>packages/playground-ui/src/domains/datasets/index.ts</files>
  <action>
Add exports to index.ts:
1. Add `export * from './hooks/use-item-selection';` after use-csv-parser export
2. Add `export * from './utils/csv-export';` after json-cell-parser export

Place in logical groupings with existing exports.
  </action>
  <verify>
```bash
cd /Users/yj/.superset/worktrees/mastra/test-gsd/packages/playground-ui
pnpm build
```
  </verify>
  <done>useItemSelection and exportItemsToCSV exported from @mastra/playground-ui</done>
</task>

</tasks>

<verification>
```bash
cd /Users/yj/.superset/worktrees/mastra/test-gsd/packages/playground-ui
pnpm build

# Verify exports
grep -l "useItemSelection" dist/src/domains/datasets/hooks/use-item-selection.d.ts
grep -l "exportItemsToCSV" dist/src/domains/datasets/utils/csv-export.d.ts
```
</verification>

<success_criteria>
- useItemSelection hook created with selection management
- exportItemsToCSV utility creates downloadable CSV
- Both exported from package index
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/08-item-selection-actions/08-01-SUMMARY.md`
</output>
