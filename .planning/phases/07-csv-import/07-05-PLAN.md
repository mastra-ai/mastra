---
phase: 07-csv-import
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/playground-ui/src/domains/datasets/hooks/use-column-mapping.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - 'useColumnMapping rebuilds mapping when headers array changes'
    - 'CSV columns appear in Ignore zone after file is parsed'
    - 'Mapping state stays in sync with headers prop'
  artifacts:
    - path: 'packages/playground-ui/src/domains/datasets/hooks/use-column-mapping.ts'
      provides: 'useColumnMapping with useEffect sync'
      exports: ['useColumnMapping', 'ColumnMapping']
  key_links:
    - from: 'use-column-mapping.ts'
      to: 'react'
      via: 'useEffect'
      pattern: 'useEffect.*headers'
---

<objective>
Fix useColumnMapping hook to sync mapping state when headers prop changes.

Purpose: CSV columns should appear in Ignore zone after file parse
Root cause: useState initializer runs once with empty headers, never updates
Fix: Add useEffect to rebuild mapping when headers change
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/07-csv-import/07-UAT.md
@.planning/debug/csv-columns-not-appearing.md
@packages/playground-ui/src/domains/datasets/hooks/use-column-mapping.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add useEffect to sync mapping with headers</name>
  <files>packages/playground-ui/src/domains/datasets/hooks/use-column-mapping.ts</files>
  <action>
    Update use-column-mapping.ts:

    1. Add useEffect after useState that rebuilds mapping when headers changes:
       ```typescript
       useEffect(() => {
         // Rebuild mapping when headers change
         const newMapping: ColumnMapping = {};
         for (const header of headers) {
           newMapping[header] = 'ignore';
         }
         setMapping(newMapping);
       }, [headers]);
       ```

    2. The useEffect should:
       - Create a new mapping object with all headers set to 'ignore'
       - Call setMapping to update state
       - Depend on headers array

    3. Keep the useState initializer for SSR/initial render, but useEffect handles updates

  </action>
  <verify>
    TypeScript compiles: `cd packages/playground-ui && pnpm tsc --noEmit`
  </verify>
  <done>useColumnMapping rebuilds mapping when headers prop changes</done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `cd packages/playground-ui && pnpm tsc --noEmit`
2. useEffect exists: `grep "useEffect" packages/playground-ui/src/domains/datasets/hooks/use-column-mapping.ts`
3. Headers dependency: `grep -A5 "useEffect" packages/playground-ui/src/domains/datasets/hooks/use-column-mapping.ts | grep "headers"`
</verification>

<success_criteria>

- useEffect syncs mapping state with headers prop
- TypeScript compiles without errors
- Manual test: CSV columns appear in Ignore zone after file parse
  </success_criteria>

<output>
After completion, create `.planning/phases/07-csv-import/07-05-SUMMARY.md`
</output>
