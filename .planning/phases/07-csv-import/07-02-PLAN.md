---
phase: 07-csv-import
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/playground-ui/src/domains/datasets/components/csv-import/column-mapping-step.tsx
  - packages/playground-ui/src/domains/datasets/hooks/use-column-mapping.ts
autonomous: true

must_haves:
  truths:
    - "User can see all CSV columns as draggable chips"
    - "User can drag columns to input/expectedOutput/metadata/ignore zones"
    - "Columns default to 'ignore' zone on first render"
    - "Dropping on a zone updates the column mapping state"
    - "At least one column must be in input zone for valid mapping"
  artifacts:
    - path: "packages/playground-ui/src/domains/datasets/components/csv-import/column-mapping-step.tsx"
      provides: "Drag-drop column mapping UI"
      exports: ["ColumnMappingStep"]
    - path: "packages/playground-ui/src/domains/datasets/hooks/use-column-mapping.ts"
      provides: "Column mapping state management"
      exports: ["useColumnMapping", "ColumnMapping"]
  key_links:
    - from: "column-mapping-step.tsx"
      to: "@hello-pangea/dnd"
      via: "DragDropContext, Droppable, Draggable"
      pattern: "DragDropContext"
    - from: "column-mapping-step.tsx"
      to: "use-column-mapping.ts"
      via: "hook import"
      pattern: "useColumnMapping"
---

<objective>
Create drag-drop column mapping UI for CSV import flow.

Purpose: Users explicitly map CSV columns to dataset fields
Output: Reusable column mapping component with state management hook
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-csv-import/07-CONTEXT.md
@.planning/phases/07-csv-import/07-RESEARCH.md
@packages/playground-ui/src/domains/agents/components/agent-metadata/agent-metadata-model-list.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create column mapping state hook</name>
  <files>packages/playground-ui/src/domains/datasets/hooks/use-column-mapping.ts</files>
  <action>
    Create use-column-mapping.ts with:

    1. Export ColumnMapping type: `Record<string, 'input' | 'expectedOutput' | 'metadata' | 'ignore'>`

    2. Export FieldType type: `'input' | 'expectedOutput' | 'metadata' | 'ignore'`

    3. Create `useColumnMapping(headers: string[])` hook:
       - Initialize mapping with all columns as 'ignore'
       - Return `{ mapping, setColumnField, resetMapping, isInputMapped }`
       - `setColumnField(column: string, field: FieldType)` updates mapping
       - `resetMapping()` resets all to 'ignore'
       - `isInputMapped` computed boolean (at least one column is 'input')

    4. Use useCallback for setColumnField to maintain stable reference
  </action>
  <verify>
    TypeScript compiles: `cd packages/playground-ui && pnpm tsc --noEmit`
  </verify>
  <done>Column mapping hook provides stable state management for drag-drop</done>
</task>

<task type="auto">
  <name>Task 2: Create column mapping step component</name>
  <files>packages/playground-ui/src/domains/datasets/components/csv-import/column-mapping-step.tsx</files>
  <action>
    Create column-mapping-step.tsx using existing @hello-pangea/dnd pattern from agent-metadata-model-list.tsx:

    1. Props interface:
       ```typescript
       interface ColumnMappingStepProps {
         headers: string[];
         mapping: ColumnMapping;
         onMappingChange: (column: string, field: FieldType) => void;
       }
       ```

    2. Create DragDropContext with four Droppable zones:
       - 'input' (required, show indicator if empty)
       - 'expectedOutput' (optional)
       - 'metadata' (optional)
       - 'ignore' (columns to skip)

    3. Each zone displays columns mapped to it as Draggable chips

    4. handleDragEnd:
       - Get column from draggableId
       - Get target field from destination.droppableId
       - Call onMappingChange(column, field)

    5. Styling:
       - Use existing playground-ui design tokens
       - Zones are horizontal rows with flex-wrap
       - Draggable columns are pill/chip styled
       - GripVertical icon from lucide-react for drag handle
       - Highlight input zone if empty (needs attention)

    Reference agent-metadata-model-list.tsx for drag-drop pattern.
  </action>
  <verify>
    TypeScript compiles: `cd packages/playground-ui && pnpm tsc --noEmit`
  </verify>
  <done>
    Column mapping component renders four drop zones with draggable column chips.
    Drag-drop updates mapping state correctly.
  </done>
</task>

</tasks>

<verification>
1. Files exist:
   - packages/playground-ui/src/domains/datasets/hooks/use-column-mapping.ts
   - packages/playground-ui/src/domains/datasets/components/csv-import/column-mapping-step.tsx
2. TypeScript compiles: `cd packages/playground-ui && pnpm tsc --noEmit`
3. DragDropContext import: `grep -l "DragDropContext" packages/playground-ui/src/domains/datasets/components/csv-import/column-mapping-step.tsx`
4. useColumnMapping exported: `grep "export.*useColumnMapping" packages/playground-ui/src/domains/datasets/hooks/use-column-mapping.ts`
</verification>

<success_criteria>
- Column mapping hook initializes all columns to 'ignore'
- Hook tracks whether input has at least one column mapped
- Component renders four drop zones with correct labels
- Dragging a column to a zone updates the mapping
- Component uses existing design system tokens (not custom colors)
</success_criteria>

<output>
After completion, create `.planning/phases/07-csv-import/07-02-SUMMARY.md`
</output>
