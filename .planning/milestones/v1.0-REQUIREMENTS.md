# Requirements Archive: v1.0 Mastra Browser Tools

**Archived:** 2026-01-27
**Status:** SHIPPED

This is the archived requirements specification for v1.0.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

# Requirements: Mastra Browser Tools v1

**Project:** Mastra Browser Tools
**Version:** 1.0
**Created:** 2026-01-26

---

## REQ-01: BrowserToolset Class

**Priority:** P0 (Critical)
**Phase:** 1
**Status:** COMPLETE

The integration must provide a `BrowserToolset` class that:
- Exposes all browser tools as a cohesive bundle
- Manages browser lifecycle (launch on first use, explicit cleanup)
- Follows Mastra integration patterns
- Lives in `integrations/agent-browser/`

**Acceptance Criteria:**
- [x] Class exports `tools` record compatible with Mastra agent registration
- [x] Single browser instance shared across tool calls
- [x] `close()` method for explicit cleanup
- [x] Compatible with `@mastra/core` peer dependency

**Outcome:** Implemented in `toolset.ts:35-158` with Singleton Promise pattern for thread-safe lazy initialization.

---

## REQ-02: Navigate Tool

**Priority:** P0 (Critical)
**Phase:** 1
**Status:** COMPLETE
**Dependencies:** REQ-01

Tool to navigate the browser to a URL.

**Acceptance Criteria:**
- [x] Triggers browser launch if not already running
- [x] Returns clear error on navigation failure
- [x] Timeout defaults to 10 seconds
- [x] Handles context.abortSignal

**Outcome:** Implemented in `tools/navigate.ts` with unified BrowserToolError handling (fixed in Phase 4).

---

## REQ-03: Snapshot Tool

**Priority:** P0 (Critical)
**Phase:** 2
**Status:** COMPLETE
**Dependencies:** REQ-01

Tool to capture accessibility tree snapshot with element refs.

**Acceptance Criteria:**
- [x] Generates deterministic refs (@e1, @e2, etc.)
- [x] Refs stored for subsequent click/type operations
- [x] Previous refs invalidated on new snapshot
- [x] Output optimized for LLM consumption (not raw DOM)

**Outcome:** Implemented in `tools/snapshot.ts` with pagination support and option filtering.

---

## REQ-04: Click Tool

**Priority:** P0 (Critical)
**Phase:** 2
**Status:** COMPLETE
**Dependencies:** REQ-03

Tool to click on elements using accessibility refs.

**Acceptance Criteria:**
- [x] Resolves ref to DOM element from current snapshot
- [x] Returns clear error if ref is stale or invalid
- [x] Includes recovery hint in error response
- [x] Timeout defaults to 5 seconds

**Outcome:** Implemented in `tools/click.ts` with stale ref detection and recovery hints.

---

## REQ-05: Type Tool

**Priority:** P0 (Critical)
**Phase:** 2
**Status:** COMPLETE
**Dependencies:** REQ-03

Tool to type text into focused element or element by ref.

**Acceptance Criteria:**
- [x] Verifies focus before typing (prevents first-char drop)
- [x] Small delay after focus before typing
- [x] Handles special characters correctly
- [x] Returns clear error if element not focusable

**Outcome:** Implemented in `tools/type.ts` using Playwright's fill() API for instant, reliable text input.

---

## REQ-06: Scroll Tool

**Priority:** P1 (High)
**Phase:** 2
**Status:** COMPLETE
**Dependencies:** REQ-01

Tool to scroll the page or element.

**Acceptance Criteria:**
- [x] Works without requiring snapshot refs
- [x] Supports both viewport and element scrolling
- [x] Returns new scroll position

**Outcome:** Implemented in `tools/scroll.ts` with viewport and element scroll modes.

---

## REQ-07: Screenshot Tool

**Priority:** P1 (High)
**Phase:** 3
**Status:** COMPLETE
**Dependencies:** REQ-01

Tool to capture screenshot of current page.

**Acceptance Criteria:**
- [x] Returns base64 for direct use in multimodal prompts
- [x] Stores viewport dimensions with screenshot
- [x] Reasonable default resolution (avoid API resizing issues)

**Outcome:** Implemented in `tools/screenshot.ts` with viewport, full-page, and element capture modes. Includes 8000px warning threshold for Claude API limits.

---

## REQ-08: Error Handling

**Priority:** P0 (Critical)
**Phase:** 2 (implemented across all phases)
**Status:** COMPLETE

All tools must implement structured error handling.

**Acceptance Criteria:**
- [x] Never expose stack traces to LLM
- [x] All errors include recovery hints
- [x] Errors indicate if retry is likely to succeed

**Outcome:** Implemented in `errors.ts` with createError() factory. All 6 tools use unified BrowserToolError format.

---

## REQ-09: Resource Cleanup

**Priority:** P0 (Critical)
**Phase:** 1
**Status:** COMPLETE

Browser resources must be properly managed.

**Acceptance Criteria:**
- [x] try/finally pattern in all tool execute functions
- [x] Browser closed on toolset close()
- [x] Handle context.abortSignal to close browser on agent abort
- [x] No memory leaks on repeated tool calls

**Outcome:** Implemented in `toolset.ts:143-157` with proper cleanup in close() method.

---

## REQ-10: Timeout Management

**Priority:** P0 (Critical)
**Phase:** 1
**Status:** COMPLETE

All operations must have sensible timeouts.

**Acceptance Criteria:**
- [x] No operation blocks indefinitely
- [x] Use 'domcontentloaded' not 'networkidle' as default wait
- [x] Timeout errors include what operation timed out

**Outcome:** Implemented with configurable timeouts: 10s navigation, 5s actions, 30s screenshots.

---

## Out of Scope (v2+)

- REQ-FUTURE-01: Session persistence (cookies/storage across runs)
- REQ-FUTURE-02: Form-filling workflows
- REQ-FUTURE-03: Cloud browser providers (Browserbase)
- REQ-FUTURE-04: Multi-tab support
- REQ-FUTURE-05: Authentication persistence
- REQ-FUTURE-06: Coordinate-based clicking fallback

---

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| REQ-01 | Phase 1 | Complete |
| REQ-02 | Phase 1 | Complete |
| REQ-09 | Phase 1 | Complete |
| REQ-10 | Phase 1 | Complete |
| REQ-03 | Phase 2 | Complete |
| REQ-04 | Phase 2 | Complete |
| REQ-05 | Phase 2 | Complete |
| REQ-06 | Phase 2 | Complete |
| REQ-08 | Phase 2 | Complete |
| REQ-07 | Phase 3 | Complete |

---

## Milestone Summary

**Shipped:** 10 of 10 v1 requirements
**Adjusted:** None
**Dropped:** None

All requirements shipped as originally specified.

---

*Archived: 2026-01-27 as part of v1.0 milestone completion*
