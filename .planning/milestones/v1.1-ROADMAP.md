# Milestone v1.1: Browser Live View

**Status:** SHIPPED 2026-01-28
**Phases:** 7-9
**Total Plans:** 5

## Overview

Enable users to watch browser agents work in real-time from within Mastra Studio. CDP screencast capture streams frames via WebSocket to a React panel rendered inline with agent chat.

## Phases

### Phase 7: Screencast API
**Goal**: BrowserToolset exposes methods to control CDP screencast capture and input injection
**Depends on**: Phase 6 (browser lifecycle must be stable)
**Requirements**: CAST-01, CAST-02, CAST-03, CAST-04, CAST-05
**Success Criteria** (what must be TRUE):
  1. Calling `startScreencast()` on BrowserToolset begins receiving CDP frames
  2. Calling `stopScreencast()` stops frame delivery and releases resources
  3. Each received frame triggers CDP `screencastFrameAck` to prevent memory exhaustion
  4. Input injection methods exist (passthrough for future use)
**Plans**: 1 plan

Plans:
- [x] 07-01-PLAN.md — Screencast types, ScreencastStream class, and BrowserToolset integration

### Phase 8: Transport Layer
**Goal**: WebSocket server endpoint relays screencast frames to connected Studio clients
**Depends on**: Phase 7 (needs screencast API)
**Requirements**: XPORT-01, XPORT-02, XPORT-03, XPORT-04
**Success Criteria** (what must be TRUE):
  1. WebSocket connection can be established at `/browser/:agentId/stream`
  2. Connected clients receive CDP frames as they are captured
  3. Disconnecting clients are cleaned up without memory leaks
  4. Screencast only runs when at least one viewer is connected (no wasted CPU)
**Plans**: 2 plans

Plans:
- [x] 08-01-PLAN.md — Browser-stream module with types, ViewerRegistry, and WebSocket route setup
- [x] 08-02-PLAN.md — Server integration with deployer createNodeServer

### Phase 9: Studio UI
**Goal**: BrowserViewPanel component renders live screencast inline with agent chat
**Depends on**: Phase 8 (needs working WebSocket endpoint)
**Requirements**: UI-01, UI-02, UI-03, UI-04, UI-05
**Success Criteria** (what must be TRUE):
  1. Browser panel renders screencast frames inline with agent chat
  2. Frame updates do not cause visible UI lag or freezing
  3. Connection status indicator shows connected/connecting/disconnected states
  4. Empty state displays when no browser is active for the agent
  5. Loading state displays during browser initialization
**Plans**: 2 plans

Plans:
- [x] 09-01-PLAN.md — useBrowserStream hook with BrowserViewFrame and BrowserViewHeader components
- [x] 09-02-PLAN.md — BrowserViewPanel assembly and AgentLayout browserSlot integration

## Progress

| Phase | Plans Complete | Status | Completed |
|-------|----------------|--------|-----------|
| 7. Screencast API | 1/1 | Complete | 2026-01-27 |
| 8. Transport Layer | 2/2 | Complete | 2026-01-27 |
| 9. Studio UI | 2/2 | Complete | 2026-01-28 |

---

## Milestone Summary

**Key Decisions:**
- WebSocket over SSE for bidirectional capability (future input injection)
- useRef pattern for frame display to avoid virtual DOM thrashing
- CDP frame ack required to prevent memory exhaustion
- typed-emitter for type-safe event emitter pattern
- @hono/node-ws for WebSocket support in Hono
- ViewerRegistry pattern: start on first viewer, stop on last viewer
- setupBrowserStream called BEFORE CORS middleware
- Exponential backoff for reconnect capped at 30s max delay
- Single BrowserViewFrame instance with CSS-only visibility toggling
- Panel rendered outside ThreadPrimitive.Viewport (survives message re-renders)
- Panel hides only on explicit user close (X button)
- everyNthFrame: 1 for headless Chrome
- BrowserToolCallsContext bridges ToolFallback and BrowserViewPanel

**Issues Resolved:**
- React Rules of Hooks violation from conditional useCallback placement
- WebSocket connection churn from dual BrowserViewFrame instances
- Panel disappearing on message re-renders (moved outside Viewport)
- Broken image icon before first frame (opacity-0 until loaded)
- Headless screencast flicker (everyNthFrame: 1, debounced hide)

**Issues Deferred:**
- None

**Technical Debt Incurred:**
- None identified during audit

---
_For current project status, see .planning/ROADMAP.md_
_Archived: 2026-01-28_
